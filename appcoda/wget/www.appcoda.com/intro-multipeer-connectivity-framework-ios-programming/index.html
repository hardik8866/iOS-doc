<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Build a Chat App Using Multipeer Connectivity Framework in iOS 7</title><link href="/prismjs/prism.css" rel="stylesheet" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<!-- This site is optimized with the Yoast WordPress SEO plugin v2.1.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Apple introduced the Multipeer Connectivity Framework in iOS 7. In this tutorial, we&#039;ll give an introduction of the framework and build a demo chat app."/>
<link rel="canonical" href="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="Apple introduced the Multipeer Connectivity Framework in iOS 7. In this tutorial, we&#039;ll give an introduction of the framework and build a demo chat app."/>
<meta name="twitter:title" content="Build a Chat App Using Multipeer Connectivity Framework in iOS 7"/>
<meta name="twitter:site" content="@appcodamobile"/>
<meta name="twitter:domain" content="AppCoda"/>
<meta name="twitter:image:src" content="http://www.appcoda.com/wp-content/uploads/2014/02/multipeer-connectivity-featured.jpg"/>
<meta name="twitter:creator" content="@appcodamobile"/>
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"WebSite","url":"http:\/\/www.appcoda.com\/","name":"AppCoda"}</script>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="AppCoda &raquo; Feed" href="http://feeds.feedburner.com/appcoda" />
<link rel="alternate" type="application/rss+xml" title="AppCoda &raquo; Comments Feed" href="http://www.appcoda.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="AppCoda &raquo; Understanding Multipeer Connectivity Framework in iOS 7 &#8211; Part 1 Comments Feed" href="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.appcoda.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.1"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f;c.supports={simple:d("simple"),flag:d("flag")},c.supports.simple&&c.supports.flag||(f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='mediaelement-css'  href='http://www.appcoda.com/wp-includes/js/mediaelement/mediaelementplayer.min.css?ver=2.16.2' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css'  href='http://www.appcoda.com/wp-includes/js/mediaelement/wp-mediaelement.css?ver=4.2.1' type='text/css' media='all' />
<link rel='stylesheet' id='eleven40-theme-css'  href='http://www.appcoda.com/wp-content/themes/eleven40/style.css?ver=2.1.2' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='http://www.appcoda.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.1.2' type='text/css' media='all' />
<link rel='stylesheet' id='ej-socialslideout-content-style-css'  href='http://www.appcoda.com/wp-content/plugins/ej-socialslider/static/slideout.css?ver=4.2.1' type='text/css' media='all' />
<link rel='stylesheet' id='et_monarch-open-sans-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' type='text/css' media='all' />
<link rel='stylesheet' id='et_monarch-css-css'  href='http://www.appcoda.com/wp-content/plugins/monarch/css/style.css?ver=1.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='codecolorer-css'  href='http://www.appcoda.com/wp-content/plugins/codecolorer/codecolorer.css?ver=0.9.9' type='text/css' media='screen' />
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/jquery/jquery.js?ver=1.11.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/wp-fluid-images//lib/fluidimage.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/ej-socialslider/static/slideout.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/optin-monster/assets/js/api.js?ver=2.1.6.6'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/qards//js/iframeResizer.min.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/qards//js/iframeResizer.contentWindow.min.js?ver=4.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.appcoda.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.appcoda.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.2.1" />
<link rel='shortlink' href='http://www.appcoda.com/?p=2975' />
<style type="text/css" id="et-social-custom-css">
				 
			</style><link rel="Shortcut Icon" href="http://www.appcoda.com/wp-content/themes/eleven40/images/favicon.ico" type="image/x-icon" />
<link rel="pingback" href="http://www.appcoda.com/xmlrpc.php" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-223304-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head>
<body class="single single-post postid-2975 single-format-standard et_monarch header-image content-sidebar"><div id="wrap"><div id="header"><div class="wrap"><div id="title-area"><p id="title"><a href="http://www.appcoda.com/">AppCoda</a></p><p id="description">Your iOS Programming Community</p></div><div class="widget-area header-widget-area"><div id="nav_menu-2" class="widget widget_nav_menu"><div class="widget-wrap"><div class="menu-default-container"><ul id="menu-default" class="menu genesis-nav-menu js-superfish"><li id="menu-item-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li id="menu-item-28" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li id="menu-item-530" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li id="menu-item-3045" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li id="menu-item-2140" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li id="menu-item-710" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div></div></div><div id="inner"><div class="wrap"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Leaderboard Responsive Ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8501671653071605"
     data-ad-slot="1756840139"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="content-sidebar-wrap"><div id="content" class="hfeed"><div class="post-2975 post type-post status-publish format-standard hentry category-course category-intermediate category-tutorials tag-ios-7 tag-ios-programming tag-multipeer-connectivity-framework tag-networking tag-xcode-5 entry"><h1 class="entry-title">Understanding Multipeer Connectivity Framework in iOS 7 &#8211; Part 1</h1> 
<div class="post-info"><span class="date published time" title="2014-02-13T13:56:32+00:00">February 13, 2014</span>  by <span class="author vcard"><span class="fn"><a href="http://www.appcoda.com/author/gabrielth/" rel="author">Gabriel Theodoropoulos</a></span></span> <span class="post-comments"><a href="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/#comments"><span class="dsq-postid" data-dsqidentifier="2975 http://www.appcoda.com/?p=2975">41 Comments</span></a></span> </div><div class="entry-content">
<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:right;margin:10px 0 10px 10px;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_300x250_iPhone_Development */
google_ad_slot = "8132041053";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<p><em>Editor&#8217;s note: This is part 1 of the Multipeer Connectivity series.</em></p>
<p>The <strong>Multipeer Connectivity Framework</strong> is one of the many new frameworks iOS 7 introduces, and it broadens the range of the applications that can be built for the new operating system. Its aim is to enable developers to create applications that will allow devices being in close distance to get connected, simply using Wi-Fi networks or Bluetooth. Great tools are offered for establishing communication between nearby devices, and for exchanging data and other resources without much effort to be required.</p>
<p>Continuing this introduction, it&#8217;s necessary to discuss a few more details about the Multipeer Connectivity framework and become more familiarized with it before we see any example of it. First of all, it&#8217;s really important to underline that this framework works <em>on nearby devices only</em>, meaning devices that use the same network infrastructure (such as Wi-Fi or Bluetooth), so don&#8217;t expect it to work for devices existing in long distance. With Multipeer Connectivity, one device is able to get connected to many other devices and communicate at the same time with all of them. A single device is called a <strong>peer</strong>. What actually takes place when a connection between two peers is established, is that a <em>Multipeer Connectivity <strong>Session</strong></em> gets created, and this session is responsible for managing the whole communication and data exchanging between peers. For multiple devices, multiple sessions can be set up.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/multipeer-connectivity-featured.jpg" alt="multipeer connectivity featured" class="aligncenter size-full wp-image-3025" /></div>
<p>Prior to any session establishment, devices (peers) need to <strong>discover</strong> one each other. Discovery is the first phase that takes place when Multipeer Connectivity is used in applications. How discovery is being made? Let&#8217;s suppose we have only two devices we want to get connected. One device at least must work as a <strong>browser</strong>, in order to search for other existing devices, and the second device must be discoverable by telling that it&#8217;s out there and wants to connect to someone, or in other words the second device must <strong>advertise</strong> itself. Normally, both devices should advertise themselves, but at least one should browse for other peers in order to establish a connection.</p>
<p>Regarding the browsing functionality especially, Apple provides two ways to use it. The first and easy one, is a browsing UI built-in directly into the framework, which when is called a modal view is displayed listing all available and connected devices to the one that works as a browser. The second way offers greater flexibility to developers, as it&#8217;s a totally programmatic way, so one can implement customized browsing according to the needs of the application. Later on we will use the first way only, as this is an introductory tutorial about this framework.<br />
<span id="more-2975"></span><br />
Once the discovery of other peers has been done, the peer that locates the advertiser sends a message asking to establish a connection. If the second one (the advertiser) accepts that, then a session is created and both peers are ready to exchange data.</p>
<p>Talking about data, there are three kinds of data that can be sent and received using the Multipeer Connectivity framework. These are:</p>
<ul>
<li>Messages (including text, images, and everything else that can be converted to a <em>NSData</em> object)</li>
<li>Streaming</li>
<li>Resources</li>
</ul>
<p>Going into some more details about messages, there are two modes that can be used for data transmission: The <em>reliable</em> and the <em>unreliable</em> mode. Using the reliable mode to send data, the framework makes sure that everything will arrive to the receiver, and in the order been sent. The cost of this reliable data sending though, is that is required more time for the transmission to be completed. On the other hand, when using the unreliable mode, data is send in no-time, really fast, but there is no guarantee that everything will arrive to the other peer, and of course, data is not sent in order. Which way is the most preferable clearly depends on the requirements of each application, so it&#8217;s up to every developer to decide what mode will use.</p>
<p>Generally, the Multipeer Connectivity framework offers classes and libraries for high-level development, so no C or other kind of low-level programming is required. Under the hood, many features are built-in ready to be used, taking away any hassle caused by implementing or addressing any network-related issues. In this tutorial we won&#8217;t consume any more time in theoretical presentation of the framework, therefore you are strongly advised to visit <a href="https://developer.apple.com/library/ios/documentation/MultipeerConnectivity/Reference/MultipeerConnectivityFramework/Introduction/Introduction.html">Apple&#8217;s documentation</a> and do some study, and of course, watch the <a href="https://developer.apple.com/wwdc/">WWDC 2013</a> Session 708 video. Note that for testing the Multipeer Connectivity framework you need to have at least two devices, or use one device and the iPhone Simulator.</p>
<p>To see how easily the Multipeer Connectivity feature can be put in action and how it lets devices communicate, just keep reading!</p>
<h2>Demo App Overview</h2>
<p>In this tutorial we will create a sample application for demonstrating the most important aspects of the Multipeer Connectivity framework. I mentioned previously that there are three kinds of data that can be exchanged using it: Messages, streaming and resources. In the demo application that we are going to implement, we will see how to send messages, meaning NSData objects from device to device, and how to share resources, such as files. However, before we start building, we need to take a quick look on what exactly the demo app is about.</p>
<p>We are going to create a <em>tabbed</em> application, with three tabs in total. Starting on purpose from the last one, titled <strong>My Connections</strong>, we will create a view controller to manage the peer (device) naming, the advertising and all the connections (the sessions actually) of the device. Specifically, using a <em>text field</em>, we&#8217;ll be able to set a custom name for the device that will appear to other peers. A <em>button</em> will display the default browser UI when it&#8217;s tapped, while a <em>switch</em> control will toggle the advertising functionality of the device. In a <em>table view</em> they will be listed all of our connections. Under the table view there will be one more <em>button</em>, which will be used to disconnect the device from the session. The next figure presents a synopsis of the view controller:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_1_tab3.jpg" alt="Multipeer Connectivity Demo App1" class="aligncenter size-full wp-image-2982" /></div>
<p>Behind the first tab is going to be another view controller. This one will be titled <strong>Chat Box</strong> and it will be used for sending text messages among devices using the Multipeer Connectivity. It will consist of a <em>text field</em> where the message will be written, a <em>text view</em> where the whole chat will appear, and a couple of <em>buttons</em>, one for sending the message and one for cancelling it. Here is a screenshot of it:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_2_tab1.jpg" alt="Multipeer Connectivity Demo App2" class="aligncenter size-full wp-image-2983" /></div>
<p>Lastly, one more view controller is going to lie behind the second tab, titled <strong>File Sharing</strong>. Here a <strong>table view</strong> will contain a list of some (sample) files. When a row is selected, then an <em>action sheet</em> will be displayed with all the peer names as its options. By selecting a peer, the selected file will be sent directly to it. To make it more attractive and more interactive, the file name, the sender and a progress view showing the progress of the file being received will be shown to the last row of the table view when a device receives a file. When it sends one, then right next to the file name a percentage showing the progress of the sending will appear. Here is the view controller behind the second tab in its initial state:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_3_tab2.jpg" alt="Multipeer Connectivity Demo App3" class="aligncenter size-full wp-image-2984" /></div>
<p>I presented all the view controllers of the demo application starting from the third tab in purpose, as the view controller behind it is the most important for us in this tutorial. Through it, we will see how the discovery and session establishment phases are handled and managed.</p>
<p>Before we reach the end of this brief app presentation, there is something more quite important I necessarily need to say. In order for the Multipeer Connectivity options to be app-wide and in order to avoid repeating building the same functionality three times (for each view controller separately), we will create a <em>class</em> for managing all the framework-related objects and tasks. In the application delegate (AppDelegate) class then we will initialize an object of this class. Also, through the application delegate we will access this object across the application. After all, it&#8217;s a terrible programming practice to develop something multiple times, instead of build it just once and use it as a tool.</p>
<p>So, after having walked through the application we are going to develop, it&#8217;s time to start working on it. You may download the two sample files at the end of this tutorial if you want to build step by step. Alternatively, get the full demo application provided for your own convenience, but stay put for all code details.</p>
<h2>Demo App Creation</h2>
<p>Launch Xcode and create a new project by clicking on the respective button at the left side of the Welcome screen:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_4_xcode_welcome.jpg" alt="Xcode Welcome Dialog" class="aligncenter size-full wp-image-2986" /></div>
<p>At the first step of the guide, select the <strong>Tabbed Application</strong> option in the <strong>Application</strong> category, under the <strong>iOS</strong> section.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_5_template1.jpg" alt="Xcode New Project Template" class="aligncenter size-full wp-image-2987" /></div>
<p>Click on the Next button to move to the next step of the guide. I named the app <strong>MCDemo</strong> in the <strong>Product Name</strong> field, but feel free to name it otherwise if you&#8217;d like. Besides that, make sure that in the <strong>Devices</strong> drop down menu, the <strong>iPhone</strong> option is selected. Leave everything else as it is and proceed by clicking on the Next button.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_6_template2.jpg" alt="Xcode Project Options" class="aligncenter size-full wp-image-2988" /></div>
<p>Finally, select a destination for your project and click on the Create button to end this guide. The project is now ready.</p>
<h2>Adding New Tab</h2>
<p>As I have already said, the application will consist of three tabs in total, but by default there are only two. So, our first task is to create a new tab and to connect it with a new class we will add to the project. Also, further than that we will set all tab titles and icons.</p>
<p>Begin by adding a new <em>UIViewController</em> class to the project for the third tab that we will add in a while. On the <strong>Project Navigation</strong>, Ctrl-click or right-click on the MCDemo group and from the popup menu select the <strong>New File&#8230;</strong> option, as shown in the next figure:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_7_new_file.jpg" alt="Multipeer Connectivity - Add New File" class="aligncenter size-full wp-image-2989" /></div>
<p>Under the <strong>iOS</strong> section, make sure that the <strong>Cocoa Touch</strong> category is selected. Then, select the <strong>Objective-C class</strong> icon and click on the Next button to proceed.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_8_new_file1.jpg" alt="Multipeer Connectivity - Add New File" class="aligncenter size-full wp-image-2990" /></div>
<p>In the <strong>Class</strong> field, set the <strong>ConnectionsViewController</strong> value. Also, make sure that the <strong>UIViewController</strong> value is filled in the <strong>Subclass of</strong> field. Do not check any of the other two options. Click on the Next to move to the next step.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_9_new_file2.jpg" alt="Multipeer Connectivity - Add New File" class="aligncenter size-full wp-image-2991" /></div>
<p>At the last step click on the Create button and you are ready. You should now see the <em>ConnectionsViewController.h</em> and <em>ConnectionsViewController.m</em> files on the Project Navigator.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_10_new_files.jpg" alt="Multipeer Connectivity - Add New File" class="aligncenter size-full wp-image-2992" /></div>
<p>Click now on the <em>Main.storyboard</em> file to let it open on the Interface Builder. As a first step, add a new view controller, by dragging it from the Object Library and dropping it to the canvas, right below the second view controller scene.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_11_third_vc.jpg" alt="Multipeer Connectivity - Designing Interface" class="aligncenter size-full wp-image-2993" /></div>
<p>Next, keep the Ctrl key on the keyboard down, click on the <em>Tab Bar Controller</em> scene, and without leaving the mouse button drag the mouse on the new scene we just added to the interface. Release both the Ctrl key and the mouse button. A black, popup window will appear, where under the <strong>Relationship Segue</strong> section you must click on the <strong>view controllers</strong> option, so as the new view controller to be added as a tab to the tab bar controller.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_12_connect_to_tabbar1.jpg" alt="Multipeer Connectivity - Designing Interface" class="aligncenter size-full wp-image-2994" /></div>
<p>The tab bar controller now contains three tabs, and our new scene has been connected to it. We need now to set the <em>ConnectionsViewController</em> class we added earlier as the class for the new view controller. To do so, click on the new view controller scene, and in the <strong>Utilities Pane</strong>, open the <strong>Identity Inspector</strong>  and in the <strong>Custom Class</strong> section start writing <em>Connect&#8230;</em> in the <strong>Class</strong> field. Xcode will automatically complete it for you.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_14_set_class.jpg" alt="Multipeer Connectivity - Set Class Name" class="aligncenter size-full wp-image-2996" /></div>
<p>Finally, we just have to set the correct titles to the tabs. To set a tab&#8217;s title, you must first select the tab on the scene (and not on the tab bar controller) you want to modify. Then, go once again on the Utilities pane, open the <strong>Attributes Inspector</strong> and under the <strong>Bar Title</strong> section set the title in the <strong>Title</strong> field.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_15_set_title.jpg" alt="Multipeer Connectivity - Set Title" class="aligncenter size-full wp-image-2997" /></div>
<p>Set the following titles:</p>
<ul>
<li>First View Controller: <strong>Chat Box</strong></li>
<li>Second View Controller: <strong>File Sharing</strong></li>
<li>Connections View Controller: <strong>My Connections</strong></li>
</ul>
<p>Note that any visual configuration on Interface Builder made in this tutorial is targeted for 4&#8243; screen devices, such as iPhone 5 or 5S. If you want to make the application run on older devices with a 3.5&#8243; screen size, just play around by applying the suggested constraints by Xcode and you&#8217;ll easily manage to have it running in these devices as well.</p>
<h2>Connections View Controller: Setup the Interface</h2>
<p>Now that the third tab, along with its respective view controller have been added, it&#8217;s time to start building our application beginning from the view controller of the last tab, the Connections View Controller. Our first mission is to setup its interface, as well as to declare and connect any required IBOutlet properties and IBAction methods. So, while being in the Interface Builder, drag and drop the controls presented right next from the Objects Library into the Connections View Controller scene. Note that for each control are provided all the properties you should modify:</p>
<ol>
<li><strong>UITextField</strong>
<ul>
<li>Frame: X=20, Y=20, Width=280, Height=30</li>
<li>Placeholder: <em>The device name displayed to others&#8230;</em></li>
</ul>
</li>
<li><strong>UILabel</strong>
<ul>
<li>Frame: X=20, Y=63, Width=180, Y=21</li>
<li>Text: <em>Visible to others?</em></li>
</ul>
</li>
<li><strong>UISwitch</strong>
<ul>
<li>Frame: X=251, Y=58, Width=51, Y=31</li>
<li>State: ON
</ul>
</li>
<li><strong>UIButton</strong>
<ul>
<li>Frame: X=94, Y=92, Width=132, Y=30</li>
<li>Title: <em>Browse for devices</em></li>
</ul>
</li>
<li><strong>UITableView</strong>
<ul>
<li>Frame: X=0, Y=130, Width=320, Y=352</li>
</ul>
</li>
<li><strong>UIButton</strong>
<ul>
<li>Frame: X=121, Y=490, Width=78, Y=30</li>
<li>Text: <em>Disconnect</em></li>
<li>Enabled: False (Unchecked)</li>
</ul>
</li>
</ol>
<p>After adding all the above, here is how your scene should look like:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_16_third_scene.jpg" alt="Multipeer Connectivity - UI" class="aligncenter size-full wp-image-2998" /></div>
<p>Let&#8217;s declare now some IBOutlet properties and some IBAction methods. Open the <em>ConnectionsViewController.h</em> file, and add the next properties in the interface body:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UITextField <span style="color: #002200;">*</span>txtName;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UISwitch <span style="color: #002200;">*</span>swVisible;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UITableView <span style="color: #002200;">*</span>tblConnectedDevices;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UIButton <span style="color: #002200;">*</span>btnDisconnect;</div></td></tr></tbody></table></div>
<p>Also, add these IBAction methods:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>browseForDevices<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>toggleVisibility<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>disconnect<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;</div></td></tr></tbody></table></div>
<p>Fine. Now head back to the <em>Main.storyboard</em> to connect them to the appropriate controls. To do that, make sure that the <strong>Document Outline Pane</strong> is shown. Next, Ctrl-click or right-click on the <strong>Connections View Controller &#8211; Connections</strong> object, and a black, popup window will appear. Next to each property (and each IBAction method) there is a circle. <em>Click on this circle next to an IBOutlet property, and without releasing the mouse button, drag and drop to the respective control on the scene</em>. The following figure illustrates exactly that:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_17_iboutlet_connection.jpg" alt="Multipeer Connectivity - Setup IBOutlet" class="aligncenter size-full wp-image-2999" /></div>
<p>The connections should be done as follows:</p>
<ul>
<li>The <em>txtName</em> property goes to the UITextField object.</li>
<li>The <em>swVisible</em> property goes to the UISwitch object.</li>
<li>The <em>tblConnectedDevices</em> property goes to the UITableView object.</li>
<li>The <em>btnDisconnect</em> property goes to the second UIButton (titled Disconnect) object.</li>
</ul>
<p>For the rest objects on the scene we don&#8217;t need to use IBOutlet properties.</p>
<p>Using the same method as above, connect the declared IBAction methods to the appropriate controls. Here is how you should match the methods with the controls:</p>
<ul>
<li>The <em>browseForDevices:</em> method should connect to the first UIButton (titled <em>Browse for devices</em>) object.</li>
<li>The <em>toggleVisibility:</em> method should connect to the UISwitch object.</li>
<li>The <em>disconnect:</em> method should connect to the second UIButton object.</li>
</ul>
<p>The interface for the Connections View Controller is now ready. We will discuss about the functionality and the purpose of each control we just added later. For the time being, we have to focus for first time on the Multipeer Connectivity framework details.</p>
<h2>A Multipeer Connectivity Framework-Related Class</h2>
<p>Right now we are going to do a big turn, as we will leave behind us the Interface Builder and any visual setup, and we will focus totally on code. In this section our goal is to create a new class, in which we will implement all framework-related logic, we will use any required framework classes and we will perform any necessary tasks. Note that it&#8217;s not required by the framework to do so, however this is the most convenient way for this sample application to perform app-wide tasks without having to re-write the same code more than once.</p>
<p>Before doing all these, the new class must be created, so Ctrl-click or Right-click on the MCDemo group in the Project Navigator, and from the popup menu select the <strong>New File&#8230;</strong> option, or simply press Command-N on your keyboard.</p>
<p>In the guide that appears, select the <strong>Objective-C class</strong> option as the template for the new file. Click Next to proceed. Next, at the <strong>Subclass of</strong> field, set the <strong>NSObject</strong> value. Right above, in the <strong>Class</strong> field, you must write the name of the new class. I named it <strong>MCManager</strong>, and it would be a good idea you name it the same, just to follow properly this tutorial.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_18_mcmanager_create.jpg" alt="Multipeer Connectivity - Create new class mcmanager" class="aligncenter size-full wp-image-3000" /></div>
<p>Finally, click on the Next, and then click on the Create button to add the new class into the project. The <em>MCManager.h</em> and <em>MCManager.m</em> files should now be listed on the Project Navigator.</p>
<p>Let&#8217;s write some code now. Open the <em>MCManager.h</em> to declare some required objects. Before doing that however, we must import the Multipeer Connectivity library to our project, therefore head at the top of the file and add the next one:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &lt;MultipeerConnectivity/MultipeerConnectivity.h&gt;</span></div></td></tr></tbody></table></div>
<p>As you see, I didn&#8217;t add the framework manually to the project, but I directly used it. The compiler will do that for us, thanks to a new feature that incorporates, named <em>Auto Linking</em>.</p>
<p>Now, modify the interface header line to adopt the <em>MCSesssionDelegate</em> protocol as follows:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> MCManager <span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/"><span style="color: #400080;">NSObject</span></a> &lt;MCSessionDelegate&gt;</div></td></tr></tbody></table></div>
<p>After doing so, declare the next objects:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> MCPeerID <span style="color: #002200;">*</span>peerID;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> MCSession <span style="color: #002200;">*</span>session;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> MCBrowserViewController <span style="color: #002200;">*</span>browser;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> MCAdvertiserAssistant <span style="color: #002200;">*</span>advertiser;</div></td></tr></tbody></table></div>
<p>The <em>peerID</em> object represents the device and it contains various properties needed for the discovery and session establishment phases. The <em>session</em> object is the most important one, as it represents the session that the current peer (the device that this app will run) will create. Any data exchanging and any communication details are controlled by this object. The <em>browser</em> object is actually representing the default UI provided by Apple for browsing for other peers, and we will use it for this purpose. For more advanced handling of the browsing feature of the framework, Apple provides a programmatic alternative way, but for now it&#8217;s out of the scope of this tutorial. Finally, there is the <em>advertiser</em> object, which is used from the current peer to advertise itself and make its discovery feasible.</p>
<p>Notice that the classes of all these objects belong to the Multipeer Connectivity framework. You&#8217;ll see how we will use them, but for now let&#8217;s declare some public methods that we&#8217;ll need later as well:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>setupPeerAndSessionWithDisplayName<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>displayName;<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>setupMCBrowser;<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>advertiseSelf<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">BOOL</span><span style="color: #002200;">&#41;</span>shouldAdvertise;</div></td></tr></tbody></table></div>
<p>Now head to the <em>MCManager.m</em> file, and for starters add the next <em>init</em> method for initialising our class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>init<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; self <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>super init<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>self<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; _peerID <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; _session <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; _browser <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; _advertiser <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> self;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>At this point, Xcode should normally be complaining and displaying some warnings. Those are because we haven&#8217;t implemented the public methods yet, and also because we didn&#8217;t add any delegate methods of the <em>MCSessionDelegate</em> protocol. Let&#8217;s silence all of them, first by adding all necessary delegate methods:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session peer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID didChangeState<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSessionState<span style="color: #002200;">&#41;</span>state<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session didReceiveData<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>data fromPeer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session didStartReceivingResourceWithName<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>resourceName fromPeer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID withProgress<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSProgress <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>progress<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session didFinishReceivingResourceWithName<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>resourceName fromPeer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID atURL<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>localURL withError<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>error<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session didReceiveStream<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSInputStream_Class/"><span style="color: #400080;">NSInputStream</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>stream withName<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>streamName fromPeer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Even though it&#8217;s obvious by the delegate method names what they are all about, let me make a quick reference on them. The first method is called when a peer changes its state, meaning when it&#8217;s connected or disconnected. There are three states: <em>MCSessionStateConnected</em>, <em>MCSessionStateConnecting</em> and <em>MCSessionStateNotConnected</em>. The last state is valid even when a peer gets disconnected from our session. Generally this delegate method is called when the peer state is modified. The second delegate method is called when new data arrives from a peer. Remember that three kinds of data can be exchanged; messages, streaming and resources. This one is the delegate for messages. The next couple of methods are called when a resource is received, and finally the last one is invoked for incoming streams. In this tutorial we&#8217;ll use all of them, except for the last one.</p>
<p>Let&#8217;s go to the public method implementation now. Begin with the next code fragment, and we&#8217;ll talk about it in a while.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>setupPeerAndSessionWithDisplayName<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>displayName<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; _peerID <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>MCPeerID alloc<span style="color: #002200;">&#93;</span> initWithDisplayName<span style="color: #002200;">:</span>displayName<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _session <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>MCSession alloc<span style="color: #002200;">&#93;</span> initWithPeer<span style="color: #002200;">:</span>_peerID<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; _session.delegate <span style="color: #002200;">=</span> self;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>First of all, the <em>peerID</em> object is initialised, as everything is based on it. The <em>displayName</em> string value that is provided to the init method (and as parameter to the method) concerns the name of the device as it will appear to other peers. This can be the device&#8217;s name (such as &#8216;John&#8217;s iPhone&#8217;), or a custom name. If you recall, we added a text field in our interface for this purpose, and we&#8217;ll see more about it later.</p>
<p>Next, we initialise the <em>session</em> object, the most important one as everything depends on it. We provide it with the <em>peerID</em> for initialisation and we make our class its delegate in the last line.</p>
<p>Let&#8217;s continue:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>setupMCBrowser<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; _browser <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>MCBrowserViewController alloc<span style="color: #002200;">&#93;</span> initWithServiceType<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;chat-files&quot;</span> session<span style="color: #002200;">:</span>_session<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>This method contains just one, but an important line. It is the initialisation of the default, pre-made by Apple view controller that displays a browser for searching other peers. It accepts two parameters upon initialisation: The <em>serviceType</em> defines the type of service that the browser should look for, and it&#8217;s a small text that describes it. This text should be the same for both the browser and the advertiser in order for the first one to be able to discover the second. There are two rules about its name:</p>
<ol>
<li>Must be 115 characters long.</li>
<li>Can contain only ASCII lowercase letters, numbers, and hyphens.</li>
</ol>
<p>The second parameter is the session object initialised on the previous method.</p>
<p>One more public method to go:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>advertiseSelf<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">BOOL</span><span style="color: #002200;">&#41;</span>shouldAdvertise<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>shouldAdvertise<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; _advertiser <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>MCAdvertiserAssistant alloc<span style="color: #002200;">&#93;</span> initWithServiceType<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;chat-files&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;discoveryInfo<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;session<span style="color: #002200;">:</span>_session<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_advertiser start<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_advertiser stop<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; _advertiser <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>We are going to use this public method for toggling the advertising feature of the device. As you notice, the parameter defines whether the device should advertise itself or not, depending on the settings of our app. Remember that we added a UISwitch object for making our peer visible/invisible to others.</p>
<p>When we want the advertiser on, we initialise it and we start it. Note the <em>serviceType</em> text that matches to the browser&#8217;s one. When we want to turn off the advertiser, we simply stop it and we make our object nil.</p>
<p>So, for now our class is ready to be used as a tool. We&#8217;ll visit it many times along the way, as we&#8217;ll add code to the delegate methods of the session. Maybe not everything makes sense to you, but don&#8217;t worry, all will become clear upon usage.</p>
<p>One last thing we have left to do, and that is to go to the <em>AppDelegate.h</em> file and declare an object of our class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> MCManager <span style="color: #002200;">*</span>mcManager;</div></td></tr></tbody></table></div>
<p>Don&#8217;t forget however to import the class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &quot;MCManager.h&quot;</span></div></td></tr></tbody></table></div>
<p>After that, open the <em>AppDelegate.m</em> file and inside the <em>application:didFinishLaunchingWithOptions:</em> delegate method add the next initialising line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">BOOL</span><span style="color: #002200;">&#41;</span>application<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UIApplication <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>application didFinishLaunchingWithOptions<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSDictionary_Class/"><span style="color: #400080;">NSDictionary</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>launchOptions<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Override point for customization after application launch.</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _mcManager <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>MCManager alloc<span style="color: #002200;">&#93;</span> init<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">YES</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>We are now in position to use our class through the object of the application delegate. Let&#8217;s go ahead to put Mutlipeer Connectivity in action!</p>
<h2>The Discovery Phase</h2>
<p>The browser view controller is going to be displayed through the <em>ConnectionsViewController</em> class we previously created, therefore we need to make it conform to the <em>MCBrowserViewControllerDelegate</em> protocol in order to be able to handle the browser. Go to the <em>ConnectionsViewController.h</em> file and import the Multipeer Connectivity framework, just like you did in the MCManager class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &lt;MultipeerConnectivity/MultipeerConnectivity.h&gt;</span></div></td></tr></tbody></table></div>
<p>Next, modify the interface header as follows:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ConnectionsViewController <span style="color: #002200;">:</span> UIViewController &lt;MCBrowserViewControllerDelegate&gt;</div></td></tr></tbody></table></div>
<p>I have already mentioned a couple of times that we will use our custom class (the MCManager class) through the application delegate. That means that we need access to it, so go to the <em>ConnectionsViewController.m</em> file, right into the private section of the interface. In there declare the next object:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> AppDelegate <span style="color: #002200;">*</span>appDelegate;</div></td></tr></tbody></table></div>
<p>Don&#8217;t worry if Xcode shows an error. You just have to make the following import:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &quot;AppDelegate.h&quot;</span></div></td></tr></tbody></table></div>
<p>Now we can access the <em>mcManager</em> object of the application delegate. How? To see that go straight ahead to the <em>viewDidLoad</em> method. In there we will add three lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>super viewDidLoad<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _appDelegate <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>AppDelegate <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>UIApplication sharedApplication<span style="color: #002200;">&#93;</span> delegate<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>_appDelegate mcManager<span style="color: #002200;">&#93;</span> setupPeerAndSessionWithDisplayName<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>UIDevice currentDevice<span style="color: #002200;">&#93;</span>.name<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>_appDelegate mcManager<span style="color: #002200;">&#93;</span> advertiseSelf<span style="color: #002200;">:</span>_swVisible.isOn<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>In the first line we instantiate the <em>appDelegate</em> object using the <em>sharedApplication</em> class method. After doing so, we are able to call any required public methods of the <em>mcManager</em> object, and that&#8217;s exactly we are doing right next. The <em>setupPeerAndSessionWithDisplayName:</em> method is being called, and as we are in the initialisation of our class, as the display name of our device we specify its actual name. During execution, if no custom name is set to the text field, then this name will appear to the other peers. Finally, we call the <em>advertiseSelf:</em> method with the current state of our switch, to either enable or keep nil the advertiser object.</p>
<p>Let&#8217;s implement the browser view controller appearance now, by adding the necessary code to the <em>browseForDevices:</em> IBAction method. Add the next code fragment in your <em>ConnectionsViewController.m</em> file:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>browseForDevices<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>_appDelegate mcManager<span style="color: #002200;">&#93;</span> setupMCBrowser<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>_appDelegate mcManager<span style="color: #002200;">&#93;</span> browser<span style="color: #002200;">&#93;</span> setDelegate<span style="color: #002200;">:</span>self<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self presentViewController<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>_appDelegate mcManager<span style="color: #002200;">&#93;</span> browser<span style="color: #002200;">&#93;</span> animated<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span> completion<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Using the first line, we call the <em>setupMCBrowser</em> public method of the <em>MCManager</em> class. Next, we set self (this class) as its delegate and finally we modally present it. After having this method implemented, the button with title <em>Browse for devices</em> is going to perfectly work, and if you compile and run the application and tap on that button, here is what you should expect to see:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_20_browser_running.jpg" alt="Multipeer Connectivity - Browser Running" class="aligncenter size-full wp-image-3002" /></div>
<p>Great! We just took our first taste from the Multipeer Connectivity framework. However, if you try to use the Done or Cancel button of the view controller, you&#8217;ll find out that they are not working. To enable them, we must implement two delegate methods of the <em>MCBrowserViewControllerDelegate</em>. So, turn back to Xcode and add these two methods:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>browserViewControllerDidFinish<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCBrowserViewController <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>browserViewController<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager.browser dismissViewControllerAnimated<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span> completion<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>browserViewControllerWasCancelled<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCBrowserViewController <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>browserViewController<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager.browser dismissViewControllerAnimated<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span> completion<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>When tapping on the Done button of the view controller, we simply want to dismiss it, and similarly want the browser to act when the Cancel button is tapped. Therefore, both of these methods contain the same code, just for dismissing the browser view controller. The first method is the delegate for the Done button, and the second one is the delegate for the Cancel button.</p>
<p>Before going any further, just note how we access the <em>browser</em> object using this:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">_appDelegate.mcManager.browser</div></td></tr></tbody></table></div>
<p>Now, both buttons of the browser view controller are perfectly working. However, the Done button is disabled and you cannot test it yet, unless another device is discovered and gets connected to the current one. Before we see that though, let&#8217;s implement two more functionalities: How to set a custom name for the device and how to enable/disable the advertiser.</p>
<h2>Peer Display Name And The Advertiser State</h2>
<p>Let&#8217;s start from the text field. Go to the <em>ConnectionsViewController.h</em> file and adopt the <em>UITextFieldDelegate</em> protocol, as shown in the next line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ConnectionsViewController <span style="color: #002200;">:</span> UIViewController &lt;MCBrowserViewControllerDelegate, UITextFieldDelegate&gt;</div></td></tr></tbody></table></div>
<p>Now, in the <em>viewDidLoad</em> method inside the <em>ConnectionsViewController.m</em> file, add the next one:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_txtName setDelegate<span style="color: #002200;">:</span>self<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>We will implement the <em>textFieldShouldReturn:</em> delegate method of the text field, because we want the keyboard to be disappeared when the Return button is tapped and the <em>peerID</em> object of the MCManager class to get the name we set to the text field. However, in the <em>viewDidLoad</em> method we have already initialised both the <em>peerID</em> and the <em>session</em> objects, so first we need to set them to nil and then reinitialise them using the specified name by calling the <em>setupPeerAndSessionWithDisplayName:</em> method. Here is the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">BOOL</span><span style="color: #002200;">&#41;</span>textFieldShouldReturn<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITextField <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>textField<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_txtName resignFirstResponder<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _appDelegate.mcManager.peerID <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; _appDelegate.mcManager.session <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; _appDelegate.mcManager.browser <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span>_swVisible isOn<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager.advertiser stop<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; _appDelegate.mcManager.advertiser <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager setupPeerAndSessionWithDisplayName<span style="color: #002200;">:</span>_txtName.text<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager setupMCBrowser<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager advertiseSelf<span style="color: #002200;">:</span>_swVisible.isOn<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">YES</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Note that we check if the advertiser is on, and if that&#8217;s the case we first stop it and then we set the respective object to nil.</p>
<p>There is an important fact that I should point out here. Once our device is connected to another peer, we shouldn&#8217;t change its display name, as a session would have been already established and any data exchange might be in progress. Therefore, in order to protect us from changing name while the device is connected, we will keep the text field disabled. Only when there is no connection to other peers the text field will be enabled, and we are going to associate this functionality with the Disconnect button later on. More specifically, once a connection gets established, the text field will become disabled, and when the Disconnect button is used to stop a connection, it will become enabled again. So, for now, just keep this in mind and let&#8217;s move forward.</p>
<p>Let&#8217;s make the switch control now to enable and disable the advertiser. Implement the following IBAction method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>toggleVisibility<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager advertiseSelf<span style="color: #002200;">:</span>_swVisible.isOn<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Pretty simple implementation, right? We just call the <em>advertiseSelf</em> method to set the advertiser&#8217;s state according to the switch&#8217;s state.</p>
<p>If you test the application now (in two devices or in one device and in the Simulator), you can play around with the peer discovery and the two more functionalities we added here. Here are some screenshots:</p>
<p>When a nearby device is found:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_21_nearby_device.jpg" alt="Search for Nearby Devices" class="aligncenter size-full wp-image-3003" /></div>
<p>Using the switch to turn on/off the advertising feature of the second device:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_22_advertising.jpg" alt="Multipeer Advertising" class="aligncenter size-full wp-image-3004" /></div>
<p>Changing the display name of the device:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_23_change_device_name.jpg" alt="Multipeer - Changing Device Name" class="aligncenter size-full wp-image-3005" /></div>
<p>Note that the display name of the device, as well as the advertiser&#8217;s state can be changed, as we still haven&#8217;t made any connections. In the next part we are going to do exactly that. We will also see how we can get notified about the connected peers, how to show the other peer&#8217;s display name on the table view and how to make the Disconnect button work.</p>
<h2>Making a Connection</h2>
<p>Making a connection is really simple. In the browser view controller, you just have to tap on a nearby device&#8217;s name and wait until it gets connected. The view controller displays the status of the connections, changing from the Not Connected to Connecting and finally to the Connected state. Once this happens, the Done button becomes enabled.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_24_making_connection.jpg" alt="Multipeer - Making Connection" class="aligncenter size-full wp-image-3006" /></div>
<p>On the other device an alert view similar to the next one appears, prompting the user to accept or decline the connection:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_25_accept_connection.jpg" alt="Multipeer - Accept Connection" class="aligncenter size-full wp-image-3007" /></div>
<p>Once the user taps on the Accept button, the connection gets established. The important now is how we can handle it, and first of all, how we can be notified about the other peer connection state all the time. Thankfully, the Multipeer Connectivity framework gives us some <em>MCSession</em> delegate methods, which we implemented previously in the <em>MCManager</em> class, without having written any code though.</p>
<p>So, open the <em>MCManager.m</em> file and locate the <em>session:peer:didChangeState:</em> method. This one is called when a new connection takes place, and is our job to handle the info that provides. What we are going to do in our case is quite simple: As this is a class other than the one that we use to manage our connections (the <em>ConnectionsViewController</em> class), we will post a <em>notification</em> to let the latter know about the peer state changing, and along with the notification we will post all the provided info. Let&#8217;s see the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session peer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID didChangeState<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSessionState<span style="color: #002200;">&#41;</span>state<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSDictionary_Class/"><span style="color: #400080;">NSDictionary</span></a> <span style="color: #002200;">*</span>dict <span style="color: #002200;">=</span> @<span style="color: #002200;">&#123;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;peerID&quot;</span><span style="color: #002200;">:</span> peerID,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;state&quot;</span> <span style="color: #002200;">:</span> <span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNumber_Class/"><span style="color: #400080;">NSNumber</span></a> numberWithInt<span style="color: #002200;">:</span>state<span style="color: #002200;">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #002200;">&#125;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotificationCenter_Class/"><span style="color: #400080;">NSNotificationCenter</span></a> defaultCenter<span style="color: #002200;">&#93;</span> postNotificationName<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;MCDidChangeStateNotification&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; object<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; userInfo<span style="color: #002200;">:</span>dict<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>At first, we create a <em>NSDictionary</em> object and we set the <em>peerID</em> and <em>state</em> parameter values as its contents. Next, we post a notification with the <em>MCDidChangeStateNotification</em> name and the <em>dict</em> object as its user info dictionary. By doing all these, we make sure that every time a peer&#8217;s state gets changed, our class will know it.</p>
<p>However, for the time being, only the half job has been done. We need to make the <em>ConnectionsViewController</em> class to observe for this notification and act appropriately when one arrives. So, open the <em>ConnectionsViewController.m</em> file, and head to the <em>viewDidLoad</em> method. Add the next content to it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotificationCenter_Class/"><span style="color: #400080;">NSNotificationCenter</span></a> defaultCenter<span style="color: #002200;">&#93;</span> addObserver<span style="color: #002200;">:</span>self<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selector<span style="color: #002200;">:</span><span style="color: #a61390;">@selector</span><span style="color: #002200;">&#40;</span>peerDidChangeStateWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;MCDidChangeStateNotification&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;object<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>With this command, we let our class observe for the specific notification. When such a notification arrives, a method should be called and any actions that need to be taken, should be written in that method. In our case, this is the <em>peerDidChangeStateWithNotification:</em>, and it&#8217;s a custom private method that we will declare right now. Go to the private section of the interface, and add the next declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ConnectionsViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
...<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>peerDidChangeStateWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>notification;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Next, we must implement it, but let&#8217;s discuss about it for a moment. What do we want to do when a new connection is being made? Simply to add the connected peer&#8217;s display name to the table view, to enable the Disconnect button and to disable the text field (I explained earlier why). On the other hand, when a peer is disconnected, we simply have to remove its name from the table view, and if no other peers exist, to disable the Disconnect button and enable the text field.</p>
<p>In order to do all that, we need an array that will be used as the datasource for our table view. Therefore, let&#8217;s declare and initialise this array, and then we will be able to implement the private method.</p>
<p>Go once again at the private section of the interface and add the next declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ConnectionsViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
...<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/"><span style="color: #400080;">NSMutableArray</span></a> <span style="color: #002200;">*</span>arrConnectedDevices;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Then, in the <em>viewDidLoad</em> method initialise it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _arrConnectedDevices <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/"><span style="color: #400080;">NSMutableArray</span></a> alloc<span style="color: #002200;">&#93;</span> init<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Also, in order our table view to respond to everything we want, we must set our class as its delegate and its datasource. So, while being in the <em>viewDidLoad</em> method, add the next two lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_tblConnectedDevices setDelegate<span style="color: #002200;">:</span>self<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_tblConnectedDevices setDataSource<span style="color: #002200;">:</span>self<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Xcode will issue now some new warnings for these two commands. That&#8217;s because we haven&#8217;t adopted two required protocols, the <em>UITableViewDelegate</em> and the <em>UITableViewDatasource</em>. To fix this, go to the <em>ConnectionsViewController.h</em> file, and modify the interface header line, just as follows:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ConnectionsViewController <span style="color: #002200;">:</span> UIViewController &lt;MCBrowserViewControllerDelegate, UITextFieldDelegate, UITableViewDelegate, UITableViewDataSource&gt;</div></td></tr></tbody></table></div>
<p>Now we are totally ready to implement our private method that will be called when a notification arrives. Open once again the <em>ConnectionsViewController.m</em> file, and start with these lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>peerDidChangeStateWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>notification<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; MCPeerID <span style="color: #002200;">*</span>peerID <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>notification userInfo<span style="color: #002200;">&#93;</span> objectForKey<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;peerID&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>peerDisplayName <span style="color: #002200;">=</span> peerID.displayName;<br />
&nbsp; &nbsp; MCSessionState state <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>notification userInfo<span style="color: #002200;">&#93;</span> objectForKey<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;state&quot;</span><span style="color: #002200;">&#93;</span> intValue<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>What we do here is not hard to be understood. We just get the two objects from the user info dictionary (<em>peerID</em> and <em>state</em>), and we keep the display name of the connected peer to a NSString object. Let&#8217;s keep going:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>peerDidChangeStateWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>notification<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>state <span style="color: #002200;">!=</span> MCSessionStateConnecting<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>state <span style="color: #002200;">==</span> MCSessionStateConnected<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_arrConnectedDevices addObject<span style="color: #002200;">:</span>peerDisplayName<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span> <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>state <span style="color: #002200;">==</span> MCSessionStateNotConnected<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span>_arrConnectedDevices count<span style="color: #002200;">&#93;</span> &gt; <span style="color: #2400d9;">0</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">int</span> indexOfPeer <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>_arrConnectedDevices indexOfObject<span style="color: #002200;">:</span>peerDisplayName<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_arrConnectedDevices removeObjectAtIndex<span style="color: #002200;">:</span>indexOfPeer<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp;<span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>First of all, we perform any action only when the current state is other than the <em>MCSessionStateConnecting</em>. So, if currently the state matches to the <em>MCSessionStateConnected</em>, then we add the peer display name to the <em>arrConnectedDevices</em> array. Otherwise, if the state is equal to the <em>MCSessionStateNotConnected</em> one, then we find the index of the current peer in the array and simply remove it. This code snippet is the heart of our method. However, we are not finished yet. Add what is missing:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>peerDidChangeStateWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>notification<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>state <span style="color: #002200;">!=</span> MCSessionStateConnecting<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; ...<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_tblConnectedDevices reloadData<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">BOOL</span> peersExist <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>_appDelegate.mcManager.session connectedPeers<span style="color: #002200;">&#93;</span> count<span style="color: #002200;">&#93;</span> <span style="color: #002200;">==</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">&#41;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_btnDisconnect setEnabled<span style="color: #002200;">:!</span>peersExist<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_txtName setEnabled<span style="color: #002200;">:</span>peersExist<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>At first, we reload the data on the table view. After that, we check if there are any peers left connected, and we assign the result of this comparison to a BOOL value. Note that the <em>connectedPeers</em> method of the <em>session</em> object returns an array with all the connected peers to the session. Anyway, depending on the bool value, we set the text field and the disconnect button enable state.</p>
<p>The method is ready, but if you run the application you&#8217;ll see no results at all. Why not? Because we still haven&#8217;t implemented the minimum required table view delegate and datasource methods. Let&#8217;s do it now. Right next, you are given all these methods at once:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>NSInteger<span style="color: #002200;">&#41;</span>numberOfSectionsInTableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">1</span>;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>NSInteger<span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView numberOfRowsInSection<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSInteger<span style="color: #002200;">&#41;</span>section<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #002200;">&#91;</span>_arrConnectedDevices count<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>UITableViewCell <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView cellForRowAtIndexPath<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>indexPath<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; UITableViewCell <span style="color: #002200;">*</span>cell <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>tableView dequeueReusableCellWithIdentifier<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;CellIdentifier&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>cell <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; cell <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>UITableViewCell alloc<span style="color: #002200;">&#93;</span> initWithStyle<span style="color: #002200;">:</span>UITableViewCellStyleDefault reuseIdentifier<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;CellIdentifier&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; cell.textLabel.text <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>_arrConnectedDevices objectAtIndex<span style="color: #002200;">:</span>indexPath.row<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>CGFloat<span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView heightForRowAtIndexPath<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>indexPath<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">60.0</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>There is nothing hard here that needs to be explained. We just display the contents of the table view. If you test the app now and make a connection, you should see something similar to this:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_26_connected_peer.jpg" alt="Multipeer - Peer Connected" class="aligncenter size-full wp-image-3008" /></div>
<p>Finally, there is just one more thing to be done and our view controller will be fully functional. That is to make the disconnect button work. Simply, implement the <em>disconnect:</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>disconnect<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager.session disconnect<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _txtName.enabled <span style="color: #002200;">=</span> <span style="color: #a61390;">YES</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_arrConnectedDevices removeAllObjects<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_tblConnectedDevices reloadData<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>As you see, the <em>session</em> object has the <em>disconnect</em> method, that enables it to break the connection. After that, the rest is easy to be understood.</p>
<p>Go and test once again the application. After you have a connection established, tap on the Disconnect button and you&#8217;ll see that in both devices the other peer&#8217;s display name goes away, while the text field becomes enabled again.</p>
<p>At this point, the Connections View Controller is ready! Up to now, we have seen many things regarding the framework, but let&#8217;s go ahead for even more interesting stuff!</p>
<h2>Setup The Chat Interface</h2>
<p>Once a connection is established, we can exchange any allowed data we want. In this part we will work with setting up the First View Controller interface, and later we will implement the chatting feature of the application. So, let&#8217;s get started!</p>
<p>Click on the <em>Main.storyboard</em> file to bring the Interface Builder up. Go to the First View Controller scene and delete its default contents.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_27_delete_default_contents.jpg" alt="Xcode Storyboard Delete Default Content" class="aligncenter size-full wp-image-3009" /></div>
<p>Then, drag and drop the following controls from the Objects Library and set some of their properties as given below:</p>
<ol>
<li><strong>UITextField</strong>
<ul>
<li>Frame: X=20, Y=20, Width=280, Height=30</li>
<li>Placeholder: <em>Your message&#8230;</em></li>
</ul>
</li>
<li><strong>UIButton</strong>
<ul>
<li>Frame: X=254, Y=58, Width=46, Height=30</li>
<li>Title: <em>Send</em></li>
</ul>
</li>
<li><strong>UIButton</strong>
<ul>
<li>Frame: X=25, Y=58, Width=48, Height=30</li>
<li>Title: <em>Cancel</em></li>
</ul>
</li>
<li><strong>UITextView</strong>
<ul>
<li>Frame: X=0, Y=96, Width=320, Height=422</li>
<li>Text: None</li>
<li>Background Color: Light Gray</li>
</ul>
</li>
</ol>
<p>Your scene should now look like this:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_28_first_vc_scene.jpg" alt="Multipeer Demo - First VC Scene" class="aligncenter size-full wp-image-3010" /></div>
<p>Let&#8217;s declare a couple of IBOutlet properties now. Open the <em>FirstViewController.h</em> file and add these two inside the interface body:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FirstViewController <span style="color: #002200;">:</span> UIViewController<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UITextField <span style="color: #002200;">*</span>txtMessage;<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UITextView <span style="color: #002200;">*</span>tvChat;<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Also, we want an IBAction method for each button, so add these as well:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FirstViewController <span style="color: #002200;">:</span> UIViewController<br />
...<br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>sendMessage<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>cancelMessage<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Before we go back to Interface Builder and while being in this file, adopt the <em>UITextField</em> protocol, as we will need later to implement a delegate method of it.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FirstViewController <span style="color: #002200;">:</span> UIViewController &lt;UITextFieldDelegate&gt;</div></td></tr></tbody></table></div>
<p>Following the same steps for connecting the IBOutlet properties and the IBAction methods as we did while we were setting the Connections View Controller up, go and connect the <em>txtMessage</em> property to the text field and the <em>tvChat</em> property to the text view. Next, connect the <em>sendMessage:</em> IBAction method to the Send button and the <em>cancelMessage:</em> to the Cancel button. Once you&#8217;ve done these steps, nothing else remains to be done here.</p>
<h2>Let&#8217;s Chat</h2>
<p>The title of this section speaks on its own for our goal here. We will do any required implementation, so our connected devices using the Multipeer Connectivity framework to be able to chat using text messages.</p>
<p>Let&#8217;s begin by doing something common for all three view controllers: To declare and instantiate an <em>AppDelegate</em> object. Go to the <em>FirstViewController.m</em> file, and import the <em>AppDelegate.h</em> file:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &quot;AppDelegate.h&quot;</span></div></td></tr></tbody></table></div>
<p>Then, inside the private section of the interface, make this declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FirstViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> AppDelegate <span style="color: #002200;">*</span>appDelegate;<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Finally, go to the <em>viewDidLoad</em> method and instantiate the object:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>super viewDidLoad<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp;_appDelegate <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>AppDelegate <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>UIApplication sharedApplication<span style="color: #002200;">&#93;</span> delegate<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Now we are able to access the <em>mcManager</em> object of the application delegate. We are continuing by implementing the <em>textFieldShouldReturn:</em> text field delegate method. We need it because we want the Return button of the keyboard to behave just like the Send UIButton, and that is to send the message to other peers. However, before we see this method, and while we are still in the <em>viewDidLoad</em> method, let&#8217;s make our class the delegate of the text field:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; _txtMessage.delegate <span style="color: #002200;">=</span> self;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Now we can implement the <em>textFieldShouldReturn:</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">BOOL</span><span style="color: #002200;">&#41;</span>textFieldShouldReturn<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITextField <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>textField<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self sendMyMessage<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">YES</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>The <em>sendMyMessage</em> method we call here is a custom, private method that we will implement in a while and that it will do the sending job. Now, it&#8217;s a good chance to implement the two IBAction methods we previously declared:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>sendMessage<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self sendMyMessage<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>cancelMessage<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_txtMessage resignFirstResponder<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>They couldn&#8217;t be any simpler. The first one also calls the <em>sendMyMessage</em> method, and the second one just makes the keyboard go away, without sending any message at all.</p>
<p>Now we can dive in to the core of the desired functionality. We will implement the private method, and we will meet a new method of the framework that allows us to send messages.</p>
<p>Go to the private section of the interface to declare the method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FirstViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
...<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>sendMyMessage;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Now we may proceed to its implementation, so let&#8217;s see it first and we&#8217;ll discuss later.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>sendMyMessage<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>dataToSend <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>_txtMessage.text dataUsingEncoding<span style="color: #002200;">:</span>NSUTF8StringEncoding<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>allPeers <span style="color: #002200;">=</span> _appDelegate.mcManager.session.connectedPeers;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_appDelegate.mcManager.session sendData<span style="color: #002200;">:</span>dataToSend<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;toPeers<span style="color: #002200;">:</span>allPeers<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; withMode<span style="color: #002200;">:</span>MCSessionSendDataReliable<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;error<span style="color: #002200;">:&amp;</span>error<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>error<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; NSLog<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;%@&quot;</span>, <span style="color: #002200;">&#91;</span>error localizedDescription<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_tvChat setText<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>_tvChat.text stringByAppendingString<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> stringWithFormat<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;I wrote:<span style="color: #2400d9;">\n</span>%@<span style="color: #2400d9;">\n</span><span style="color: #2400d9;">\n</span>&quot;</span>, _txtMessage.text<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_txtMessage setText<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_txtMessage resignFirstResponder<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>The <em>session</em> object has the <em>sendData:toPeers:withMode:error:</em> method, which is the one that actually sends a message. The data should be a <em>NSData</em> object and that&#8217;s exactly is taking place in the first line by using the <em>dataUsingEncoding:</em> method.</p>
<p>The second parameter of the method must be a <em>NSArray</em> with all peers that should receive the message. For the sake of the tutorial, we&#8217;ll send the message to all connected peers. In a real application you can let users select the recipients of the message.</p>
<p>The third parameter is quite important, as this is the place where we define the mode that our data will be sent. At the beginning of this tutorial, I said that there are two modes, the reliable and the unreliable. This is supposed to be a chat application, so we don&#8217;t want to lose any package. Therefore, when calling the method we specify the <em>MCSessionSendDataReliable</em> value.</p>
<p>The last parameter is the all-time classic error object, which we use to check if any error occurred after we have this method called. Indeed, if any error occurs, we just log its description, as there is no reason to handle it in any other way in our demo app.</p>
<p>Finally, we perform three more tasks. First of all, we display the message to the text view, and to make clear that it&#8217;s us who wrote it, we prepend the <em>I wrote:</em> text. Next, we clear the text field from the current content, and finally we make the keyboard go away.</p>
<p>Further than the new method of the <em>session</em> object we just met, there is nothing difficult or weird. Let&#8217;s focus now on what happens when a message is received by a peer. Once that happens, the <em>session:didReceiveData:fromPeer:</em> delegate method is called, and it&#8217;s our responsibility to handle the received message according to our needs. We have implemented this method in the <em>MCManager</em> class, but with no content at all. Now it&#8217;s the appropriate time to pay it a visit and manage the received data.</p>
<p>Go to the <em>MCManager.m</em> file, and find the <em>session:didReceiveData:fromPeer:</em> method. Our approach here is going to be the same to the <em>session:peer:didChangeState:</em> method, and that means that we will post a notification that our class (FirstViewController) will catch and act appropriately.</p>
<p>Here is its implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session didReceiveData<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>data fromPeer<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>MCPeerID <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>peerID<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSDictionary_Class/"><span style="color: #400080;">NSDictionary</span></a> <span style="color: #002200;">*</span>dict <span style="color: #002200;">=</span> @<span style="color: #002200;">&#123;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;data&quot;</span><span style="color: #002200;">:</span> data,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;peerID&quot;</span><span style="color: #002200;">:</span> peerID<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #002200;">&#125;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotificationCenter_Class/"><span style="color: #400080;">NSNotificationCenter</span></a> defaultCenter<span style="color: #002200;">&#93;</span> postNotificationName<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;MCDidReceiveDataNotification&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; object<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; userInfo<span style="color: #002200;">:</span>dict<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>As you see, we create a <em>NSDictionary</em> object with the provided data and peer as its contents. Next, we post a notification with the given name and send the dictionary along with it. After having added this simple code, we have nothing more to do, so let&#8217;s go back to the <em>FirstViewController.m</em> file.</p>
<p>Our next task is to make our class observe for this notification, and we&#8217;ll do that in the <em>viewDidLoad</em> method. Add the next code fragment:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; ...<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotificationCenter_Class/"><span style="color: #400080;">NSNotificationCenter</span></a> defaultCenter<span style="color: #002200;">&#93;</span> addObserver<span style="color: #002200;">:</span>self<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selector<span style="color: #002200;">:</span><span style="color: #a61390;">@selector</span><span style="color: #002200;">&#40;</span>didReceiveDataWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;MCDidReceiveDataNotification&quot;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;object<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>The <em>didReceiveDataWithNotification:</em> method in the selector is the private method that is called every time such a notification arrives. We are going to implement it in a while, but first let&#8217;s declare it. Go to the private section of the interface and add this declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FirstViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
...<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>didReceiveDataWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>notification;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>What we want this method to do is fairly simple. The user info dictionary of the notification contains the peer that sent the message and the message itself as a <em>NSData</em> object. From the peer object we&#8217;ll get its display name, and we will convert the data into a <em>NSString</em> object. Once that has been done, then we will add to the text view the peer display name along with its message.</p>
<p>Here is the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>didReceiveDataWithNotification<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>notification<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; MCPeerID <span style="color: #002200;">*</span>peerID <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>notification userInfo<span style="color: #002200;">&#93;</span> objectForKey<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;peerID&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>peerDisplayName <span style="color: #002200;">=</span> peerID.displayName;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>receivedData <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>notification userInfo<span style="color: #002200;">&#93;</span> objectForKey<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;data&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>receivedText <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> alloc<span style="color: #002200;">&#93;</span> initWithData<span style="color: #002200;">:</span>receivedData encoding<span style="color: #002200;">:</span>NSUTF8StringEncoding<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>_tvChat performSelectorOnMainThread<span style="color: #002200;">:</span><span style="color: #a61390;">@selector</span><span style="color: #002200;">&#40;</span>setText<span style="color: #002200;">:</span><span style="color: #002200;">&#41;</span> withObject<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>_tvChat.text stringByAppendingString<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> stringWithFormat<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;%@ wrote:<span style="color: #2400d9;">\n</span>%@<span style="color: #2400d9;">\n</span><span style="color: #2400d9;">\n</span>&quot;</span>, peerDisplayName, receivedText<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span> waitUntilDone<span style="color: #002200;">:</span><span style="color: #a61390;">NO</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Note that we set the text to the text view by calling the <em>performSelectorOnMainThread:withObject:waitUntilDone:</em> method. This is done because the data is received in a secondary thread, and any visual update should always take place on the main thread of the application.</p>
<p>Our chatting feature is ready! If you want to test it, first establish a connection and then start sending text messages from peer to peer.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/02/t4_29_chat_sample.jpg" alt="Multipeer Demo - Chat Sample" class="aligncenter size-full wp-image-3011" /></div>
<h2>Summary</h2>
<p>The Multipeer Connectivity framework is a brand-new feature on iOS 7. In this tutorial we gave you a brief introduction of the framework and demonstrated how you can use it to build a simple chat app. There is still a lot to explore. In part 2 of the tutorial series, we&#8217;ll continue to work on the project and see how to share file with nearby devices. Stay tuned.</p>
<p>For your reference, you can <a href="https://dl.dropboxusercontent.com/u/2857188/MCDemo.zip">download the complete Xcode project from here</a>. As always, feel free to share your thoughts and comments below.</p>
<p><strong>Update:</strong> <a href="http://www.appcoda.com/intro-ios-multipeer-connectivity-programming/">Part 2</a> is now available.</p>

<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:none;margin:20px 0 20px 0;text-align:center;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_336_280_Ad */
google_ad_slot = "4009415334";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div><h3>You May Like These:</h3><div style="clear: both"></div><div style="border: 0pt none ; margin: 0pt; padding: 0pt;"><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/why-launching-appcoda/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2012/03/appcoda-launch1-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Why Launching AppCoda?</div></div></a><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/ios-programming-101-send-email-iphone-app/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2012/07/SimpleEmail-Tutorial-Logo-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">iOS Programming 101: How To Send Email in Your iPhone App</div></div></a><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/ios-programming-local-notification-tutorial/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/06/Local-Notification-Tutorial-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Adding Local Notifications in Your iOS App</div></div></a><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/intro-text-kit-ios-programming-guide/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2014/01/intro-text-kit-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Using Text Kit to Manage Text in Your iOS Apps</div></div></a></div><div style="clear: both"></div><span class="et_social_bottom_trigger"></span><!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/"
    dc:identifier="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/"
    dc:title="Understanding Multipeer Connectivity Framework in iOS 7 &#8211; Part 1"
    trackback:ping="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/trackback/" />
</rdf:RDF>-->
</div><div class="post-meta"><span class="categories">Filed Under: <a href="http://www.appcoda.com/course/" rel="category tag">Course</a>, <a href="http://www.appcoda.com/course/intermediate/" rel="category tag">Intermediate</a>, <a href="http://www.appcoda.com/tutorials/" rel="category tag">Tutorials</a></span> <span class="tags">Tagged With: <a href="http://www.appcoda.com/tag/ios-7/" rel="tag">iOS 7</a>, <a href="http://www.appcoda.com/tag/ios-programming/" rel="tag">iOS Programming</a>, <a href="http://www.appcoda.com/tag/multipeer-connectivity-framework/" rel="tag">multipeer connectivity framework</a>, <a href="http://www.appcoda.com/tag/networking/" rel="tag">networking</a>, <a href="http://www.appcoda.com/tag/xcode-5/" rel="tag">Xcode 5</a></span></div><div class="after-post widget-area"><div id="text-8" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Free Chapters of Our Swift Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="http://www.appcoda.com/wp-content/uploads/2014/10/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignright size-medium wp-image-4153" width="200" /></a>If you want to create an app but don't know where to begin, this book covers the whole aspect of Swift programming and iOS 8 development and shows you every step from an idea to a real app on App Store. This book features a lot of hands-on exercises and projects. You will first create a simple app, then prototype an app idea, and later add some features to it in each chapter, until a real app is built. Want to learn more? <a href="http://www.appcoda.com/swift/">Check it out here and get three free chapters.</a>
</p>
<br/></div>
		</div></div>
<div id="featured-page-2" class="widget featured-content featuredpage"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for our Free Tutorials</h4>
<div class="post-38 page type-page status-publish has-post-thumbnail hentry entry"><ul>
<li>Learn iOS Programming From Scratch</li>
<li>Step by Step Guide to Build Your First iPhone App</li>
<li>Complete Source Code for Your Reference</li>
<li>More Programming Tips and Tutorials to Come</li>
</ul>
<div class="enews">
<h4 class="widgettitle">Whatcha waiting for?</h4>
<form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" id="mce-EMAIL" placeholder="Enter your email address" required><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button"><br />
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"/><br />
</form>
</div>
</div></div></div>
</div></div><div class="author-box"><div><img alt='' src='http://2.gravatar.com/avatar/582c964c3dafd700a4df627225d859fe?s=70&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/582c964c3dafd700a4df627225d859fe?s=140&amp;d=mm&amp;r=g 2x' class='avatar avatar-70 photo' height='70' width='70' /> <strong>About Gabriel Theodoropoulos</strong><br /><p>Gabriel has been a software developer for about two decades. He has long experience in developing software solutions for various platforms in many programming languages. Since middle-2010 he has been developing almost exclusively for iOS. Tutorials consist of the best way to share knowledge with people all over the world. Follow Gabriel at <a href="http://plus.google.com/+gabrieltheodoropoulos">Google+</a> and <a href="https://twitter.com/gabtheodor">Twitter</a>.</p>
</div></div>
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-3539">
        <div id="dsq-comment-header-3539" class="dsq-comment-header">
            <cite id="dsq-cite-3539">
                <span id="dsq-author-user-3539">HiVoid</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3539" class="dsq-comment-body">
            <div id="dsq-comment-message-3539" class="dsq-comment-message"><p>I followed the code, but I couldn&#8217;t find any devices when I tapped the button.(I am testing using two devices.) Then I downloaded the complete project from the author, the result is exactly the same&#8230; So I am really confused now, how does the author get the screenshot?&#8230;</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-3540">
        <div id="dsq-comment-header-3540" class="dsq-comment-header">
            <cite id="dsq-cite-3540">
                <span id="dsq-author-user-3540">Gabriel Thedoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3540" class="dsq-comment-body">
            <div id="dsq-comment-message-3540" class="dsq-comment-message"><p>Hi,</p>
<p>Please make sure that you have properly connected all IBOutlet properties and IBAction methods in the ConnectionsViewController class. That would be probably a reason for not discovering other devices.</p>
<p>Gabriel</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-3548">
        <div id="dsq-comment-header-3548" class="dsq-comment-header">
            <cite id="dsq-cite-3548">
                <span id="dsq-author-user-3548">HiVoid</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3548" class="dsq-comment-body">
            <div id="dsq-comment-message-3548" class="dsq-comment-message"><p>Thank you so much for replying me. I just went through the code again, and I completely understand the logic now. And I think it should work perfectly as your screenshots show. However, I am running YOUR project on my two devices, and there should suppose to be no errors at all. But neither of my device could find the other one when clicking the browse button. I am quite sure both devices have turned their wifi on, and both the switches are on. So I am really confused, and I want to wait for other guys to test the code to see if it can work out perfectly.</p>
<p>One more thing, in the textfield, if I didn&#8217;t type anything in, and then i hit return button, the program just exit directly.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-3551">
        <div id="dsq-comment-header-3551" class="dsq-comment-header">
            <cite id="dsq-cite-3551">
                <span id="dsq-author-user-3551">Gabriel Thedoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3551" class="dsq-comment-body">
            <div id="dsq-comment-message-3551" class="dsq-comment-message"><p>Hey,</p>
<p>You are welcome. That sounds really strange. I tested the project again after I&#8217;ve had it removed from both devices and the Simulator and it worked fine to me.</p>
<p>Well, as a piece of advice I would suggest to remove and re-install the app once again, and also make sure that before you try to establish a connection you have the Connections tab selected (that&#8217;s important so all related objects to be initialized).</p>
<p>Regarding the textfield, just add the next piece of code in the textFieldShouldReturn: delegate method and you&#8217;ll be fine:</p>
<p>if (_txtName.text.length == 0) {<br />
        return YES;<br />
    }</p>
<p>I just omitted it to make the presented code simpler.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-5" id="dsq-comment-4190">
        <div id="dsq-comment-header-4190" class="dsq-comment-header">
            <cite id="dsq-cite-4190">
                <span id="dsq-author-user-4190">Raj ambi</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4190" class="dsq-comment-body">
            <div id="dsq-comment-message-4190" class="dsq-comment-message"><p>i have used this code and its working fine. but its working only via bluetooth its not working via WiFi. Is anything possible to change/run through Wifi.please let me know as soon as.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt depth-2" id="dsq-comment-4017">
        <div id="dsq-comment-header-4017" class="dsq-comment-header">
            <cite id="dsq-cite-4017">
                <span id="dsq-author-user-4017">Anmol</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4017" class="dsq-comment-body">
            <div id="dsq-comment-message-4017" class="dsq-comment-message"><p>Hi Gabriel</p>
<p>I am having the same problem as HiVoid is facing.Please help</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-3555">
        <div id="dsq-comment-header-3555" class="dsq-comment-header">
            <cite id="dsq-cite-3555">
                <span id="dsq-author-user-3555">tomski2000</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3555" class="dsq-comment-body">
            <div id="dsq-comment-message-3555" class="dsq-comment-message"><p>Hi Gabriel,<br />
Great post. Is the any way to automatically send and receive invitations to peers that show up in the the list using MCAdvertiserAssistant? I would like to have the invitation process handled in the background for anyone with the same service type , and haven&#8217;t been able to get my head around the MCNearbyServiceAdvertiser. </p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-3559">
        <div id="dsq-comment-header-3559" class="dsq-comment-header">
            <cite id="dsq-cite-3559">
                <span id="dsq-author-user-3559">Gabriel Thedoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3559" class="dsq-comment-body">
            <div id="dsq-comment-message-3559" class="dsq-comment-message"><p>Hi,</p>
<p>The MCNearbyServiceBrowser class has the </p>
<p>invitePeer:toSession:withContext:timeout:</p>
<p>method which I think you should check out. With it, you can programmatically invite other, discovered peers and wait for their response for a specific time period.</p>
<p>For your convenience, <a href="https://developer.apple.com/library/ios/documentation/MultipeerConnectivity/Reference/MCNearbyServiceBrowserClassRef/Reference/Reference.html#//apple_ref/occ/instm/MCNearbyServiceBrowser/invitePeer:toSession:withContext:timeout:" rel="nofollow">here</a> is the official documentation where you can find more info about your request.</p>
<p>I wish good luck!</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://maniacdev.com/2014/02/tutorial-getting-started-with-the-ios-7-multipeer-connectivity-api' rel='external nofollow' class='url'>Tutorial: Getting Started With The iOS 7 Multipeer Connectivity API</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://vishaldharmawat.wordpress.com/2014/02/20/build-a-chat-app-using-multipeer-connectivity-framework-in-ios-7/' rel='external nofollow' class='url'>Build a Chat App Using Multipeer Connectivity Framework in iOS 7 |  VishalDharmawat - iPhone and iPad Development</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://www.iphoneclub.nl/326662/firechat-iphone-chatten-zonder-internet-maar-werkt-het/' rel='external nofollow' class='url'>FireChat voor iPhone belooft chatten zonder internet, maar werkt het? - iPhoneclub.nl</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://superlevin.ifengyuan.tw/%e3%80%90%e8%bd%89%e8%b2%bc%e3%80%91xcode%e9%96%8b%e7%99%bc%e4%bb%bffirechat%e6%95%99%e5%ad%b8/' rel='external nofollow' class='url'>xcodefirechat | Levin&#039;s Blog-</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-3973">
        <div id="dsq-comment-header-3973" class="dsq-comment-header">
            <cite id="dsq-cite-3973">
                <span id="dsq-author-user-3973">Ali</span>
            </cite>
        </div>
        <div id="dsq-comment-body-3973" class="dsq-comment-body">
            <div id="dsq-comment-message-3973" class="dsq-comment-message"><p>Hi Gabriel,<br />
Is there any way to advertise while the app is in the background? Right now the app stops advertising when goes into background state. Any low-level APIs i can use to achieve that?</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-8612">
        <div id="dsq-comment-header-8612" class="dsq-comment-header">
            <cite id="dsq-cite-8612">
http://www.gtiapps.com/                <span id="dsq-author-user-8612">Gabriel Theodoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8612" class="dsq-comment-body">
            <div id="dsq-comment-message-8612" class="dsq-comment-message"><p>Hi,<br />
Unfortunately no, browsing and advertising in background is not supported. You must restart these services every time the app launches.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://www.blogchoc.com/2014/03/30/le-tchat-sans-connexion-grace-a-une-nouveaute-meconnue-dios-7-avec-lapp-firechat/' rel='external nofollow' class='url'>Le tchat sans connexion grce  une nouveaut mconnue diOS 7 avec lapp Firechat | Blogchoc.com &#8211; toute l&#039;actualit croustillante du web</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-4018">
        <div id="dsq-comment-header-4018" class="dsq-comment-header">
            <cite id="dsq-cite-4018">
                <span id="dsq-author-user-4018">Anmol</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4018" class="dsq-comment-body">
            <div id="dsq-comment-message-4018" class="dsq-comment-message"><p>Hi Gabriel</p>
<p>Will this code work with a simulator and a real device connected on the same network.If yes, then i am probably facing the same issue as HIVOID is facing.Please help</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-4026">
        <div id="dsq-comment-header-4026" class="dsq-comment-header">
            <cite id="dsq-cite-4026">
                <span id="dsq-author-user-4026">raj</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4026" class="dsq-comment-body">
            <div id="dsq-comment-message-4026" class="dsq-comment-message"><p>I don&#8217;t recall Apple doing this before, but they seem to have pulled access to the WWDC 2013 session videos months ahead of WWDC 2014.</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-4032">
        <div id="dsq-comment-header-4032" class="dsq-comment-header">
            <cite id="dsq-cite-4032">
                <span id="dsq-author-user-4032">raj</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4032" class="dsq-comment-body">
            <div id="dsq-comment-message-4032" class="dsq-comment-message"><p>Hi Gabriel,</p>
<p>I&#8217;ve tried both the code I typed in (up to before &#8220;Setup the Chat Interface&#8221;) and your finished project. In both cases, I get &#8220;Declined&#8221; when trying to connect to a discovered device, but I never see a prompt requesting a connection. I&#8217;m using the simulator and an iPhone 4 (iOS 7.0x), and I try to connect to the phone from the simulator.</p>
<p>Any ideas why this might be? Obviously, it has something to do with settings (Bluetooth is ON for both my iMac and iPhone), not your code.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-4036">
        <div id="dsq-comment-header-4036" class="dsq-comment-header">
            <cite id="dsq-cite-4036">
                <span id="dsq-author-user-4036">raj</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4036" class="dsq-comment-body">
            <div id="dsq-comment-message-4036" class="dsq-comment-message"><p>So I tried using my iPhone and iPad Mini instead of the simulator and I was able to connect. I&#8217;m assuming that for whatever hardware reasons, the simulator cannot be used for multi-peer chat</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-8418">
        <div id="dsq-comment-header-8418" class="dsq-comment-header">
            <cite id="dsq-cite-8418">
http://appsunited.net/                <span id="dsq-author-user-8418">appsunited</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8418" class="dsq-comment-body">
            <div id="dsq-comment-message-8418" class="dsq-comment-message"><p>Raj, thanks for this information! I was also confused, it&#8217;s not working with my iPhone 5S and the iOS Simulator on my Macbook Retina.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-4728">
        <div id="dsq-comment-header-4728" class="dsq-comment-header">
            <cite id="dsq-cite-4728">
                <span id="dsq-author-user-4728">Sam</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4728" class="dsq-comment-body">
            <div id="dsq-comment-message-4728" class="dsq-comment-message"><p>Hi  Gabriel,<br />
Could you please tell me how to make it so in the UI TextView, the new messages stack on top of each other instead of going down the page? Thanks heaps. <img src="http://www.appcoda.com/wp-includes/images/smilies/simple-smile.png" alt=":-)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-6084">
        <div id="dsq-comment-header-6084" class="dsq-comment-header">
            <cite id="dsq-cite-6084">
                <span id="dsq-author-user-6084">Apple Show</span>
            </cite>
        </div>
        <div id="dsq-comment-body-6084" class="dsq-comment-body">
            <div id="dsq-comment-message-6084" class="dsq-comment-message"><p>Is it possible to translate the view for the device connecting? Would be really awesome!</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-7957">
        <div id="dsq-comment-header-7957" class="dsq-comment-header">
            <cite id="dsq-cite-7957">
                <span id="dsq-author-user-7957">Amanda</span>
            </cite>
        </div>
        <div id="dsq-comment-body-7957" class="dsq-comment-body">
            <div id="dsq-comment-message-7957" class="dsq-comment-message"><p>Hi Gabriel,<br />
Is there any way to auto connect one specific device? For example when an iPhone named &#8220;A&#8221; acts as a browser and finds an iPhone named &#8220;B&#8221;, &#8220;A&#8221; can auto request for connection and then &#8220;B&#8221; will auto accept. After all these the two can chat with each other. Please help</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-8613">
        <div id="dsq-comment-header-8613" class="dsq-comment-header">
            <cite id="dsq-cite-8613">
http://www.gtiapps.com/                <span id="dsq-author-user-8613">Gabriel Theodoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8613" class="dsq-comment-body">
            <div id="dsq-comment-message-8613" class="dsq-comment-message"><p>Hi there,<br />
It is possible to do what you&#8217;re asking, but you shouldn&#8217;t use the default browser view controller. You must use the MCNearbyServiceBrowser and the MCNearbyServiceAdvertiser classes, and implement a custom way to browse and advertise. I&#8217;d advise you to take a look in the Apple documentation. It&#8217;s not hard to be done.</p>
<p>P.S.: There will be a tutorial soon for implementing custom browsing and advertising.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-3" id="dsq-comment-8701">
        <div id="dsq-comment-header-8701" class="dsq-comment-header">
            <cite id="dsq-cite-8701">
                <span id="dsq-author-user-8701">Amanda</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8701" class="dsq-comment-body">
            <div id="dsq-comment-message-8701" class="dsq-comment-message"><p>Many thanks for your help! I&#8217;ll have a try. Looking forward to it!</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-8745">
        <div id="dsq-comment-header-8745" class="dsq-comment-header">
            <cite id="dsq-cite-8745">
                <span id="dsq-author-user-8745">Cool Fish</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8745" class="dsq-comment-body">
            <div id="dsq-comment-message-8745" class="dsq-comment-message"><p>Hi Gabriel, </p>
<p>Do I need extra code to handle reconnection after disconnecting? This demo project worked well for me until i started to disconnect from either side of a connection and then reconnect. The the advertiser seemed not to respond to the invitation from the same browser any more, and the browser showed &#8220;connecting&#8221; for ever. I tried to call the setupPeerAndSessionWithDisplayName() function inside disconnect(), but it did not solve the issue. Thanks!</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-8955">
        <div id="dsq-comment-header-8955" class="dsq-comment-header">
            <cite id="dsq-cite-8955">
                <span id="dsq-author-user-8955">Socraz6</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8955" class="dsq-comment-body">
            <div id="dsq-comment-message-8955" class="dsq-comment-message"><p>I&#8217;m having the same issue.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://appgong.com/1582/' rel='external nofollow' class='url'>Build a Chat App Using Multipeer Connectivity Framework in iOS 7 - appgong</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://leoreubelt.wordpress.com/2014/06/25/get-it-done/' rel='external nofollow' class='url'>Get it done | leoreubelt</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-16841">
        <div id="dsq-comment-header-16841" class="dsq-comment-header">
            <cite id="dsq-cite-16841">
                <span id="dsq-author-user-16841">s</span>
            </cite>
        </div>
        <div id="dsq-comment-body-16841" class="dsq-comment-body">
            <div id="dsq-comment-message-16841" class="dsq-comment-message"><p>thank you, this helped me a lot because i forgot to put performSelectorOnMainThread &#8230;now it works great tkanks</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-29182">
        <div id="dsq-comment-header-29182" class="dsq-comment-header">
            <cite id="dsq-cite-29182">
                <span id="dsq-author-user-29182">rickin</span>
            </cite>
        </div>
        <div id="dsq-comment-body-29182" class="dsq-comment-body">
            <div id="dsq-comment-message-29182" class="dsq-comment-message"><p>Hi Gabriel,<br />
First of all i would like to say its an outstanding piece of article. Although I am facing a strange issue, I could see multiple names appearing for the same device when the run your code. Can you please tell me what could be the reason for it ?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-45473">
        <div id="dsq-comment-header-45473" class="dsq-comment-header">
            <cite id="dsq-cite-45473">
                <span id="dsq-author-user-45473">Mahender</span>
            </cite>
        </div>
        <div id="dsq-comment-body-45473" class="dsq-comment-body">
            <div id="dsq-comment-message-45473" class="dsq-comment-message"><p>Hi Gabriel,</p>
<p>I am not getting devices when I hit the Browse Devices.  I tried your code also..Can u help me? I checked all the IBOutlets and IBActions(connections)..Thanks</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-46000">
        <div id="dsq-comment-header-46000" class="dsq-comment-header">
            <cite id="dsq-cite-46000">
http://www.gtiapps.com/                <span id="dsq-author-user-46000">Gabriel Theodoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-46000" class="dsq-comment-body">
            <div id="dsq-comment-message-46000" class="dsq-comment-message"><p>Hi,</p>
<p>Almost after a year working with multipeer connectivity, and after having talked with many other developers, it seems that the MPC is &#8220;unstable&#8221;, meaning that you can&#8217;t say for sure if it will work or not. For example, when it works on my system and devices, it happens not to be working to my clients (occasionally). I&#8217;m afraid that I don&#8217;t have a clear answer for you, I&#8217;d just recommend you to turn off/on the WiFi and Bluetooth again to all your devices, and wait to see what will happen. If that won&#8217;t work too, then I&#8217;d tell you to take a look at the Apple&#8217;s documentation and implement the MPC manually (it&#8217;s easy to do).</p>
<p>Wish you good luck!</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-57033">
        <div id="dsq-comment-header-57033" class="dsq-comment-header">
            <cite id="dsq-cite-57033">
                <span id="dsq-author-user-57033">Adam Henry</span>
            </cite>
        </div>
        <div id="dsq-comment-body-57033" class="dsq-comment-body">
            <div id="dsq-comment-message-57033" class="dsq-comment-message"><p>Any advice for sending a jpeg using this method? I have tried everything I can think of to get this to send and receive something other than a txt file but to no avail. It won&#8217;t show up in the table.</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-65146">
        <div id="dsq-comment-header-65146" class="dsq-comment-header">
            <cite id="dsq-cite-65146">
http://kittynit.com                <span id="dsq-author-user-65146">zoey</span>
            </cite>
        </div>
        <div id="dsq-comment-body-65146" class="dsq-comment-body">
            <div id="dsq-comment-message-65146" class="dsq-comment-message"><p>Hi I&#8217;m Zoey.Victoria. Vann and I&#8217;m new</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-65151">
        <div id="dsq-comment-header-65151" class="dsq-comment-header">
            <cite id="dsq-cite-65151">
http://kittynit.com                <span id="dsq-author-user-65151">zoey</span>
            </cite>
        </div>
        <div id="dsq-comment-body-65151" class="dsq-comment-body">
            <div id="dsq-comment-message-65151" class="dsq-comment-message"><p>Hey! Umm? Do think I&#8217;m a nightmare, please?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-72200">
        <div id="dsq-comment-header-72200" class="dsq-comment-header">
            <cite id="dsq-cite-72200">
http://www.javae.co                <span id="dsq-author-user-72200">Anthony Randazzo</span>
            </cite>
        </div>
        <div id="dsq-comment-body-72200" class="dsq-comment-body">
            <div id="dsq-comment-message-72200" class="dsq-comment-message"><p>Great tutorial! Could you point me in the right direction toward customizing an MCBrowserController-like table to display devices/users nearby? &#8211; Thanks</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-99200">
        <div id="dsq-comment-header-99200" class="dsq-comment-header">
            <cite id="dsq-cite-99200">
                <span id="dsq-author-user-99200">B. Krishna Kishore</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99200" class="dsq-comment-body">
            <div id="dsq-comment-message-99200" class="dsq-comment-message"><p>Great Tutorial!!!! can any one help me on this? How can i send messages over long distance by relaying data from one node to another using multipeer framework? Kindly suggest me any ideas how to do this application?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-99206">
        <div id="dsq-comment-header-99206" class="dsq-comment-header">
            <cite id="dsq-cite-99206">
                <span id="dsq-author-user-99206">Jung Jihoon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99206" class="dsq-comment-body">
            <div id="dsq-comment-message-99206" class="dsq-comment-message"><p>Hi Gabriel, thank you for ur tutorial. I am just absolute beginner of programming. </p>
<p>Well, having a small issue in &#8220;Connections View Controller: Set up the interface&#8221;, what to select one thing in received actions. see pic below. </p>
<p>Please help me. </p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-99207">
        <div id="dsq-comment-header-99207" class="dsq-comment-header">
            <cite id="dsq-cite-99207">
                <span id="dsq-author-user-99207">Jung Jihoon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99207" class="dsq-comment-body">
            <div id="dsq-comment-message-99207" class="dsq-comment-message"><p>and, same as others &#8211; disconnect, toggle&#8230;</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-100099">
        <div id="dsq-comment-header-100099" class="dsq-comment-header">
            <cite id="dsq-cite-100099">
                <span id="dsq-author-user-100099">Abner Abbey</span>
            </cite>
        </div>
        <div id="dsq-comment-body-100099" class="dsq-comment-body">
            <div id="dsq-comment-message-100099" class="dsq-comment-message"><p>I think it&#8217;d have been much better that you had made a singleton class for the MCManager instead of putting is in the AppDelegate.</p>
</div>
        </div>

    </li><!-- #comment-## -->
            </ul>


        </div>

    </div>

<script type="text/javascript">
var disqus_url = 'http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/';
var disqus_identifier = '2975 http://www.appcoda.com/?p=2975';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'appcoda';
var disqus_title = "Understanding Multipeer Connectivity Framework in iOS 7 &#8211; Part 1";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=2975';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

</div><div id="sidebar" class="sidebar widget-area"><div id="search-4" class="widget widget_search"><div class="widget-wrap"><form role="search" method="get" id="searchform" class="searchform" action="http://www.appcoda.com/" >
                    <div><label class="screen-reader-text" for="s">Search for:</label>
                    <input type="text" value="" name="s" id="s" />
                    <input type="submit" id="searchsubmit" value="Search" />
                    </div>
                    </form></div></div>
<div id="text-2" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for Our Free Tutorials</h4>
			<div class="textwidget"><div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" id="mce-EMAIL" placeholder="Enter your email address" required><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"/>
</form>
</div></div>
		</div></div>
<div id="text-6" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><!-- BuySellAds Zone Code -->
<div id="bsap_1283996" class="bsarocks bsap_459a84cf8fa0d5ea9dccfcfd1c3531e0"></div>
<!-- End BuySellAds Zone Code --></div>
		</div></div>
<div id="text-4" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><div class="fb-like-box" data-href="http://www.facebook.com/appcodamobile" data-width="300" data-height="260" data-show-faces="true" data-border-color="#F1F1F1" data-stream="false" data-header="false"></div></div>
		</div></div>
		<div id="recent-posts-3" class="widget widget_recent_entries"><div class="widget-wrap">		<h4 class="widget-title widgettitle">Recent Posts</h4>
		<ul>
					<li>
				<a href="http://www.appcoda.com/react-native-introduction/">Introduction to React Native: Building iOS Apps with JavaScript</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/cloudkit-introduction-tutorial/">Working with CloudKit in iOS 8</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/instagram-app-parse-swift/">Building an Instagram-Like App with Parse and Swift</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/google-maps-api-tutorial/">A Swift Tutorial for Google Maps SDK</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/ios8-share-extension-swift/">Building a Simple Share Extension in iOS 8 App</a>
						</li>
				</ul>
		</div></div>
<div id="wp_insert_ad_widget-3" class="widget widget_wp_insert_ad_widget"><div class="widget-wrap"><div class="wpInsert wpInsertAdWidget" style="margin: 5px; padding: 0px;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Premium Large Skyscraper -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-8501671653071605"
     data-ad-slot="6120307730"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></div></div>
<div id="nav_menu-3" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar" class="menu"><li id="menu-item-57" class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li id="menu-item-58" class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li id="menu-item-59" class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li id="menu-item-68" class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
</div></div></div></div><div id="footer-widgets" class="footer-widgets"><div class="wrap"><div class="footer-widgets-1 widget-area"><div id="nav_menu-4" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">About AppCoda</h4>
<div class="menu-default-container"><ul id="menu-default-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div><div class="footer-widgets-2 widget-area"><div id="text-9" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Our New Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="http://www.appcoda.com/wp-content/uploads/2014/10/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignleft size-medium wp-image-4153" /></a></div>
		</div></div>
</div><div class="footer-widgets-3 widget-area"><div id="nav_menu-5" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar-1" class="menu"><li class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
<div id="text-3" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Email Newsletter</h4>
			<div class="textwidget"><p>Sign up to receive free tutorial and
to hear what's going on with AppCoda!</p>
<div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" id="mce-EMAIL" placeholder="Enter your email address" required><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"/>
</form>
</div></div>
		</div></div>
</div></div></div><div id="footer" class="footer"><div class="wrap">    <p>&copy; Copyright 2015 <a href="http://appcoda.com/">AppCoda</a> &middot; All Rights Reserved &middot; Powered by <a href="http://wordpress.org/">WordPress &middot; <a href="http://www.appcoda.com/privacy-policy">Privacy Policy</a> &middot; <a href="http://www.appcoda.com/terms-of-service/">Terms of Service</a></p>
    </div></div></div><!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
<script src="/prismjs/prism.js"></script>        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'appcoda';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); 
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
                    <!-- Version: 0.3.3 -->
            <script type="text/javascript">
                var EjSocialSlideoutJsApi_Settings =
                {
                    SliderImage: "<img width=\"150\" height=\"150\" src=\"http:\/\/www.appcoda.com\/wp-content\/uploads\/2015\/04\/appcoda-300-150x150.png\" class=\"attachment-thumbnail\" alt=\"appcoda-300\" \/>",
                    SocialProfiles: {"Facebook":{"Name":"Facebook","NetworkId":"Facebook","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Facebook","Description":"And get free tutorial updates"},"Twitter":{"Name":"Twitter","NetworkId":"Twitter","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Twitter","Description":"And get free tutorial updates"}},
                    Preview: false
                                    };

                if (typeof (EjSocialSlideoutJsApi) !== "undefined")
                    EjSocialSlideoutJsApi.SettingsLoaded(EjSocialSlideoutJsApi_Settings);
            </script>
            <div id='ej-ss-slideout-dom-templates' style='display:none'><div id='ej-ss-slideout-dom-template-facebook'><div class='fb-follow' data-href='https://www.facebook.com/appcodamobile' data-width='210' data-colorscheme='light' data-layout='standard' data-show-faces='true'></div></div><div id='ej-ss-slideout-dom-template-twitter'><a href='https://twitter.com/appcodamobile' class='twitter-follow-button' data-show-count='true' data-size='medium'>Follow @appcodamobile</a></div></div><div class="et_social_sidebar_networks et_social_visible_sidebar et_social_slideright et_social_animated et_social_rectangle et_social_sidebar_flip et_social_sidebar_withcounts et_social_withtotalcount et_social_mobile_off">
					<div class="et_social_totalcount et_social_dark">
							<span class="et_social_totalcount_count et_social_total_share" data-post_id="2975"></span>
							<span class="et_social_totalcount_label">Shares</span>
						</div>
					<ul class="et_social_icons_container"><li class="et_social_facebook">
									<a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;t=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="2975" data-social_type="share">
										<i class="et_social_icon et_social_icon_facebook"></i>
										
										<div class="et_social_count"><span>102</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_twitter">
									<a href="http://twitter.com/share?text=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="2975" data-social_type="share">
										<i class="et_social_icon et_social_icon_twitter"></i>
										
										<div class="et_social_count"><span>32</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_googleplus">
									<a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;t=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="2975" data-social_type="share">
										<i class="et_social_icon et_social_icon_googleplus"></i>
										
										<div class="et_social_count"><span>16</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_linkedin">
									<a href="http://www.linkedin.com/shareArticle?mini=true&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;title=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="2975" data-social_type="share">
										<i class="et_social_icon et_social_icon_linkedin"></i>
										
										<div class="et_social_count"><span>6</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li></ul>
					<span class="et_social_hide_sidebar et_social_icon"></span>
				</div><div class="et_social_flyin et_social_resize et_social_flyin_bottom_right et_social_slideup et_social_trigger_bottom et_social_mobile_on">
					<a href="#" class="et_social_icon et_social_icon_cancel"></a>
					<div class="et_social_header">
						<h3>Share This</h3>
						<p>Share this post with your friends!</p>
					</div>
					<div class="et_social_networks et_social_2col et_social_slide et_social_rectangle et_social_left et_social_withnetworknames">
						
						<ul class="et_social_icons_container"><li class="et_social_facebook"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;t=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="2975" data-social_type="share"><i class="et_social_icon et_social_icon_facebook"></i><div class="et_social_network_label"><div class="et_social_networkname">Facebook</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_twitter"><a href="http://twitter.com/share?text=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="2975" data-social_type="share"><i class="et_social_icon et_social_icon_twitter"></i><div class="et_social_network_label"><div class="et_social_networkname">Twitter</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_googleplus"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;t=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="2975" data-social_type="share"><i class="et_social_icon et_social_icon_googleplus"></i><div class="et_social_network_label"><div class="et_social_networkname">Google+</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_linkedin"><a href="http://www.linkedin.com/shareArticle?mini=true&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fintro-multipeer-connectivity-framework-ios-programming%2F&#038;title=Understanding%20Multipeer%20Connectivity%20Framework%20in%20iOS%207%20%E2%80%93%20Part%201" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="2975" data-social_type="share"><i class="et_social_icon et_social_icon_linkedin"></i><div class="et_social_network_label"><div class="et_social_networkname">LinkedIn</div></div><span class="et_social_overlay"></span></a></li></ul>
					</div>
				</div><span></span><style type="text/css" class="fluid-images">img{max-width:100%;height:auto;}</style><div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><script type='text/javascript'>
/* <![CDATA[ */
var mejsL10n = {"language":"en-US","strings":{"Close":"Close","Fullscreen":"Fullscreen","Download File":"Download File","Download Video":"Download Video","Play\/Pause":"Play\/Pause","Mute Toggle":"Mute Toggle","None":"None","Turn off Fullscreen":"Turn off Fullscreen","Go Fullscreen":"Go Fullscreen","Unmute":"Unmute","Mute":"Mute","Captions\/Subtitles":"Captions\/Subtitles"}};
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/mediaelement/mediaelement-and-player.min.js?ver=2.16.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/mediaelement/wp-mediaelement.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/www.appcoda.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ...","cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.1.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/monarch/js/idle-timer.min.js?ver=1.2.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var monarchSettings = {"ajaxurl":"http:\/\/www.appcoda.com\/wp-admin\/admin-ajax.php","pageurl":"http:\/\/www.appcoda.com\/intro-multipeer-connectivity-framework-ios-programming\/","stats_nonce":"3c279d6f27","share_counts":"41afbcf48b","follow_counts":"80583e3ade","total_counts":"861aff4fd8","media_single":"ed7cd3edd6","media_total":"e88d48f2ea","generate_all_window_nonce":"6da8221303","no_img_message":"No images available for sharing on this page"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/monarch/js/custom.js?ver=1.2.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/comment-reply.min.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/themes/genesis/lib/js/menu/superfish.min.js?ver=1.7.4'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/themes/genesis/lib/js/menu/superfish.args.min.js?ver=2.1.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/themes/genesis/lib/js/menu/superfish.compat.min.js?ver=2.1.2'></script>
</body>
</html>

<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: www.appcoda.com @ 2015-05-04 12:37:25 by W3 Total Cache -->