<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Background Transfer Service in iOS 7 SDK: Download File in Background</title><link href="/prismjs/prism.css" rel="stylesheet" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<!-- This site is optimized with the Yoast WordPress SEO plugin v2.1.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="The Background Transfer Service is a new feature in iOS 7 SDK. In this programming tutorial, we show you how to use it to download file in background."/>
<link rel="canonical" href="http://www.appcoda.com/background-transfer-service-ios7/" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="The Background Transfer Service is a new feature in iOS 7 SDK. In this programming tutorial, we show you how to use it to download file in background."/>
<meta name="twitter:title" content="Background Transfer Service in iOS 7 SDK: Download File in Background"/>
<meta name="twitter:site" content="@appcodamobile"/>
<meta name="twitter:domain" content="AppCoda"/>
<meta name="twitter:image:src" content="http://www.appcoda.com/wp-content/uploads/2014/04/bts-featured.jpg"/>
<meta name="twitter:creator" content="@appcodamobile"/>
<script type='application/ld+json'>{"@context":"http:\/\/schema.org","@type":"WebSite","url":"http:\/\/www.appcoda.com\/","name":"AppCoda"}</script>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="AppCoda &raquo; Feed" href="http://feeds.feedburner.com/appcoda" />
<link rel="alternate" type="application/rss+xml" title="AppCoda &raquo; Comments Feed" href="http://www.appcoda.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="AppCoda &raquo; Background Transfer Service in iOS 7 SDK: How To Download File in Background Comments Feed" href="http://www.appcoda.com/background-transfer-service-ios7/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.appcoda.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.1"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f;c.supports={simple:d("simple"),flag:d("flag")},c.supports.simple&&c.supports.flag||(f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='mediaelement-css'  href='http://www.appcoda.com/wp-includes/js/mediaelement/mediaelementplayer.min.css?ver=2.16.2' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css'  href='http://www.appcoda.com/wp-includes/js/mediaelement/wp-mediaelement.css?ver=4.2.1' type='text/css' media='all' />
<link rel='stylesheet' id='eleven40-theme-css'  href='http://www.appcoda.com/wp-content/themes/eleven40/style.css?ver=2.1.2' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='http://www.appcoda.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.1.2' type='text/css' media='all' />
<link rel='stylesheet' id='ej-socialslideout-content-style-css'  href='http://www.appcoda.com/wp-content/plugins/ej-socialslider/static/slideout.css?ver=4.2.1' type='text/css' media='all' />
<link rel='stylesheet' id='et_monarch-open-sans-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' type='text/css' media='all' />
<link rel='stylesheet' id='et_monarch-css-css'  href='http://www.appcoda.com/wp-content/plugins/monarch/css/style.css?ver=1.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='codecolorer-css'  href='http://www.appcoda.com/wp-content/plugins/codecolorer/codecolorer.css?ver=0.9.9' type='text/css' media='screen' />
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/jquery/jquery.js?ver=1.11.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/wp-fluid-images//lib/fluidimage.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/ej-socialslider/static/slideout.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/optin-monster/assets/js/api.js?ver=2.1.6.6'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/qards//js/iframeResizer.min.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/qards//js/iframeResizer.contentWindow.min.js?ver=4.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.appcoda.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.appcoda.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.2.1" />
<link rel='shortlink' href='http://www.appcoda.com/?p=3255' />
<style type="text/css" id="et-social-custom-css">
				 
			</style><link rel="Shortcut Icon" href="http://www.appcoda.com/wp-content/themes/eleven40/images/favicon.ico" type="image/x-icon" />
<link rel="pingback" href="http://www.appcoda.com/xmlrpc.php" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-223304-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head>
<body class="single single-post postid-3255 single-format-standard et_monarch header-image content-sidebar"><div id="wrap"><div id="header"><div class="wrap"><div id="title-area"><p id="title"><a href="http://www.appcoda.com/">AppCoda</a></p><p id="description">Your iOS Programming Community</p></div><div class="widget-area header-widget-area"><div id="nav_menu-2" class="widget widget_nav_menu"><div class="widget-wrap"><div class="menu-default-container"><ul id="menu-default" class="menu genesis-nav-menu js-superfish"><li id="menu-item-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li id="menu-item-28" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li id="menu-item-530" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li id="menu-item-3045" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li id="menu-item-2140" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li id="menu-item-710" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div></div></div><div id="inner"><div class="wrap"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Leaderboard Responsive Ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8501671653071605"
     data-ad-slot="1756840139"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="content-sidebar-wrap"><div id="content" class="hfeed"><div class="post-3255 post type-post status-publish format-standard hentry category-course category-intermediate category-tutorials tag-background-fetch tag-ios-7 tag-ios-programming tag-nsurlsession tag-xcode-5 entry"><h1 class="entry-title">Background Transfer Service in iOS 7 SDK: How To Download File in Background</h1> 
<div class="post-info"><span class="date published time" title="2014-04-07T00:29:52+00:00">April 7, 2014</span>  by <span class="author vcard"><span class="fn"><a href="http://www.appcoda.com/author/gabrielth/" rel="author">Gabriel Theodoropoulos</a></span></span> <span class="post-comments"><a href="http://www.appcoda.com/background-transfer-service-ios7/#comments"><span class="dsq-postid" data-dsqidentifier="3255 http://www.appcoda.com/?p=3255">49 Comments</span></a></span> </div><div class="entry-content">
<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:right;margin:10px 0 10px 10px;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_300x250_iPhone_Development */
google_ad_slot = "8132041053";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<p>In a <a href="http://www.appcoda.com/ios7-background-fetch-programming/">previous tutorial</a> I presented a specific new multitasking feature in iOS 7, the Background Fetch, showing how easy it is to make an app to schedule downloads in the background. In this tutorial, I am going to work with another great multitasking feature, named <strong>Background Transfer Service</strong>.</p>
<p>Prior to iOS 7, only a few kinds of application were allowed to download resources or content on the background while they would not run, and just for a limited time. Big downloads should actually occur while the app was in the foreground, and that was a hard fact for all developers. However, things changed in iOS 7 with the Background Transfer Service coming, as it totally eliminates all the limitations presented above. Not only every app can download content while it&#8217;s not running, but it can also have as much time as it&#8217;s required at its disposal until all downloads are over.</p>
<p>Great flexibility and more power comes when the Background Transfer Service is combined with other multitasking features, such as the Background Fetch. For example, using the Background Fetch an app can schedule and initiate a download in the limited time that has at its disposal, and then using the Background Transfer Service to perform the actual data downloading.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/bts-featured.jpg" alt="Background Transfer Service Tutorial" class="aligncenter size-full wp-image-3277" /></div>
<p>When the Background Transfer Service gets in action, what is actually happening is that the operating system takes charge of all the download process, performing everything in background threads (daemons). While a download is in progress, delegates are used to inform the app for the progress, and wakes it up in the background to get more data if needed, such as credentials for logging in to a service. However, even though everything is controlled by the system, users can cancel all downloads at any time through the application.</p>
<p>Many times, the Background Transfer Service is synonymous with a new API introduced in iOS 7, the <strong>NSURLSession</strong>. This class actually replaces the <em>NSURLConnection</em> which was used until iOS 6, providing more features, flexibility and power when dealing with online content. With NSURLSession, three types of actions are allowed: File downloading and uploading, and data fetching (for instance, HTML or JSON). To communicate with online servers, it uses the HTTP (and HTTPs) protocol.<br />
<span id="more-3255"></span><br />
Sessions created by the NSURLSession class, use as parts of them objects of the <strong>NSURLSessionTask</strong> class, called <em>tasks</em>. The NSURLSessionTask is an abstract one, therefore it cannot be used directly. However, there are three concrete subclasses of it that they can be used instead. These are:</p>
<ol>
<li><strong>NSURLSessionDataTask</strong>: This class is used to fetch data.</li>
<li><strong>NSURLSessionDownloadTask</strong>: This one is used for downloading files.</li>
<li><strong>NSURLSessionUploadTask</strong>: It is used for uploading files to a server.</li>
</ol>
<p>The above three classes provide ways to create tasks that perform all the allowed actions by the NSURLSession. Further more, a variety of delegate methods are provided for controlling all task actions and states, as well as for keeping track of the progress of a task.</p>
<p>The theory regarding the Background Transfer Service does not stop here. There are a lot more that can be written, but that&#8217;s the basic knowledge you need to have before we go any further. Of course, you are encouraged to visit Apple&#8217;s official documentation and make a comprehensive reading there as well.</p>
<p>In this tutorial we are going to see how to download files using the NSURLSession and the NSURLSessionDownloadTask classes. You will learn how to initiate download processes, how to track their progress while being in the foreground, and how to make your app able to cooperate with the system and get messages while being in the background. After having finished this tutorial, you&#8217;ll be almost ready to create apps that make use of the Background Transfer Service. So, keep on reading to learn some new pretty interesting multitasking stuff.</p>
<h2>Demo App Overview</h2>
<p>Our main goal in this tutorial is to manage to download some PDF files from Apple, using the NSURLSession and the NSURLSessionDownloadTask classes, and save them to the app&#8217;s Documents directory. Before I go into more details, here is a screenshot of the final product:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_1_sample.jpg" alt="Background Transfer Service Demo App" class="aligncenter size-full wp-image-3258" /></div>
<p>Looking at the above image, let&#8217;s discuss about it. As I said, our target is to download some files from Apple, five in total. Their size will vary: From about 700 KB to about 29 MB. In our sample app, we will add a <em>table view</em>, with five rows, each one matching to a file. On each cell, we will have the following subviews:</p>
<ol>
<li>A label for displaying the file name.</li>
<li>A button for starting and pausing the downloading.</li>
<li>A button for stopping the downloading.</li>
<li>A progress view for tracking visually the progress of each download.</li>
<li>A label that will be placed over the two above buttons (the buttons will become hidden), informing that a download is over.</li>
</ol>
<p>Let me underline at this point that a NSURLSessionDownloadTask task object can be either paused or totally stopped. In both cases, when talking about pausing or stopping, we actually talk about <em>cancelling</em> the task, with one great difference: In the first case the class produces data for <em>resuming</em> the downloading of a file, while in the second that does not happen. So, by adding the buttons described above in each table view cell, we will manage to resume, pause or stop each file download separately.</p>
<p>In the introduction of this tutorial I mentioned that the Background Transfer Service reports the progress of a task to our app using delegate methods. That&#8217;s one more element we are going to try out, and for that reason we will use the progress bar on each cell. The progress bar will keep us informed about the progress of each download.</p>
<p>Further than the work we&#8217;ll do on each cell, we will add two more buttons under the table view. By using the first one, we will be able to start simultaneously (not really, but it will look like that) all file downloads. By using the second one, we will cancel all tasks. The functionality of those two buttons won&#8217;t be difficult to be implemented, as everything that we want them to perform, it will have already been implemented for a single download.</p>
<p>Lastly, we are going to add a navigation bar for showing the title of the app, and a toolbar at the bottom side of the screen where we will add a bar button item. This one will be used to delete all downloaded files from the app&#8217;s Documents directory, and to re-initialise all those properties that take part on a download process. For keeping a visual consistency, we will also apply the color of the navigation bar to the status bar.</p>
<p>Beyond all that, we are going to create an auxiliary class, which will be used to store various data regarding a file and its download status. I won&#8217;t get into more details on that, as we are going to devote a whole section to it. I want just to make clear that this class will be very important to us, as it&#8217;s going to be our primary tool during implementation. Actually, an object of that class will match to a file, so we are going to have five objects in total stored into an array. More about all these later.</p>
<p>As a final note, for testing the background download of the files (meaning when the app is not running), we are going to send a local notification to inform us when they are all finished. That will be the greatest proof of the Background Transfer Service functionality, of which the importance and usefulness I&#8217;m confident that you&#8217;ll manage to get through this tutorial.</p>
<p>Before we do the first step, please download the icons that will be used to the app from <a href="https://dl.dropboxusercontent.com/u/2857188/bts-appicons.zip">here</a>.</p>
<h2>Creating the App</h2>
<p>Let&#8217;s start by creating our demo project. Launch Xcode and create a new project. In the guide window that will appear, make sure to select a <strong>Single View Application</strong>, in the <strong>Application</strong> category under the <strong>iOS</strong> section.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_2_template1.jpg" alt="Background Transfer Service - Creating Project Template" class="aligncenter size-full wp-image-3259" /></div>
<p>Click on the Next button to proceed. In the second step of the guide, in the <strong>Product Name</strong> field set the <strong>BGTransferDemo</strong> value as the project&#8217;s name (or anything else you like), and make sure that in the <strong>Devices</strong> drop down menu the <strong>iPhone</strong> value is selected.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_3_template2.jpg" alt="Background Transfer Service - Project Option" class="aligncenter size-full wp-image-3260" /></div>
<p>Once you are ready, click one again on the Next button to go to the last step of the guide. In this window, just select a place to save your project and click Create. You are ready to go!</p>
<h2>Interface Setup</h2>
<p>We are going to begin the development of our app by setting up and configuring the interface using the Interface Builder. Click on the <em>Main.storyboard</em> file and wait until the IB screen appears in front of you.</p>
<p>For starters, grab from the <strong>Object Library</strong> a <strong>Navigation Bar</strong>, add it to the view and set its following attributes:</p>
<ul>
<li><em>Frame</em>: X=0, Y=20, Width=320, Height=44</li>
<li><em>Bar Tint</em>: From the <strong>Crayons</strong> Palette, select the <em>Aqua</em> color.</li>
<li><em>Title</em>: BG Transfer Demo</li>
</ul>
<p>Next, get a <strong>UIView</strong> object, and set the following:</p>
<ul>
<li><em>Frame</em>: X=0, Y=0, Width=320, Height=40</li>
<li><em>Background Color</em>: Aqua (as before)</li>
</ul>
<p>By adding this view on the status bar area, we manage to have a color consistency.</p>
<p>Until now, here is how your view should look like:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_4_nav_status.jpg" alt="Background Transfer Service - Navigation Bar" class="aligncenter size-full wp-image-3261" /></div>
<p>Next, get a <strong>UIToolbar</strong> and place it to the bottom of the screen. Select the existing bar button item, and set its <strong>Identifier</strong> to <strong>Refresh</strong>. Also, get a <strong>Flexible Space Bar Button Item</strong> and add it to the left of the existing bar button item. Here it is:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_5_toolbar.jpg" alt="Background Transfer Service - Toolbar" class="aligncenter size-full wp-image-3262" /></div>
<p>Let&#8217;s continue building our user interface, by adding a <strong>UITableView</strong> object to the view. Set its frame to (0, 64, 320, 300).</p>
<p>After that, get a <strong>UITableViewCell</strong> object and place it on the table view that you added previously to the view. Select it and set the next couple of attributes:</p>
<ul>
<li><em>Identifier</em>: idCell</li>
<li><em>Row Height</em>: 60</li>
<li><em>Selection</em>: None</li>
</ul>
<p>In the cell prototype, we are going to add some subviews. Begin with a <strong>UILabel</strong>, by setting the next properties of it:</p>
<ul>
<li><em>Frame</em>: X=20, Y=19, Width=208, Height=21</li>
<li><em>Font Size</em>: 14.0</li>
</ul>
<p>Next, add two *<em>UIButton</em> objects. For the first one, set these:</p>
<ul>
<li><em>Frame</em>: X=236, Y=17, Width=25, Height=25</li>
<li><em>Title</em>: None</li>
<li><em>Image</em>: play-25</li>
<li><em>Background Color</em>: From the <strong>Crayons</strong> Palette, select the <strong>Cantaloupe</strong> color.</li>
</ul>
<p>To the second button, set the next attributes:</p>
<ul>
<li><em>Frame</em>: X=275, Y=17, Width=25, Height=25</li>
<li><em>Title</em>: None</li>
<li><em>Image</em>: stop-25</li>
<li><em>Background Color</em>: From the <strong>Crayons</strong> Palette, select the <strong>Cantaloupe</strong> color.</li>
</ul>
<p>Get another <strong>UILabel</strong> from the Object Library, add it to the prototype cell, and set its next properties:</p>
<ul>
<li><em>Frame</em>: X=236, Y=17, Width=64, Height=25</li>
<li><em>Text</em>: Ready</li>
<li><em>Font Size</em>: 14.0</li>
<li><em>Color</em>: From the <strong>Crayons</strong> Palette, select the <strong>Clover</strong> color.</li>
<li><em>Hidden</em>: YES</li>
<li><em>Text Alignment</em>: Center</li>
</ul>
<p>Finally, add a <strong>UIProgressView</strong> object, setting its frame to (20, 49, 280, 2).</p>
<p>Your prototype cell should be similar to this one:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_6_prototype_cell.jpg" alt="Background Transfer Service - Table Cell" class="aligncenter size-full wp-image-3263" /></div>
<p>Before we add any more subviews to the interface, let&#8217;s set the <em>tag</em> values to the subviews of the prototype cell as shown below (the order matches to the order they presented):</p>
<ol>
<li>Label: 10</li>
<li>Start button: 20</li>
<li>Stop button: 30</li>
<li>Progress view: 40</li>
<li>Label (Ready): 50</li>
</ol>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_7_tag.jpg" alt="Background Transfer Service - Tag" class="aligncenter size-full wp-image-3264" /></div>
<p>Now, let&#8217;s keep going and let&#8217;s a couple of <strong>UIButton</strong> objects to the view, right under the table view.</p>
<p>For the first one:</p>
<ul>
<li><em>Frame</em>: X=60, Y=404, Width=200, Height=30</li>
<li><em>Title</em>: Start All Downloads</li>
<li><em>Text Color</em>: White</li>
<li><em>Background Color</em>: Aqua</li>
</ul>
<p>For the second one:</p>
<ul>
<li><em>Frame</em>: X=60, Y=453, Width=200, Height=30</li>
<li><em>Title</em>: Stop All Downloads</li>
<li><em>Text Color</em>: White</li>
<li><em>Background Color</em>: Aqua</li>
</ul>
<p>The user interface is ready. Here is a preview:</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_8_final_ib.jpg" alt="Background Transfer Service - Final Interface Builder" class="aligncenter size-full wp-image-3265" /></div>
<p>Now that all the subviews have been added to the main view, we must declare an IBOutlet property for the table view, and some IBAction methods that should be connected to the appropriate controls. Begin by opening the <em>ViewController.h</em> file. In there, add the next code segment:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ViewController <span style="color: #002200;">:</span> UIViewController<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>weak, nonatomic<span style="color: #002200;">&#41;</span> IBOutlet UITableView <span style="color: #002200;">*</span>tblFiles;<br />
<br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>startOrPauseDownloadingSingleFile<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>stopDownloading<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>startAllDownloads<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>stopAllDownloads<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<br />
<span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>initializeAll<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender;<br />
<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Return to the Interface Builder and connect the <em>tblFiles</em> property to the table view. Next, match the action methods with the subviews as shown below:</p>
<ol>
<li><strong>startOrPauseDownloadingSingleFile</strong>: Connect it to the start button of the prototype cell.</li>
<li><strong>stopDownloading</strong>: Connect it to the stop button of the prototype cell.</li>
<li><strong>startAllDownloads</strong>: Connect it to the first button below the table view, titled <em>Start All Downloads</em>.</li>
<li><strong>stopAllDownloads</strong>: Connect to the second button below the table view, titled <em>Stop All Downloads</em>.</li>
<li><strong>initializeAll</strong>: Connect it to the bar button item of the toolbar.</li>
</ol>
<p>The interface is now set up and configured, and that means that we can move forward to the implementation of the app.</p>
<h2>An Auxiliary Class</h2>
<p>Now that the interface of our app is ready, we can proceed in coding. However, before we perform any implementation, we are going in this part to create an auxiliary class that will help us keep vital data throughout the project. We&#8217;ll see everything in details, but first let&#8217;s add the class&#8217;s file to the project.</p>
<p>On your keyboard hit the Command-N combination to let Xcode present the guide for adding a new file. In the first window, select the <strong>Objective-C class</strong> in the <strong>Cocoa Touch</strong> category under the <strong>iOS</strong> section.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_9_add_class1.jpg" alt="Background Transfer Service - Add Class" class="aligncenter size-full wp-image-3266" /></div>
<p>Click Next and in the second step, in the <strong>Subclass of</strong> field add the <strong>NSObject</strong> value. Then, in the <strong>Class</strong> field set the <strong>FileDownloadInfo</strong> as the class name.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_10_add_class2.jpg" alt="Background Transfer Service - Add Class" class="aligncenter size-full wp-image-3267" /></div>
<p>Click on the Next button once again, and in the last step click on the Create button.</p>
<p>In this class we are going to declare a bunch of public properties, and a custom init method. Right next, I&#8217;m giving you the declarations in the <em>FileDownloadInfo.h</em> file. After that, I&#8217;ll provide a short description about each one.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> FileDownloadInfo <span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/"><span style="color: #400080;">NSObject</span></a><br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>fileTitle;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>downloadSource;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> NSURLSessionDownloadTask <span style="color: #002200;">*</span>downloadTask;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>taskResumeData;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic<span style="color: #002200;">&#41;</span> <span style="color: #a61390;">double</span> downloadProgress;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic<span style="color: #002200;">&#41;</span> <span style="color: #a61390;">BOOL</span> isDownloading;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic<span style="color: #002200;">&#41;</span> <span style="color: #a61390;">BOOL</span> downloadComplete;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic<span style="color: #002200;">&#41;</span> <span style="color: #a61390;">unsigned</span> <span style="color: #a61390;">long</span> taskIdentifier;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Here is what each property is for:</p>
<ul>
<li><em>fileTitle</em>: This property keeps a title describing the file to be downloaded (not the file name).</li>
<li><em>downloadSource</em>: The URL source where a file should be downloaded from as a NSString object.</li>
<li><em>downloadTask</em>: A <em>NSURLSessionDownloadTask</em> object that will be used to keep a strong reference to the download task of a file.</li>
<li><em>taskResumeData</em>: A NSData object that keeps the data produced by a cancelled download task that can be resumed at a later time (in other words, when it&#8217;s paused).</li>
<li><em>downloadProgress</em>: The download progress of a file as reported by the NSURLSession delegate methods.</li>
<li><em>isDownloading</em>: This flag, as its name suggests, indicates whether a file is being downloaded or not.</li>
<li><em>downloadComplete</em>: Indicates whether a file download has been completed.</li>
<li><em>taskIdentifier</em>: When a download task is initiated, the NSURLSession assigns it a unique identifier so it can be distinguished among others. The identifier values start from 0. In this property, we will assign the task identifier value of the <em>downloadTask</em> property (even though the <em>downloadTask</em> object has its own <em>taskIdentifier</em> property) just for our own convenience during implementation.</li>
</ul>
<p>Note that a download task provides ways for checking the download status of a file. However, we declared our own properties here so we can work more in convenient way.</p>
<p>Now that all the necessary properties have been declared, let&#8217;s create a custom init method. In this one, we will provide the file title and the download source as parameters. Here is the declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>initWithFileTitle<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>title andDownloadSource<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>source;</div></td></tr></tbody></table></div>
<p>Now, go to the <em>FileDownloadInfo.m</em> file, and implement it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>initWithFileTitle<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>title andDownloadSource<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>source<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>self <span style="color: #002200;">==</span> <span style="color: #002200;">&#91;</span>super init<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; self.fileTitle <span style="color: #002200;">=</span> title;<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.downloadSource <span style="color: #002200;">=</span> source;<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.downloadProgress <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.isDownloading <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.downloadComplete <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.taskIdentifier <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> self;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Our class is ready. As a final step, go to the <em>ViewController.m</em> file and import it, so we can use it later:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &quot;FileDownloadInfo.h&quot;</span></div></td></tr></tbody></table></div>
<h2>Enabling Background Modes</h2>
<p>Before we dive deep in writing code, we must do a necessary configuration, so our app be able to use the Background Transfer Service.</p>
<p>In the <strong>Project Navigator</strong>, select the project target at the top side. Next, in the main window click on the <strong>Capabilities</strong> tab, and all the features that you can enable or disable simply using a switch button will be displayed there. Among them, locate the <strong>Background Modes</strong> area (second from the end), and click on the switch button at its right to enable it.</p>
<div class="figure"><img src="http://www.appcoda.com/wp-content/uploads/2014/04/t9_11_capabilities.jpg" alt="Background Transfer Service - Capabilities" class="aligncenter size-full wp-image-3268" /></div>
<h2>Properties Initialization</h2>
<p>In this part of the tutorial we are going to perform two tasks: The first one is to declare some private properties in the <em>ViewController</em> class, as well as some constants, and the second is to initialize five <em>FileDownloadInfo</em> objects that will be used for handling all the download process.</p>
<p>Let&#8217;s begin by declaring some constants using the <em>#define</em> preprocessor command. These constants match to the tag values we set to the subviews of the prototype cell in the Interface Builder. We will perform this step even though is optional, so instead of having to remember the tag value of each subview, we will just use the constant name when we want to make a reference to any of them.</p>
<p>In the <em>ViewController.m</em> file, go to the top of it, right under the last <em>#import</em> command. Add the next lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #11740a; font-style: italic;">// Define some constants regarding the tag values of the prototype cell's subviews.</span><br />
<span style="color: #6e371a;">#define CellLabelTagValue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10</span><br />
<span style="color: #6e371a;">#define CellStartPauseButtonTagValue &nbsp; &nbsp;20</span><br />
<span style="color: #6e371a;">#define CellStopButtonTagValue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30</span><br />
<span style="color: #6e371a;">#define CellProgressBarTagValue &nbsp; &nbsp; &nbsp; &nbsp; 40</span><br />
<span style="color: #6e371a;">#define CellLabelReadyTagValue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;50</span></div></td></tr></tbody></table></div>
<p>Now, go to the private section of the class, and add the following three declarations:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> NSURLSession <span style="color: #002200;">*</span>session;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/"><span style="color: #400080;">NSMutableArray</span></a> <span style="color: #002200;">*</span>arrFileDownloadData;<br />
<br />
<span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, strong<span style="color: #002200;">&#41;</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> <span style="color: #002200;">*</span>docDirectoryURL;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>The <em>session</em> object is the NSURLSession session that we will create and use in our application. We will work with that in the next section. The <em>arrFileDownloadData</em> mutable array, is the array in which they will be stored the five <em>FileDownloadInfo</em> objects that we will create in a while, where each such object matches to a file. Finally, the <em>docDirectoryURL</em> property will be assigned with the URL of the Documents directory of the app. I emphasize to the fact that the path to the Documents directory will be expressed as a NSURL object instead of a NSString object, because when working with the NSURLSession class we mostly deal with NSURL objects.</p>
<p>Further than the above properties, declare a private method as well, in which we will make the array&#8217;s and the the <em>FileDownloadInfo</em> objects&#8217; initialization. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
...<br />
...<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>initializeFileDownloadDataArray;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>Let&#8217;s proceed now with the <em>initializeFileDownloadDataArray</em> method implementation. In the code fragment that follows, the array is firstly initialized and then they are added to it five <em>FileDownloadInfo</em> objects. These objects are initialized and added to the array at the same time. Note that we use the custom init method we created to the <em>FileDownloadInfo</em> class, so we provide as parameters both the file title and the download source for each one.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>initializeFileDownloadDataArray<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; self.arrFileDownloadData <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/"><span style="color: #400080;">NSMutableArray</span></a> alloc<span style="color: #002200;">&#93;</span> init<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.arrFileDownloadData addObject<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>FileDownloadInfo alloc<span style="color: #002200;">&#93;</span> initWithFileTitle<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;iOS Programming Guide&quot;</span> andDownloadSource<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;https://developer.apple.com/library/ios/documentation/iphone/conceptual/iphoneosprogrammingguide/iphoneappprogrammingguide.pdf&quot;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.arrFileDownloadData addObject<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>FileDownloadInfo alloc<span style="color: #002200;">&#93;</span> initWithFileTitle<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;Human Interface Guidelines&quot;</span> andDownloadSource<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/MobileHIG.pdf&quot;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.arrFileDownloadData addObject<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>FileDownloadInfo alloc<span style="color: #002200;">&#93;</span> initWithFileTitle<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;Networking Overview&quot;</span> andDownloadSource<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;https://developer.apple.com/library/ios/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/NetworkingOverview.pdf&quot;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.arrFileDownloadData addObject<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>FileDownloadInfo alloc<span style="color: #002200;">&#93;</span> initWithFileTitle<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;AV Foundation&quot;</span> andDownloadSource<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/AVFoundationPG.pdf&quot;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.arrFileDownloadData addObject<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>FileDownloadInfo alloc<span style="color: #002200;">&#93;</span> initWithFileTitle<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;iPhone User Guide&quot;</span> andDownloadSource<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;http://manuals.info.apple.com/MANUALS/1000/MA1565/en_US/iphone_user_guide.pdf&quot;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Now that this method has been defined, it must be called every time the app is launched. Therefore, go to the <em>viewDidLoad</em> method and make that call:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>viewDidLoad<br />
<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>super viewDidLoad<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self initializeFileDownloadDataArray<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>So far, so good! The array we just initialized and filled with objects will be used multiple times during the app implementation, and now that it&#8217;s ready we can move on and assign the appropriate value to the <em>docDirectoryURL</em> property. Add the next couple of lines to the <em>viewDidLoad</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>URLs <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">&#93;</span> URLsForDirectory<span style="color: #002200;">:</span>NSDocumentDirectory inDomains<span style="color: #002200;">:</span>NSUserDomainMask<span style="color: #002200;">&#93;</span>;<br />
self.docDirectoryURL <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>URLs objectAtIndex<span style="color: #002200;">:</span><span style="color: #2400d9;">0</span><span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>Lastly, add the next few lines that make <em>self</em> the delegate and datasource of the table view, and disable the scrolling on it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #11740a; font-style: italic;">// Make self the delegate and datasource of the table view.</span><br />
self.tblFiles.delegate <span style="color: #002200;">=</span> self;<br />
self.tblFiles.dataSource <span style="color: #002200;">=</span> self;<br />
<br />
<span style="color: #11740a; font-style: italic;">// Disable scrolling in table view.</span><br />
self.tblFiles.scrollEnabled <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;</div></td></tr></tbody></table></div>
<h2>Table View Preparation</h2>
<p>Up to this point, we created the custom class that we will use in our project, we declared some private properties and we did some initializations. Now, before we dive in the Background Transfer Service details, it&#8217;s the best time to implement the minimum delegate and datasource table view methods required by our app to run.</p>
<p>First of all, open the <em>ViewController.h</em> file and modify the <em>@interface</em> header line, so our class conforms to the <em>UITableViewDelegate</em> and <em>UITableViewDataSource</em> protocols as shown below:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ViewController <span style="color: #002200;">:</span> UIViewController &lt;UITableViewDelegate, UITableViewDataSource&gt;</div></td></tr></tbody></table></div>
<p>Now, return to the <em>ViewController.m</em> file, and add the next three methods:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>NSInteger<span style="color: #002200;">&#41;</span>numberOfSectionsInTableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">1</span>;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>NSInteger<span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView numberOfRowsInSection<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSInteger<span style="color: #002200;">&#41;</span>section<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> self.arrFileDownloadData.count;<br />
<span style="color: #002200;">&#125;</span><br />
<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>CGFloat<span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView heightForRowAtIndexPath<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>indexPath<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">60.0</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>We&#8217;ve left the <em>tableView:cellForRowAtIndexPath:</em> method to implement. Before I present it, let me say in short what is going to take place in it.</p>
<ol>
<li>At first, we will dequeue the cell.</li>
<li>We will get the appropriate <em>FileDownloadInfo</em> object from the <em>arrFileDownloadData</em> array based on the <em>indexPath.row</em> value for accessing the respective file&#8217;s download properties.</li>
<li>We will get all the cell&#8217;s subviews using their tag values, and we will assign them to local variables for easy access.</li>
<li>We will declare a local variable for storing the appropriate image name for the start button.</li>
<li>We will set the file&#8217;s title to the appropriate label of the cell.</li>
<li>If the file is not being downloaded, meaning that the <em>isDownloading</em> property of the respective <em>FileDownloadInfo</em> object is false, then: A. The progress view will become hidden, B. The stop button will become disabled. C. Depending on whether the download is complete or not (the <em>downloadComplete</em> property of the <em>FileDownloadInfo</em> object), we will either display the start and stop buttons, or the label with the <em>Ready</em> text. D. We&#8217;ll define the <em>play-25</em> as the image name for the start button, which will prompt to tap it for starting the download.</li>
<li>If the file is being downloaded, then: A. We will show the progress view. B. We will enable the stop button. C. We will change the start button&#8217;s image name to <em>pause-25</em>.</li>
<li>Finally, we will set the appropriate image to the start button depending on any case of the above.</li>
</ol>
<p>Here is the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br />46<br />47<br />48<br />49<br />50<br />51<br />52<br />53<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span>UITableViewCell <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UITableView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>tableView cellForRowAtIndexPath<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>indexPath<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; UITableViewCell <span style="color: #002200;">*</span>cell <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>tableView dequeueReusableCellWithIdentifier<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;idCell&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>cell <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; cell <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>UITableViewCell alloc<span style="color: #002200;">&#93;</span> initWithStyle<span style="color: #002200;">:</span>UITableViewCellStyleDefault reuseIdentifier<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;idCell&quot;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the respective FileDownloadInfo object from the arrFileDownloadData array.</span><br />
&nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>indexPath.row<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get all cell's subviews.</span><br />
&nbsp; &nbsp; UILabel <span style="color: #002200;">*</span>displayedTitle <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UILabel <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span><span style="color: #2400d9;">10</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; UIButton <span style="color: #002200;">*</span>startPauseButton <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UIButton <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span>CellStartPauseButtonTagValue<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; UIButton <span style="color: #002200;">*</span>stopButton <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UIButton <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span>CellStopButtonTagValue<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; UIProgressView <span style="color: #002200;">*</span>progressView <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UIProgressView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span>CellProgressBarTagValue<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; UILabel <span style="color: #002200;">*</span>readyLabel <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UILabel <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span>CellLabelReadyTagValue<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>startPauseButtonImageName;<br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Set the file title.</span><br />
&nbsp; &nbsp; displayedTitle.text <span style="color: #002200;">=</span> fdi.fileTitle;<br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Depending on whether the current file is being downloaded or not, specify the status</span><br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// of the progress bar and the couple of buttons on the cell.</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">!</span>fdi.isDownloading<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Hide the progress view and disable the stop button.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; progressView.hidden <span style="color: #002200;">=</span> <span style="color: #a61390;">YES</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; stopButton.enabled <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Set a flag value depending on the downloadComplete property of the fdi object.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Using it will be shown either the start and stop buttons, or the Ready label.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">BOOL</span> hideControls <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>fdi.downloadComplete<span style="color: #002200;">&#41;</span> ? <span style="color: #a61390;">YES</span> <span style="color: #002200;">:</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; startPauseButton.hidden <span style="color: #002200;">=</span> hideControls;<br />
&nbsp; &nbsp; &nbsp; &nbsp; stopButton.hidden <span style="color: #002200;">=</span> hideControls;<br />
&nbsp; &nbsp; &nbsp; &nbsp; readyLabel.hidden <span style="color: #002200;">=</span> <span style="color: #002200;">!</span>hideControls;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; startPauseButtonImageName <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;play-25&quot;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Show the progress view and update its progress, change the image of the start button so it shows</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// a pause icon, and enable the stop button.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; progressView.hidden <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; progressView.progress <span style="color: #002200;">=</span> fdi.downloadProgress;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; stopButton.enabled <span style="color: #002200;">=</span> <span style="color: #a61390;">YES</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; startPauseButtonImageName <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;pause-25&quot;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Set the appropriate image to the start button.</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>startPauseButton setImage<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>UIImage imageNamed<span style="color: #002200;">:</span>startPauseButtonImageName<span style="color: #002200;">&#93;</span> forState<span style="color: #002200;">:</span>UIControlStateNormal<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Ready! At this point, you may test the app for first time. Don&#8217;t expect anything to work yet, you will just see its appearance.</p>
<h2>Creating a Session</h2>
<p>Previously, we declared a private property named <em>session</em>, which is an object of the NSURLSession class, and now we are going to work with it. In order to create a session for initiating download or upload tasks either on the background or the foreground, another class must be used, and that is the <em>NSURLSessionConfiguration</em> class. Through this, various session properties and policies can be set, a list of which you can find <a href="https://developer.apple.com/library/ios/documentation/Foundation/Reference/NSURLSessionConfiguration_class/Reference/Reference.html">here</a>.</p>
<p>What we are going to do here is pretty straightforward: At first, we will <em>instantiate</em> a NSURLSessionConfiguration object using the <em>backgroundSessionConfiguration</em> class method, we will set a desired property value, and then we will <em>instantiate</em> the <em>session</em> property.</p>
<p>Note: The <em>backgroundSessionConfiguration</em> class method is used when it&#8217;s desirable to perform background tasks. However, there are two more class methods for instantiating a session configuration object: The <em>defaultSessionConfiguration</em> which causes the session to behave just like the NSURLConnection with a default configuration, and the <em>ephemeralSessionConfiguration</em> which is useful when no persistent data storage of cookies or credentials is required.</p>
<p>The <em>backgroundSessionConfiguration</em> class method accepts one parameter, <em>an identifier</em>, which uniquely identifies the session started by our app in the system. It&#8217;s not possible two sessions with the same identifier to exist at the same time. In the returned configuration object by the above method, we will set only one property, the <em>HTTPMaximumConnectionsPerHost</em>. Through this, we will allow five simultaneous downloads to take place at once. In code, go to the <em>viewDidLoad</em> method and add the next lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">NSURLSessionConfiguration <span style="color: #002200;">*</span>sessionConfiguration <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>NSURLSessionConfiguration backgroundSessionConfiguration<span style="color: #002200;">:</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;com.BGTransferDemo&quot;</span><span style="color: #002200;">&#93;</span>;<br />
sessionConfiguration.HTTPMaximumConnectionsPerHost <span style="color: #002200;">=</span> <span style="color: #2400d9;">5</span>;</div></td></tr></tbody></table></div>
<p>You see that as the identifier value for our configuration object we set the <em>com.BGTransferDemo</em>. That is not set of stone, you can use any string that uniquely identifies the app in the system.</p>
<p>The next step that must be performed, is to instantiate the <em>session</em> property using the <em>sessionConfiguration</em> object. Here is how this is done:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">self.session <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>NSURLSession sessionWithConfiguration<span style="color: #002200;">:</span>sessionConfiguration<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;delegate<span style="color: #002200;">:</span>self<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delegateQueue<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>By writing three simple lines, a NSURLSession session has been instantiated and is now ready to be used in order to fire background download tasks.</p>
<p>Don&#8217;t worry if by setting <em>self</em> as the delegate of the session will make Xcode to issue some warnings. To silence it, open the <em>ViewController.h</em> file and modify the <em>@interface</em> header line to adopt the next protocol, as it seems right next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ViewController <span style="color: #002200;">:</span> UIViewController &lt;UITableViewDelegate, UITableViewDataSource, NSURLSessionDelegate&gt;</div></td></tr></tbody></table></div>
<h2>Starting a Download Task</h2>
<p>The <em>session</em> object we just instantiated, offers a variety of methods that allow to initiate a background download task. In our case, we&#8217;ll use the <em>downloadTaskWithURL:</em> method, which accepts a NSURL object as its parameter. Once it gets called, the file download begins. However, before we get there, let&#8217;s see everything step by step.</p>
<p>Earlier, when we designed the app interface in the Interface Builder, we declared some IBAction methods and we connected them to various subviews. To initiate, pause and resume a download task, we are going to use the <em>startOrPauseDownloadingSingleFile:</em> one. The steps we will make in it, are the following:</p>
<ol>
<li>At first, we will make sure that the start button of a table view cell was tapped, simply by checking its <em>superview class</em>.</li>
<li>Next, we will specify the index path of the cell the start button belongs to.</li>
<li>Based on the index path&#8217;s <em>row</em> property, we will get the <em>FileDownloadInfo</em> object from the respective index of the <em>arrFileDownloadData</em> array.</li>
<li>We will check the <em>isDownloading</em> property, and if the specific file is not being downloaded, <em>or if the download task is not paused</em>, we will create a new download task using the <em>downloadTaskWithURL:</em> method of the <em>session</em> property.</li>
</ol>
<p>Let&#8217;s see the implementation now, and we&#8217;ll discuss a bit more later:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44<br />45<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>startOrPauseDownloadingSingleFile<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if the parent view of the sender button is a table view cell.</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>sender superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span> isKindOfClass<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>UITableViewCell class<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the container cell.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; UITableViewCell <span style="color: #002200;">*</span>containerCell <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UITableViewCell <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>sender superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the row (index) of the cell. We'll keep the index path as well, we'll need it later.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> <span style="color: #002200;">*</span>cellIndexPath <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.tblFiles indexPathForCell<span style="color: #002200;">:</span>containerCell<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">int</span> cellIndex <span style="color: #002200;">=</span> cellIndexPath.row;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the FileDownloadInfo object being at the cellIndex position of the array.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>cellIndex<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// The isDownloading property of the fdi object defines whether a downloading should be started</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// or be stopped.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">!</span>fdi.isDownloading<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// This is the case where a download task should be started.</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Create a new task, but check whether it should be created using a URL or resume data.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>fdi.taskIdentifier <span style="color: #002200;">==</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// If the taskIdentifier property of the fdi object has value -1, then create a new task</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// providing the appropriate URL as the download source.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadTask <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.session downloadTaskWithURL<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> URLWithString<span style="color: #002200;">:</span>fdi.downloadSource<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Keep the new task identifier.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.taskIdentifier <span style="color: #002200;">=</span> fdi.downloadTask.taskIdentifier;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Start the task.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fdi.downloadTask resume<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// The resume of a download task will be done here.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// &nbsp;The pause of a download task will be done here.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Change the isDownloading property value.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.isDownloading <span style="color: #002200;">=</span> <span style="color: #002200;">!</span>fdi.isDownloading;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the table view.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.tblFiles reloadRowsAtIndexPaths<span style="color: #002200;">:</span>@<span style="color: #002200;">&#91;</span>cellIndexPath<span style="color: #002200;">&#93;</span> withRowAnimation<span style="color: #002200;">:</span>UITableViewRowAnimationNone<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>First of all, let me justify the use of <em>[[[[sender superview] superview] superview]</em> in the first <em>if</em> condition. All the subviews we added to the prototype cells, belong to a view named <em>content view</em>, and this content view is a subview of a <em>scroll view</em>. The scroll view is actually a direct subview of the cell, that&#8217;s why we use the <em>superview</em> property so many times.</p>
<p>If you carefully see the above code snippet, you&#8217;ll notice that we check if a download task exists or not by using the <em>taskIdentifier</em> property of our custom class. When a new download task gets started, this property gets the tasks&#8217;s identifier value, so it stops having the −1 value. Further than that, the newly created download task is assigned to the <em>downloadTask</em> of the <em>fdi</em> object, so we can have a strong reference to it and access it directly later on.</p>
<p>Note that at the end of the method we change the <em>isDownloading</em> property value and we assign it the exact opposite value. The last step that is being performed, it the reloading of the appropriate table view row.</p>
<p>Beyond all that, it&#8217;s now clear how handful the <em>FileDownloadInfo</em> custom class we previously created is. By using its simple properties, we can control the behavior of a download task. Finally, as you see there are two <em>else</em> cases, which will be used for pausing and resuming a task, but that&#8217;s something that we will work with later.</p>
<p>At this point, you may run the app and tap on the start button (or click on the Simulator) of any file. I guarantee that the file will be perfectly downloaded, however you are not going to acknowledge it, as for the time being we haven&#8217;t implemented any report or other delegate methods. Moreover, the downloaded file is never going to be placed to the Documents directory, as that&#8217;s something that we must implement too.</p>
<h2>Tracking Progress</h2>
<p>A very important step was just implemented, by making a download task to get started. However, we are unable to know if the download is actually being performed, as we haven&#8217;t implemented any delegate method that could help us with that yet. So, in this part of the tutorial, let&#8217;s focus our attention on how we can manage to get the progress of a file download, and how we can reflect this progress visually to the user. That means in our app that we must update the progress view of each file that is being downloaded. By doing so we will succeed two things: The first (and obvious) is to keep us or our users informed about the whole progress, and the second is that by using a progress view, the app will become more alive.</p>
<p>There are numerous delegate methods that one could implement depending on the requirements of each application. To keep track of the download progress, there is the <em>URLSession:downloadTask:didWriteData:totalBytesWritten:totalBytesExpectedToWrite:</em> delegate method, which we are going to implement right now. Let&#8217;s have a look at it first, then we&#8217;ll talk about it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>URLSession<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session downloadTask<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSessionDownloadTask <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>downloadTask didWriteData<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>int64_t<span style="color: #002200;">&#41;</span>bytesWritten totalBytesWritten<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>int64_t<span style="color: #002200;">&#41;</span>totalBytesWritten totalBytesExpectedToWrite<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>int64_t<span style="color: #002200;">&#41;</span>totalBytesExpectedToWrite<span style="color: #002200;">&#123;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>totalBytesExpectedToWrite <span style="color: #002200;">==</span> NSURLSessionTransferSizeUnknown<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; NSLog<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;Unknown transfer size&quot;</span><span style="color: #002200;">&#41;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span> &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Locate the FileDownloadInfo object among all based on the taskIdentifier property of the task.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">int</span> index <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self getFileDownloadInfoIndexWithTaskIdentifier<span style="color: #002200;">:</span>downloadTask.taskIdentifier<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>index<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a> mainQueue<span style="color: #002200;">&#93;</span> addOperationWithBlock<span style="color: #002200;">:^</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Calculate the progress.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadProgress <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">double</span><span style="color: #002200;">&#41;</span>totalBytesWritten <span style="color: #002200;">/</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">double</span><span style="color: #002200;">&#41;</span>totalBytesExpectedToWrite;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the progress view of the appropriate cell and update its progress.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UITableViewCell <span style="color: #002200;">*</span>cell <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.tblFiles cellForRowAtIndexPath<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> indexPathForRow<span style="color: #002200;">:</span>index inSection<span style="color: #002200;">:</span><span style="color: #2400d9;">0</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UIProgressView <span style="color: #002200;">*</span>progressView <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UIProgressView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span>CellProgressBarTagValue<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; progressView.progress <span style="color: #002200;">=</span> fdi.downloadProgress; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span> &nbsp; &nbsp;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>The first thing we have to do, is to check if the system is aware of the size of the file that&#8217;s being downloaded. We will proceed with the progress update if only this data exists. If the file size is unknown, we simply display a message to the debugger, as there is no need to do anything else here.</p>
<p>The important part however is in the <em>else</em> clause. First of all, with these two lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">int</span> index <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self getFileDownloadInfoIndexWithTaskIdentifier<span style="color: #002200;">:</span>downloadTask.taskIdentifier<span style="color: #002200;">&#93;</span>;<br />
FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>index<span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>we locate the index of the appropriate <em>FileDownloadInfo</em> object in the <em>arrFileDownloadData</em> array, based on the task description of the <em>downloadTask</em> parameter object, and we use a local pointer to access it. The <em>getFileDownloadInfoIndexWithTaskIdentifier:</em> is a private method that we will implement in a while.</p>
<p>Next, because the download task works in background threads, any visual upgrades must take place in the main thread of the app. So, inside the block of the <em>addOperationWithBlock:</em> method of the main queue operation, at first we calculate the progress as a double value and then assign it to the <em>downloadProgress</em> property of the <em>fdi</em> object:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">fdi.downloadProgress <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">double</span><span style="color: #002200;">&#41;</span>totalBytesWritten <span style="color: #002200;">/</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">double</span><span style="color: #002200;">&#41;</span>totalBytesExpectedToWrite;</div></td></tr></tbody></table></div>
<p>Next we locate the cell matching to the file index that&#8217;s being downloaded:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">UITableViewCell <span style="color: #002200;">*</span>cell <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.tblFiles cellForRowAtIndexPath<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> indexPathForRow<span style="color: #002200;">:</span>index inSection<span style="color: #002200;">:</span><span style="color: #2400d9;">0</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>Then we get access to the progress view of the cell:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">UIProgressView <span style="color: #002200;">*</span>progressView <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UIProgressView <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span>cell viewWithTag<span style="color: #002200;">:</span>CellProgressBarTagValue<span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>Finally we update its progress value:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap">progressView.progress <span style="color: #002200;">=</span> fdi.downloadProgress;</div></td></tr></tbody></table></div>
<p>That easy! Every time that the system reports back any progress, we reflect it to the respective progress view.</p>
<p>Now, let&#8217;s implement the <em>getFileDownloadInfoIndexWithTaskIdentifier:</em> we just used. First, it must be declared, so go to the private section of the interface and make its declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@interface</span> ViewController <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><br />
...<br />
...<br />
<br />
<span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span><span style="color: #002200;">&#41;</span>getFileDownloadInfoIndexWithTaskIdentifier<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">unsigned</span> <span style="color: #a61390;">long</span><span style="color: #002200;">&#41;</span>taskIdentifier;<br />
<br />
<span style="color: #a61390;">@end</span></div></td></tr></tbody></table></div>
<p>It&#8217;s implementation is very simple. In a loop, we&#8217;ll access all <em>FileDownloadInfo</em> objects of the <em>arrFileDownloadData</em> array one by one, until we find the task with identifier matching to the parameter&#8217;s one. When it&#8217;s found, we&#8217;ll just break the loop and we&#8217;ll return the found index value. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span><span style="color: #002200;">&#41;</span>getFileDownloadInfoIndexWithTaskIdentifier<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">unsigned</span> <span style="color: #a61390;">long</span><span style="color: #002200;">&#41;</span>taskIdentifier<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">int</span> index <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span>;<br />
&nbsp; &nbsp; <span style="color: #a61390;">for</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span> i<span style="color: #002200;">=</span><span style="color: #2400d9;">0</span>; i&lt;<span style="color: #002200;">&#91;</span>self.arrFileDownloadData count<span style="color: #002200;">&#93;</span>; i<span style="color: #002200;">++</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>i<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>fdi.taskIdentifier <span style="color: #002200;">==</span> taskIdentifier<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index <span style="color: #002200;">=</span> i;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">break</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">return</span> index;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Go and give the app a try now. When you&#8217;ll start a file download, you&#8217;ll see the progress view indicating the progress of the download. That&#8217;s fine, but yet there&#8217;s the need to handle the downloaded file, and that&#8217;s something that we&#8217;ll do in the next part.</p>
<h2>Finishing Actions</h2>
<p>Every time a download is over, the downloaded file must be copied from a temporary location where it resides to the Documents directory of the app. Besides that, it&#8217;s necessary to know when a download has finished, so we can update our interface.</p>
<p>Previously, we implemented one of the many delegate methods provided, and using it we managed to report progress to the user. Now, we are going to implement two other delegate methods as well, where the most work will be done to the first one.</p>
<p>So, the first delegate method we are going to work with, is the <em>URLSession:downloadTask:didFinishDownloadingToURL:</em>. This one is called by the system every time a download is over, and is our duty to write the appropriate code in order to get the file from its temporary location (the third parameter of the method).</p>
<p>Before I comment any further, let me present its implementation and after that I will point out the most important parts of it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>URLSession<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session downloadTask<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSessionDownloadTask <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>downloadTask didFinishDownloadingToURL<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>location<span style="color: #002200;">&#123;</span><br />
<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/"><span style="color: #400080;">NSFileManager</span></a> <span style="color: #002200;">*</span>fileManager <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>destinationFilename <span style="color: #002200;">=</span> downloadTask.originalRequest.URL.lastPathComponent;<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> <span style="color: #002200;">*</span>destinationURL <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.docDirectoryURL URLByAppendingPathComponent<span style="color: #002200;">:</span>destinationFilename<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span>fileManager fileExistsAtPath<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>destinationURL path<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fileManager removeItemAtURL<span style="color: #002200;">:</span>destinationURL error<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">BOOL</span> success <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>fileManager copyItemAtURL<span style="color: #002200;">:</span>location<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; toURL<span style="color: #002200;">:</span>destinationURL<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error<span style="color: #002200;">:&amp;</span>amp;error<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>success<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Change the flag values of the respective FileDownloadInfo object.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">int</span> index <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self getFileDownloadInfoIndexWithTaskIdentifier<span style="color: #002200;">:</span>downloadTask.taskIdentifier<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>index<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.isDownloading <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadComplete <span style="color: #002200;">=</span> <span style="color: #a61390;">YES</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Set the initial value to the taskIdentifier property of the fdi object,</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// so when the start button gets tapped again to start over the file download.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.taskIdentifier <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// In case there is any resume data stored in the fdi object, just make it nil.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.taskResumeData <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a> mainQueue<span style="color: #002200;">&#93;</span> addOperationWithBlock<span style="color: #002200;">:^</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the respective table view row using the main thread.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.tblFiles reloadRowsAtIndexPaths<span style="color: #002200;">:</span>@<span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> indexPathForRow<span style="color: #002200;">:</span>index inSection<span style="color: #002200;">:</span><span style="color: #2400d9;">0</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;withRowAnimation<span style="color: #002200;">:</span>UITableViewRowAnimationNone<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; NSLog<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;Unable to copy temp file. Error: %@&quot;</span>, <span style="color: #002200;">&#91;</span>error localizedDescription<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>At the beginning of the method, with these two lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>destinationFilename <span style="color: #002200;">=</span> downloadTask.originalRequest.URL.lastPathComponent;<br />
<a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> <span style="color: #002200;">*</span>destinationURL <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.docDirectoryURL URLByAppendingPathComponent<span style="color: #002200;">:</span>destinationFilename<span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>we specify the destination URL where the file will be copied permanently. The <em>lastPathComponent</em> property seen above is very useful, as it provides the <em>actual file name</em>, along with its extension (for instance, <em>networkingoverview.pdf</em>). You may wonder why we use that way to get the destination file name first, and then form the destination path with that file name, instead of using the <em>location</em> parameter value. Well, the truth is that the <em>location</em> value does not contain the actual name of the file; a random series of characters or digits is used instead.</p>
<p>The next move is to check if the file already exists in the Documents directory, using the <em>fileManager</em> object that was instantiated at the beginning of the method, and the <em>destinationURL</em> value. If it already exists, then is being removed.</p>
<p>The file copying process takes place here:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">BOOL</span> success <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>fileManager copyItemAtURL<span style="color: #002200;">:</span>location<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; toURL<span style="color: #002200;">:</span>destinationURL<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error<span style="color: #002200;">:&amp;</span>amp;error<span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>We&#8217;re taking the file from the <em>location</em> path and we&#8217;re copying it to the <em>destinationURL</em> path. The outcome of this is stored to the <em>success</em> flag.</p>
<p>If the copying above is successful, then a series of actions must be taken. At first, using the <em>getFileDownloadInfoIndexWithTaskIdentifier:</em> private method we previously implemented, we locate the index of the respective <em>FileDownloadInfo</em> object in the <em>arrFileDownloadData</em> array, and we use the <em>fdi</em> pointer for easier access. Next, we indicate that the file is not being downloaded and that the download is complete. The <em>taskIdentifier</em> property gets its initial value (-1), while the <em>taskResumeData</em> property gets the nil value in case it contains any resume data. Finally, using the main thread, the appropriate table view row is reloaded, so the label with the <em>Ready</em> text to be shown and the start and stop buttons to be hidden.</p>
<p>The other delegate method we will implement, is useful in case we want to track down any error that may occurred during a download process. It&#8217;s implementation is very simple as you&#8217;ll see, and of course, the way this method is used to every application depends on its nature. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>URLSession<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session task<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSessionTask <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>task didCompleteWithError<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>error<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>error <span style="color: #002200;">!=</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; NSLog<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;Download completed with error: %@&quot;</span>, <span style="color: #002200;">&#91;</span>error localizedDescription<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; NSLog<span style="color: #002200;">&#40;</span><span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;Download finished successfully.&quot;</span><span style="color: #002200;">&#41;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>As you see, we only log a message depending on whether there is an error or not. However, let me clear out that is called even when a download task is cancelled, as the cancelation is treated as an error by the method. Later on, when the pause and stop functionality will have been implemented, you&#8217;ll notice that every time you stop a task, the <em>Download completed with error: Cancelled</em> message will appear to the debugger.</p>
<p>In our implementation we didn&#8217;t do much here. In real-world applications, you&#8217;ll definitely need to add some serious code here and handle each state.</p>
<p>Feel free now to run the app, and initiate a download. Wait until it finishes, and then see the start-stop buttons going away, while the <em>Ready</em> label is appeared. Moreover, locate the Documents directory of the app on your hard drive, and confirm that the file has been downloaded.</p>
<h2>Pause, Resume and Stop a Download Task</h2>
<p>Until now, we are able to initiate a file download process, to track its progress and to perform any required actions upon finishing, however we still cannot pause or stop a download task. In this part, we are going to implement these two features too, so our sample app reaches the perfection even more.</p>
<p>Before getting into details, let me clarify a couple of facts. First of all, the phrase <em>pause a download task</em> is good enough to make us understand the concept of our discussion, however programmatically speaking this is not accurate. The truth is that either we want to pause or stop a download task, we must perform the same action, <em>to cancel the task</em>. The difference is that in the first case the download task produces some <em>data for resuming</em> the download, while in the second case that doesn&#8217;t happen. In both cases, the task gets destroyed and if it&#8217;s desirable to resume the download, a new task is created using the resume data earlier produced.</p>
<p>So, after having made that clarification, let&#8217;s see how to implement everything described in the title of this section. For starters, go to the <em>startOrPauseDownloadingSingleFile:</em> IBAction method, and locate the second <em>else</em> case with the next comment in it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #11740a; font-style: italic;">// &nbsp;The pause of a download task will be done here.</span></div></td></tr></tbody></table></div>
<p>As you understand, we&#8217;ll begin by pausing a task. The NSURLSessionDownloadTask class, provides a really convenient method to cancel a task and get the resume data at the same time, the <em>cancelByProducingResumeData:</em>. It&#8217;s parameter is a block, where the resume data is provided as an argument, and in there we must implement the logic code for storing the resume data.</p>
<p>Right next, it is the implementation of the pause functionality. It&#8217;s quite simple, as we just get the resume data provided by the block and we store it to the <em>taskResumeData</em> property of the appropriate <em>FileDownloadInfo</em> object. If you want, take a look to the already implemented part of the method in order to remember what we&#8217;ve done so far.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #11740a; font-style: italic;">// Pause the task by canceling it and storing the resume data.</span><br />
<span style="color: #002200;">&#91;</span>fdi.downloadTask cancelByProducingResumeData<span style="color: #002200;">:^</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>resumeData<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
<span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>resumeData <span style="color: #002200;">!=</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; fdi.taskResumeData <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a> alloc<span style="color: #002200;">&#93;</span> initWithData<span style="color: #002200;">:</span>resumeData<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span><span style="color: #002200;">&#93;</span>;</div></td></tr></tbody></table></div>
<p>If you go and run the app, you&#8217;ll see that by tapping (or clicking) on the pause button, the download stops, and in the debugger is shown the <em>Download completed with error: Cancelled</em> message. That&#8217;s really cool, but we must now be able to resume the download.</p>
<p>To do so, find the next comment in the IBAction method you are currently in:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #11740a; font-style: italic;">// The resume of a download task will be done here.</span></div></td></tr></tbody></table></div>
<p>In its position, add the following code segment that performs the resuming.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #11740a; font-style: italic;">// Create a new download task, which will use the stored resume data.</span><br />
fdi.downloadTask <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.session downloadTaskWithResumeData<span style="color: #002200;">:</span>fdi.taskResumeData<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#91;</span>fdi.downloadTask resume<span style="color: #002200;">&#93;</span>;<br />
<br />
<span style="color: #11740a; font-style: italic;">// Keep the new download task identifier.</span><br />
fdi.taskIdentifier <span style="color: #002200;">=</span> fdi.downloadTask.taskIdentifier;</div></td></tr></tbody></table></div>
<p>This time, a new download task is created by using the <em>downloadTaskWithResumeData:</em> method of the <em>session</em> object. This new task is assigned to the <em>downloadTask</em> object for future access, and then it&#8217;s resumed. Finally, the new task identifier is stored to the respective property.</p>
<p>Easy enough, don&#8217;t you agree? Test again the app if you want. This time you can start a download, and then pause and resume it. That&#8217;s great, but how to stop a download?</p>
<p>Well, stoping a download will seem to you pretty straightforward, after having done all the above with the download task. We are going to implement the <em>stopDownloading:</em> IBAction method, and as you&#8217;ll see in the code segment that follows, it&#8217;s pretty much like the <em>startOrPauseDownloadingSingleFile:</em> method at its beginning:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>stopDownloading<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>sender superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span> isKindOfClass<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>UITableViewCell class<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the container cell.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; UITableViewCell <span style="color: #002200;">*</span>containerCell <span style="color: #002200;">=</span> <span style="color: #002200;">&#40;</span>UITableViewCell <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>sender superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span> superview<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the row (index) of the cell. We'll keep the index path as well, we'll need it later.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a> <span style="color: #002200;">*</span>cellIndexPath <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.tblFiles indexPathForCell<span style="color: #002200;">:</span>containerCell<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">int</span> cellIndex <span style="color: #002200;">=</span> cellIndexPath.row;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the FileDownloadInfo object being at the cellIndex position of the array.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>cellIndex<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Cancel the task.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fdi.downloadTask cancel<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Change all related properties.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.isDownloading <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.taskIdentifier <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadProgress <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the table view.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.tblFiles reloadRowsAtIndexPaths<span style="color: #002200;">:</span>@<span style="color: #002200;">&#91;</span>cellIndexPath<span style="color: #002200;">&#93;</span> withRowAnimation<span style="color: #002200;">:</span>UITableViewRowAnimationNone<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>In short, once the appropriate <em>FileDownloadInfo</em> object gets located, the <em>downloadTask</em> property is used to cancel the download. Note that all the other related to the downloading properties get their proper values. Finally, the table view row is reloaded to visually upgrade the results of our action.</p>
<p>Now, you the app that can properly initiate, pause resume and stop a file download. So, give it a try.</p>
<h2>Starting Downloads All Together</h2>
<p>Now that we can download a single file, as well as to pause, resume and stop it, let&#8217;s see how we can initiate a mass download of all files. Actually, we can&#8217;t just start all downloads at once, but we can use a loop and then initiate every file download one by one.</p>
<p>For starters, let&#8217;s see the code that should be added to the <em>startAllDownloads:</em> IBAction method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>startAllDownloads<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Access all FileDownloadInfo objects using a loop.</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">for</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span> i<span style="color: #002200;">=</span><span style="color: #2400d9;">0</span>; i&lt;<span style="color: #002200;">&#91;</span>self.arrFileDownloadData count<span style="color: #002200;">&#93;</span>; i<span style="color: #002200;">++</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>i<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if a file is already being downloaded or not.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">!</span>fdi.isDownloading<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if should create a new download task using a URL, or using resume data.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>fdi.taskIdentifier <span style="color: #002200;">==</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadTask <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.session downloadTaskWithURL<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a> URLWithString<span style="color: #002200;">:</span>fdi.downloadSource<span style="color: #002200;">&#93;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadTask <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.session downloadTaskWithResumeData<span style="color: #002200;">:</span>fdi.taskResumeData<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Keep the new taskIdentifier.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fdi.taskIdentifier <span style="color: #002200;">=</span> fdi.downloadTask.taskIdentifier;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Start the download.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fdi.downloadTask resume<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Indicate for each file that is being downloaded.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.isDownloading <span style="color: #002200;">=</span> <span style="color: #a61390;">YES</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the table view.</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.tblFiles reloadData<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Nothing new takes place here. We have already met every single step, and now we just combine them. Using the <em>for</em> loop, we access one by one every <em>FileDownloadInfo</em> object in the <em>arrFileDownloadData</em> array. Our first concern is to check whether a file is already being downloaded or not, so if it isn&#8217;t to start it now. Next, it&#8217;s required to check using the <em>taskIdentifier</em> property if a new download task should be created for a full download, or simply to use any existing resume data and continue from where it was left off. In any case, all or any files that are not currently being downloaded begin doing so now. Finally, the table view is reloaded to update the interface as well.</p>
<p>After you have added the above code in the IBAction method, you can try the app and tap (or click) on the <em>Start All Downloads</em> button. For simplicity reasons, we don&#8217;t support mass pausing functionality.</p>
<h2>Canceling All Downloads</h2>
<p>Stoping all file downloads at once, is easier that starting them. Once again, our work almost in its entirety will take place in a loop. The logic is simple: Using a <em>for</em> loop, we&#8217;ll access each <em>FileDownloadInfo</em> object in the <em>arrFileDownladData</em> array. We will check if the <em>isDownloading</em> property is true, meaning that a download is in progress, and then we will cancel the respective task. Then, we will set the appropriate values to all related properties, and lastly we will reload the table view.</p>
<p>The implementation will take place in the <em>stopAllDownloads:</em> IBAction method. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>stopAllDownloads<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Access all FileDownloadInfo objects using a loop.</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">for</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span> i<span style="color: #002200;">=</span><span style="color: #2400d9;">0</span>; i&lt;<span style="color: #002200;">&#91;</span>self.arrFileDownloadData count<span style="color: #002200;">&#93;</span>; i<span style="color: #002200;">++</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>i<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if a file is being currently downloading.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>fdi.isDownloading<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Cancel the task.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fdi.downloadTask cancel<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Change all related properties.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.isDownloading <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.taskIdentifier <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadProgress <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadTask <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the table view.</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.tblFiles reloadData<span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>If you run the app now, you will manage to stop all downloads at once.</p>
<h2>Handling Downloads on the Background</h2>
<p>When the app is not running and background transfers (downloads or uploads) are active, the system wakes the app up in case it needs any credentials or it is necessary to inform it about a complete transfer. The second case is what we care about in this tutorial, and to be more precise, in here we will add the code that will handle all downloads that finish on the background while our app is inactive. To make it more spicy, after all transfers have finished, we will show a local notification to inform us about it.</p>
<p>Every time that the background thread of the system (the deamon) that is responsible for a file download of our app has messages for it, it calls the <em>application:handleEventsForBackgroundURLSession:completionHandler:</em> application delegate method. By doing so, the session identifier that woke the app up, along with a completion handler are passed to the app. The completion handler of the parameter must be stored locally, and called when all downloads are finished so the system knows that no more background activity is required (all transfers are complete) and any reserved resources to be freed up. Of course, upon each download finish, the <em>URLSession:downloadTask:didFinishDownloadingToURL:</em> delegate method is called to do all the finishing actions, such as copying the downloaded file from the temporary location to the Documents directory.</p>
<p>Let&#8217;s see all in action. At first, go to the <em>AppDelegate.h</em> file, and add the next property declaration:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #a61390;">@property</span> <span style="color: #002200;">&#40;</span>nonatomic, copy<span style="color: #002200;">&#41;</span> <span style="color: #a61390;">void</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">^</span>backgroundTransferCompletionHandler<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>;</div></td></tr></tbody></table></div>
<p>Next, go to the <em>AppDelegate.m</em> file, and add the next implementation of the application delegate method I previously mentioned:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>application<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>UIApplication <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>application handleEventsForBackgroundURLSession<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>identifier completionHandler<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">^</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span><span style="color: #002200;">&#41;</span>completionHandler<span style="color: #002200;">&#123;</span><br />
<br />
&nbsp; &nbsp; self.backgroundTransferCompletionHandler <span style="color: #002200;">=</span> completionHandler;<br />
<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>As you see, the completion handler passed from the system to our app is stored to the property we just declared. The <em>backgroundTransferCompletionHandler</em> is the one that is called when all downloads are complete.</p>
<p>Further than the above method, when the system has no more messages to send to our app after a background transfer, the <em>URLSessionDidFinishEventsForBackgroundURLSession:</em> NSURLSession delegate method is called. In that method we will make the call to the completion handler, and we will show the local notification.</p>
<p>For starters, go to the top of the <em>ViewController.m</em> file, and import the <em>AppDelegate.h</em> header file.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #6e371a;">#import &quot;AppDelegate.h&quot;</span></div></td></tr></tbody></table></div>
<p>In the implementation that follows, notice that we first make sure that all downloads are over. Once that&#8217;s true, we store locally the completion handler and make nil the <em>backgroundTransferCompletionHandler</em> property. The call to the local copy of completion handler must always take place in the main thread.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">void</span><span style="color: #002200;">&#41;</span>URLSessionDidFinishEventsForBackgroundURLSession<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span>NSURLSession <span style="color: #002200;">*</span><span style="color: #002200;">&#41;</span>session<span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; AppDelegate <span style="color: #002200;">*</span>appDelegate <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>UIApplication sharedApplication<span style="color: #002200;">&#93;</span>.delegate;<br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if all download tasks have been finished.</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.session getTasksWithCompletionHandler<span style="color: #002200;">:^</span><span style="color: #002200;">&#40;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>dataTasks, <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>uploadTasks, <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>downloadTasks<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span><span style="color: #002200;">&#91;</span>downloadTasks count<span style="color: #002200;">&#93;</span> <span style="color: #002200;">==</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>appDelegate.backgroundTransferCompletionHandler <span style="color: #002200;">!=</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Copy locally the completion handler.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">void</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">^</span>completionHandler<span style="color: #002200;">&#41;</span><span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">=</span> appDelegate.backgroundTransferCompletionHandler;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Make nil the backgroundTransferCompletionHandler.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; appDelegate.backgroundTransferCompletionHandler <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a> mainQueue<span style="color: #002200;">&#93;</span> addOperationWithBlock<span style="color: #002200;">:^</span><span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Call the completion handler to tell the system that there are no other background transfers.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; completionHandler<span style="color: #002200;">&#40;</span><span style="color: #002200;">&#41;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Show a local notification when all downloads are over.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UILocalNotification <span style="color: #002200;">*</span>localNotification <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>UILocalNotification alloc<span style="color: #002200;">&#93;</span> init<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; localNotification.alertBody <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">@</span><span style="color: #bf1d1a;">&quot;All files have been downloaded!&quot;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span><span style="color: #002200;">&#91;</span>UIApplication sharedApplication<span style="color: #002200;">&#93;</span> presentLocalNotificationNow<span style="color: #002200;">:</span>localNotification<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><span style="color: #002200;">&#93;</span>;<br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Beyond than calling the completion handler, you see that we setup and present a simple local notification, without playing any sound or showing a badge number to the app icon.</p>
<p>Making the operating system work with our app while it&#8217;s not running, is more or less that simple. Of course, in a real-world app the handling code could differentiate from the above, but the important is that you are now aware of the actions you should make.</p>
<h2>Reset All</h2>
<p>During the interface setup in the Interface Builder, we added to the toolbar a bar button item with the refresh icon, and at the moment is the only control in our app that we haven&#8217;t worked with. The purpose of this button is to re-initialize everything, so we can test the app without having to terminate and re-launch it. More specifically, when tapping this button, the properties of all the <em>FileDownloadInfo</em> objects will get their initial values, and all the downloaded files will be removed from the Documents directory.</p>
<p>The whole job will take place in the <em>initializeAll:</em> IBAction method. Here is the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br /></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">-</span> <span style="color: #002200;">&#40;</span>IBAction<span style="color: #002200;">&#41;</span>initializeAll<span style="color: #002200;">:</span><span style="color: #002200;">&#40;</span><span style="color: #a61390;">id</span><span style="color: #002200;">&#41;</span>sender <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Access all FileDownloadInfo objects using a loop and give all properties their initial values.</span><br />
&nbsp; &nbsp; <span style="color: #a61390;">for</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span> i<span style="color: #002200;">=</span><span style="color: #2400d9;">0</span>; i&lt;<span style="color: #002200;">&#91;</span>self.arrFileDownloadData count<span style="color: #002200;">&#93;</span>; i<span style="color: #002200;">++</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; FileDownloadInfo <span style="color: #002200;">*</span>fdi <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>self.arrFileDownloadData objectAtIndex<span style="color: #002200;">:</span>i<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">&#40;</span>fdi.isDownloading<span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fdi.downloadTask cancel<span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.isDownloading <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadComplete <span style="color: #002200;">=</span> <span style="color: #a61390;">NO</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.taskIdentifier <span style="color: #002200;">=</span> <span style="color: #002200;">-</span><span style="color: #2400d9;">1</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadProgress <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span>;<br />
&nbsp; &nbsp; &nbsp; &nbsp; fdi.downloadTask <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the table view.</span><br />
&nbsp; &nbsp; <span style="color: #002200;">&#91;</span>self.tblFiles reloadData<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/"><span style="color: #400080;">NSFileManager</span></a> <span style="color: #002200;">*</span>fileManager <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">&#93;</span>;<br />
<br />
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get all files in documents directory.</span><br />
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>allFiles <span style="color: #002200;">=</span> <span style="color: #002200;">&#91;</span>fileManager contentsOfDirectoryAtURL<span style="color: #002200;">:</span>self.docDirectoryURL<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;includingPropertiesForKeys<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options<span style="color: #002200;">:</span>NSDirectoryEnumerationSkipsHiddenFiles<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #a61390;">for</span> <span style="color: #002200;">&#40;</span><span style="color: #a61390;">int</span> i<span style="color: #002200;">=</span><span style="color: #2400d9;">0</span>; i&lt;<span style="color: #002200;">&#91;</span>allFiles count<span style="color: #002200;">&#93;</span>; i<span style="color: #002200;">++</span><span style="color: #002200;">&#41;</span> <span style="color: #002200;">&#123;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">&#91;</span>fileManager removeItemAtURL<span style="color: #002200;">:</span><span style="color: #002200;">&#91;</span>allFiles objectAtIndex<span style="color: #002200;">:</span>i<span style="color: #002200;">&#93;</span> error<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span><span style="color: #002200;">&#93;</span>;<br />
&nbsp; &nbsp; <span style="color: #002200;">&#125;</span><br />
<span style="color: #002200;">&#125;</span></div></td></tr></tbody></table></div>
<p>Note that this feature on the sample app is totally auxiliary, and it has nothing to do with the Background Transfer Service. We add it just for our own convenience.</p>
<h2>Compile and Run the App</h2>
<p>During the project&#8217;s implementation, there were many opportunities where you could have tried out the application. However, if you still haven&#8217;t done so, now that we&#8217;re almost at the end of this tutorial it the best time to do so. Run the app, either on the Simulator, or on a device, and play around with all the functionalities we added to it. Start, pause, resume and stop downloads, either for single files, or all together. Feel free to modify any part of the code, or download files other than those used here.</p>
<h2>Summary</h2>
<p>The Background Transfer Service, along with the NSURLSession and all related classes, consist of a big evolution regarding the multitasking in iOS. In this tutorial I tried to demonstrate only a way of using all that stuff, but there are more you should study if you are about to build such an app. Just a word of caution, be careful when using multitasking technologies so your app doesn&#8217;t exhaust the device&#8217;s resources (such as draining the battery). If you have never worked with that new technology in iOS but you are planning to do so, I hope I managed to show you the way. If not, I hope you find the tutorial interesting. Remember that the only thing that limits the creation of amazing new apps, is your imagination. So, get some ideas and start working. You have the tools, now add the art! Happy multitasking!</p>
<p>For your reference, you can <a href="https://dl.dropboxusercontent.com/u/2857188/BGTransferDemo.zip">download the complete Xcode project from here</a>.</p>
<p>Disclaimer: The copyright of the icons belongs to <a href="http://www.icons8.com">icons8</a>.</p>

<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:none;margin:20px 0 20px 0;text-align:center;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_336_280_Ad */
google_ad_slot = "4009415334";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div><h3>You May Like These:</h3><div style="clear: both"></div><div style="border: 0pt none ; margin: 0pt; padding: 0pt;"><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/uipageviewcontroller-tutorial-intro/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/06/UIPageViewController-Tutorial-Screen-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">How to Use UIPageViewController to Build Tutorial Screens</div></div></a><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/ios-programming-save-data-parse-cloud-tutorial/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/08/Parse-Backend-Tutorial-2-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Adding a Cloud Backend for Your iOS App Using Parse - Part 2</div></div></a><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/uipageviewcontroller-storyboard-tutorial/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/11/page-view-controller-1-150x150.jpeg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">How To Create UIPageViewController Using Storyboard</div></div></a><a onmouseout="this.style.backgroundColor='#FFFFFF'" onmouseover="this.style.backgroundColor='#EEEEEF'" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/understanding-key-value-observing-coding/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2014/08/kvo-featured-150x150.png) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Understanding Key-Value Observing and Coding</div></div></a></div><div style="clear: both"></div><span class="et_social_bottom_trigger"></span><!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="http://www.appcoda.com/background-transfer-service-ios7/"
    dc:identifier="http://www.appcoda.com/background-transfer-service-ios7/"
    dc:title="Background Transfer Service in iOS 7 SDK: How To Download File in Background"
    trackback:ping="http://www.appcoda.com/background-transfer-service-ios7/trackback/" />
</rdf:RDF>-->
</div><div class="post-meta"><span class="categories">Filed Under: <a href="http://www.appcoda.com/course/" rel="category tag">Course</a>, <a href="http://www.appcoda.com/course/intermediate/" rel="category tag">Intermediate</a>, <a href="http://www.appcoda.com/tutorials/" rel="category tag">Tutorials</a></span> <span class="tags">Tagged With: <a href="http://www.appcoda.com/tag/background-fetch/" rel="tag">background fetch</a>, <a href="http://www.appcoda.com/tag/ios-7/" rel="tag">iOS 7</a>, <a href="http://www.appcoda.com/tag/ios-programming/" rel="tag">iOS Programming</a>, <a href="http://www.appcoda.com/tag/nsurlsession/" rel="tag">NSURLSession</a>, <a href="http://www.appcoda.com/tag/xcode-5/" rel="tag">Xcode 5</a></span></div><div class="after-post widget-area"><div id="text-8" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Free Chapters of Our Swift Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="http://www.appcoda.com/wp-content/uploads/2014/10/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignright size-medium wp-image-4153" width="200" /></a>If you want to create an app but don't know where to begin, this book covers the whole aspect of Swift programming and iOS 8 development and shows you every step from an idea to a real app on App Store. This book features a lot of hands-on exercises and projects. You will first create a simple app, then prototype an app idea, and later add some features to it in each chapter, until a real app is built. Want to learn more? <a href="http://www.appcoda.com/swift/">Check it out here and get three free chapters.</a>
</p>
<br/></div>
		</div></div>
<div id="featured-page-2" class="widget featured-content featuredpage"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for our Free Tutorials</h4>
<div class="post-38 page type-page status-publish has-post-thumbnail hentry entry"><ul>
<li>Learn iOS Programming From Scratch</li>
<li>Step by Step Guide to Build Your First iPhone App</li>
<li>Complete Source Code for Your Reference</li>
<li>More Programming Tips and Tutorials to Come</li>
</ul>
<div class="enews">
<h4 class="widgettitle">Whatcha waiting for?</h4>
<form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" id="mce-EMAIL" placeholder="Enter your email address" required><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button"><br />
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"/><br />
</form>
</div>
</div></div></div>
</div></div><div class="author-box"><div><img alt='' src='http://2.gravatar.com/avatar/582c964c3dafd700a4df627225d859fe?s=70&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/582c964c3dafd700a4df627225d859fe?s=140&amp;d=mm&amp;r=g 2x' class='avatar avatar-70 photo' height='70' width='70' /> <strong>About Gabriel Theodoropoulos</strong><br /><p>Gabriel has been a software developer for about two decades. He has long experience in developing software solutions for various platforms in many programming languages. Since middle-2010 he has been developing almost exclusively for iOS. Tutorials consist of the best way to share knowledge with people all over the world. Follow Gabriel at <a href="http://plus.google.com/+gabrieltheodoropoulos">Google+</a> and <a href="https://twitter.com/gabtheodor">Twitter</a>.</p>
</div></div>
<div id="disqus_thread">
            <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-4065">
        <div id="dsq-comment-header-4065" class="dsq-comment-header">
            <cite id="dsq-cite-4065">
                <span id="dsq-author-user-4065">Adam Dehaven</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4065" class="dsq-comment-body">
            <div id="dsq-comment-message-4065" class="dsq-comment-message"><p>I don&#8217;t think the download project link is working</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-4068">
        <div id="dsq-comment-header-4068" class="dsq-comment-header">
            <cite id="dsq-cite-4068">
http://www.simonblog.com                <span id="dsq-author-user-4068">Simon Ng</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4068" class="dsq-comment-body">
            <div id="dsq-comment-message-4068" class="dsq-comment-message"><p>Adam, I&#8217;ve tested the download link again. It works. The file is hosted on Dropbox. If you can access it, you should be able to download the project. Please try again.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-4079">
        <div id="dsq-comment-header-4079" class="dsq-comment-header">
            <cite id="dsq-cite-4079">
                <span id="dsq-author-user-4079">MacBoy</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4079" class="dsq-comment-body">
            <div id="dsq-comment-message-4079" class="dsq-comment-message"><p>I understand why his download did not work, because directly under the text-based download link is an advertisement in a big button that says &#8220;Download&#8221;.  It fooled me also!  Use this link to download in case you get confused.  <a href="https://dl.dropboxusercontent.com/u/2857188/BGTransferDemo.zip" rel="nofollow">https://dl.dropboxusercontent.com/u/2857188/BGTransferDemo.zip</a></p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-4100">
        <div id="dsq-comment-header-4100" class="dsq-comment-header">
            <cite id="dsq-cite-4100">
                <span id="dsq-author-user-4100">LittlePeculiar</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4100" class="dsq-comment-body">
            <div id="dsq-comment-message-4100" class="dsq-comment-message"><p>This was fantastic. I&#8217;m currently in the need of finding the best, most efficient way to download/upload files in the background. Thanks for this. Great! Great! tutorial.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-4110">
        <div id="dsq-comment-header-4110" class="dsq-comment-header">
            <cite id="dsq-cite-4110">
http://www.gtiapps.com/                <span id="dsq-author-user-4110">Gabriel Theodoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4110" class="dsq-comment-body">
            <div id="dsq-comment-message-4110" class="dsq-comment-message"><p>You&#8217;re welcome! Glad I helped you!</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-4124">
        <div id="dsq-comment-header-4124" class="dsq-comment-header">
            <cite id="dsq-cite-4124">
                <span id="dsq-author-user-4124">Paul</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4124" class="dsq-comment-body">
            <div id="dsq-comment-message-4124" class="dsq-comment-message"><p>Thanks. I added a check for fdi.downloadComplete in ViewController.m &gt; startAllDownloads: so it doesn&#8217;t start a new download for a downloaded file.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-4128">
        <div id="dsq-comment-header-4128" class="dsq-comment-header">
            <cite id="dsq-cite-4128">
http://www.gtiapps.com/                <span id="dsq-author-user-4128">Gabriel Theodoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4128" class="dsq-comment-body">
            <div id="dsq-comment-message-4128" class="dsq-comment-message"><p>Good point!</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-4192">
        <div id="dsq-comment-header-4192" class="dsq-comment-header">
            <cite id="dsq-cite-4192">
                <span id="dsq-author-user-4192">Raushan Kumar</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4192" class="dsq-comment-body">
            <div id="dsq-comment-message-4192" class="dsq-comment-message"><p>sir,your tutorial is really fantastic ,but can you you help me out by explaining how to upload images using background thread in details..</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-5010">
        <div id="dsq-comment-header-5010" class="dsq-comment-header">
            <cite id="dsq-cite-5010">
http://www.gtiapps.com/                <span id="dsq-author-user-5010">Gabriel Theodoropoulos</span>
            </cite>
        </div>
        <div id="dsq-comment-body-5010" class="dsq-comment-body">
            <div id="dsq-comment-message-5010" class="dsq-comment-message"><p>Hi,<br />
I would advise you to read on Apple documentation about the upload task (NSURLSessionUploadTask) and how it works. Explaining everything here in comments would be really hard, but it could be possibly a topic for a future tutorial.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-4775">
        <div id="dsq-comment-header-4775" class="dsq-comment-header">
            <cite id="dsq-cite-4775">
                <span id="dsq-author-user-4775">Jeremiah</span>
            </cite>
        </div>
        <div id="dsq-comment-body-4775" class="dsq-comment-body">
            <div id="dsq-comment-message-4775" class="dsq-comment-message"><p>I think I would rather write the code myself instead of using this approach &#8211; looks convoluted.</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-5484">
        <div id="dsq-comment-header-5484" class="dsq-comment-header">
            <cite id="dsq-cite-5484">
                <span id="dsq-author-user-5484">Jorge Casariego</span>
            </cite>
        </div>
        <div id="dsq-comment-body-5484" class="dsq-comment-body">
            <div id="dsq-comment-message-5484" class="dsq-comment-message"><p>Great Tutorial @gabrieltheodoropoulos:disqus It works perfectly!!</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-5741">
        <div id="dsq-comment-header-5741" class="dsq-comment-header">
            <cite id="dsq-cite-5741">
                <span id="dsq-author-user-5741">Zane Kleinberg</span>
            </cite>
        </div>
        <div id="dsq-comment-body-5741" class="dsq-comment-body">
            <div id="dsq-comment-message-5741" class="dsq-comment-message"><p>how can someone view what has been downloaded</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://mywiki.Wooledge.org/BASH/RK=0/Wprowadzenie_do_pneumatyki' rel='external nofollow' class='url'>pneumatyka Koszalin</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-6543">
        <div id="dsq-comment-header-6543" class="dsq-comment-header">
            <cite id="dsq-cite-6543">
                <span id="dsq-author-user-6543">Lucifer</span>
            </cite>
        </div>
        <div id="dsq-comment-body-6543" class="dsq-comment-body">
            <div id="dsq-comment-message-6543" class="dsq-comment-message"><p>There is an error when you remove the app from task bar..</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-9370">
        <div id="dsq-comment-header-9370" class="dsq-comment-header">
            <cite id="dsq-cite-9370">
                <span id="dsq-author-user-9370">amil</span>
            </cite>
        </div>
        <div id="dsq-comment-body-9370" class="dsq-comment-body">
            <div id="dsq-comment-message-9370" class="dsq-comment-message"><p>Short question, I tried this code in a bigger project, with multiple tableviews. If I go to another view and back to the tableview, it stopped reloading the progressbar. Why ist this happening?</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-14414">
        <div id="dsq-comment-header-14414" class="dsq-comment-header">
            <cite id="dsq-cite-14414">
                <span id="dsq-author-user-14414">amil</span>
            </cite>
        </div>
        <div id="dsq-comment-body-14414" class="dsq-comment-body">
            <div id="dsq-comment-message-14414" class="dsq-comment-message"><p>No idea?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt depth-2" id="dsq-comment-43605">
        <div id="dsq-comment-header-43605" class="dsq-comment-header">
            <cite id="dsq-cite-43605">
                <span id="dsq-author-user-43605">Varun</span>
            </cite>
        </div>
        <div id="dsq-comment-body-43605" class="dsq-comment-body">
            <div id="dsq-comment-message-43605" class="dsq-comment-message"><p>Yeah! the same thing happened with my project too, and is still happening, so it turns out that if you create a new session or if you invalidate your session when you dismiss the VC and create a new session every time you load your VC, the tableview will work properly, however it is not a good approach as invalidating a session, will defeat the purpose of a background fetch itself!! so we have to look at some other options, let me know if you get a breakthrough this behavior of the tableview!!..</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-3" id="dsq-comment-99777">
        <div id="dsq-comment-header-99777" class="dsq-comment-header">
            <cite id="dsq-cite-99777">
                <span id="dsq-author-user-99777">Riyas Mohamed</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99777" class="dsq-comment-body">
            <div id="dsq-comment-message-99777" class="dsq-comment-message"><p>Hi,<br />
Have you found any solution for this. I am also encountering the same issue where the VC is not updated though it is working perfectly for the first time.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-4" id="dsq-comment-99814">
        <div id="dsq-comment-header-99814" class="dsq-comment-header">
            <cite id="dsq-cite-99814">
                <span id="dsq-author-user-99814">Riyas Mohamed</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99814" class="dsq-comment-body">
            <div id="dsq-comment-message-99814" class="dsq-comment-message"><p>it is working fine. After I add &#8211; (void)viewWillDisappear { [session invalidateAndCancel] } .</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-10946">
        <div id="dsq-comment-header-10946" class="dsq-comment-header">
            <cite id="dsq-cite-10946">
                <span id="dsq-author-user-10946">cmatt</span>
            </cite>
        </div>
        <div id="dsq-comment-body-10946" class="dsq-comment-body">
            <div id="dsq-comment-message-10946" class="dsq-comment-message"><p>Great tutorial! I&#8217;m also trying this code in a larger project and it work great &#8211; as long as I stay on the tableview controller. When I switch to a different view controller and then back I lose the progress bar. The file  continues to download in the background but the progress bar is not visible. Are you able to suggest a fix for this?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://sopugalicious.blogspot.ro/2012/06/birthday-gifts-finnish-design-shop.html' rel='external nofollow' class='url'>bracelet shamballa wikipedia fr</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-25216">
        <div id="dsq-comment-header-25216" class="dsq-comment-header">
            <cite id="dsq-cite-25216">
                <span id="dsq-author-user-25216">Siarhei Brazil</span>
            </cite>
        </div>
        <div id="dsq-comment-body-25216" class="dsq-comment-body">
            <div id="dsq-comment-message-25216" class="dsq-comment-message"><p>Why nothing was selected in Background Modes section? Shouldn&#8217;t be background fetch or remote notifications are selected?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-26708">
        <div id="dsq-comment-header-26708" class="dsq-comment-header">
            <cite id="dsq-cite-26708">
                <span id="dsq-author-user-26708">iEODs</span>
            </cite>
        </div>
        <div id="dsq-comment-body-26708" class="dsq-comment-body">
            <div id="dsq-comment-message-26708" class="dsq-comment-message"><p>Hello,<br />
 Nice tutorial, I have used your code in my project it works fine, I am facing one issue, when downloading is going on and network is disconnect it stop but when network connected the it dosen&#8217;t start from where it stop and also when I press the pause button then it crash. please suggest. I try other way but it doesn&#8217;t work.</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://trendreads.com/story.php?title=poker-online-portugal' rel='external nofollow' class='url'>discuss</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://www.zescience.com/?p=6701' rel='external nofollow' class='url'>Does NSUrlSession continue file transfer if the app is killed from task manager?</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-32219">
        <div id="dsq-comment-header-32219" class="dsq-comment-header">
            <cite id="dsq-cite-32219">
                <span id="dsq-author-user-32219">coder</span>
            </cite>
        </div>
        <div id="dsq-comment-body-32219" class="dsq-comment-body">
            <div id="dsq-comment-message-32219" class="dsq-comment-message"><p>I compiled in the latest Xcode 6 preview-5 using the and found the individual start/stop buttons did not work. looking closer, your multi-levelsuperview reference :</p>
<p>if ([[[[sender superview] superview] superview] isKindOfClass:[UITableViewCell class]]) {</p>
<p>needed to be:</p>
<p>if ([[[sender superview] superview] isKindOfClass:[UITableViewCell class]]) {</p>
<p>there are also two warnings, so this:</p>
<p>int cellIndex = cellIndexPath.row;</p>
<p>needs to be:</p>
<p>NSInteger cellIndex = cellIndexPath.row;</p>
<p>then, I could compile and run with individual file start/stop buttons functional. Possibly something has change to disallow this referencing approach. What would be a more robust way to code the line with 3 superviews?</p>
<p>brian.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-99539">
        <div id="dsq-comment-header-99539" class="dsq-comment-header">
            <cite id="dsq-cite-99539">
                <span id="dsq-author-user-99539">D Mason</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99539" class="dsq-comment-body">
            <div id="dsq-comment-message-99539" class="dsq-comment-message"><p>I did something like this to get around that issue </p>
<p>-(UITableViewCell*)findUITableViewCell:(id)sender{</p>
<p>    id superView = [sender superview];</p>
<p>    UITableViewCell *containerCell;</p>
<p>    //os7 sucks so i need to travers the view hierarchy</p>
<p>    while (YES) {</p>
<p>        if ([superView  isKindOfClass:[UITableViewCell class]]) {</p>
<p>            containerCell = superView;</p>
<p>            break;</p>
<p>        }else</p>
<p>            superView = [superView superview];</p>
<p>    }</p>
<p>    return containerCell;</p>
<p>}</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-32223">
        <div id="dsq-comment-header-32223" class="dsq-comment-header">
            <cite id="dsq-cite-32223">
                <span id="dsq-author-user-32223">coder</span>
            </cite>
        </div>
        <div id="dsq-comment-body-32223" class="dsq-comment-body">
            <div id="dsq-comment-message-32223" class="dsq-comment-message"><p>these two references likewise need to change:</p>
<p>  UITableViewCell *containerCell = (UITableViewCell *)[[[sender superview] superview] superview];</p>
<p>to:</p>
<p>        UITableViewCell *containerCell = (UITableViewCell *)[[sender superview] superview];</p>
</div>
        </div>

    <ul class="children">
    <li class="comment even depth-2" id="dsq-comment-99540">
        <div id="dsq-comment-header-99540" class="dsq-comment-header">
            <cite id="dsq-cite-99540">
                <span id="dsq-author-user-99540">D Mason</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99540" class="dsq-comment-body">
            <div id="dsq-comment-message-99540" class="dsq-comment-message"><p>depending on the ios version you need to traverse the views</p>
<p>-(UITableViewCell*)findUITableViewCell:(id)sender{<br />
    id superView = [sender superview];<br />
    UITableViewCell *containerCell;<br />
    while (YES) {<br />
        if ([superView  isKindOfClass:[UITableViewCell class]]) {<br />
            containerCell = superView;<br />
            break;<br />
        }else<br />
            superView = [superView superview];<br />
    }<br />
    return containerCell;<br />
}</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://en.wikipilipinas.org/index.php/User:RandiPevie' rel='external nofollow' class='url'>Installing hardwood flooring</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-43405">
        <div id="dsq-comment-header-43405" class="dsq-comment-header">
            <cite id="dsq-cite-43405">
                <span id="dsq-author-user-43405">Varun</span>
            </cite>
        </div>
        <div id="dsq-comment-body-43405" class="dsq-comment-body">
            <div id="dsq-comment-message-43405" class="dsq-comment-message"><p>I have used the same strategy in using NSURLSession for background transfer, however i have used a NSMutableArray to store my &#8220;fdi&#8221; objects, but the array returns as empty as soon as the;</p>
<p>-(void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite</p>
<p>delegate method is called by the session object, also i have initialised the NSMutableArray properly it happens in the middle of the execution one time the NSMutablArray has one object and the on calling of the method the NSmutableArray returns empty i do not know why, can somebody help me out here!, as to why such a behaviour is happenning also i cannot update the tableview on my interface the second time i load my VC.</p>
<p>NOTE: The session is initiated every time i load the VC it gives me a statement: &#8220;A background URLSession with identifier  already exists!&#8221;</p>
<p>thanks in advance..</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-43739">
        <div id="dsq-comment-header-43739" class="dsq-comment-header">
            <cite id="dsq-cite-43739">
                <span id="dsq-author-user-43739">DSchmid</span>
            </cite>
        </div>
        <div id="dsq-comment-body-43739" class="dsq-comment-body">
            <div id="dsq-comment-message-43739" class="dsq-comment-message"><p>Thanks very much for this excellent tutorial! I&#8217;ve one question though, in my case (which is a bit of a side step from your tutorial, even though as far as the background transfer goes I essentially use your code) the </p>
<p>URLSessionDidFinishEventsForBackgroundURLSession never gets called after all files have been downloaded. My alterations to your example are basically that I first parse an XML file to get a list of files to download and then after copying add the destinationURL to a NSMutablearray for further usage (I ultimately want to use it in an AVPlayer). Since I can&#8217;t open your original project (XCode 5 crashes when I try to open it) I can&#8217;t check if that method gets called in your example. </p>
<p>Thanks for any insight!</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-43994">
        <div id="dsq-comment-header-43994" class="dsq-comment-header">
            <cite id="dsq-cite-43994">
                <span id="dsq-author-user-43994">oliverspencer</span>
            </cite>
        </div>
        <div id="dsq-comment-body-43994" class="dsq-comment-body">
            <div id="dsq-comment-message-43994" class="dsq-comment-message"><p>Does anyone have an example of this in Swift?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://peppermintgraphics.com/blogs/?p=8' rel='external nofollow' class='url'>iPhone Interview Questions | iBlogs</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-46156">
        <div id="dsq-comment-header-46156" class="dsq-comment-header">
            <cite id="dsq-cite-46156">
                <span id="dsq-author-user-46156">pat</span>
            </cite>
        </div>
        <div id="dsq-comment-body-46156" class="dsq-comment-body">
            <div id="dsq-comment-message-46156" class="dsq-comment-message"><p>remark: if the &#8220;taskResumeData == nil&#8221; when using &#8220;[self.session downloadTaskWithResumeData:fdi.taskResumeData]&#8221;, it will complete with error(unsupported URL) immediately.</p>
<p>Therefore, before every call of downloadTaskWithResumeData, we should do a taskResumeData check:<br />
if (fdi.taskResumeData != nil)<br />
                      fdi.downloadTask = [self.session downloadTaskWithResumeData:fdi.taskResumeData];<br />
                else<br />
                      fdi.downloadTask = [self.session downloadTaskWithURL:[NSURL URLWithString:fdi.downloadSource]];</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-49193">
        <div id="dsq-comment-header-49193" class="dsq-comment-header">
            <cite id="dsq-cite-49193">
                <span id="dsq-author-user-49193">TVR</span>
            </cite>
        </div>
        <div id="dsq-comment-body-49193" class="dsq-comment-body">
            <div id="dsq-comment-message-49193" class="dsq-comment-message"><p>Hi First of all, great tutorial, </p>
<p>I have done both preparing my own project step by step as above and download your one, when i launch the app followed by &#8220;Start all downloads&#8221;, further i move the app in background states the app running smoothly everything works fine, on background state after completing the download the app fail to call the delegate &#8220;handleEventsForBackgroundURLSession&#8221; and so on failed to notifying as per above(code)</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://dataisgreat.com/abnormal-talks/' rel='external nofollow' class='url'>비정상회담 다시보기</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-64660">
        <div id="dsq-comment-header-64660" class="dsq-comment-header">
            <cite id="dsq-cite-64660">
                <span id="dsq-author-user-64660">voluntas88</span>
            </cite>
        </div>
        <div id="dsq-comment-body-64660" class="dsq-comment-body">
            <div id="dsq-comment-message-64660" class="dsq-comment-message"><p>I used this tutorial for implementation file diwnloading in my iPad project. All things works correctly. But I use popOver view as Downloader View. So after this popOver view is dismissed, download process continue work, and while file is downloading and I open the popOver view once more, I want progress view shows current progress of downloading. I tried different ways to implement, but without success. Can somebody help me with this my issue?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-66704">
        <div id="dsq-comment-header-66704" class="dsq-comment-header">
            <cite id="dsq-cite-66704">
                <span id="dsq-author-user-66704">Pahnev</span>
            </cite>
        </div>
        <div id="dsq-comment-body-66704" class="dsq-comment-body">
            <div id="dsq-comment-message-66704" class="dsq-comment-message"><p>How would I check if file exists on ViewDidLoad, so the load and stop buttons were hidden when app is launched again?</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-67160">
        <div id="dsq-comment-header-67160" class="dsq-comment-header">
            <cite id="dsq-cite-67160">
                <span id="dsq-author-user-67160">jinyoon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-67160" class="dsq-comment-body">
            <div id="dsq-comment-message-67160" class="dsq-comment-message"><p>Hi. Thanks to this nice tutorial.</p>
<p>I have a question.</p>
<p>In iOS 8, </p>
<p>&#8211; (void)application:(UIApplication *)application handleEventsForBackgroundURLSession:(NSString *)identifier completionHandler:(void (^)())completionHandler</p>
<p>not called.</p>
<p>But in iOS 7, It worked.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-99544">
        <div id="dsq-comment-header-99544" class="dsq-comment-header">
            <cite id="dsq-cite-99544">
                <span id="dsq-author-user-99544">D Mason</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99544" class="dsq-comment-body">
            <div id="dsq-comment-message-99544" class="dsq-comment-message"><p>In order for this to work in iOS8 you need to add </p>
<p>if ([UIApplication instancesRespondToSelector:@selector(registerUserNotificationSettings:)]){<br />
        [application registerUserNotificationSettings:[UIUserNotificationSettings settingsForTypes:UIUserNotificationTypeAlert|UIUserNotificationTypeBadge|UIUserNotificationTypeSound categories:nil]];</p>
<p>    }</p>
<p>in your AppDelegates</p>
<p>&#8211; (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-79476">
        <div id="dsq-comment-header-79476" class="dsq-comment-header">
            <cite id="dsq-cite-79476">
                <span id="dsq-author-user-79476">smorales</span>
            </cite>
        </div>
        <div id="dsq-comment-body-79476" class="dsq-comment-body">
            <div id="dsq-comment-message-79476" class="dsq-comment-message"><p>Congrats! Nice tutorial.</p>
<p>I&#8217;m having some issues when app goes background and I have a long task queue for one session. The main handicap is that I have to download a large number of small files, from 400 to 900 files. Which is the better approach to accomplish this? Enqueue all task in one NSURLSession, having different NSUSLSession with a few task in each one?</p>
<p>Thanks!</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-83783">
        <div id="dsq-comment-header-83783" class="dsq-comment-header">
            <cite id="dsq-cite-83783">
                <span id="dsq-author-user-83783">animesh</span>
            </cite>
        </div>
        <div id="dsq-comment-body-83783" class="dsq-comment-body">
            <div id="dsq-comment-message-83783" class="dsq-comment-message"><p>Love this tutorial please help to know how to do uploading&#8230;Please</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-99182">
        <div id="dsq-comment-header-99182" class="dsq-comment-header">
            <cite id="dsq-cite-99182">
                <span id="dsq-author-user-99182">Bryan Rodriguez</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99182" class="dsq-comment-body">
            <div id="dsq-comment-message-99182" class="dsq-comment-message"><p>Hello!, i working on a project which needs to download about 50 audio-books files in background. How can i known which DownloadTask is being downloaded when user re-open the app manually? To avoid start a duplicated download task by the same file.</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment odd alt thread-even depth-1" id="dsq-comment-99442">
        <div id="dsq-comment-header-99442" class="dsq-comment-header">
            <cite id="dsq-cite-99442">
                <span id="dsq-author-user-99442">Tom</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99442" class="dsq-comment-body">
            <div id="dsq-comment-message-99442" class="dsq-comment-message"><p>Hello,<br />
The above example play and pause button is not working for me. the if condition itself its fail.. any one can help me</p>
</div>
        </div>

    </li><!-- #comment-## -->
    <li class="comment even thread-odd thread-alt depth-1" id="dsq-comment-99762">
        <div id="dsq-comment-header-99762" class="dsq-comment-header">
            <cite id="dsq-cite-99762">
                <span id="dsq-author-user-99762">Riyas Mohamed</span>
            </cite>
        </div>
        <div id="dsq-comment-body-99762" class="dsq-comment-body">
            <div id="dsq-comment-message-99762" class="dsq-comment-message"><p>It works perfectly with some changes mentioned in the comments.  I copied the code into my Tableview controller and called my tableview controller. First time, it works fine. After I click the back button and comeback to the view, progressbar is not displaying the progress though download is working. ie. UI is not updated.  would appreciate if anybody help on this issue.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-100699">
        <div id="dsq-comment-header-100699" class="dsq-comment-header">
            <cite id="dsq-cite-100699">
                <span id="dsq-author-user-100699">DanK</span>
            </cite>
        </div>
        <div id="dsq-comment-body-100699" class="dsq-comment-body">
            <div id="dsq-comment-message-100699" class="dsq-comment-message"><p>Are you sure that your cod is not re-initalizing your FileDownloadInfo?  In his code he does this in </p>
<p>&#8211; (void)viewDidLoad {<br />
    [super viewDidLoad];</p>
<p>    // Do any additional setup after loading the view, typically from a nib.<br />
    [self initalizeFileDownloadDataArray];</p>
<p>make sure if you&#8217;re coming back into this viewcontroller that you save the FileDownloadInfo somewhere and reload it.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
    <li class="post pingback">
        <p>Pingback: <a href='http://eldoocs.net/iphone-sdk-manual-download/' rel='external nofollow' class='url'>Iphone Sdk Manual Download Manual Gadget, Car And Technology Manual PDF - Eldoocs.Net</a>()</p>
    </li>
    </li><!-- #comment-## -->
    <li class="comment even thread-even depth-1" id="dsq-comment-101302">
        <div id="dsq-comment-header-101302" class="dsq-comment-header">
            <cite id="dsq-cite-101302">
                <span id="dsq-author-user-101302">Raviraj Wadhwa</span>
            </cite>
        </div>
        <div id="dsq-comment-body-101302" class="dsq-comment-body">
            <div id="dsq-comment-message-101302" class="dsq-comment-message"><p>Hello, What will happen to the downloading process if I kill the app?</p>
</div>
        </div>

    </li><!-- #comment-## -->
            </ul>


        </div>

    </div>

<script type="text/javascript">
var disqus_url = 'http://www.appcoda.com/background-transfer-service-ios7/';
var disqus_identifier = '3255 http://www.appcoda.com/?p=3255';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'appcoda';
var disqus_title = "Background Transfer Service in iOS 7 SDK: How To Download File in Background";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=3255';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

</div><div id="sidebar" class="sidebar widget-area"><div id="search-4" class="widget widget_search"><div class="widget-wrap"><form role="search" method="get" id="searchform" class="searchform" action="http://www.appcoda.com/" >
                    <div><label class="screen-reader-text" for="s">Search for:</label>
                    <input type="text" value="" name="s" id="s" />
                    <input type="submit" id="searchsubmit" value="Search" />
                    </div>
                    </form></div></div>
<div id="text-2" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for Our Free Tutorials</h4>
			<div class="textwidget"><div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" id="mce-EMAIL" placeholder="Enter your email address" required><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"/>
</form>
</div></div>
		</div></div>
<div id="text-6" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><!-- BuySellAds Zone Code -->
<div id="bsap_1283996" class="bsarocks bsap_459a84cf8fa0d5ea9dccfcfd1c3531e0"></div>
<!-- End BuySellAds Zone Code --></div>
		</div></div>
<div id="text-4" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><div class="fb-like-box" data-href="http://www.facebook.com/appcodamobile" data-width="300" data-height="260" data-show-faces="true" data-border-color="#F1F1F1" data-stream="false" data-header="false"></div></div>
		</div></div>
		<div id="recent-posts-3" class="widget widget_recent_entries"><div class="widget-wrap">		<h4 class="widget-title widgettitle">Recent Posts</h4>
		<ul>
					<li>
				<a href="http://www.appcoda.com/react-native-introduction/">Introduction to React Native: Building iOS Apps with JavaScript</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/cloudkit-introduction-tutorial/">Working with CloudKit in iOS 8</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/instagram-app-parse-swift/">Building an Instagram-Like App with Parse and Swift</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/google-maps-api-tutorial/">A Swift Tutorial for Google Maps SDK</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/ios8-share-extension-swift/">Building a Simple Share Extension in iOS 8 App</a>
						</li>
				</ul>
		</div></div>
<div id="wp_insert_ad_widget-3" class="widget widget_wp_insert_ad_widget"><div class="widget-wrap"><div class="wpInsert wpInsertAdWidget" style="margin: 5px; padding: 0px;"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Premium Large Skyscraper -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-8501671653071605"
     data-ad-slot="6120307730"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></div></div>
<div id="nav_menu-3" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar" class="menu"><li id="menu-item-57" class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li id="menu-item-58" class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li id="menu-item-59" class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li id="menu-item-68" class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
</div></div></div></div><div id="footer-widgets" class="footer-widgets"><div class="wrap"><div class="footer-widgets-1 widget-area"><div id="nav_menu-4" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">About AppCoda</h4>
<div class="menu-default-container"><ul id="menu-default-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div><div class="footer-widgets-2 widget-area"><div id="text-9" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Our New Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="http://www.appcoda.com/wp-content/uploads/2014/10/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignleft size-medium wp-image-4153" /></a></div>
		</div></div>
</div><div class="footer-widgets-3 widget-area"><div id="nav_menu-5" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar-1" class="menu"><li class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
<div id="text-3" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Email Newsletter</h4>
			<div class="textwidget"><p>Sign up to receive free tutorial and
to hear what's going on with AppCoda!</p>
<div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" id="mce-EMAIL" placeholder="Enter your email address" required><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"/>
</form>
</div></div>
		</div></div>
</div></div></div><div id="footer" class="footer"><div class="wrap">    <p>&copy; Copyright 2015 <a href="http://appcoda.com/">AppCoda</a> &middot; All Rights Reserved &middot; Powered by <a href="http://wordpress.org/">WordPress &middot; <a href="http://www.appcoda.com/privacy-policy">Privacy Policy</a> &middot; <a href="http://www.appcoda.com/terms-of-service/">Terms of Service</a></p>
    </div></div></div><!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
<script src="/prismjs/prism.js"></script>        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'appcoda';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); 
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
                    <!-- Version: 0.3.3 -->
            <script type="text/javascript">
                var EjSocialSlideoutJsApi_Settings =
                {
                    SliderImage: "<img width=\"150\" height=\"150\" src=\"http:\/\/www.appcoda.com\/wp-content\/uploads\/2015\/04\/appcoda-300-150x150.png\" class=\"attachment-thumbnail\" alt=\"appcoda-300\" \/>",
                    SocialProfiles: {"Facebook":{"Name":"Facebook","NetworkId":"Facebook","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Facebook","Description":"And get free tutorial updates"},"Twitter":{"Name":"Twitter","NetworkId":"Twitter","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Twitter","Description":"And get free tutorial updates"}},
                    Preview: false
                                    };

                if (typeof (EjSocialSlideoutJsApi) !== "undefined")
                    EjSocialSlideoutJsApi.SettingsLoaded(EjSocialSlideoutJsApi_Settings);
            </script>
            <div id='ej-ss-slideout-dom-templates' style='display:none'><div id='ej-ss-slideout-dom-template-facebook'><div class='fb-follow' data-href='https://www.facebook.com/appcodamobile' data-width='210' data-colorscheme='light' data-layout='standard' data-show-faces='true'></div></div><div id='ej-ss-slideout-dom-template-twitter'><a href='https://twitter.com/appcodamobile' class='twitter-follow-button' data-show-count='true' data-size='medium'>Follow @appcodamobile</a></div></div><div class="et_social_sidebar_networks et_social_visible_sidebar et_social_slideright et_social_animated et_social_rectangle et_social_sidebar_flip et_social_sidebar_withcounts et_social_withtotalcount et_social_mobile_off">
					<div class="et_social_totalcount et_social_dark">
							<span class="et_social_totalcount_count et_social_total_share" data-post_id="3255"></span>
							<span class="et_social_totalcount_label">Shares</span>
						</div>
					<ul class="et_social_icons_container"><li class="et_social_facebook">
									<a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;t=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="3255" data-social_type="share">
										<i class="et_social_icon et_social_icon_facebook"></i>
										
										<div class="et_social_count"><span>65</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_twitter">
									<a href="http://twitter.com/share?text=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="3255" data-social_type="share">
										<i class="et_social_icon et_social_icon_twitter"></i>
										
										<div class="et_social_count"><span>39</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_googleplus">
									<a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;t=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="3255" data-social_type="share">
										<i class="et_social_icon et_social_icon_googleplus"></i>
										
										<div class="et_social_count"><span>16</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_linkedin">
									<a href="http://www.linkedin.com/shareArticle?mini=true&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;title=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="3255" data-social_type="share">
										<i class="et_social_icon et_social_icon_linkedin"></i>
										
										<div class="et_social_count"><span>14</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li></ul>
					<span class="et_social_hide_sidebar et_social_icon"></span>
				</div><div class="et_social_flyin et_social_resize et_social_flyin_bottom_right et_social_slideup et_social_trigger_bottom et_social_mobile_on">
					<a href="#" class="et_social_icon et_social_icon_cancel"></a>
					<div class="et_social_header">
						<h3>Share This</h3>
						<p>Share this post with your friends!</p>
					</div>
					<div class="et_social_networks et_social_2col et_social_slide et_social_rectangle et_social_left et_social_withnetworknames">
						
						<ul class="et_social_icons_container"><li class="et_social_facebook"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;t=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="3255" data-social_type="share"><i class="et_social_icon et_social_icon_facebook"></i><div class="et_social_network_label"><div class="et_social_networkname">Facebook</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_twitter"><a href="http://twitter.com/share?text=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="3255" data-social_type="share"><i class="et_social_icon et_social_icon_twitter"></i><div class="et_social_network_label"><div class="et_social_networkname">Twitter</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_googleplus"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;t=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="3255" data-social_type="share"><i class="et_social_icon et_social_icon_googleplus"></i><div class="et_social_network_label"><div class="et_social_networkname">Google+</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_linkedin"><a href="http://www.linkedin.com/shareArticle?mini=true&#038;url=http%3A%2F%2Fwww.appcoda.com%2Fbackground-transfer-service-ios7%2F&#038;title=Background%20Transfer%20Service%20in%20iOS%207%20SDK%3A%20How%20To%20Download%20File%20in%20Background" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="3255" data-social_type="share"><i class="et_social_icon et_social_icon_linkedin"></i><div class="et_social_network_label"><div class="et_social_networkname">LinkedIn</div></div><span class="et_social_overlay"></span></a></li></ul>
					</div>
				</div><span></span><style type="text/css" class="fluid-images">img{max-width:100%;height:auto;}</style><div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><script type='text/javascript'>
/* <![CDATA[ */
var mejsL10n = {"language":"en-US","strings":{"Close":"Close","Fullscreen":"Fullscreen","Download File":"Download File","Download Video":"Download Video","Play\/Pause":"Play\/Pause","Mute Toggle":"Mute Toggle","None":"None","Turn off Fullscreen":"Turn off Fullscreen","Go Fullscreen":"Go Fullscreen","Unmute":"Unmute","Mute":"Mute","Captions\/Subtitles":"Captions\/Subtitles"}};
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/mediaelement/mediaelement-and-player.min.js?ver=2.16.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/mediaelement/wp-mediaelement.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/www.appcoda.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ...","cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.1.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/monarch/js/idle-timer.min.js?ver=1.2.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var monarchSettings = {"ajaxurl":"http:\/\/www.appcoda.com\/wp-admin\/admin-ajax.php","pageurl":"http:\/\/www.appcoda.com\/background-transfer-service-ios7\/","stats_nonce":"3c279d6f27","share_counts":"41afbcf48b","follow_counts":"80583e3ade","total_counts":"861aff4fd8","media_single":"ed7cd3edd6","media_total":"e88d48f2ea","generate_all_window_nonce":"6da8221303","no_img_message":"No images available for sharing on this page"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/plugins/monarch/js/custom.js?ver=1.2.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-includes/js/comment-reply.min.js?ver=4.2.1'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/themes/genesis/lib/js/menu/superfish.min.js?ver=1.7.4'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/themes/genesis/lib/js/menu/superfish.args.min.js?ver=2.1.2'></script>
<script type='text/javascript' src='http://www.appcoda.com/wp-content/themes/genesis/lib/js/menu/superfish.compat.min.js?ver=2.1.2'></script>
<!-- This site converts visitors into subscribers and customers with the OptinMonster WordPress plugin v2.1.6.6 - http://optinmonster.com/ -->
<div id="om-d7egu9k5k9-lightbox" class="optin-monster-overlay" style="display:none;"><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script><style type="text/css" class="om-theme-case-study-styles">.optin-monster-success-message {font-size: 21px;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;color: #282828;font-weight: 300;text-align: center;margin: 0 auto;}.optin-monster-success-overlay .om-success-close {font-size: 32px !important;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif !important;color: #282828 !important;font-weight: 300 !important;position: absolute !important;top: 0px !important;right: 10px !important;background: none !important;text-decoration: none !important;width: auto !important;height: auto !important;display: block !important;line-height: 32px !important;padding: 0 !important;}.om-helper-field {display: none !important;visibility: hidden !important;opacity: 0 !important;height: 0 !important;line-height: 0 !important;}html div#om-d7egu9k5k9-lightbox * {box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;}html div#om-d7egu9k5k9-lightbox {background:none;border:0;border-radius:0;-webkit-border-radius:0;-moz-border-radius:0;float:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing: grayscale;height:auto;letter-spacing:normal;outline:none;position:static;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;margin:0;padding:0;line-height:1;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-shadow:none;-moz-box-shadow:none;-ms-box-shadow:none;-o-box-shadow:none;box-shadow:none;-webkit-appearance:none;}html div#om-d7egu9k5k9-lightbox {background: rgb(0, 0, 0);background: rgba(0, 0, 0, .7);font-family: helvetica,arial,sans-serif;-moz-osx-font-smoothing: grayscale;-webkit-font-smoothing: antialiased;line-height: 1;width: 100%;height: 100%;}html div#om-d7egu9k5k9-lightbox .om-clearfix {clear: both;}html div#om-d7egu9k5k9-lightbox .om-clearfix:after {clear: both;content: ".";display: block;height: 0;line-height: 0;overflow: auto;visibility: hidden;zoom: 1;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin {background: #fff;display: none;position: absolute;top: 50%;left: 50%;min-height: 175px;max-width: 700px;width: 100%;z-index: 734626274;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-wrap {position: relative;height: 100%;}html div#om-d7egu9k5k9-lightbox .om-close {position: absolute;top: -12px;right: -12px;text-decoration: none !important;display: block;width: 35px;height: 35px;background: url("http://www.appcoda.com/wp-content/plugins/optin-monster/assets/css/images/close.png") no-repeat scroll 0 0;z-index: 1500;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-bar {margin-bottom: 20px;clear: both;}html div#om-d7egu9k5k9-lightbox .om-bar {float: left;width: 25%;height: 11px;display: block;}html div#om-d7egu9k5k9-lightbox .om-red-bar {background-color: #ef3e36;}html div#om-d7egu9k5k9-lightbox .om-green-bar {background-color: #abb92e;}html div#om-d7egu9k5k9-lightbox .om-orange-bar {background-color: #f57826;}html div#om-d7egu9k5k9-lightbox .om-blue-bar {background-color: #17b4e9;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-header {min-height: 30px;padding: 15px;width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-title {font-size: 24px;color: #484848;width: 100%;margin-bottom: 15px;text-shadow: 0 1px #fff;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-tagline {font-size: 16px;line-height: 1.25;color: #484848;width: 100%;margin-bottom: 30px;text-shadow: 0 1px #fff;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-content {padding: 15px;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left {float: left;max-width: 280px;width: 100%;position: relative;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-image-container {position: relative;max-width: 280px;max-height: 245px;margin: 0 auto;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-image-container img {display: block;margin: 0 auto;text-align: center;height: auto;max-width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-right {float: right;max-width: 370px;width: 100%;background-color: #dadada;margin-right: -15px;padding: 20px;position: relative;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-arrow {position: absolute;width: 49px;height: 56px;left: -40px;top: -40px;}html div#om-d7egu9k5k9-lightbox label {color: #333;}html div#om-d7egu9k5k9-lightbox input,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email {background-color: #fff;width: 100%;border: 1px solid #ccc;font-size: 16px;line-height: 24px;padding: 10px 6px;overflow: hidden;outline: none;margin: 0 0 15px;vertical-align: middle;height: 46px;}html div#om-d7egu9k5k9-lightbox input[type=submit],html div#om-d7egu9k5k9-lightbox button,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-submit {background: #484848;border: 1px solid #484848;width: 100%;color: #fff;font-size: 20px;padding: 12px 6px;line-height: 28px;text-align: center;vertical-align: middle;cursor: pointer;margin: 0;height: 54px;}html div#om-d7egu9k5k9-lightbox input[type=checkbox],html div#om-d7egu9k5k9-lightbox input[type=radio] {-webkit-appearance: checkbox;width: auto;outline: invert none medium;padding: 0;margin: 0;}@media (max-width: 700px) {html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin[style] {width: 100%;position: relative;}html div#om-d7egu9k5k9-lightbox .om-close {right: 9px;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-right,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-submit,html div#om-d7egu9k5k9-lightbox .om-has-email #om-lightbox-case-study-optin-email {float: none;width: 100%;max-width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email {margin-bottom: 15px;}}@media only screen and (-webkit-min-device-pixel-ratio: 2),only screen and (min--moz-device-pixel-ratio: 2),only screen and (-o-min-device-pixel-ratio: 2/1),only screen and (min-device-pixel-ratio: 2),only screen and (min-resolution: 192dpi),only screen and (min-resolution: 2dppx) {html div#om-d7egu9k5k9-lightbox .om-close {background-image: url("http://www.appcoda.com/wp-content/plugins/optin-monster/assets/css/images/<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="d1b2bdbea2b491e3a9ffa1bfb6">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>");background-size: 35px 35px;}}</style><div id="om-lightbox-case-study-optin" class="om-lightbox-case-study om-clearfix om-theme-case-study om-custom-html-form"><div id="om-lightbox-case-study-optin-wrap" class="om-clearfix"><a href="#" class="om-close" title="Close"></a><div id="om-lightbox-case-study-optin-bar" class="om-clearfix"><span class="om-bar om-red-bar"></span><span class="om-bar om-green-bar"></span><span class="om-bar om-orange-bar"></span><span class="om-bar om-blue-bar"></span></div><div id="om-lightbox-case-study-header" class="om-clearfix"><div id="om-lightbox-case-study-optin-title" data-om-action="editable" data-om-field="title" style="color:#484848;font-family:Bree Serif;font-size:32px;text-align:center;"><span style="font-family:montserrat;">FREE Swift Programming Course</span></div><div id="om-lightbox-case-study-optin-tagline" data-om-action="editable" data-om-field="tagline" style="color:#484848;font-family:Open Sans;font-size:24px;text-align:center;"><span style="font-family:montserrat;">Sign up today and get a 7 day email course with free tips and ebook chapters for starting app development.</span></div></div><div id="om-lightbox-case-study-content" class="om-clearfix"><div id="om-lightbox-case-study-left"><div id="om-lightbox-case-study-optin-image-container" class="om-image-container om-clearfix"><img class="optin-monster-image optin-monster-image-lightbox-case-study" src="http://www.appcoda.com/wp-content/uploads/2015/01/swift-free-course-280x245.jpg" alt="" title="swift-free-course" /></div></div><div id="om-lightbox-case-study-right"><img id="om-lightbox-case-study-arrow" src="http://www.appcoda.com/wp-content/plugins/optin-monster/includes/themes/case-study/images/arrow.png" alt="Arrow" /><form action="http://sendy.appcoda.com/sendy/subscribe" method="POST" accept-charset="utf-8">
<input id="om-lightbox-case-study-optin-name" type="text" name="name" value="" data-om-action="selectable" data-om-target="#optin-monster-field-name_field" placeholder="Enter your name here..." style="color:#484848;font-family:Montserrat;">
<input id="om-lightbox-case-study-optin-email" type="email" name="email" value="" data-om-action="selectable" data-om-target="#optin-monster-field-email_field" placeholder="Enter your email address here..." style="color:#484848;font-family:Montserrat;">
<input id="om-lightbox-case-study-optin-submit" type="submit" data-om-action="selectable" data-om-target="#optin-monster-field-submit_field" value="Send me the course" style="color:#ffffff;background-color:#484848;border-color:#484848;font-family:Montserrat;">
<input type="hidden" name="list" value="neAW97jagVmb3C3O892VnnLA"/>
</form></div></div></div><input type="email" name="email" value="" class="om-helper-field" /><input type="text" name="website" value="" class="om-helper-field" /></div><script type="text/javascript">jQuery(document).ready(function($){WebFont.load({google: {families: ['Montserrat%7CBree+Serif%7COpen+Sans']}});});</script></div>
<script type="text/javascript">var d7egu9k5k9_lightbox, omo = {"id":4744,"optin":"d7egu9k5k9-lightbox","campaign":"Free Swift Programming Course","clones":[""],"hash":"d7egu9k5k9-lightbox","optin_js":"d7egu9k5k9_lightbox","type":"lightbox","theme":"case-study","cookie":30,"delay":5000,"second":0,"exit":1,"redirect":"","redirect_pass":false,"custom":true,"test":false,"global_cookie":23320,"preview":false,"ajax":"http:\/\/www.appcoda.com\/?optin-monster-ajax-route=1","mobile":false,"post_id":3255,"preloader":"http:\/\/www.appcoda.com\/wp-content\/plugins\/optin-monster\/assets\/css\/images\/preloader.gif","error":"There was an error with your submission. Please try again.","ajax_error":"There was an error with the AJAX request: ","name_error":"Please enter a valid name.","email_error":"Please enter a valid email address.","bot_error":"Honeypot fields have been activated. Your submission is being flagged as potential spam.","success":"Thanks for subscribing! Please check your email for further instructions.","exit_sensitivity":20}; d7egu9k5k9_lightbox = new OptinMonster(); d7egu9k5k9_lightbox.init(omo);</script>
<!--[if lte IE 9]><script type="text/javascript">var om_ie_browser = true;</script><![endif]--><!-- / OptinMonster WordPress plugin. -->
</body>
</html>

<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: www.appcoda.com @ 2015-05-04 12:22:07 by W3 Total Cache -->