<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0047)http://www.appcoda.com/chat-app-swift-tutorial/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" class="wf-montserrat7cbreeserif7copensans-n4-inactive wf-inactive"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Building a Chat App in Swift Using Multipeer Connectivity Framework</title><link href="http://www.appcoda.com/prismjs/prism.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- This site is optimized with the Yoast WordPress SEO plugin v2.1.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="This Swift programming tutorial will show you how to build a chat app using Multipeer Connectivity Framework in iOS 8.">
<link rel="canonical" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/Building a Chat App in Swift Using Multipeer Connectivity Framework.html">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="This Swift programming tutorial will show you how to build a chat app using Multipeer Connectivity Framework in iOS 8.">
<meta name="twitter:title" content="Building a Chat App in Swift Using Multipeer Connectivity Framework">
<meta name="twitter:site" content="@appcodamobile">
<meta name="twitter:domain" content="AppCoda">
<meta name="twitter:image:src" content="http://www.appcoda.com/wp-content/uploads/2015/01/mpc-swift-featured.jpg">
<meta name="twitter:creator" content="@appcodamobile">
<script id="facebook-jssdk" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/all.js"></script><script async="" type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/ca-pub-8501671653071605.js"></script><script type="text/javascript" async="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/ga.js"></script><script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","url":"http:\/\/www.appcoda.com\/","name":"AppCoda"}</script>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="AppCoda » Feed" href="http://feeds.feedburner.com/appcoda">
<link rel="alternate" type="application/rss+xml" title="AppCoda » Comments Feed" href="http://www.appcoda.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="AppCoda » Building a Chat App in Swift Using Multipeer Connectivity Framework Comments Feed" href="http://www.appcoda.com/chat-app-swift-tutorial/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.appcoda.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.1"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f;c.supports={simple:d("simple"),flag:d("flag")},c.supports.simple&&c.supports.flag||(f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/wp-emoji-release.min.js" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="mediaelement-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/mediaelementplayer.min.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/wp-mediaelement.css" type="text/css" media="all">
<link rel="stylesheet" id="eleven40-theme-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/styles.css" type="text/css" media="all">
<link rel="stylesheet" id="ej-socialslideout-content-style-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/slideout.css" type="text/css" media="all">
<link rel="stylesheet" id="et_monarch-open-sans-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/css" type="text/css" media="all">
<link rel="stylesheet" id="et_monarch-css-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/style(1).css" type="text/css" media="all">
<link rel="stylesheet" id="codecolorer-css" href="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/codecolorer.css" type="text/css" media="screen">
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/jquery.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/fluidimage.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/slideout.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/api.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/iframeResizer.min.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/iframeResizer.contentWindow.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.appcoda.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.appcoda.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.2.1">
<link rel="shortlink" href="http://www.appcoda.com/?p=4685">
<style type="text/css" id="et-social-custom-css">
				 
			</style><link rel="Shortcut Icon" href="http://www.appcoda.com/wp-content/themes/eleven40/images/favicon.ico" type="image/x-icon">
<link rel="pingback" href="http://www.appcoda.com/xmlrpc.php">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-223304-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script><script type="text/javascript" async="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/embed.js"></script><script type="text/javascript" async="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/bsa.js"></script><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Montserrat%7CBree+Serif%7COpen+Sans"><script async="" type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/count.js"></script><script type="text/javascript" id="_bsap_js_459a84cf8fa0d5ea9dccfcfd1c3531e0" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/s_459a84cf8fa0d5ea9dccfcfd1c3531e0.js" async="async"></script><script async="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/count-data.js"></script><script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/pro.js" id="_bsap_premium_pro"></script><script type="text/javascript" id="_bsaPRO_js" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/saved_resource" async="async"></script></head>
<body class="single single-post postid-4685 single-format-standard et_monarch header-image content-sidebar"><div id="wrap"><div id="header"><div class="wrap"><div id="title-area"><p id="title"><a href="http://www.appcoda.com/">AppCoda</a></p><p id="description">Your iOS Programming Community</p></div><div class="widget-area header-widget-area"><div id="nav_menu-2" class="widget widget_nav_menu"><div class="widget-wrap"><div class="menu-default-container"><ul id="menu-default" class="menu genesis-nav-menu js-superfish sf-js-enabled sf-arrows"><li id="menu-item-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li id="menu-item-28" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li id="menu-item-530" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li id="menu-item-3045" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li id="menu-item-2140" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li id="menu-item-710" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div></div></div><div id="inner"><div class="wrap"><script async="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/adsbygoogle.js"></script>
<!-- Leaderboard Responsive Ad -->
<ins class="adsbygoogle" style="display: block; height: 90px;" data-ad-client="ca-pub-8501671653071605" data-ad-slot="1756840139" data-ad-format="auto" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:1140px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:1140px;background-color:transparent"><iframe width="1140" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="content-sidebar-wrap"><div id="content" class="hfeed"><div class="post-4685 post type-post status-publish format-standard hentry category-course category-intermediate category-swift-2 category-tutorials tag-ios-programming tag-multipeer-connectivity-framework tag-swift tag-xcode-6 entry"><h1 class="entry-title">Building a Chat App in Swift Using Multipeer Connectivity Framework</h1> 
<div class="post-info"><span class="date published time" title="2015-01-20T09:33:19+00:00">January 20, 2015</span>  by <span class="author vcard"><span class="fn"><a href="http://www.appcoda.com/author/gabrielth/" rel="author">Gabriel Theodoropoulos</a></span></span> <span class="post-comments"><a href="http://www.appcoda.com/chat-app-swift-tutorial/#disqus_thread" data-disqus-identifier="4685 http://www.appcoda.com/?p=4685"><span class="dsq-postid" data-dsqidentifier="4685 http://www.appcoda.com/?p=4685">22 Comments</span></a></span> </div><div class="entry-content">
<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:right;margin:10px 0 10px 10px;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_300x250_iPhone_Development */
google_ad_slot = "8132041053";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/show_ads.js">
</script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins>
</div>
<p>When programming in iOS, there are certain aspects of the SDK that pull the developers’ attention and interest a lot more than others, and one of them is the <strong><a href="https://developer.apple.com/library/prerelease/ios/documentation/MultipeerConnectivity/Reference/MultipeerConnectivityFramework/index.html">Multipeer Connectivity</a></strong> framework. As you know, the MPC framework is not new in iOS 8, instead it was first-introduced in the seventh (7th) version of it, about a year and a half ago. In the past, I’d written a couple of tutorials about it, and to tell the truth, I was surprised from the interest that people seemed to have about it. Now, some months later, I return with a new post regarding it, as I believe that there are still things that need to be explained.</p>
<p>You may wonder why I bring to the surface a topic a bit old, and not something new included in iOS 8. Well, I’m doing that for three reasons:</p>
<ol>
<li>Many readers have approached me through e-mail messages, asking how to perform various tasks in multipeer connectivity that were not mentioned in the previous two tutorials. By answering to all those messages, I found out that there’s a need that I hadn’t noticed earlier; People want more information about it, which is hard to find sometimes.</li>
<li>The implementation I presented in the last couple tutorials was based in the use of a default, pre-made view controller existing in the iOS SDK for <em>inviting</em> other peers and establishing a connection. I found out that people was asking for manual implementation, and that’s something we are about to see here.</li>
<li>I think that it will be quite useful and educational to see how to implement MPC in Swift.</li>
</ol>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/mpc-swift-featured.jpg" alt="Multipeer Connectivity Framework in Swift" class="aligncenter size-full wp-image-4702" style="width:NaN%;"></div>
<p>During the lifetime of the multipeer connectivity framework, it has been proved that the possibilities that it came to offer gave birth to new ideas to a great number of developers. Connecting devices using such a simple way seems so attractive, and that’s why programmers want to integrate it into their applications. However, if you haven’t used the MPC framework yet, I must warn you: Sometimes it’s not as reliable as you may expect, and that’s something I’ve seen personally in my projects, and also other developers have reported to me. MPC uses both Bluetooth and WiFi to connect <em>nearby</em> devices, but even though it sounds too good and promising, sometimes the connection either fails or is to slow, leading to communication errors. That’s important in cases you need to transfer vital data. I would advice you to use a backup communication solution (such as a web service), so you make sure that there is an alternative and your application will continue to work even if the MPC fails. However, despite to what I just said, I still believe that MPC if a good tool for all iOS developers, so it worths it one (last) more tutorial.</p>
<p><span id="more-4685"></span></p>
<p>Getting into the details of MPC is not something I’m planning to do. If you want to get a taste of it, then simply pay a visit to this tutorial <a href="http://www.appcoda.com/intro-multipeer-connectivity-framework-ios-programming/">here</a>. Instead, I’m going to give you a short overview of the multipeer connectivity framework.</p>
<p>So, MPC contains four important classes representing the following concepts:</p>
<ol>
<li><strong>Peer</strong> (<em>MCPeerID</em>): A peer is actually a device, programmatically represented. It’s usually the first thing needs to be set up, as an object of this class is used as a parameter upon the initialization of the next classes’ instances. Also, it contains an important property, named <em>displayName</em>. This is the device name appearing to the other, nearby peers.</li>
<li><strong>Session</strong> (<em>MCSession</em> class): It’s the connection established between two peers, after the first one has invited the second, and of course the invitation has been accepted. A session regards two devices only. A third device cannot be connected to an existing session, instead another one is used.</li>
<li><strong>Browser</strong> (<em>MCNearbyServiceBrowser</em> class): The methods of this class are used to find other nearby devices and invite them to join a session. As a prerequisite, the other devices must <em>advertise</em> themselves. In this tutorial we’ll use this class to manually invite other devices.</li>
<li><strong>Advertiser</strong> (<em>MCNearbyServiceAdvertiser</em>): This class is responsible for advertising a device, meaning making the device visible or not to others, and for accepting or not invitations from other peers for connecting to sessions.</li>
</ol>
<p>The logic of the multipeer connectivity framework is simple: A device (a peer) using its <em>browser</em>, searches for other devices around. As I said, a device must advertise itself so as to be discoverable. Once it finds one or more peers, it can send an invitation for connecting to a session. The invitation can be sent either automatically once a nearby peer is found, or after the user has decided to do so. Actually, this is totally up to the application that is being implemented, so there’s not a standard recipe. You will be the one to decide when you’ll send an invitation. In any case, once the invitation has been accepted, the session is established and then the two peers can send and receive <em>data</em>, <em>resources</em>, or <em>streams</em>.</p>
<p>My goal in this post is to show you how to programmatically browse, invite and connect to other peers. Note that what you’ll see next, it’s just a way of implementation. Obviously, you can use all the provided tools by the MPC in the way you want and perform your own implementation that suits to the application you build. What you’ll see it’s just a sample of how the MPC framework can be implemented and integrated purely programmatically from the beginning to the end, without using any pre-made view controller of the SDK. Hopefully, by the end of this tutorial, many of you may find some answers to what you seek.</p>
<p>Lastly, if you’ve never worked with the MPC framework before I encourage you to take a quick look at both the official documentation by Apple, and my previous tutorials, so you have an idea before you proceed. Having said that, let’s don’t waste any more time, and let’s dive in some programming aspects of the multipeer connectivity.</p>
<h2>About the Demo App</h2>
<p>Let’s talk now a bit about the demo application of this tutorial, which is going to be a <em>chat application</em>. Okay, I know that it might be a scenario too common and that we created a chat app in the first multipeer connectivity tutorial, however let me justify myself by saying this: No matter how hard I tried to find another, better example, the chat application was always the #1 in my list when I was thinking about the programming stuff I wanted to present today. I believe this is something that you’ll agree with too by the end of the tutorial, so let’s move forward.</p>
<p>As we have already done in many tutorials, we are not going to build the app from scratch. Instead, I’ll give you a starter project which you can <a href="https://www.dropbox.com/s/adbuyk2j1vgmbmd/MPCRevisitedTemplate.zip?dl=0">download here</a>, and we’ll keep working on that. The application will be called <strong>MPCRevisited</strong>, and I think that is the best title in this case. Please go and navigate yourself around the project once you download it, so you get familiarized with it and be able to work fast in it.</p>
<p>As I said, we are going to build a chat application. This application will be parted by two view controllers, where the second one will be modally displayed to the user. If you look to the Interface Builder in the project, you’ll see that in the first view controller’s scene there’s a tableview. In this tableview we are going to display all the nearby devices discovered by the multipeer connectivity framework, while the peers’ list will be dynamically refreshed as existing peers will be lost, and new peers will appear near to the device. In the first view controller you will also find a toolbar with a bar button item in it. Later on, we’ll use this button item to turn on and off the discoverability of the device with aim to see how the advertising feature of the MPC works.</p>
<p>Once a listed peer is tapped, we’ll ask the user at the other end if he wants to chat or not. If he declines, nothing will happen. But upon acceptance, the second view controller named <em>ChatViewController</em> will be displayed on the screen, so the two devices can exchange text messages. In the second view controller scene there is a textfield for writing the message, and a tableview where all the messages will be listed. Also, a toolbar at the top and with another bar button item will be used to end the chat. I believe its completely pointless to discuss any further details here, as we’ll see everything quite thoroughly upon implementation.</p>
<p>Before I present you a few screenshots of the final app, let me also say one last thing. Even though we can connect a device with up to seven (7) more using the multipeer connectivity, in our example we are going to connect it to just one more peer, the one that we’ll chat with each time. Let me clarify that connecting peers together using sessions is a completely different thing from discovering and listing all nearby peers, and now I’m referring to the first case. Anyway, you’ll see everything step by step starting from the next part, but for now, just take a taste from the app:</p>
<p></p><center><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_2_ask_chat_alert.png" alt="t27_2_ask_chat_alert" style="width:NaN%;"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_3_chatting.png" alt="t27_3_chatting" style="width:NaN%;"></center><p></p>
<h2>A Custom Class</h2>
<p>Knowing what our project is all about, let’s get our hands dirty by creating a custom class. In this class we will deal with the multipeer connectivity by implementing all the necessary framework methods needed to function properly. Also, as you’ll see by the end of this part, we will create a new <em>protocol</em> with ultimate goal to use the <em>delegation pattern</em> and pass that way messages to the calling class.</p>
<p>But, first things first. In Xcode, hit the Cmd-N key combination on your keyboard. In the guide that appears, select to create a new <strong>Cocoa Touch Class</strong> as shown below:</p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_4_class_template_1.png" alt="t27_4_class_template_1" class="aligncenter size-full wp-image-4692" style="width:NaN%;"></div>
<p>In the second step, make the new class subclass of the <strong>NSObject</strong> class, and name it <strong>MPCManager</strong>.</p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_5_class_template_2.png" alt="t27_5_class_template_2" class="aligncenter size-full wp-image-4693" style="width:NaN%;"></div>
<p>Proceed to get finished with the guide, and then make sure that you are working on the <em>MPCManager.swift</em> file.</p>
<p>As the first line of code, we’ll import the multipeer connectivity framework to the class. So, head to the top of the file and add the following:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">import MultipeerConnectivity</div></td></tr></tbody></table></div>
<p>Now, let’s declare the objects of the MPC framework classes that we’re going to use. At the top of the class add the next lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var session<span style="color: #002200;">:</span> MCSession<span style="color: #002200;">!</span><br>
<br>
var peer<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span><br>
<br>
var browser<span style="color: #002200;">:</span> MCNearbyServiceBrowser<span style="color: #002200;">!</span><br>
<br>
var advertiser<span style="color: #002200;">:</span> MCNearbyServiceAdvertiser<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>Apart from the above, let’s declare in advance two more variables that we are going to need later:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var foundPeers <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>MCPeerID<span style="color: #002200;">]</span><span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
var invitationHandler<span style="color: #002200;">:</span> <span style="color: #002200;">(</span><span style="color: #002200;">(</span>Bool, MCSession<span style="color: #002200;">!</span><span style="color: #002200;">)</span><span style="color: #002200;">-</span>&gt;Void<span style="color: #002200;">)</span><span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>In the <em>foundPeers</em> array we will store all the peers that the browser of a device will discover. Note that no connection to these peers will be made, we just need to know all the found peers by the device. Also, this array is initialized upon declaration, as there’s no need to keep it nil. We want it ready to accept new objects once we they’re found.</p>
<p>The <em>invitationHandler</em> is actually a <em>completion handler</em> declaration, but for now I won’t say anything more. We’ll talk about it when it’s time to use it.</p>
<p>Our next step is to make our custom class conform to specific MPC protocols. The delegate methods of these protocols will make us able to handle the multipeer connectivity, and deal with the browser, the advertiser and the session. So, modify the class’s header line by adding the protocols as shown below:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">class MPCManager<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/"><span style="color: #400080;">NSObject</span></a>, MCSessionDelegate, MCNearbyServiceBrowserDelegate, MCNearbyServiceAdvertiserDelegate</div></td></tr></tbody></table></div>
<p>I think it’s needless to say what each protocol is for.</p>
<p>Now, let’s create an initializer and let’s initialize all the MPC objects. We’ll see them one by one, starting from the <em>peer</em> object. This one represents the device as seen by all the other nearby devices, and upon its initialization it requires to be provided with a <em>display name</em>. This display name will be visible to other peers, and it can be any string you want. We will keep things simple here by simply setting the device’s name as the display name of the peer, however I don’t recommend to do so in a real application. Maybe you should let users type the name they desire, or use another method to specify the peer’s name. In code, the initialization is the following:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override init<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; super.init<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; peer <span style="color: #002200;">=</span> MCPeerID<span style="color: #002200;">(</span>displayName<span style="color: #002200;">:</span> UIDevice.currentDevice<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.name<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Through the <em>UIDevice</em> class we access the device’s name.</p>
<p>With the peer object already initialized, we can proceed to the rest of the objects. Note that the peer must be the first one that gets initialized, as it’s used by all the other objects as a parameter upon their initialization. Let’s focus on the <em>session</em> object:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override init<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; session <span style="color: #002200;">=</span> MCSession<span style="color: #002200;">(</span>peer<span style="color: #002200;">:</span> peer<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; session.delegate <span style="color: #002200;">=</span> self<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>As you can see, a session object is initialized with just one argument, the peer we previously specified. Besides the initialization, we also make our class the delegate of the <em>session</em> object.</p>
<p>Next, the <em>browser</em> object:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override init<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; browser <span style="color: #002200;">=</span> MCNearbyServiceBrowser<span style="color: #002200;">(</span>peer<span style="color: #002200;">:</span> peer, serviceType<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"appcoda-mpc"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; browser.delegate <span style="color: #002200;">=</span> self<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The initializer of this object accepts two parameters: The first one is the peer. The second one is a value that can’t be changed after the initialization, and it regards the service type that the browser should browse for. In simple words, it uniquely identifies the application among others so the MPC knows what to search for, and the same service type value must be set to the advertiser as well (you’ll see that in just a second). There are two rules that you should always follow when setting this value: (a) It mustn’t be longer than 15 characters, and (b) it can contain only lowercase ASCII characters, numbers and hyphens. In case you break any rule, an exception will be thrown at runtime and the app will crash.</p>
<p>Regarding the <em>advertiser</em>:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override init<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; advertiser <span style="color: #002200;">=</span> MCNearbyServiceAdvertiser<span style="color: #002200;">(</span>peer<span style="color: #002200;">:</span> peer, discoveryInfo<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span>, serviceType<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"appcoda-mpc"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; advertiser.delegate <span style="color: #002200;">=</span> self<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Notice that here we set the same service type value as before. The extra parameter existing here, named <em>discoveryInfo</em>, is a dictionary that can contain any kind of extra information you want to pass to the other peers upon discovery. Note that both keys and values of this dictionary must be strings. For simplicity reasons, we set this parameter to nil.</p>
<p>The <em>init</em> method is ready, and here it is in one piece:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override init<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; super.init<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; peer <span style="color: #002200;">=</span> MCPeerID<span style="color: #002200;">(</span>displayName<span style="color: #002200;">:</span> UIDevice.currentDevice<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.name<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; session <span style="color: #002200;">=</span> MCSession<span style="color: #002200;">(</span>peer<span style="color: #002200;">:</span> peer<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; session.delegate <span style="color: #002200;">=</span> self<br>
<br>
&nbsp; &nbsp; browser <span style="color: #002200;">=</span> MCNearbyServiceBrowser<span style="color: #002200;">(</span>peer<span style="color: #002200;">:</span> peer, serviceType<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"appcoda-mpc"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; browser.delegate <span style="color: #002200;">=</span> self<br>
<br>
&nbsp; &nbsp; advertiser <span style="color: #002200;">=</span> MCNearbyServiceAdvertiser<span style="color: #002200;">(</span>peer<span style="color: #002200;">:</span> peer, discoveryInfo<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span>, serviceType<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"appcoda-mpc"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; advertiser.delegate <span style="color: #002200;">=</span> self<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Before we reach the end of this part, let’s create a new protocol for implementing the delegation pattern. Note that we’ll declare all the delegate methods that we’re about to need during the development of this application in advance. We won’t bother again to deal with the protocol, and we’ll have them handy when we need them.</p>
<p>Go above the class definition, and add the next code segment:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">protocol MPCManagerDelegate <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; func foundPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; func lostPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; func invitationWasReceived<span style="color: #002200;">(</span>fromPeer<span style="color: #002200;">:</span> String<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; func connectedWithPeer<span style="color: #002200;">(</span>peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>I’m not going to discuss what each of the above function is for. We’ll see them in details in the next parts.</p>
<p>Lastly, let’s declare a delegate object in the <em>MPCManager</em> class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var delegate<span style="color: #002200;">:</span> MPCManagerDelegate?</div></td></tr></tbody></table></div>
<p>For the time being, we have successfully managed to reach the first important checkpoint of the project and we can take a breath here. Before I finish this part, let me say that any errors you see in Xcode are normal, and they’ll go away after we have all the MPC’s delegate methods implemented.</p>
<h2>Browsing for Peers</h2>
<p>The <em>MCNearbyServiceBrowserDelegate</em> protocol contains three methods that allow us to handle the found and lost peers, and any error that may occur during browsing. We’ll continue developing this demo application by implementing these methods, but as you’ll find out, they’re easy enough as there is no much to do in any of them.</p>
<p>Let’s get started with the first one, which is called by the MPC when a nearby peer is found (in other words, when another device is discovered). Let me give you the implementation first, and then we’ll talk about it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func browser<span style="color: #002200;">(</span>browser<span style="color: #002200;">:</span> MCNearbyServiceBrowser<span style="color: #002200;">!</span>, foundPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span>, withDiscoveryInfo info<span style="color: #002200;">:</span> <span style="color: #002200;">[</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/"><span style="color: #400080;">NSObject</span></a> <span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">]</span><span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; foundPeers.append<span style="color: #002200;">(</span>peerID<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; delegate?.foundPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The first and most important action we must take, is to add the found peer in the <em>foundPeers</em> array (we declared it in the previous part, remember?). Later, we are going to use this array as the datasource of the tableview in the <em>ViewController</em> class, where we will list all the found peers. So, once we do so, we make a call to the <em>foundPeer</em> delegate method of the <em>MPCManagerDelegate</em> protocol. This delegate method will be implemented in the <em>ViewController</em> class (in the next part), and in there we’ll reload the tableview data so the newly found peer to be displayed to the user.</p>
<p>Now that we have handled the case where a peer is found, we must deal with the exact opposite case; we must take care of the peers that are no longer available (discoverable). For this reason, let’s implement the next delegate method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func browser<span style="color: #002200;">(</span>browser<span style="color: #002200;">:</span> MCNearbyServiceBrowser<span style="color: #002200;">!</span>, lostPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">for</span> <span style="color: #002200;">(</span>index, aPeer<span style="color: #002200;">)</span> <span style="color: #a61390;">in</span> enumerate<span style="color: #002200;">(</span>foundPeers<span style="color: #002200;">)</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> aPeer <span style="color: #002200;">==</span> peerID <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foundPeers.removeAtIndex<span style="color: #002200;">(</span>index<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">break</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; delegate?.lostPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>No much to say here, as the code explains itself pretty well I think. At first we locate the peer that was lost in the <em>foundPeers</em> array, and then we remove it. After having done so and the peer is no longer in our “list”, we must notify the <em>ViewController</em> class so it updates the tableview with the displayed peers. For that reason, we call the <em>lostPeer</em> delegate method, in which later during its implementation we’ll reload the tableview data.</p>
<p>Lastly, there’s one more delegate method we should implement, and that is for managing any error that may occur and the browsing is unable to be performed. Obviously, we are not going to do any serious error handling here, we’ll just display the error message. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func browser<span style="color: #002200;">(</span>browser<span style="color: #002200;">:</span> MCNearbyServiceBrowser<span style="color: #002200;">!</span>, didNotStartBrowsingForPeers error<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a><span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; println<span style="color: #002200;">(</span>error.localizedDescription<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Before we reach the end of this part, let me highlight the following: Instead of using the above delegate methods to inform the <em>ViewController</em> class about the changes happening to the peers, we could have used the <em>Key-Value Coding</em> and <em>Key-Value Observing</em> mechanisms to track any changes of the <em>foundPeers</em> array. However, we don’t do that just because there’s no need to write extra code since the <em>MPCManagerDelegate</em> protocol exists. If we wouldn’t need it to implement more methods other than the above two, then we could have used the KVC and KVO instead of the delegation pattern. So, we stick to it, as the implementation of the delegate methods consists of a much faster and simple process in this case.</p>
<p>With all the above, the application is capable of browsing for other peers. Now, let’s go ahead to add the necessary code so we display them once they’re found.</p>
<h2>Displaying Found Peers</h2>
<p>Now that our demo application can discover nearby peers and add (or remove) them in the <em>foundPeers</em> array, let’s go to the <em>ViewController</em> class to display them in the existing tableview. Prior to that though, we will pay a visit to the <em>AppDelegate</em> class, where we will declare an <em>MPCManager</em> object. In the rest of classes we’ll be able to access it through the application delegate instance.</p>
<p>In the Project Navigator just click to the <em>AppDelegate.swift</em> file to open it. At the top of the class, add the following line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var mpcManager<span style="color: #002200;">:</span> MPCManager<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>Also, go to the <em>application(application:didFinishLaunchingWithOptions:)</em> method to initialise it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func application<span style="color: #002200;">(</span>application<span style="color: #002200;">:</span> UIApplication, didFinishLaunchingWithOptions launchOptions<span style="color: #002200;">:</span> <span style="color: #002200;">[</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/"><span style="color: #400080;">NSObject</span></a><span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">]</span>?<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Bool <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Override point for customization after application launch.</span><br>
<br>
&nbsp; &nbsp; mpcManager <span style="color: #002200;">=</span> MPCManager<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">true</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, we can open the <em>ViewController.swift</em> file and keep working there. If you take a look around, you will see that a minimum implementation has been already done. Apparently, we are going to add more code, and we will fix the tableview-related methods so everything to be working properly. Let’s begin by declaring and instantiating at the same time an application delegate object at the top of the class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">let appDelegate <span style="color: #002200;">=</span> UIApplication.sharedApplication<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.delegate as AppDelegate</div></td></tr></tbody></table></div>
<p>Instantiating or initialising an object upon declaration is an awesome feature of Swift, because less code is required to be written and the development process becomes faster. The next step is to set the <em>ViewController</em> as the delegate of the <em>MPCManager</em> class, so in the <em>viewDidLoad</em> method add the next simple line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; appDelegate.mpcManager.delegate <span style="color: #002200;">=</span> self<br>
<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Xcode will show an error in this line now, and that’s because of an easy reason: We didn’t adopt the <em>MPCManagerDelegate</em> protocol yet. So, go to the class header line, and add it as you see next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">class ViewController<span style="color: #002200;">:</span> UIViewController, UITableViewDelegate, UITableViewDataSource, MPCManagerDelegate</div></td></tr></tbody></table></div>
<p>Let’s continue now by implementing the two delegate methods we used in the previous part, the <em>foundPeer</em> and <em>lostPeer</em>. In both cases what we only want is to refresh the tableview, so their implementation is quite easy:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func foundPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; tblPeers.reloadData<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span><br>
<br>
<br>
func lostPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; tblPeers.reloadData<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The above is an important step towards our goal, but still nothing is going to appear unless we “tell” the tableview what the datasource is and of course, unless we do the proper modifications so it displays the names of the nearby peers. So, let’s do that by starting from the total number of rows that the one and only section is going to have. Obviously, the rows will match to the total number of the found peers:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, numberOfRowsInSection section<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Int <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> appDelegate.mpcManager.foundPeers.count<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, it’s time to display the name of each peer:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell <span style="color: #002200;">=</span> tableView.dequeueReusableCellWithIdentifier<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"idCellPeer"</span><span style="color: #002200;">)</span> as UITableViewCell<br>
<br>
&nbsp; &nbsp; cell.textLabel?.text <span style="color: #002200;">=</span> appDelegate.mpcManager.foundPeers<span style="color: #002200;">[</span>indexPath.row<span style="color: #002200;">]</span>.displayName<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Notice in the above code that we access the display name of each peer in the <em>foundPeers</em> array.</p>
<p>Finally, let’s specify the height of each row:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, heightForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; CGFloat <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">60.0</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>After having done all the above, the tableview is going to perfectly work.</p>
<p>Even though we’ve done an important work here, we are not over yet as there is another final and crucial detail: By default the browsing functionality is off, and the device is not going to browse for other peers unless we instruct it to do so. Starting the browser can be done at any time you want, depending always on the requirements of your application. Here, we’ll start the browser right after the app gets launched, so go to the <em>viewDidLoad</em> method and add the next line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; appDelegate.mpcManager.browser.startBrowsingForPeers<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>To perform the exact opposing thing and stop the browser, you can make a call to the <em>stopBrowsingForPeers()</em> method of the browser.</p>
<p>Everything regarding the browser is now ready, so we can move ahead and focus on the advertising functionality of the device.</p>
<h2>Handling Advertising</h2>
<p>Apart from browsing, the multipeer connectivity framework lets a device to advertise itself to the nearby peers as well. Browsing would be pointless without advertising. Actually, they complete each other, and they’re equally important. When talking about advertising, it’s like saying whether a device is visible to others or not. If the advertising functionality is enabled to an app, then the device is visible to other nearby peers. If not, then there’s no way to be discovered by other peers. We are going to see that in a bit more detailed level in this part, as we’ll make make our demo application capable of enabling and disabling the advertising functionality.</p>
<p>If you explored for a while the starter project you’ve got in your hands, then you would have definitely seen that in the <em>ViewController</em> scene there is a toolbar with a bar button item in it. We are going to use this button by implementing the <em>startStopAdvertising(sender:)</em> action method, where, as you assume, we’ll toggle the advertising functionality of the multipeer connectivity framework. To keep things simple, we’ll just display an action sheet when the button is tapped. In this action sheet, two buttons only are going to exist: One to switch between the two advertising states, and one to cancel and close the action sheet dialog. To make it more interesting, we’ll make the first button title get changed depending on the current state.</p>
<p>Before we see all the above in code, let’s declare a new Bool property, which we’ll use to check if the device is advertising or not. Make sure that you still have the <em>ViewController.swift</em> open, and then go to the top of the class and add the next line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var isAdvertising<span style="color: #002200;">:</span> Bool<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>This variable needs to have a value, and we’ll do so in the <em>viewDidLoad</em> method. We are going to set its value to <em>true</em>, meaning that the device is currently advertising itself. However, in order for this to be true, we must turn this feature on, so in the <em>viewDidLoad</em> method go and do both of what we just said:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; appDelegate.mpcManager.advertiser.startAdvertisingPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; isAdvertising <span style="color: #002200;">=</span> <span style="color: #a61390;">true</span> &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, we can go to the action method and implement it. At first, I give you the respective code snippet. Then, we’ll say a few things about it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func startStopAdvertising<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let actionSheet <span style="color: #002200;">=</span> UIAlertController<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">""</span>, message<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"Change Visibility"</span>, preferredStyle<span style="color: #002200;">:</span> UIAlertControllerStyle.ActionSheet<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; var actionTitle<span style="color: #002200;">:</span> String<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> isAdvertising <span style="color: #002200;">==</span> <span style="color: #a61390;">true</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; actionTitle <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">"Make me invisible to others"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; actionTitle <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">"Make me visible to others"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; let visibilityAction<span style="color: #002200;">:</span> UIAlertAction <span style="color: #002200;">=</span> UIAlertAction<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> actionTitle, style<span style="color: #002200;">:</span> UIAlertActionStyle.Default<span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span>alertAction<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> self.isAdvertising <span style="color: #002200;">==</span> <span style="color: #a61390;">true</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.appDelegate.mpcManager.advertiser.stopAdvertisingPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.appDelegate.mpcManager.advertiser.startAdvertisingPeer<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.isAdvertising <span style="color: #002200;">=</span> <span style="color: #002200;">!</span>self.isAdvertising<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; let cancelAction <span style="color: #002200;">=</span> UIAlertAction<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"Cancel"</span>, style<span style="color: #002200;">:</span> UIAlertActionStyle.Cancel<span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span>alertAction<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; actionSheet.addAction<span style="color: #002200;">(</span>visibilityAction<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; actionSheet.addAction<span style="color: #002200;">(</span>cancelAction<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; self.presentViewController<span style="color: #002200;">(</span>actionSheet, animated<span style="color: #002200;">:</span> <span style="color: #a61390;">true</span>, completion<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Let’s see in short what is being taking place in the above implementation:</p>
<ul>
<li>Firstly, we initialize an action sheet controller by providing it with a message and the proper style.</li>
<li>Next, depending on the current value of the <em>isAdvertising</em> variable, we specify the title for the first button of the action sheet by assigning the proper value to the <em>actionTitle</em> local variable.</li>
<li>By having the correct title, we create a new <em>alert action</em> which will be triggered when the user will tap in the first button.</li>
<li>The most important part is here: Based on the value of the <em>isAdvertising</em> variable, we either stop or start the advertising of the device. Of course, don’t forget to set the exact opposing value to the <em>isAdvertising</em> variable.</li>
<li>We create an (empty) action for the cancel button.</li>
<li>Both of the actions are added to the action sheet controller.</li>
<li>Finally, the action sheet controller is presented animated to the view.</li>
</ul>
<p>You will see how the above action method works later on, during the app testing. With all the above, you’ll be able to change the discoverability state of your device on will.</p>
<h2>Inviting a Peer</h2>
<p>The purpose of the multipeer connectivity is to let two (or more) devices to establish a connection and exchange data. That means that we are in the half-way until now, as we have only implemented the peer discovery and the advertising functionality. The next step is to invite a peer to join a session, so it’s possible between two devices to communicate.</p>
<p>The most important here is to understand that when implementing the MPC manually (like this demo), it’s totally up to you to decide when it’s the best time to invite a found peer to connect to a session. There’s not a default time to do that, and the appropriate timing is strictly related to the nature of the application. For example, here we are going to invite a nearby peer when we’ll tap on its name in the <em>ViewController</em> class’s tableview. In other cases, you might need to send the invitation right after the peer is discovered by the browser. Again, you are free to decide based on the app requirements when you should send the invitation. Additionally, it’s equally important to know that the invitation can be sent and a connection to be established without asking for the user’s consent; you can perform anything simply behind the scenes. However, I would advice you to always inform the user that his app is about to get connected to another device, to send and receive data, etc.</p>
<p>With the above in mind, let’s get back to our demo. Our goals in this part are:</p>
<ol>
<li>To send an invitation to another peer when we tap on its name in the tableview.</li>
<li>To receive the invitation.</li>
<li>To ask user if he accepts to chat with the inviter (actually if he accepts the invitation).</li>
<li>To accept or decline the invitation.</li>
</ol>
<p>Being already in the <em>ViewController.swift</em> file, let’s get started by making the tableview respond when tapping on it. Right next, we are going to implement the <em>tableView(tableView:didSelectRowAtIndexPath:)</em> delegate method, and in it we’ll perform a quite important task: We’ll send the invitation to the selected peer. As you’ll see, this takes just one line of code. Let’s see the method and then we’ll keep discussing about it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, didSelectRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let selectedPeer <span style="color: #002200;">=</span> appDelegate.mpcManager.foundPeers<span style="color: #002200;">[</span>indexPath.row<span style="color: #002200;">]</span> as MCPeerID<br>
<br>
&nbsp; &nbsp; appDelegate.mpcManager.browser.invitePeer<span style="color: #002200;">(</span>selectedPeer, toSession<span style="color: #002200;">:</span> appDelegate.mpcManager.session, withContext<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span>, timeout<span style="color: #002200;">:</span> <span style="color: #2400d9;">20</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>To be honest, we could have even avoided the first line where we assign the selected peer into a local variable, and with one line only to perform something really important. Anyway, the first line makes things clearer, so let’s keep it there.</p>
<p>Using the <em>invitePeer(peerID:toSession:withContext:timeout:)</em> of the browser object, we sent an invitation to the selected peer using the multipeer connectivity framework. It accepts the following parameters:</p>
<ol>
<li><em>peerID</em>: The peer to which we want to send the invitation.</li>
<li><em>toSession</em>: The session object that we initialized in the <em>MPCManager</em> class.</li>
<li><em>withContext</em>: This parameter can be used if you want to send some extra data to the invited peer. It requires a <em>NSData</em> object.</li>
<li><em>timeout</em>: Here we specify how many seconds the inviter will be waiting for the other peer’s answer. The default value is 30 seconds, here we set it to 20. Your app requirements will “tell” you how much the waiting time should be in a real application.</li>
</ol>
<p>Now, jump for a second right above the class, and import the MPC framework so a new error shown in the above line to disappear:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">import MultipeerConnectivity</div></td></tr></tbody></table></div>
<p>The above was the first step. Next, we must implement a couple of delegate methods of the <em>MCNearbyServiceAdvertiserDelegate</em> protocol, so the app can handle a received invitation. Open the <em>MPCManager.swift</em> file to keep working.</p>
<p>The method you are going to see next, contains an <em>invitation handler</em> which is used to reply to the peer that sent the invitation. This handler accepts two arguments, where the first one is a bool value indicating whether the invitation was accepted or not, and the second is the session object, in case of a positive answer. In this demo application we are not going to give an answer straight away back to the inviter, because we will ask the user if he wants to chat or not first. So, we must temporarily store the invitation handler to a property, and after the user has responded we can call it in order to reply to the invitation. If you remember, we had previously declared the following:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var invitationHandler<span style="color: #002200;">:</span> <span style="color: #002200;">(</span><span style="color: #002200;">(</span>Bool, MCSession<span style="color: #002200;">!</span><span style="color: #002200;">)</span><span style="color: #002200;">-</span>&gt;Void<span style="color: #002200;">)</span><span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>In this one we will store the invitation handler. With that said, we can see the implementation of the first delegate method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func advertiser<span style="color: #002200;">(</span>advertiser<span style="color: #002200;">:</span> MCNearbyServiceAdvertiser<span style="color: #002200;">!</span>, didReceiveInvitationFromPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span>, withContext context<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a><span style="color: #002200;">!</span>, invitationHandler<span style="color: #002200;">:</span> <span style="color: #002200;">(</span><span style="color: #002200;">(</span>Bool, MCSession<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void<span style="color: #002200;">)</span><span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; self.invitationHandler <span style="color: #002200;">=</span> invitationHandler<br>
<br>
&nbsp; &nbsp; delegate?.invitationWasReceived<span style="color: #002200;">(</span>peerID.displayName<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Keeping the invitation handler to the <em>invitationHandler</em> property is as simple as that. Note that both handlers have the same name, so the use of the <em>self</em> specifier is mandatory here.</p>
<p>Besides that, we make a call to another method of the <em>MPCManagerDelegate</em> protocol. With it, we notify the <em>ViewController</em> class that an invitation was received, so it shows an alert controller to the user asking to chat. We’ll see its implementation in just a while, but for now notice that we pass just the display name of the peer. This is what we care about for now.</p>
<p>The second delegate method of the <em>MCNearbyServiceAdvertiserDelegate</em> protocol is used to handle the case in which the advertiser cannot be turned on. Here, we’ll just print the error message to the console:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func advertiser<span style="color: #002200;">(</span>advertiser<span style="color: #002200;">:</span> MCNearbyServiceAdvertiser<span style="color: #002200;">!</span>, didNotStartAdvertisingPeer error<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a><span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; println<span style="color: #002200;">(</span>error.localizedDescription<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, let’s head back to the <em>ViewController.swift</em> file, where we will implement the <em>invitationWasReceived(fromPeer:)</em> delegate method. In it, we will simply show an alert controller to the user. Its message will inform which the user asking to chat is (we’ll show the display name of the peer), and we’ll provide two options: Accept and Decline. No matter what the user selects, we’ll use the <em>invitationHandler</em> property of the <em>MPCManager</em> class to reply to the inviter. Let’s see the implementation now:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func invitationWasReceived<span style="color: #002200;">(</span>fromPeer<span style="color: #002200;">:</span> String<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let alert <span style="color: #002200;">=</span> UIAlertController<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">""</span>, message<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"<span style="color: #2400d9;">\(</span>fromPeer) wants to chat with you."</span>, preferredStyle<span style="color: #002200;">:</span> UIAlertControllerStyle.Alert<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; let acceptAction<span style="color: #002200;">:</span> UIAlertAction <span style="color: #002200;">=</span> UIAlertAction<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"Accept"</span>, style<span style="color: #002200;">:</span> UIAlertActionStyle.Default<span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span>alertAction<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; self.appDelegate.mpcManager.invitationHandler<span style="color: #002200;">(</span><span style="color: #a61390;">true</span>, self.appDelegate.mpcManager.session<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; let declineAction <span style="color: #002200;">=</span> UIAlertAction<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"Cancel"</span>, style<span style="color: #002200;">:</span> UIAlertActionStyle.Cancel<span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span>alertAction<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; self.appDelegate.mpcManager.invitationHandler<span style="color: #002200;">(</span><span style="color: #a61390;">false</span>, <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; alert.addAction<span style="color: #002200;">(</span>acceptAction<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; alert.addAction<span style="color: #002200;">(</span>declineAction<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a>.mainQueue<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.addOperationWithBlock <span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; self.presentViewController<span style="color: #002200;">(</span>alert, animated<span style="color: #002200;">:</span> <span style="color: #a61390;">true</span>, completion<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The above is a typical alert controller implementation, so there’s nothing complex in it. In the case of the <em>acceptAction</em> action, we call the <em>invitationHandler</em> property of the <em>mpcManager</em> object, setting the <em>true</em> as the response to the invitation and providing the session object. On the other hand, if the user doesn’t want to chat, then we set the <em>false</em> value to the invitation handler and the <em>nil</em> as the second argument; there’s no need to send the session in this case.</p>
<p>One more significant step has just finished, so we can go and see what the states of a session are and what happens (in this demo app) when a connection is made.</p>
<h2>Connecting to a Session</h2>
<p>A session, which is represented by the <em>session</em> object in the <em>MPCManager</em> class, is the ultimate target when working with the multipeer connectivity. Once both peers have connected to a session, it’s possible for them to exchange data or resources, and perform streaming. A session has three states in total: The desired one is the <em>Connected</em>. The second is the <em>Connecting</em> state, which is an intermediate, temporary state that a session enters to when trying to connect. Lastly, the third one is the <em>Not Connected</em> state, which can either be the result of the user’s decline to connect (not accepting the invitation), or the connection simply fails.</p>
<p>The multipeer connectivity framework allows us to have control over each state, and that’s possible through a delegate method of the <em>MCSessionDelegate</em> protocol. Usually, the implementation of this method is not difficult, as it’s only required to examine each case and take the proper actions. In the following code snippet, you’ll see that only in the <em>Connected</em> state we make a call to another delegate method of the <em>MPCManagerDelegate</em> protocol. In the other two cases, we simply display a message to the console, so we can know during testing what’s the exact state of the session at any time. Before you copy the next code, make sure to open the <em>MPCManager.swift</em> file.</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func session<span style="color: #002200;">(</span>session<span style="color: #002200;">:</span> MCSession<span style="color: #002200;">!</span>, peer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span>, didChangeState state<span style="color: #002200;">:</span> MCSessionState<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">switch</span> state<span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">case</span> MCSessionState.Connected<span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; println<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"Connected to session: <span style="color: #2400d9;">\(</span>session)"</span><span style="color: #002200;">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; delegate?.connectedWithPeer<span style="color: #002200;">(</span>peerID<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">case</span> MCSessionState.Connecting<span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; println<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"Connecting to session: <span style="color: #2400d9;">\(</span>session)"</span><span style="color: #002200;">)</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">default</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; println<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"Did not connect to session: <span style="color: #2400d9;">\(</span>session)"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Using the <em>connectedWithPeer(peerID:)</em> delegate method, we inform the <em>ViewController</em> class that the device has connected to a session with a nearby peer, the one specified by the <em>peerID</em> parameter above.</p>
<p>Back to the <em>ViewController.swift</em> file again, let’s implement the <em>connectedWithPeer(peerID:)</em> method. In this demo application we want to start chatting right after the peers have connected to the session, so we only have to navigate to the <em>Chat View Controller</em> scene. Easy enough, here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func connectedWithPeer<span style="color: #002200;">(</span>peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a>.mainQueue<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.addOperationWithBlock <span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; self.performSegueWithIdentifier<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"idSegueChat"</span>, sender<span style="color: #002200;">:</span> self<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Note that the above will make both devices (the inviter and the invitee) to perform the segue, as the session will eventually reach the <em>Connected</em> state in both of them.</p>
<p>From now on we’ll be working on the <em>ChatViewController</em> class. Let me underline just one thing before we proceed: We are not going to deal with the case where the user turns down the invitation for chatting. I don’t think that there’s anything really important to that, so I leave it to you to implement it if you want.</p>
<h2>A Handy Method To Send Data</h2>
<p>In this part we are going to create a custom method in the <em>MPCManager</em> class, which we’ll use to send data to another peer. Actually, in this one we are going to make a call to special method of the <em>MCSession</em> class which is responsible for sending data, but first we will prepare and configure all the arguments that this method accepts. The reason we create this custom method is simply to avoid doing all the configuration more than one time later on.</p>
<p>Let me start by giving you the implementation first (make sure to open the <em>MPCManager.swift</em> file):</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func sendData<span style="color: #002200;">(</span>dictionaryWithData dictionary<span style="color: #002200;">:</span> Dictionary&lt;String, String&gt;, toPeer targetPeer<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Bool <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let dataToSend <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSKeyedArchiver_Class/"><span style="color: #400080;">NSKeyedArchiver</span></a>.archivedDataWithRootObject<span style="color: #002200;">(</span>dictionary<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; let peersArray <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/"><span style="color: #400080;">NSArray</span></a><span style="color: #002200;">(</span>object<span style="color: #002200;">:</span> targetPeer<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; var error<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a>?<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>session.sendData<span style="color: #002200;">(</span>dataToSend, toPeers<span style="color: #002200;">:</span> peersArray, withMode<span style="color: #002200;">:</span> MCSessionSendDataMode.Reliable, error<span style="color: #002200;">:</span> <span style="color: #002200;">&amp;</span>error<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; println<span style="color: #002200;">(</span>error?.localizedDescription<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">false</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">true</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The <em>MPCSession</em> method called above is the <em>sendData(data:toPeers:withMode:error:)</em> and it accepts the following parameters:</p>
<ul>
<li><em>data</em>: The actual data that will be sent, expressed as a <em>NSData</em> object.</li>
<li><em>toPeers</em>: An array (<em>NSArray</em>) with the peers that should receive the data.</li>
<li><em>withMode</em>: The data sending mode. There are two modes: <em>Reliable</em> and <em>Unreliable</em>. You can use the second mode in less crucial cases, where any unreceived data won’t cause any problems at all.</li>
<li><em>error</em>: A <em>NSError</em> object that will contain any error that may occur.</li>
</ul>
<p>Now, let’s see what takes place in the above implementation. As you see, the method gets two parameters: (a) A dictionary object, which in our case will contain the message. (b) The target peer. At first, the dictionary is converted to a <em>NSData</em> object by archiving it using the <em>NSKeyedArchiver</em> class. Then, a new array named <em> peersArray</em> is initialized with one object only, the target peer. After the error variable declaration, we make a call to the data sending method of the <em>session</em> object, providing all the above variables as parameters.</p>
<p>If any error occurs while sending data, then we display its description and we return <em>false</em> from the method. Otherwise, the <em>true</em> value is returned, meaning that everything went smoothly.</p>
<p>The above method will be used in the next part. For us it consists of a tool, and that’s the way we are going to use it.</p>
<h2>Sending Data Between Peers</h2>
<p>All the messages that the peers will send and receive during the chat session, are going to be displayed in the tableview existing in the <em>Chat View Controller</em> scene. The last displayed message will be always the most recent one, and every time a message is either sent or received will force a reload to that tableview.</p>
<p>As you may guess, we are going to use an <em>array</em> for storing all messages. Obviously, this array is going to be the datasource of the tableview. It’s important to say that each object of this array is going to be a <em>Dictionary</em> with both its key and value to be String values. Why a dictionary? Because we need to have a pair of data for each message sent or received: The sender (author) of the message and the message itself. When our device is the one sending the message (when we’re the authors), then the “self” value will be set as the sender of the message in our device, while our peer display name will be sent to the other device.</p>
<p>Let’s get back to work again, as we have more than a few things to do here too. The first step is to declare and initialize the messages array (the datasource of the tableview). Along with it, we are going go declare and instantiate an application delegate object, so we can access the <em>mpcManager</em> property of the <em>AppDelegate</em> class. Let’s see all that by opening the <em>ChatViewController.swift</em> file. At the top of the class add the next two lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var messagesArray<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>Dictionary&lt;String, String&gt;<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">]</span><br>
<br>
let appDelegate <span style="color: #002200;">=</span> UIApplication.sharedApplication<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.delegate as AppDelegate</div></td></tr></tbody></table></div>
<p>The <em>messagesArray</em> is initialized as an empty array. Also, we are not going to set the <em>ChatViewController</em> class as the delegate of the <em>mpcManager</em> object. Instead, we’ll use another approach to get messages from the <em>MPCManager</em> class.</p>
<p>When chatting, all actions are triggered after a new message gets written and the Send button is tapped. Once this happens, there are certain things we should do:</p>
<ol>
<li>To hide the keyboard.</li>
<li>To create a dictionary with the message and call the custom method of the previous part to send it to the other peer.</li>
<li>To create another dictionary with both the sender and the message as its contents, and then store it in the <em>messagesArray</em> array.</li>
<li>To update the tableview.</li>
<li>To clear the textfield after the message has been sent.</li>
</ol>
<p>The above will take place in the <em>textFieldShouldReturn(textField:)</em> delegate method of the <em>UITextFieldDelegate</em> protocol. If you look at the <em>viewDidLoad</em> method, the <em>ChatViewController</em> class has already been set as the delegate of the textfield.</p>
<p>Here is the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func textFieldShouldReturn<span style="color: #002200;">(</span>textField<span style="color: #002200;">:</span> UITextField<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Bool <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; textField.resignFirstResponder<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; let messageDictionary<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>String<span style="color: #002200;">:</span> String<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">:</span> textField.text<span style="color: #002200;">]</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> appDelegate.mpcManager.sendData<span style="color: #002200;">(</span>dictionaryWithData<span style="color: #002200;">:</span> messageDictionary, toPeer<span style="color: #002200;">:</span> appDelegate.mpcManager.session.connectedPeers<span style="color: #002200;">[</span><span style="color: #2400d9;">0</span><span style="color: #002200;">]</span> as MCPeerID<span style="color: #002200;">)</span><span style="color: #002200;">{</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; var dictionary<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>String<span style="color: #002200;">:</span> String<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"sender"</span><span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"self"</span>, <span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">:</span> textField.text<span style="color: #002200;">]</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; messagesArray.append<span style="color: #002200;">(</span>dictionary<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; self.updateTableview<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; println<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"Could not send data"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; textField.text <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">""</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">true</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>A couple of notes now: You see that we call the <em>sendData(dictionaryWithData:toPeer:)</em> custom method by providing it with the <em>messageDictionary</em> we created right above of it. Also, it’s interesting how we specify the target peer using the <em>appDelegate.mpcManager.session.connectedPeers[0]</em> object. To make this a bit more clear, it’s necessary to say that the <em>MCSession</em> class contains an array property named <em>connectedPeers</em>, to which all the peers connected to our device are added. In our implementation, we know that only one peer will be connected to the session, so it’s safe to access it directly using in the first index of that array.</p>
<p>If the data is successfully sent, then we prepare a new dictionary with the sender and the message. As this is our message, the “self” value is set as the sender. Then, using the <em>append</em> method of the <em>messagesArray</em> we add the dictionary to the array. Lastly, we call the <em>updateTableview</em> method to update the tableview. It’s a custom one, and we’ll implement it right next.</p>
<p>If any error occurs, then we just display a message to the console. No matter what will happen, at the end of the above method we clear the textfield.</p>
<p>The <em>updateTableview</em> method that we are about to write has double purpose: Firstly, to reload the tableview data, so any new message to be displayed there. Secondly, to automatically scroll to the end of the tableview, so the most recent message to be always visible. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func updateTableview<span style="color: #002200;">(</span><span style="color: #002200;">)</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; self.tblChat.reloadData<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> self.tblChat.contentSize.height &gt; self.tblChat.frame.size.height <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; tblChat.scrollToRowAtIndexPath<span style="color: #002200;">(</span><a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">(</span>forRow<span style="color: #002200;">:</span> messagesArray.count <span style="color: #002200;">-</span> <span style="color: #2400d9;">1</span>, inSection<span style="color: #002200;">:</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">)</span>, atScrollPosition<span style="color: #002200;">:</span> UITableViewScrollPosition.Bottom, animated<span style="color: #002200;">:</span> <span style="color: #a61390;">true</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>If the height of the tableview’s content size becomes greater than the height of the tableview’s frame, then we must scroll. We do so by using the method you see above.</p>
<p>Now, at the top of the class import the multipeer connectivity framework to fix the error issued by Xcode in the <em> textFieldShouldReturn(textField:)</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">import MultipeerConnectivity</div></td></tr></tbody></table></div>
<p>There’s one final job we must do before we end this part. We must fix the tableview-related methods. First of all, the number of the rows must match to the total objects existing in the <em>messagesArray</em> array:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, numberOfRowsInSection section<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Int <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> messagesArray.count<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>In the <em>tableView(tableView:cellForRowAtIndexPath:)</em> method, we are going to check which the sender of the message is. If the sender’s value is the “self” value, then we’ll set the purple color to the subtitle label and we’ll display the message “I said:”. In the opposite case, we’ll specify the orange color and we’ll display the message “X said:”, where X is the display name of the other peer. Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell <span style="color: #002200;">=</span> tableView.dequeueReusableCellWithIdentifier<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"idCell"</span><span style="color: #002200;">)</span> as UITableViewCell<br>
<br>
&nbsp; &nbsp; let currentMessage <span style="color: #002200;">=</span> messagesArray<span style="color: #002200;">[</span>indexPath.row<span style="color: #002200;">]</span> as Dictionary&lt;String, String&gt;<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let sender <span style="color: #002200;">=</span> currentMessage<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"sender"</span><span style="color: #002200;">]</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; var senderLabelText<span style="color: #002200;">:</span> String<br>
&nbsp; &nbsp; &nbsp; &nbsp; var senderColor<span style="color: #002200;">:</span> UIColor<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> sender <span style="color: #002200;">==</span> <span style="color: #bf1d1a;">"self"</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; senderLabelText <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">"I said:"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; senderColor <span style="color: #002200;">=</span> UIColor.purpleColor<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; senderLabelText <span style="color: #002200;">=</span> sender <span style="color: #002200;">+</span> <span style="color: #bf1d1a;">" said:"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; senderColor <span style="color: #002200;">=</span> UIColor.orangeColor<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; cell.detailTextLabel?.text <span style="color: #002200;">=</span> senderLabelText<br>
&nbsp; &nbsp; &nbsp; &nbsp; cell.detailTextLabel?.textColor <span style="color: #002200;">=</span> senderColor<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let message <span style="color: #002200;">=</span> currentMessage<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">]</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; cell.textLabel?.text <span style="color: #002200;">=</span> message<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>There is nothing difficult at all in the above method, therefore there’s nothing else to discuss about it.</p>
<p>It would be interesting at this point to mention something about the height of the tableview rows. It’s obvious that we can’t tell for sure what the height should be, as the length of the messages will vary, and the height of each row should be dynamically set. For this reason, we use a new feature of iOS 8, named <em>self sizing cells</em>. You can find <a href="http://www.appcoda.com/self-sizing-cells/">a great tutorial on this by Simon here</a>. What it gets is simple: We set the number of lines in the cell’s text label to zero, and then in the <em>viewDidLoad</em> method we set the next two properties:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">tblChat.estimatedRowHeight <span style="color: #002200;">=</span> <span style="color: #2400d9;">60.0</span><br>
tblChat.rowHeight <span style="color: #002200;">=</span> UITableViewAutomaticDimension</div></td></tr></tbody></table></div>
<p>iOS will take care of the rest. You can find the above already existing in the <em>viewDidLoad</em>.</p>
<p>With the above said, we can carry on and handle the received data.</p>
<h2>Receiving Data</h2>
<p>Now that the app sends messages, we must handle them when they are received. We are going to work in both the <em>MPCManager</em> and the <em>ChatViewController</em> classes. For starters, we are going to implement a new method of the <em>MPCSessionDelegate</em> protocol.</p>
<p>Open the <em>MPCManager.swift</em> file, and add the next method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func session<span style="color: #002200;">(</span>session<span style="color: #002200;">:</span> MCSession<span style="color: #002200;">!</span>, didReceiveData data<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a><span style="color: #002200;">!</span>, fromPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let dictionary<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>String<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"data"</span><span style="color: #002200;">:</span> data, <span style="color: #bf1d1a;">"fromPeer"</span><span style="color: #002200;">:</span> peerID<span style="color: #002200;">]</span><br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotificationCenter_Class/"><span style="color: #400080;">NSNotificationCenter</span></a>.defaultCenter<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.postNotificationName<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"receivedMPCDataNotification"</span>, object<span style="color: #002200;">:</span> dictionary<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>It contains only two, but important lines. At first, both the received data object and the sender peer are added to a dictionary. Next, we post a <em>notification</em> (<em>NSNotification</em>) named <em>receivedMPCDataNotificaton</em>. In the <em>ChatViewController</em> we’ll observer for it, and then we’ll handle it properly, so the display name of the sender and the message to be shown in the tableview. In the previous part I said that the <em>ChatViewController</em> won’t be set as the delegate of the <em>MPCManager</em> class, and that we would use another approach to get messages from this class. This different approach is the above notification we post.</p>
<p>Now, let’s head back to the <em>ChatViewController.swift</em> file, where in the <em>viewDidLoad</em> method we must observe for the above notification. That’s simple to do, as it only takes the next line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ... &nbsp; &nbsp;<br>
<br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotificationCenter_Class/"><span style="color: #400080;">NSNotificationCenter</span></a>.defaultCenter<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.addObserver<span style="color: #002200;">(</span>self, selector<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"handleMPCReceivedDataWithNotification:"</span>, name<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"receivedMPCDataNotification"</span>, object<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>With that, every time that new data is received a notification will be posted, and the <em>ChatViewController</em> class will be aware of that.</p>
<p>We’ve left one last step here, to implement the <em>handleMPCReceivedDataWithNotification(notification:)</em> custom message. This one will be called when the notification arrives.</p>
<p>Before we see its implementation, let me outline what is going to take place in it:</p>
<ul>
<li>Initially, we’ll get the dictionary posted along with the notification, and we’ll “extract” the data and the peer contained in it.</li>
<li>We’ll convert the data object to a <em>Dictionary</em>, so we can access the message.</li>
<li>At this point, we’ll make a convention, and we’ll agree to a special phrase that means the end of chat. This phrase will be the <em>“<em>end_chat</em>“</em> message.</li>
<li>If the message is other than the above special value, then we’ll create a new dictionary containing the sender’s display name and the message. This dictionary will be added to the <em>messagesArray</em> array. Also, we will update the tableview.</li>
<li>If the message signals the end of chat, then we’ll show an alert to the user letting him know that the other peer ended the chat, and we’ll dismiss the view controller. We’ll write the code for this step in the next part.</li>
</ul>
<p>Let’s see all the above in code. Extra comments in the next snippet will help you get it much easier:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func handleMPCReceivedDataWithNotification<span style="color: #002200;">(</span>notification<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the dictionary containing the data and the source peer from the notification.</span><br>
&nbsp; &nbsp; let receivedDataDictionary <span style="color: #002200;">=</span> notification.object as Dictionary&lt;String, AnyObject&gt;<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// "Extract" the data and the source peer from the received dictionary.</span><br>
&nbsp; &nbsp; let data <span style="color: #002200;">=</span> receivedDataDictionary<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"data"</span><span style="color: #002200;">]</span> as? <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/"><span style="color: #400080;">NSData</span></a><br>
&nbsp; &nbsp; let fromPeer <span style="color: #002200;">=</span> receivedDataDictionary<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"fromPeer"</span><span style="color: #002200;">]</span> as MCPeerID<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Convert the data (NSData) into a Dictionary object.</span><br>
&nbsp; &nbsp; let dataDictionary <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSKeyedUnarchiver_Class/"><span style="color: #400080;">NSKeyedUnarchiver</span></a>.unarchiveObjectWithData<span style="color: #002200;">(</span>data<span style="color: #002200;">!</span><span style="color: #002200;">)</span> as Dictionary&lt;String, String&gt;<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if there's an entry with the "message" key.</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let message <span style="color: #002200;">=</span> dataDictionary<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">]</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Make sure that the message is other than "_end_chat_".</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> message <span style="color: #002200;">!=</span> <span style="color: #bf1d1a;">"_end_chat_"</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Create a new dictionary and set the sender and the received message to it.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var messageDictionary<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>String<span style="color: #002200;">:</span> String<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"sender"</span><span style="color: #002200;">:</span> fromPeer.displayName, <span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">:</span> message<span style="color: #002200;">]</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Add this dictionary to the messagesArray array.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; messagesArray.append<span style="color: #002200;">(</span>messageDictionary<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Reload the tableview data and scroll to the bottom using the main thread.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a>.mainQueue<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.addOperationWithBlock<span style="color: #002200;">(</span><span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.updateTableview<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>We are ready. Now when a new message arrives, the app will handle it by displaying it to the tableview.</p>
<h2>End Chatting</h2>
<p>Few things remain to be done until the application is ready to function. One of them is to make it capable of ending a chat, either when one of the peers wants so, or when the session is not in the Connected state any more.</p>
<p>In the <em>Chat View Controller</em> scene, there is a bar button item in the toolbar at the top side, which calls the <em>endChat(sender:)</em> action method when is tapped. We’ll use this action method to send one last message to the other peer telling that the chat is over, and then we’ll dismiss the view controller. This message of course, is the “_end_chat” phrase we said about in the previous part.</p>
<p>Let’s see the implementation now:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func endChat<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let messageDictionary<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>String<span style="color: #002200;">:</span> String<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"_end_chat_"</span><span style="color: #002200;">]</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> appDelegate.mpcManager.sendData<span style="color: #002200;">(</span>dictionaryWithData<span style="color: #002200;">:</span> messageDictionary, toPeer<span style="color: #002200;">:</span> appDelegate.mpcManager.session.connectedPeers<span style="color: #002200;">[</span><span style="color: #2400d9;">0</span><span style="color: #002200;">]</span> as MCPeerID<span style="color: #002200;">)</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; self.dismissViewControllerAnimated<span style="color: #002200;">(</span><span style="color: #a61390;">true</span>, completion<span style="color: #002200;">:</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.appDelegate.mpcManager.session.disconnect<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>As you see, we dismiss the view controller and then we disconnect the peer from the session using the <em>disconnect()</em> method of the <em>MCSession</em> class. The above implementation gives enough time to the session so as to stay alive until the last message has been sent.</p>
<p>In the last part we implemented partially the <em>handleMPCReceivedDataWithNotification(notification:)</em> custom method. I’m saying partially, because we didn’t add any code at all in the case where the end chat message is received. Now it’s time to add it, and before we do so I’m just mentioning that we are going to display an alert controller to the user notifying him that the other peer ended the chat. After that, we’ll disconnect from the session and we’ll dismiss the view controller. Here’s the missing part of that method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func handleMPCReceivedDataWithNotification<span style="color: #002200;">(</span>notification<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNotification_Class/"><span style="color: #400080;">NSNotification</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Check if there's an entry with the "message" key.</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let message <span style="color: #002200;">=</span> dataDictionary<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"message"</span><span style="color: #002200;">]</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// In this case an "_end_chat_" message was received.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Show an alert view to the user.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let alert <span style="color: #002200;">=</span> UIAlertController<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">""</span>, message<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"<span style="color: #2400d9;">\(</span>fromPeer.displayName) ended this chat."</span>, preferredStyle<span style="color: #002200;">:</span> UIAlertControllerStyle.Alert<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let doneAction<span style="color: #002200;">:</span> UIAlertAction <span style="color: #002200;">=</span> UIAlertAction<span style="color: #002200;">(</span>title<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"Okay"</span>, style<span style="color: #002200;">:</span> UIAlertActionStyle.Default<span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span>alertAction<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.appDelegate.mpcManager.session.disconnect<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.dismissViewControllerAnimated<span style="color: #002200;">(</span><span style="color: #a61390;">true</span>, completion<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert.addAction<span style="color: #002200;">(</span>doneAction<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSOperationQueue_Class/"><span style="color: #400080;">NSOperationQueue</span></a>.mainQueue<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.addOperationWithBlock<span style="color: #002200;">(</span><span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.presentViewController<span style="color: #002200;">(</span>alert, animated<span style="color: #002200;">:</span> <span style="color: #a61390;">true</span>, completion<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><span style="color: #002200;">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>A chat can also be ended when the other peer just terminates the application, or for some reason the connection between the two devices is lost. That’s a case we must take care of also. What must be done is to post a new notification from the <em>browser(browser:lostPeer:)</em> delegate method in the <em>MPCManager.swift</em> file. Then, we must observe for it and handle it, exactly as we did in the previous notification. However, this time I’m not going to show you that implementation. To make things more interesting, I let you do that all alone as an exercise. I said what must be done, so go ahead and try it out if you want.</p>
<p>So, we’re almost there. One small addition and we’ll be ready to test everything.</p>
<h2>Finishing Touches</h2>
<p>We are just a step away from testing the app, but still there is something missing. That is to define some delegate methods of the <em>MCSessionDelegate</em> protocol in the <em>MPCManager</em> class that we don’t actually need, but they must be there. By doing so, any error Xcode might still showing will disappear too.</p>
<p>Without any further delay open the <em>MCPManager.swift</em> file and just paste the next methods:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func session<span style="color: #002200;">(</span>session<span style="color: #002200;">:</span> MCSession<span style="color: #002200;">!</span>, didStartReceivingResourceWithName resourceName<span style="color: #002200;">:</span> String<span style="color: #002200;">!</span>, fromPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span>, withProgress progress<span style="color: #002200;">:</span> NSProgress<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">}</span><br>
<br>
func session<span style="color: #002200;">(</span>session<span style="color: #002200;">:</span> MCSession<span style="color: #002200;">!</span>, didFinishReceivingResourceWithName resourceName<span style="color: #002200;">:</span> String<span style="color: #002200;">!</span>, fromPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span>, atURL localURL<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURL_Class/"><span style="color: #400080;">NSURL</span></a><span style="color: #002200;">!</span>, withError error<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/"><span style="color: #400080;">NSError</span></a><span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">}</span><br>
<br>
func session<span style="color: #002200;">(</span>session<span style="color: #002200;">:</span> MCSession<span style="color: #002200;">!</span>, didReceiveStream stream<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSInputStream_Class/"><span style="color: #400080;">NSInputStream</span></a><span style="color: #002200;">!</span>, withName streamName<span style="color: #002200;">:</span> String<span style="color: #002200;">!</span>, fromPeer peerID<span style="color: #002200;">:</span> MCPeerID<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span> <span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<h2>Testing the App</h2>
<p>You can run the demo application either in two devices (at least), or in a device and the Simulator. Then start playing with the browser and the advertiser, by turning on and off the advertising functionality of the app. Then select another peer and tap on its name to begin chatting. Send and receive some messages, and then end the conversation. Once you get finish testing, change any part of the code you want and add extra functionalities.</p>
<p>Right next I’m giving you a few screenshots of mine. Note that I ran the app in iPhone and the Simulator.</p>
<p><em>Having discovered a nearby peer:</em></p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_1_list_peers.png" alt="t27_1_list_peers" class="aligncenter size-full wp-image-4689" style="width:NaN%;"></div>
<p><em>Turning off the advertiser:</em></p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_6_turn_off_advertiser.png" alt="t27_6_turn_off_advertiser" class="aligncenter size-full wp-image-4694" style="width:NaN%;"></div>
<p><em>Asking the user to chat:</em></p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_2_ask_chat_alert.png" alt="t27_2_ask_chat_alert" class="aligncenter size-full wp-image-4690" style="width:NaN%;"></div>
<p><em>Chatting:</em></p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_3_chatting.png" alt="t27_3_chatting" class="aligncenter size-full wp-image-4691" style="width:NaN%;"></div>
<p><em>End of chat:</em></p>
<div class="figure"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/t27_7_end_of_chat.png" alt="t27_7_end_of_chat" class="aligncenter size-full wp-image-4695" style="width:NaN%;"></div>
<h2>Summary</h2>
<p>One more tutorial about the multipeer connectivity came to the end, hoping that all the implementation and coding we did in the previous parts to have been proven useful. What I presented you today is just a sample of how you can use MPC, and there are a few rules you have to follow. Regarding anything else, it’s up to you to decide about the MPC’s flow, or when and how you should perform all the various tasks and actions (i.e. when to send an invitation). Obviously there are aspects of the framework that we didn’t touch at all, and some that we worked partially with. The demo application we implemented has still tons of stuff missing so it starts looking like a normal one, but to me it was just perfect so as to make my point. As a final word, I hope that this tutorial will work as a quick how-to for many of you, if not all, and furthermore it will guide you towards the direction that you should look for more information and resources. The multipeer connectivity framework can give birth to countless new app ideas, so don’t lose any more time! Start thinking now!</p>
<p>For your reference, you can <a href="https://www.dropbox.com/s/sdi6h5xosssbkei/MPCRevisited.zip?dl=0">download the final project here</a>.</p>

<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:none;margin:20px 0 20px 0;text-align:center;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_336_280_Ad */
google_ad_slot = "4009415334";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/show_ads.js">
</script><ins id="aswift_2_expand" style="display:inline-table;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:336px;background-color:transparent"><ins id="aswift_2_anchor" style="display:block;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:336px;background-color:transparent"><iframe width="336" height="280" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;"></iframe></ins></ins>
</div>

<div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div><h3>You May Like These:</h3><div style="clear: both"></div><div style="border: 0pt none ; margin: 0pt; padding: 0pt;"><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/ios-maze-game-programming-tutorial-collision-detection/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/05/Maze-Game-Part-3-Tutorial-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Developing a Simple Maze Game Part 3 - Collision Detection</div></div></a><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/ios-programming-save-data-parse-cloud-tutorial/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/08/Parse-Backend-Tutorial-2-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Adding a Cloud Backend for Your iOS App Using Parse - Part 2</div></div></a><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/self-sizing-cells/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2014/09/self-sizing-cell-featured-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Understanding Self Sizing Cells and Dynamic Type in iOS 8</div></div></a><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/cloudkit-introduction-tutorial/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2015/04/cloudkit-featured-150x150.png) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Working with CloudKit in iOS 8</div></div></a></div><div style="clear: both"></div><span class="et_social_bottom_trigger"></span><!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="http://www.appcoda.com/chat-app-swift-tutorial/"
    dc:identifier="http://www.appcoda.com/chat-app-swift-tutorial/"
    dc:title="Building a Chat App in Swift Using Multipeer Connectivity Framework"
    trackback:ping="http://www.appcoda.com/chat-app-swift-tutorial/trackback/" />
</rdf:RDF>-->
</div><div class="post-meta"><span class="categories">Filed Under: <a href="http://www.appcoda.com/course/" rel="category tag">Course</a>, <a href="http://www.appcoda.com/course/intermediate/" rel="category tag">Intermediate</a>, <a href="http://www.appcoda.com/swift-2/" rel="category tag">Swift</a>, <a href="http://www.appcoda.com/tutorials/" rel="category tag">Tutorials</a></span> <span class="tags">Tagged With: <a href="http://www.appcoda.com/tag/ios-programming/" rel="tag">iOS Programming</a>, <a href="http://www.appcoda.com/tag/multipeer-connectivity-framework/" rel="tag">multipeer connectivity framework</a>, <a href="http://www.appcoda.com/tag/swift/" rel="tag">swift</a>, <a href="http://www.appcoda.com/tag/xcode-6/" rel="tag">Xcode 6</a></span></div><div class="after-post widget-area"><div id="text-8" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Free Chapters of Our Swift Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignright size-medium wp-image-4153" style="width:26.31578947368421%;"></a>If you want to create an app but don't know where to begin, this book covers the whole aspect of Swift programming and iOS 8 development and shows you every step from an idea to a real app on App Store. This book features a lot of hands-on exercises and projects. You will first create a simple app, then prototype an app idea, and later add some features to it in each chapter, until a real app is built. Want to learn more? <a href="http://www.appcoda.com/swift/">Check it out here and get three free chapters.</a>
<p></p>
<br></div>
		</div></div>
<div id="featured-page-2" class="widget featured-content featuredpage"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for our Free Tutorials</h4>
<div class="post-38 page type-page status-publish has-post-thumbnail hentry entry"><ul>
<li>Learn iOS Programming From Scratch</li>
<li>Step by Step Guide to Build Your First iPhone App</li>
<li>Complete Source Code for Your Reference</li>
<li>More Programming Tips and Tutorials to Come</li>
</ul>
<div class="enews">
<h4 class="widgettitle">Whatcha waiting for?</h4>
<form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" placeholder="Enter your email address" required=""><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button"><br>
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"><br>
</form>
</div>
</div></div></div>
</div></div><div class="author-box"><div><img alt="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/582c964c3dafd700a4df627225d859fe" srcset="http://2.gravatar.com/avatar/582c964c3dafd700a4df627225d859fe?s=140&amp;d=mm&amp;r=g 2x" class="avatar avatar-70 photo" height="70" width="70"> <strong>About Gabriel Theodoropoulos</strong><br><p>Gabriel has been a software developer for about two decades. He has long experience in developing software solutions for various platforms in many programming languages. Since middle-2010 he has been developing almost exclusively for iOS. Tutorials consist of the best way to share knowledge with people all over the world. Follow Gabriel at <a href="http://plus.google.com/+gabrieltheodoropoulos">Google+</a> and <a href="https://twitter.com/gabtheodor">Twitter</a>.</p>
</div></div>
<div id="disqus_thread"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="about:blank" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 0px !important;"></iframe></div>

<script type="text/javascript">
var disqus_url = 'http://www.appcoda.com/chat-app-swift-tutorial/';
var disqus_identifier = '4685 http://www.appcoda.com/?p=4685';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'appcoda';
var disqus_title = "Building a Chat App in Swift Using Multipeer Connectivity Framework";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=4685';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

</div><div id="sidebar" class="sidebar widget-area"><div id="search-4" class="widget widget_search"><div class="widget-wrap"><form role="search" method="get" id="searchform" class="searchform" action="http://www.appcoda.com/">
                    <div><label class="screen-reader-text" for="s">Search for:</label>
                    <input type="text" value="" name="s" id="s">
                    <input type="submit" id="searchsubmit" value="Search">
                    </div>
                    </form></div></div>
<div id="text-2" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for Our Free Tutorials</h4>
			<div class="textwidget"><div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" placeholder="Enter your email address" required=""><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw">
</form>
</div></div>
		</div></div>
<div id="text-6" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><!-- BuySellAds Zone Code -->
<div id="bsap_1283996" class="bsap bsap_1283996" data-serve="CYAD42T"></div>
<!-- End BuySellAds Zone Code --></div>
		</div></div>
<div id="text-4" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><div class="fb-like-box" data-href="http://www.facebook.com/appcodamobile" data-width="300" data-height="260" data-show-faces="true" data-border-color="#F1F1F1" data-stream="false" data-header="false"></div></div>
		</div></div>
		<div id="recent-posts-3" class="widget widget_recent_entries"><div class="widget-wrap">		<h4 class="widget-title widgettitle">Recent Posts</h4>
		<ul>
					<li>
				<a href="http://www.appcoda.com/react-native-introduction/">Introduction to React Native: Building iOS Apps with JavaScript</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/cloudkit-introduction-tutorial/">Working with CloudKit in iOS 8</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/instagram-app-parse-swift/">Building an Instagram-Like App with Parse and Swift</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/google-maps-api-tutorial/">A Swift Tutorial for Google Maps SDK</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/ios8-share-extension-swift/">Building a Simple Share Extension in iOS 8 App</a>
						</li>
				</ul>
		</div></div>
<div id="wp_insert_ad_widget-3" class="widget widget_wp_insert_ad_widget"><div class="widget-wrap"><div class="wpInsert wpInsertAdWidget" style="margin: 5px; padding: 0px;"><script async="" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/adsbygoogle.js"></script>
<!-- Premium Large Skyscraper -->
<ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-8501671653071605" data-ad-slot="6120307730" data-adsbygoogle-status="done"><ins id="aswift_3_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_3_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></div></div>
<div id="nav_menu-3" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar" class="menu"><li id="menu-item-57" class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li id="menu-item-58" class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li id="menu-item-59" class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li id="menu-item-68" class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
</div></div></div></div><div id="footer-widgets" class="footer-widgets"><div class="wrap"><div class="footer-widgets-1 widget-area"><div id="nav_menu-4" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">About AppCoda</h4>
<div class="menu-default-container"><ul id="menu-default-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div><div class="footer-widgets-2 widget-area"><div id="text-9" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Our New Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignleft size-medium wp-image-4153"></a></div>
		</div></div>
</div><div class="footer-widgets-3 widget-area"><div id="nav_menu-5" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar-1" class="menu"><li class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
<div id="text-3" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Email Newsletter</h4>
			<div class="textwidget"><p>Sign up to receive free tutorial and
to hear what's going on with AppCoda!</p>
<div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" placeholder="Enter your email address" required=""><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw">
</form>
</div></div>
		</div></div>
</div></div></div><div id="footer" class="footer"><div class="wrap">    <p>© Copyright 2015 <a href="http://appcoda.com/">AppCoda</a> · All Rights Reserved · Powered by <a href="http://wordpress.org/">WordPress · </a><a href="http://www.appcoda.com/privacy-policy">Privacy Policy</a> · <a href="http://www.appcoda.com/terms-of-service/">Terms of Service</a></p>
    </div></div></div><!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
<script src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/prism.js"></script>        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'appcoda';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); 
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
                    <!-- Version: 0.3.3 -->
            <script type="text/javascript">
                var EjSocialSlideoutJsApi_Settings =
                {
                    SliderImage: "<img width=\"150\" height=\"150\" src=\"http:\/\/www.appcoda.com\/wp-content\/uploads\/2015\/04\/appcoda-300-150x150.png\" class=\"attachment-thumbnail\" alt=\"appcoda-300\" \/>",
                    SocialProfiles: {"Facebook":{"Name":"Facebook","NetworkId":"Facebook","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Facebook","Description":"And get free tutorial updates"},"Twitter":{"Name":"Twitter","NetworkId":"Twitter","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Twitter","Description":"And get free tutorial updates"}},
                    Preview: false
                                    };

                if (typeof (EjSocialSlideoutJsApi) !== "undefined")
                    EjSocialSlideoutJsApi.SettingsLoaded(EjSocialSlideoutJsApi_Settings);
            </script>
            <div id="ej-ss-slideout-dom-templates" style="display:none"><div id="ej-ss-slideout-dom-template-facebook"><div class="fb-follow" data-href="https://www.facebook.com/appcodamobile" data-width="210" data-colorscheme="light" data-layout="standard" data-show-faces="true"></div></div><div id="ej-ss-slideout-dom-template-twitter"><a href="https://twitter.com/appcodamobile" class="twitter-follow-button" data-show-count="true" data-size="medium">Follow @appcodamobile</a></div></div><div class="et_social_sidebar_networks et_social_visible_sidebar et_social_slideright et_social_animated et_social_rectangle et_social_sidebar_flip et_social_sidebar_withcounts et_social_withtotalcount et_social_mobile_off" style="top: 189.5px;">
					<div class="et_social_totalcount et_social_dark">
							<span class="et_social_totalcount_count et_social_total_share" data-post_id="4685"><span class="et_social_placeholder"></span></span>
							<span class="et_social_totalcount_label">Shares</span>
						</div>
					<ul class="et_social_icons_container"><li class="et_social_facebook">
									<a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&t=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework" class="et_social_share et_social_display_count" rel="nofollow" data-social_name="facebook" data-post_id="4685" data-social_type="share" data-min_count="0">
										<i class="et_social_icon et_social_icon_facebook"></i>
										
										
										<span class="et_social_overlay"></span>
									<span class="et_social_placeholder"></span></a>
								</li><li class="et_social_twitter">
									<a href="http://twitter.com/share?text=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework&url=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&via=appcodamobile" class="et_social_share et_social_display_count" rel="nofollow" data-social_name="twitter" data-post_id="4685" data-social_type="share" data-min_count="0">
										<i class="et_social_icon et_social_icon_twitter"></i>
										
										
										<span class="et_social_overlay"></span>
									<span class="et_social_placeholder"></span></a>
								</li><li class="et_social_googleplus">
									<a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&t=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework" class="et_social_share et_social_display_count" rel="nofollow" data-social_name="googleplus" data-post_id="4685" data-social_type="share" data-min_count="0">
										<i class="et_social_icon et_social_icon_googleplus"></i>
										
										
										<span class="et_social_overlay"></span>
									<span class="et_social_placeholder"></span></a>
								</li><li class="et_social_linkedin">
									<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&title=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework" class="et_social_share et_social_display_count" rel="nofollow" data-social_name="linkedin" data-post_id="4685" data-social_type="share" data-min_count="0">
										<i class="et_social_icon et_social_icon_linkedin"></i>
										
										
										<span class="et_social_overlay"></span>
									<span class="et_social_placeholder"></span></a>
								</li></ul>
					<span class="et_social_hide_sidebar et_social_icon"></span>
				</div><div class="et_social_flyin et_social_resize et_social_flyin_bottom_right et_social_slideup et_social_trigger_bottom et_social_mobile_on">
					<a href="http://www.appcoda.com/chat-app-swift-tutorial/#" class="et_social_icon et_social_icon_cancel"></a>
					<div class="et_social_header">
						<h3>Share This</h3>
						<p>Share this post with your friends!</p>
					</div>
					<div class="et_social_networks et_social_2col et_social_slide et_social_rectangle et_social_left et_social_withnetworknames">
						
						<ul class="et_social_icons_container"><li class="et_social_facebook"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&t=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="4685" data-social_type="share"><i class="et_social_icon et_social_icon_facebook"></i><div class="et_social_network_label"><div class="et_social_networkname">Facebook</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_twitter"><a href="http://twitter.com/share?text=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework&url=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="4685" data-social_type="share"><i class="et_social_icon et_social_icon_twitter"></i><div class="et_social_network_label"><div class="et_social_networkname">Twitter</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_googleplus"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&t=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="4685" data-social_type="share"><i class="et_social_icon et_social_icon_googleplus"></i><div class="et_social_network_label"><div class="et_social_networkname">Google+</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_linkedin"><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.appcoda.com%2Fchat-app-swift-tutorial%2F&title=Building%20a%20Chat%20App%20in%20Swift%20Using%20Multipeer%20Connectivity%20Framework" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="4685" data-social_type="share"><i class="et_social_icon et_social_icon_linkedin"></i><div class="et_social_network_label"><div class="et_social_networkname">LinkedIn</div></div><span class="et_social_overlay"></span></a></li></ul>
					</div>
				</div><span></span><style type="text/css" class="fluid-images">img{max-width:100%;height:auto;}</style><div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_http" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/KTWTb9MY5lw.html" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/KTWTb9MY5lw(1).html" style="border: none;"></iframe></div></div></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><script type="text/javascript">
/* <![CDATA[ */
var mejsL10n = {"language":"en-US","strings":{"Close":"Close","Fullscreen":"Fullscreen","Download File":"Download File","Download Video":"Download Video","Play\/Pause":"Play\/Pause","Mute Toggle":"Mute Toggle","None":"None","Turn off Fullscreen":"Turn off Fullscreen","Go Fullscreen":"Go Fullscreen","Unmute":"Unmute","Mute":"Mute","Captions\/Subtitles":"Captions\/Subtitles"}};
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/"};
/* ]]> */
</script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/mediaelement-and-player.min.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/wp-mediaelement.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/jquery.form.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/www.appcoda.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ...","cached":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/scripts.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/idle-timer.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var monarchSettings = {"ajaxurl":"http:\/\/www.appcoda.com\/wp-admin\/admin-ajax.php","pageurl":"http:\/\/www.appcoda.com\/chat-app-swift-tutorial\/","stats_nonce":"3c279d6f27","share_counts":"41afbcf48b","follow_counts":"80583e3ade","total_counts":"861aff4fd8","media_single":"ed7cd3edd6","media_total":"e88d48f2ea","generate_all_window_nonce":"6da8221303","no_img_message":"No images available for sharing on this page"};
/* ]]> */
</script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/custom.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/superfish.min.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/superfish.args.min.js"></script>
<script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/superfish.compat.min.js"></script>
<!-- This site converts visitors into subscribers and customers with the OptinMonster WordPress plugin v2.1.6.6 - http://optinmonster.com/ -->
<div id="om-d7egu9k5k9-lightbox" class="optin-monster-overlay" style="display:none;"><script type="text/javascript" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/webfont.js"></script><style type="text/css" class="om-theme-case-study-styles">.optin-monster-success-message {font-size: 21px;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;color: #282828;font-weight: 300;text-align: center;margin: 0 auto;}.optin-monster-success-overlay .om-success-close {font-size: 32px !important;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif !important;color: #282828 !important;font-weight: 300 !important;position: absolute !important;top: 0px !important;right: 10px !important;background: none !important;text-decoration: none !important;width: auto !important;height: auto !important;display: block !important;line-height: 32px !important;padding: 0 !important;}.om-helper-field {display: none !important;visibility: hidden !important;opacity: 0 !important;height: 0 !important;line-height: 0 !important;}html div#om-d7egu9k5k9-lightbox * {box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;}html div#om-d7egu9k5k9-lightbox {background:none;border:0;border-radius:0;-webkit-border-radius:0;-moz-border-radius:0;float:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing: grayscale;height:auto;letter-spacing:normal;outline:none;position:static;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;margin:0;padding:0;line-height:1;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-shadow:none;-moz-box-shadow:none;-ms-box-shadow:none;-o-box-shadow:none;box-shadow:none;-webkit-appearance:none;}html div#om-d7egu9k5k9-lightbox {background: rgb(0, 0, 0);background: rgba(0, 0, 0, .7);font-family: helvetica,arial,sans-serif;-moz-osx-font-smoothing: grayscale;-webkit-font-smoothing: antialiased;line-height: 1;width: 100%;height: 100%;}html div#om-d7egu9k5k9-lightbox .om-clearfix {clear: both;}html div#om-d7egu9k5k9-lightbox .om-clearfix:after {clear: both;content: ".";display: block;height: 0;line-height: 0;overflow: auto;visibility: hidden;zoom: 1;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin {background: #fff;display: none;position: absolute;top: 50%;left: 50%;min-height: 175px;max-width: 700px;width: 100%;z-index: 734626274;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-wrap {position: relative;height: 100%;}html div#om-d7egu9k5k9-lightbox .om-close {position: absolute;top: -12px;right: -12px;text-decoration: none !important;display: block;width: 35px;height: 35px;background: url("http://www.appcoda.com/wp-content/plugins/optin-monster/assets/css/images/close.png") no-repeat scroll 0 0;z-index: 1500;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-bar {margin-bottom: 20px;clear: both;}html div#om-d7egu9k5k9-lightbox .om-bar {float: left;width: 25%;height: 11px;display: block;}html div#om-d7egu9k5k9-lightbox .om-red-bar {background-color: #ef3e36;}html div#om-d7egu9k5k9-lightbox .om-green-bar {background-color: #abb92e;}html div#om-d7egu9k5k9-lightbox .om-orange-bar {background-color: #f57826;}html div#om-d7egu9k5k9-lightbox .om-blue-bar {background-color: #17b4e9;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-header {min-height: 30px;padding: 15px;width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-title {font-size: 24px;color: #484848;width: 100%;margin-bottom: 15px;text-shadow: 0 1px #fff;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-tagline {font-size: 16px;line-height: 1.25;color: #484848;width: 100%;margin-bottom: 30px;text-shadow: 0 1px #fff;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-content {padding: 15px;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left {float: left;max-width: 280px;width: 100%;position: relative;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-image-container {position: relative;max-width: 280px;max-height: 245px;margin: 0 auto;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-image-container img {display: block;margin: 0 auto;text-align: center;height: auto;max-width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-right {float: right;max-width: 370px;width: 100%;background-color: #dadada;margin-right: -15px;padding: 20px;position: relative;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-arrow {position: absolute;width: 49px;height: 56px;left: -40px;top: -40px;}html div#om-d7egu9k5k9-lightbox label {color: #333;}html div#om-d7egu9k5k9-lightbox input,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email {background-color: #fff;width: 100%;border: 1px solid #ccc;font-size: 16px;line-height: 24px;padding: 10px 6px;overflow: hidden;outline: none;margin: 0 0 15px;vertical-align: middle;height: 46px;}html div#om-d7egu9k5k9-lightbox input[type=submit],html div#om-d7egu9k5k9-lightbox button,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-submit {background: #484848;border: 1px solid #484848;width: 100%;color: #fff;font-size: 20px;padding: 12px 6px;line-height: 28px;text-align: center;vertical-align: middle;cursor: pointer;margin: 0;height: 54px;}html div#om-d7egu9k5k9-lightbox input[type=checkbox],html div#om-d7egu9k5k9-lightbox input[type=radio] {-webkit-appearance: checkbox;width: auto;outline: invert none medium;padding: 0;margin: 0;}@media (max-width: 700px) {html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin[style] {width: 100%;position: relative;}html div#om-d7egu9k5k9-lightbox .om-close {right: 9px;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-right,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-submit,html div#om-d7egu9k5k9-lightbox .om-has-email #om-lightbox-case-study-optin-email {float: none;width: 100%;max-width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email {margin-bottom: 15px;}}@media only screen and (-webkit-min-device-pixel-ratio: 2),only screen and (min--moz-device-pixel-ratio: 2),only screen and (-o-min-device-pixel-ratio: 2/1),only screen and (min-device-pixel-ratio: 2),only screen and (min-resolution: 192dpi),only screen and (min-resolution: 2dppx) {html div#om-d7egu9k5k9-lightbox .om-close {background-image: url("http://www.appcoda.com/wp-content/plugins/optin-monster/assets/css/images/<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="f89b94978b9db8ca80d688969f">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>");background-size: 35px 35px;}}</style><div id="om-lightbox-case-study-optin" class="om-lightbox-case-study om-clearfix om-theme-case-study om-custom-html-form"><div id="om-lightbox-case-study-optin-wrap" class="om-clearfix"><a href="http://www.appcoda.com/chat-app-swift-tutorial/#" class="om-close" title="Close"></a><div id="om-lightbox-case-study-optin-bar" class="om-clearfix"><span class="om-bar om-red-bar"></span><span class="om-bar om-green-bar"></span><span class="om-bar om-orange-bar"></span><span class="om-bar om-blue-bar"></span></div><div id="om-lightbox-case-study-header" class="om-clearfix"><div id="om-lightbox-case-study-optin-title" data-om-action="editable" data-om-field="title" style="color:#484848;font-family:Bree Serif;font-size:32px;text-align:center;"><span style="font-family:montserrat;">FREE Swift Programming Course</span></div><div id="om-lightbox-case-study-optin-tagline" data-om-action="editable" data-om-field="tagline" style="color:#484848;font-family:Open Sans;font-size:24px;text-align:center;"><span style="font-family:montserrat;">Sign up today and get a 7 day email course with free tips and ebook chapters for starting app development.</span></div></div><div id="om-lightbox-case-study-content" class="om-clearfix"><div id="om-lightbox-case-study-left"><div id="om-lightbox-case-study-optin-image-container" class="om-image-container om-clearfix"><img class="optin-monster-image optin-monster-image-lightbox-case-study" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/swift-free-course-280x245.jpg" alt="" title="swift-free-course"></div></div><div id="om-lightbox-case-study-right"><img id="om-lightbox-case-study-arrow" src="./Building a Chat App in Swift Using Multipeer Connectivity Framework_files/arrow.png" alt="Arrow"><form action="http://sendy.appcoda.com/sendy/subscribe" method="POST" accept-charset="utf-8">
<input id="om-lightbox-case-study-optin-name" type="text" name="name" value="" data-om-action="selectable" data-om-target="#optin-monster-field-name_field" placeholder="Enter your name here..." style="color:#484848;font-family:Montserrat;">
<input id="om-lightbox-case-study-optin-email" type="email" name="email" value="" data-om-action="selectable" data-om-target="#optin-monster-field-email_field" placeholder="Enter your email address here..." style="color:#484848;font-family:Montserrat;">
<input id="om-lightbox-case-study-optin-submit" type="submit" data-om-action="selectable" data-om-target="#optin-monster-field-submit_field" value="Send me the course" style="color:#ffffff;background-color:#484848;border-color:#484848;font-family:Montserrat;">
<input type="hidden" name="list" value="neAW97jagVmb3C3O892VnnLA">
</form></div></div></div><input type="email" name="email" value="" class="om-helper-field"><input type="text" name="website" value="" class="om-helper-field"></div><script type="text/javascript">jQuery(document).ready(function($){WebFont.load({google: {families: ['Montserrat%7CBree+Serif%7COpen+Sans']}});});</script></div>
<script type="text/javascript">var d7egu9k5k9_lightbox, omo = {"id":4744,"optin":"d7egu9k5k9-lightbox","campaign":"Free Swift Programming Course","clones":[""],"hash":"d7egu9k5k9-lightbox","optin_js":"d7egu9k5k9_lightbox","type":"lightbox","theme":"case-study","cookie":30,"delay":5000,"second":0,"exit":1,"redirect":"","redirect_pass":false,"custom":true,"test":false,"global_cookie":23320,"preview":false,"ajax":"http:\/\/www.appcoda.com\/?optin-monster-ajax-route=1","mobile":false,"post_id":4685,"preloader":"http:\/\/www.appcoda.com\/wp-content\/plugins\/optin-monster\/assets\/css\/images\/preloader.gif","error":"There was an error with your submission. Please try again.","ajax_error":"There was an error with the AJAX request: ","name_error":"Please enter a valid name.","email_error":"Please enter a valid email address.","bot_error":"Honeypot fields have been activated. Your submission is being flagged as potential spam.","success":"Thanks for subscribing! Please check your email for further instructions.","exit_sensitivity":20}; d7egu9k5k9_lightbox = new OptinMonster(); d7egu9k5k9_lightbox.init(omo);</script>
<!--[if lte IE 9]><script type="text/javascript">var om_ie_browser = true;</script><![endif]--><!-- / OptinMonster WordPress plugin. -->



<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: www.appcoda.com @ 2015-05-04 12:37:26 by W3 Total Cache --></body></html>