<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0051)http://www.appcoda.com/text-to-speech-ios-tutorial/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" class="wf-montserrat7cbreeserif7copensans-n4-inactive wf-inactive"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Building a Text to Speech App Using AVSpeechSynthesizer</title><link href="http://www.appcoda.com/prismjs/prism.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- This site is optimized with the Yoast WordPress SEO plugin v2.1.1 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="This Swift programming tutorial will show you how to build a text-to-speech app using AVSpeechSynthesizer in iOS.">
<link rel="canonical" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/Building a Text to Speech App Using AVSpeechSynthesizer.html">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="This Swift programming tutorial will show you how to build a text-to-speech app using AVSpeechSynthesizer in iOS.">
<meta name="twitter:title" content="Building a Text to Speech App Using AVSpeechSynthesizer">
<meta name="twitter:site" content="@appcodamobile">
<meta name="twitter:domain" content="AppCoda">
<meta name="twitter:image:src" content="http://www.appcoda.com/wp-content/uploads/2015/02/text-to-speech-app.jpg">
<meta name="twitter:creator" content="@appcodamobile">
<script id="facebook-jssdk" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/all.js"></script><script async="" type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/ca-pub-8501671653071605.js"></script><script type="text/javascript" async="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/ga.js"></script><script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","url":"http:\/\/www.appcoda.com\/","name":"AppCoda"}</script>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="AppCoda » Feed" href="http://feeds.feedburner.com/appcoda">
<link rel="alternate" type="application/rss+xml" title="AppCoda » Comments Feed" href="http://www.appcoda.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="AppCoda » Building a Text to Speech App Using AVSpeechSynthesizer Comments Feed" href="http://www.appcoda.com/text-to-speech-ios-tutorial/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.appcoda.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.1"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f;c.supports={simple:d("simple"),flag:d("flag")},c.supports.simple&&c.supports.flag||(f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/wp-emoji-release.min.js" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="mediaelement-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/mediaelementplayer.min.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/wp-mediaelement.css" type="text/css" media="all">
<link rel="stylesheet" id="eleven40-theme-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/styles.css" type="text/css" media="all">
<link rel="stylesheet" id="ej-socialslideout-content-style-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/slideout.css" type="text/css" media="all">
<link rel="stylesheet" id="et_monarch-open-sans-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/css" type="text/css" media="all">
<link rel="stylesheet" id="et_monarch-css-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/style(1).css" type="text/css" media="all">
<link rel="stylesheet" id="codecolorer-css" href="./Building a Text to Speech App Using AVSpeechSynthesizer_files/codecolorer.css" type="text/css" media="screen">
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/jquery.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/fluidimage.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/slideout.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/api.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/iframeResizer.min.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/iframeResizer.contentWindow.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.appcoda.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.appcoda.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.2.1">
<link rel="shortlink" href="http://www.appcoda.com/?p=4837">
<style type="text/css" id="et-social-custom-css">
				 
			</style><link rel="Shortcut Icon" href="http://www.appcoda.com/wp-content/themes/eleven40/images/favicon.ico" type="image/x-icon">
<link rel="pingback" href="http://www.appcoda.com/xmlrpc.php">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-223304-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script><script type="text/javascript" async="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/embed.js"></script><script type="text/javascript" async="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/bsa.js"></script><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Montserrat%7CBree+Serif%7COpen+Sans"><script async="" type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/count.js"></script><script type="text/javascript" id="_bsap_js_459a84cf8fa0d5ea9dccfcfd1c3531e0" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/s_459a84cf8fa0d5ea9dccfcfd1c3531e0.js" async="async"></script><script async="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/count-data.js"></script></head>
<body class="single single-post postid-4837 single-format-standard et_monarch header-image content-sidebar"><div id="wrap"><div id="header"><div class="wrap"><div id="title-area"><p id="title"><a href="http://www.appcoda.com/">AppCoda</a></p><p id="description">Your iOS Programming Community</p></div><div class="widget-area header-widget-area"><div id="nav_menu-2" class="widget widget_nav_menu"><div class="widget-wrap"><div class="menu-default-container"><ul id="menu-default" class="menu genesis-nav-menu js-superfish sf-js-enabled sf-arrows"><li id="menu-item-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li id="menu-item-28" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li id="menu-item-530" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li id="menu-item-3045" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li id="menu-item-2140" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li id="menu-item-710" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div></div></div><div id="inner"><div class="wrap"><script async="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/adsbygoogle.js"></script>
<!-- Leaderboard Responsive Ad -->
<ins class="adsbygoogle" style="display: block; height: 90px;" data-ad-client="ca-pub-8501671653071605" data-ad-slot="1756840139" data-ad-format="auto" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:1140px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:1140px;background-color:transparent"><iframe width="1140" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="content-sidebar-wrap"><div id="content" class="hfeed"><div class="post-4837 post type-post status-publish format-standard hentry category-course category-intermediate category-swift-2 category-tutorials tag-avspeechsynthesizer tag-ios-8 tag-ios-programming tag-swift tag-text-to-speech entry"><h1 class="entry-title">Building a Text to Speech App Using AVSpeechSynthesizer</h1> 
<div class="post-info"><span class="date published time" title="2015-02-17T00:32:54+00:00">February 17, 2015</span>  by <span class="author vcard"><span class="fn"><a href="http://www.appcoda.com/author/gabrielth/" rel="author">Gabriel Theodoropoulos</a></span></span> <span class="post-comments"><a href="http://www.appcoda.com/text-to-speech-ios-tutorial/#disqus_thread" data-disqus-identifier="4837 http://www.appcoda.com/?p=4837"><span class="dsq-postid" data-dsqidentifier="4837 http://www.appcoda.com/?p=4837">5 Comments</span></a></span> </div><div class="entry-content">
<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:right;margin:10px 0 10px 10px;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_300x250_iPhone_Development */
google_ad_slot = "8132041053";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/show_ads.js">
</script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left: 0px; position: absolute; top: 0px; border-radius: 2px; border: 1px solid rgba(0, 0, 0, 0); box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px;"></iframe></ins></ins>
</div>
<p>iOS is an operating system with many possibilities, allowing to create from really simple to super-advanced applications. There are times where applications have to be multi-featured, providing elegant solutions that exceed the limits of the common places, and lead to a superb user experience. Also, there are numerous technologies one could exploit, and in this tutorial we are going to focus on one of them, which is no other than the <strong>Text to Speech</strong>.</p>
<p>Text-to-speech (TTS) is not something new in iOS 8. Since iOS 7 dealing with TTS has been really easy, as the code required to make an app speak is straightforward and easy to be handled. To make things more precise, iOS 7 introduced a new class named <strong>AVSpeechSynthesizer</strong>, and as you understand from its prefix it’s part of the powerful <em>AVFoundation</em> framework. The <em>AVSpeechSynthesizer</em> class, along with some other classes, can produce speech based on a given text (or multiple pieces of text), and provides the possibility to configure various properties regarding it.</p>
<div class="figure"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/text-to-speech-app.jpg" alt="text-to-speech-app" class="aligncenter size-full wp-image-4852" style="width:NaN%;"></div>
<p>The <em>AVSpeechSynthesizer</em> is the responsible class for carrying out the heavy work of converting text to speech. It’s capable of initiating, pausing, stopping and continuing a speech process. However, it doesn’t interact directly with the text. There’s an intermediate class that does that job, and is called <em>AVSpeechUtterance</em>. An object of this class represents a piece of text that should be spoken, and to put it really simply, an utterance is actually the text that’s about to be spoken, enriched with some properties regarding the final output. The most important of those properties that the <em>AVSpeechUtterance</em> class handles (besides the text) are the speech <em>rate</em>, <em>pitch</em> and <em>volume</em>. There are a few more, but we’ll see them in a while. Also, an utterance object defines the <em>voice</em> that will be used for speaking. A voice is an object of the <em>AVSpeechSynthesisVoice</em> class. It always matches to a specific language, and up to now Apple supports 37 different voices, meaning voices for 37 different locales (we’ll talk about that later).</p>
<p>Once an utterance object has been properly configured, it’s passed to a speech synthesizer object so the system starts producing the speech. To speak many pieces of text, meaning many utterances, doesn’t require any effort at all; all it takes is to set the utterances to the synthesizer in the order that should be spoken, and the synthesizer automatically queues them.</p>
<p><span id="more-4837"></span></p>
<p>Along with the <em><a href="https://developer.apple.com/library/prerelease/ios/documentation/AVFoundation/Reference/AVSpeechSynthesizer_Ref/index.html">AVSpeechSynthesizer</a></em> class comes the the <em>AVSpeechSynthesizerDelegate</em> protocol. It contains useful delegate methods that if they get used properly, they allow to keep track of the progress of the speech, and the currently spoken text too. Tracking the progress might be something that you won’t need in your apps, but if you will, then here you’ll see how you can achieve that. It’s a bit of a tricky process, but once you understand how everything works, all will become pretty clear.</p>
<p>If you want, feel free to take a look at the official documentation about all those classes. In my part, I stop this introductory discussion here, as there are a lot of things to do, but trust me, all of them are really interesting. As a final note, I need to say that all the testings of the demo app must be done in real device (iPhone). Unfortunately, text-to-speech doesn’t work in the Simulator, so plug your phones and let’s go.</p>
<h2>Demo App Overview</h2>
<p>We’ll begin our today exploration with an overview of the demo application (as we always do). The first thing I must say, is that we’re not going to build it from scratch. You can download a starter project from <a href="https://www.dropbox.com/s/l32ddae9jxbdn6d/SpeechDemoStart.zip?dl=0">this link</a>, which contains a minimum implementation, and of course, the interface already made in the Interface Builder. I would suggest to look around a bit before we continue, so you get familiarized with it and be able to move faster in the upcoming parts.</p>
<p>Let me describe now the app details. It is a navigation based application parted from two distinct view controllers. In the first one, there’s a textview where we’ll be adding the text that we want to be spoken. This textview occupies the most of the screen, and right below there are three buttons. The first button will be used to start the speech, while the other two are for pausing and stopping it. They won’t appear simultaneously; when the Speak button is visible the other two will be hidden, and the opposite. We’ll switch between them by implementing an easy animated effect. Additionally, right below the buttons exists a progress view. We’ll use it to show the progress of the speech during time.</p>
<p>The second view controller will be used to specify various settings regarding the speech. More specifically, through this view controller we’ll be able to change the values of the rate, pitch and volume properties, but furthermore we’ll be able to pick a different voice for the speech, other than the default one.</p>
<p>Through the implementation that follows in the next parts, you’ll find out that bringing text-to-speech to life is relatively easy. Once we get finished with the creation of all the TTS-related stuff, I’ll give you an extra section in this tutorial that will make the demo application much more alive and interactive. We’ll work with some text properties, and eventually we will make it capable of highlighting the currently spoken word by changing its foreground (text) color from black to orange. Even though what we’ll do there is not a part of the TTS process, I think it’s a pretty interesting topic to work with. It’s up to you to decide whether you’ll read it or not, as it consists of an extra content.</p>
<p>The following screenshots illustrate the two view controllers of the app, and an instance of it during the speech where the currently spoken word is highlighted. Take a first taste, and we will begin the real work.</p>
<p></p><center><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/t29_1_view_controller1.png" alt="text to speech demo" style="width:NaN%;"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/t29_2_view_controller2.png" alt="t29_2_view_controller2" style="width:NaN%;"></center><p></p>
<h2>Speaking Made Easy</h2>
<p>So, now you are aware of what the today project is about and you have downloaded the starter project, let’s begin implementing. This time we’ll go straight to the point, as we are about to make the currently empty demo application capable of speaking without any delay. As I said in the beginning, the main role when dealing with text to speech features has the <em>AVSpeechSynthesizer</em> class. This is the one that will perform the actual speech, however it doesn’t just work on its own. It is always used in conjunction with other classes as we’ll see next, because various configurations regarding the speech outcome do not apply directly to this one.</p>
<p>First things first, and begin by opening the <em>ViewController.swift</em> file in Xcode. There, we need to declare and initialize a class variable (a constant actually) of the aforementioned class. So, go to the top of the class where all the outlet properties are already declared, and somewhere there add the following line. It’s just one, but a really important one:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">let speechSynthesizer <span style="color: #002200;">=</span> AVSpeechSynthesizer<span style="color: #002200;">(</span><span style="color: #002200;">)</span></div></td></tr></tbody></table></div>
<p>That simple. Now, in order for the <em>speechSynthesizer</em> to “speak”, it’s needed to be provided it with some text to do that. However, we don’t just set a string value representing the text directly to that object as a property. Instead, we must make use of the <em>AVSpeechUtterance</em> class that I mentioned in the introduction. This, besides than accepting the text that should be spoken, it also contains properties that affect the final result. We’ll see about them in just a while. So, putting it all together, we are going to create an object of this class so as to set the text we want to be spoken, and finally to perform the actual speech using the object we declared right above.</p>
<p>An object of the <em>AVSpeechUtterance</em> class doesn’t have to be public like the last one; instead it can be locally declared, and that’s what we’ll do. Among the few implemented stuff existing in the starter project you’ve got in your hands, there’s an action method called <em>speak(_:)</em>. This method is just defined in the class and connected to the proper button in Interface Builder. Navigate there, as it’s time to make it speak for first time by adding the couple next lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let speechUtterance <span style="color: #002200;">=</span> AVSpeechUtterance<span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.text<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Obviously, upon the <em>speechUtterance</em> object initialization we specify the text that should be spoken. In this case we want our app to say everything existing in the textview, therefore we pass it the whole text of the textview. Next, we simply make a call to the <em>speakUtterance(_:)</em> method of the speech synthesizer object, and we’re telling the synthesizer to speak using the text we set in the utterance variable. As you’ll see next, this method also says to the synthesizer object to apply any settings or effects to the speech.</p>
<p>Now you can go ahead and run the application. Whatever you have written in the textview it will be spoken out loud from your device! Cool!</p>
<p>The voice that you’ll be hearing during the speech progress matches to the current <em>locale</em> settings of your device. By changing that, another voice matching to the new locale will be used to speak. You can find out that by modifying your current language settings if you’re curious enough. However, if you can sit back and wait for a while, you won’t really have to do that; we will add a feature later so we can pick a voice right through our demo app!</p>
<p>Now, let’s play around a bit with three properties regarding the actual speech: The <strong>rate</strong>, the <strong>pitchMultiplier</strong> and the <strong>volume</strong>. All these three properties have default values, and belong to the <em>AVSpeechUtterance</em> class. They also have maximum and minimum values. Right next you’re given with the maximum and minimum values they can get:</p>
<ol>
<li><em>Rate</em>: Its minimum value specified by the <em>AVSpeechUtteranceMinimumSpeechRate</em> constant (0.0), and the maximum by the <em>AVSpeechUtteranceMaximumSpeechRate</em> (1.0). Its default value is defined by the <em>AVSpeechUtteranceDefaultSpeechRate</em> constant.</li>
<li><em>pitchMultiplier</em>: The pitch multiplier acceptable values are between 0.5 and 2.0, where 1.0 is the default value.</li>
<li><em>volume</em>: It ranges from 0.0 to 1.0, and by default it’s set to 1.0.</li>
</ol>
<p>Time to use all these three properties to see how they can affect out spoken text. In the <em>speak(_:)</em> action method once again, add the next lines, but make sure to call the <em>speakUtterance(_:)</em> method as the last command. Note that you can set any value you desire in the following properties (within range of course); the following are just random values:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let speechUtterance <span style="color: #002200;">=</span> AVSpeechUtterance<span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.text<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; speechUtterance.rate <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.25</span><br>
&nbsp; &nbsp; speechUtterance.pitchMultiplier <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.25</span><br>
&nbsp; &nbsp; speechUtterance.volume <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.75</span><br>
<br>
&nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Run the app once again now, and listen to the new way the text is spoken. It’s really great that the default speech way is modified according to our preferences, and in order to achieve a perfect result in a real app, it’s necessary to play with the above values or give users the option to change them.</p>
<p>Making a quick sum-up at this point, you see that we wrote no more than five lines, but yet we managed to implement the basic feature of the application. Now that we have taken the first taste, we’ll keep adding new stuff and transforming the app to a more complex and advanced one.</p>
<h2>Handling Rate, Pitch and Volume</h2>
<p>As you can assume by running the application, applying various values to the rate, pitch and volume can result to interesting speech outcome. However, it’s quite annoying to terminate the app and re-run it every time you want to change any of them. It would be much more handy to be able to do so in the app, and if you remember, that’s one of our goals here. However, before we implement that functionality, we much find a more general way to work with these three values, and of course, we must figure out how we will save them permanently.</p>
<p>Let’s get started by declaring three new class variables. Each one of them will match to a value (rate, pitch, volume), and we’ll assign them to the speech utterance object properties, instead of using plain numbers. Let’s see:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var rate<span style="color: #002200;">:</span> Float<span style="color: #002200;">!</span><br>
<br>
var pitch<span style="color: #002200;">:</span> Float<span style="color: #002200;">!</span><br>
<br>
var volume<span style="color: #002200;">:</span> Float<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>Then, go back again in the <em>speak(_:)</em> method, and replace any number values with the above variables, similarly to what is shown next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let speechUtterance <span style="color: #002200;">=</span> AVSpeechUtterance<span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.text<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; speechUtterance.rate <span style="color: #002200;">=</span> rate<br>
&nbsp; &nbsp; speechUtterance.pitchMultiplier <span style="color: #002200;">=</span> pitch<br>
&nbsp; &nbsp; speechUtterance.volume <span style="color: #002200;">=</span> volume<br>
<br>
&nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Nice, this is a more general way, and the speech will be produced according to the values of the above variables.</p>
<p>There are several approaches to store permanently the above variables. The easiest one, and perfectly suitable for the demo application we are implementing, is to use the <em>user defaults (NSUserDefaults)</em>. Further than simply saving and loading from the user defaults dictionary, we will also <strong>register default</strong> values, meaning that we’ll set predefined values for the above three variables upon the first app run. Even though that sounds a bit unnecessary to do, you’ll understand later that it’s required, because we are going to load the existing stored values during the settings implementation. Let’s don’t run though, we’ll do everything in turn.</p>
<p>Let’s implement a couple of custom methods now. In the first one, we’ll register the user defaults as shown next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func registerDefaultSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; rate <span style="color: #002200;">=</span> AVSpeechUtteranceDefaultSpeechRate<br>
&nbsp; &nbsp; pitch <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>
&nbsp; &nbsp; volume <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>
<br>
&nbsp; &nbsp; let defaultSpeechSettings<span style="color: #002200;">:</span> Dictionary&lt;<a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/"><span style="color: #400080;">NSObject</span></a>, AnyObject&gt; <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"rate"</span><span style="color: #002200;">:</span> rate, <span style="color: #bf1d1a;">"pitch"</span><span style="color: #002200;">:</span> pitch, <span style="color: #bf1d1a;">"volume"</span><span style="color: #002200;">:</span> volume<span style="color: #002200;">]</span><br>
<br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.registerDefaults<span style="color: #002200;">(</span>defaultSpeechSettings<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>In the above segment we set some initial values to each variable, and then we add them to a dictionary. We save this dictionary to the user defaults file by calling the <em>registerDefaults(_:)</em> method, and with that we manage to have data from the beginning of the app.</p>
<p>In the second method we will load the data from the user defaults dictionary, and we’ll assign it to the proper variables. It’s easy enough:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func loadSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Bool <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let userDefaults <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span> as <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let theRate<span style="color: #002200;">:</span> Float <span style="color: #002200;">=</span> userDefaults.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"rate"</span><span style="color: #002200;">)</span> as? Float <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; rate <span style="color: #002200;">=</span> theRate<br>
&nbsp; &nbsp; &nbsp; &nbsp; pitch <span style="color: #002200;">=</span> userDefaults.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"pitch"</span><span style="color: #002200;">)</span> as Float<br>
&nbsp; &nbsp; &nbsp; &nbsp; volume <span style="color: #002200;">=</span> userDefaults.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"volume"</span><span style="color: #002200;">)</span> as Float<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">true</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #a61390;">false</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Two things to mention here: At first, notice that the method returns a Bool value; True when the data has been loaded and assigned to the variables successfully, and False when there’s no data at all. At second, we check if there is stored data in the user defaults simply by using an <em>if let</em> statement and asking for the rate value. If it exists, then they all exist (we’ll stick to that logic here, however in a real app you would be much more safe if you would check each value separately).</p>
<p>Now, let’s use the above methods, as simply defining them is not good enough. In the <em>viewDidLoad</em> method, we will try to load the data from the user defaults. If there’s no data, then we’ll register the default values:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>loadSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; registerDefaultSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Note here that we are not going to create any method at all to save altered values to the user defaults. This is something that will take place later in the settings view controller, where after having changed any value graphically we’ll store it so it gets reflected during the speech.</p>
<h2>Pausing and Stopping the Speech</h2>
<p>If you took a look in the storyboard of the starter project you downloaded, then you would have noticed that besides the Speak button there are two more: <em>Pause</em> and <em>Stop</em>. As you correctly assume, these two buttons will be used to pause and stop the speech process respectively, as a talking app would be useless if it only speaks, but it’s unable to stop doing that.</p>
<p>The pause and stop functionalities are not the same, as they have one important difference. When pausing, the speech can continue from the point it was left off. On the other hand, when stopping, the speech does not continue from the point it was stopped, but it starts over again.</p>
<p>In the <em>ViewController.swift</em> file you can find two other action methods, named <em>pauseSpeech(_:)</em> and <em>stopSpeech(_:)</em> respectively. Let’s go to add the missing code, starting from the pause method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func pauseSpeech<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; speechSynthesizer.pauseSpeakingAtBoundary<span style="color: #002200;">(</span>AVSpeechBoundary.Word<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Pausing the speech is literally a matter of a single line. By calling the <em>pauseSpeakingAtBoundary(_:)</em> method of the synthesizer object, we force the speech to pause. There’s one important element here, and that is the parameter value. This method wants to know whether it should pause immediately and then continue from the point it was left off, or it should pause after it has spoken the current word, and continue that way from the next word later. This kind of information is described from an <em>enum</em> value, named <em>AVSpeechBoundary</em>. This enum has two values:</p>
<ol>
<li><em>AVSpeechBoundaryImmediate</em>: Using this, the pause happens instantly.</li>
<li><em>AVSpeechBoundaryWord</em>: With this, the pause happens once the current word has been spoken.</li>
</ol>
<p>In the above code, I chose to set the second value, but you can change that if you want.</p>
<p>Similarly to the above implementation, the stop method is the following:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func stopSpeech<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; speechSynthesizer.stopSpeakingAtBoundary<span style="color: #002200;">(</span>AVSpeechBoundary.Immediate<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>This time we make use of another method of the synthesizer object, named <em>stopSpeakingAtBoundary(_:)</em>. This method makes the speech process stop, and the argument it accepts is the same as before; a speech boundary value. In contrary to the previous method, here I chose to stop immediately the speech process.</p>
<p>Go now and run the app. Tap on the Speak button to let it start speaking, and then try both the Pause and Stop buttons.</p>
<p>You don’t see the buttons? But of course! That’s reasonable to happen, as we didn’t perform any action at all to make them visible. The only button shown there is the Speak button.</p>
<p>Let’s fix that by implementing another custom method. In it, we’ll apply an easy animation for showing and hiding the buttons. I think it’s pointless to say that when the Pause and Stop buttons are visible, the Speak button must be hidden. Just before we see this method, let me underline that these two buttons are not actually hidden; their alpha value has been set to zero.</p>
<p>In the next code segment I give you the implementation of this new method, and we’ll discuss it right next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func animateActionButtonAppearance<span style="color: #002200;">(</span>shouldHideSpeakButton<span style="color: #002200;">:</span> Bool<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var speakButtonAlphaValue<span style="color: #002200;">:</span> CGFloat <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>
&nbsp; &nbsp; var pauseStopButtonsAlphaValue<span style="color: #002200;">:</span> CGFloat <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> shouldHideSpeakButton <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; speakButtonAlphaValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; pauseStopButtonsAlphaValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; UIView.animateWithDuration<span style="color: #002200;">(</span><span style="color: #2400d9;">0.25</span>, animations<span style="color: #002200;">:</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; self.btnSpeak.alpha <span style="color: #002200;">=</span> speakButtonAlphaValue<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; self.btnPause.alpha <span style="color: #002200;">=</span> pauseStopButtonsAlphaValue<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; self.btnStop.alpha <span style="color: #002200;">=</span> pauseStopButtonsAlphaValue<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>As you see in the first line, the method accepts a Bool argument telling whether the Speak button should be hidden or not. When it’s true, we’ll show the Speak button, and when it’s false, we’ll hide it and we’ll make the Pause and Stop buttons visible. In the method body we begin by specifying two float (CGFloat) variables representing the desired alpha value of the buttons. Note that if the Speak button must be hidden, we change the values of these variables. Then, using a simple UIView animation block we assign the final alpha value to each button. Note that the <em>pauseStopButtonsAlphaValue</em> variable describes the alpha state for both the Pause and Stop button.</p>
<p>The above method will result in a fade-in and fade-out effect. If you want, you can change the animation duration (0.25 seconds) to any value you want. Now that is ready, we can go an call it. That must take place in all the action methods of the buttons, and let’s begin by updating the most recent ones, those we saw in the beginning of this part. Right next you can see them containing the call to the above method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func pauseSpeech<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; speechSynthesizer.pauseSpeakingAtBoundary<span style="color: #002200;">(</span>AVSpeechBoundary.Word<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; animateActionButtonAppearance<span style="color: #002200;">(</span><span style="color: #a61390;">false</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span><br>
<br>
<br>
@IBAction func stopSpeech<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; speechSynthesizer.stopSpeakingAtBoundary<span style="color: #002200;">(</span>AVSpeechBoundary.Immediate<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; animateActionButtonAppearance<span style="color: #002200;">(</span><span style="color: #a61390;">false</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>In both of them we call the <em>animateActionButtonAppearance(_:)</em> method passing the <em>false</em> argument.</p>
<p>In the <em>speak(_:)</em> method things are a bit more complex, as further than simply calling the above method, we must also check if the synthesizer is currently speaking or not. That’s really important, because if it is speaking and gets paused, we must tell the synthesizer to simply continue when the Speak button gets tapped again. If it’s not speaking, then we must tell it to start doing so. To put it in other words, we must tell the synthesizer how to proceed after any of the Pause or Stop buttons has been tapped.</p>
<p>In the following code snippet you can see all the needed changes:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>speechSynthesizer.speaking <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let speechUtterance <span style="color: #002200;">=</span> AVSpeechUtterance<span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.text<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.rate <span style="color: #002200;">=</span> rate<br>
&nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.pitchMultiplier <span style="color: #002200;">=</span> pitch<br>
&nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.volume <span style="color: #002200;">=</span> volume<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; speechSynthesizer.continueSpeaking<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; animateActionButtonAppearance<span style="color: #002200;">(</span><span style="color: #a61390;">true</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>At first we check if the synthesizer is not speaking using the <em>speaking</em> property of the object. If that’s the case, then we do what we saw earlier. However, if it’s speaking (meaning that was speaking before the Pause button was tapped), then we call the <em>continueSpeaking</em> method to let the synthesizer continue right from the point it was paused. Lastly, we hide the Speak button and show the other two animated, and this time we pass the <em>true</em> value as an argument, denoting that we want the Speak button to be hidden.</p>
<p>Now you can try to run the app again. You will see the Pause and Stop buttons appearing, and you can use them to pause and stop the speech. That’s nice, and with little effort, uh?</p>
<h2>Speaking Multiple Utterances</h2>
<p>At this point our synthesizer can speech pretty well the text we provide it with, and that is the content of the textview. However, a synthesizer is capable of doing more than that, and to be specific, it can queue and speech multiple texts, instead of just one.</p>
<p>Queueing multiple text so they’re spoken by the synthesizer is not something we need to manually do. Each piece of text is provided to the synthesizer to the way we have already seen, and it is automatically queued. What we only have to take care about, is to make sure that we give synthesizer the texts in the proper order.</p>
<p>In this example we’ll “feed” our synthesizer with multiple texts in such way: We’ll break the text of the textview in pieces based on the line break character (\n). Each piece of text that will come up (let’s name it paragraph, because actually this is it), will be set in order to the synthesizer, so it gets spoken. Besides that, we’ll meet a new property here that we will use to set a small delay between subsequent text speeches.</p>
<p>In the <em>speak(_:)</em> action method, go in the body of the <em>if</em> statement, and just comment-out or delete its contents:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>speechSynthesizer.speaking <span style="color: #002200;">{</span><br>
<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; ...<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>In the empty <em>if</em> now add the code shown in the next snippet:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>speechSynthesizer.speaking <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let textParagraphs <span style="color: #002200;">=</span> tvEditor.text.componentsSeparatedByString<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"<span style="color: #2400d9;">\n</span>"</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">for</span> pieceOfText <span style="color: #a61390;">in</span> textParagraphs <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let speechUtterance <span style="color: #002200;">=</span> AVSpeechUtterance<span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> pieceOfText<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.rate <span style="color: #002200;">=</span> rate<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.pitchMultiplier <span style="color: #002200;">=</span> pitch<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.volume <span style="color: #002200;">=</span> volume<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.postUtteranceDelay <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.005</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; ...<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Let’s see what happens here: At first, we break the text in paragraphs, separating the text based on the break line character. The <em>componentsSeparatedByString(:_)</em> method returns an <em>array</em> of substrings, and of course all break line characters are missing. Next, in a loop we access each piece of text (each paragraph) one by one. We initialize at first the utterance object using the current paragraph, and we set all of the properties we desire. At the end, we ask from the synthesizer to speak the utterance, and with that each text is queued to be spoken in the correct order.</p>
<p>Note in the above snippet the <em>postUtteranceDelay</em> property. This is used to add a delay after the current text has been spoken, and in our case we set it to a really small value. You can add a delay before the new text as well, you just need to access the <em>preUtteranceDelay</em> property (we don’t use it here). Using either of these aforementioned properties is something we want here, because we need our synthesizer to “take a breath” before it continues to the next paragraph. Also, we want it to speak in a more natural way (make bigger pauses between paragraphs).</p>
<p>Everything else in the above method remains the same. You can try the app again now. This time make sure that you “break” your text in the textview by tapping the Return key. You might think that the synthesizer says everything as one text, but the truth is that this time uses multiple texts.</p>
<h2>Tracking Speech Progress</h2>
<p>Text-to-Speech solutions can be useful in various kind of applications, and maybe there will be times where you’ll need to keep track of the speech progress. Once you have this information, you can use it in many ways: Internally in your app, to display the current progress graphically to the user, and many more. However, getting the speech progress from the synthesizer might be a bit of a tricky job, so here I am going to show you how to succeed this. I believe that what I’ll show you is going to be good enough in most cases, however definitely is not the only way to track the speech progress. I’ll show you a solution, and then you can step on it to implement your own. Unfortunately, speech synthesizer doesn’t provide a simple, straightforward way to inform us about that.</p>
<p>In the storyboard file of the project and in the <em>View Controller scene</em> specifically, you will find a <em>progress bar</em> lying right under the action buttons we used earlier. Our goal is to reflect the speech progress on it, so we have an idea how long the speech process has gone.</p>
<p>As I said, there is no straight way to get the tracking information we want. However, the <em>delegate</em> methods of the synthesizer class can help us a lot towards that goal. As you will see next, we are going to adopt the <em>AVSpeechSynthesizerDelegate</em> protocol, and then we will be based on three delegate methods to <em>calculate</em> the progress. Things are going to become a bit complex here, so I’ll try to be as detailed as possible.</p>
<p>At first, let’s adopt the protocol I just mentioned about, and let’s tell the synthesizer object that our class is its delegate. In the <em>ViewController.swift</em> file go to the class opening line, and declare the protocol’s name:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">class ViewController<span style="color: #002200;">:</span> UIViewController, AVSpeechSynthesizerDelegate <span style="color: #002200;">{</span>...</div></td></tr></tbody></table></div>
<p>In the <em>viewDidLoad</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; speechSynthesizer.delegate <span style="color: #002200;">=</span> self &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, let’s define, without adding any code yet, the following three methods:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, didFinishSpeechUtterance utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
<br>
<span style="color: #002200;">}</span><br>
<br>
<br>
func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, didStartSpeechUtterance utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
<br>
<span style="color: #002200;">}</span><br>
<br>
<br>
func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Before we proceed, it’s important to explain the logic we’re about to follow, so we are all in the same page. I’ll begin talking about the last delegate method above, where as you see there’s a parameter named <em>characterRange</em>. This value is really an important one, because it “tells” us the range of the currently spoken word in the utterance that the synthesizer speaks. To make that clear, imagine that the spoken text is the following line:</p>
<p><em>My name is Gabriel</em></p>
<p>… and that currently the synthesizer says the “name” word. The range in this case is: (3, 4), where 3 is the location of the range, and 4 is its length.</p>
<p><em>Note: I advice you to read a bit about the <strong>NSRange</strong> structure in the web, so you get the meaning not only of that, but of what we’ll also do next. In short, a NSRange variable specifies a text range using two values: The <strong>location</strong> that shows the position of the first character in the whole text, and the <strong>length</strong> that shows how long the range is</em>.</p>
<p>So, returning to our work again, you can guess that if we know the range of the currently spoken word and also know the total length of the text (which we do through the <em>utterance</em> parameter), we can calculate the progress as a percentage. Great, but that’s good just in case we have one utterance only. What happens if there are more than one, and the synthesizer must produce speech for multiple utterances?</p>
<p>The solution in that problem will rely on the previous thoughts regarding the range parameter, and I will advance it by saying that we will calculate the progress made in the whole text (all pieces of text, not just the current one) by mixing the current range with the length of texts that have been already spoken. Of course, that means that we must keep track of various data regarding the utterance that is currently spoken, the total number of utterances, the total text length, and more.</p>
<p>Let’s make everything clear and specific now. Go to the top of the <em>ViewController</em> class, and declare the following properties:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var totalUtterances<span style="color: #002200;">:</span> Int<span style="color: #002200;">!</span> <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
<br>
var currentUtterance<span style="color: #002200;">:</span> Int<span style="color: #002200;">!</span> <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
<br>
var totalTextLength<span style="color: #002200;">:</span> Int <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
<br>
var spokenTextLengths<span style="color: #002200;">:</span> Int <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span></div></td></tr></tbody></table></div>
<p>Here’s what they are for:</p>
<ol>
<li><em>totalUtterances</em>: In it we will store the total utterances (the total different texts queued) that the synthesizer will produce speech for.</li>
<li><em>currentUtterance</em>: The number of the utterance that’s currently being spoken (ex. 2 out of 10).</li>
<li><em>totalTextLength</em>: It will keep the length of the whole text (all text pieces). We’ll compare the range of the words against this value later.</li>
<li><em>spokenTextLengths</em>: In this variable we’ll store the length of the texts that have been already spoken.</li>
</ol>
<p>The above variables must get their initial values, and the proper place to do that is the <em>speak(_:)</em> action method. Go in it, make sure you are in the <em>if</em> statement body, and then add the lines noted below:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>speechSynthesizer.speaking <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let textParagraphs <span style="color: #002200;">=</span> tvEditor.text.componentsSeparatedByString<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"<span style="color: #2400d9;">\n</span>"</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Add these lines.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; totalUtterances <span style="color: #002200;">=</span> textParagraphs.count<br>
&nbsp; &nbsp; &nbsp; &nbsp; currentUtterance <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; totalTextLength <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; spokenTextLengths <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">for</span> pieceOfText <span style="color: #a61390;">in</span> textParagraphs <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let speechUtterance <span style="color: #002200;">=</span> AVSpeechUtterance<span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> pieceOfText<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.rate <span style="color: #002200;">=</span> rate<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.pitchMultiplier <span style="color: #002200;">=</span> pitch<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.volume <span style="color: #002200;">=</span> volume<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.postUtteranceDelay <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.005</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Add this too.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; totalTextLength <span style="color: #002200;">=</span> totalTextLength <span style="color: #002200;">+</span> pieceOfText.utf16Count<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; ...<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>In the first addition above, we store the total number of utterances to the <em>totalUtterances</em> variable, and as you see, it’s equal to the total number of the text pieces. To the rest variables we just set the zero as their initial value. Next, in the <em>for</em> loop we calculate the total length of all texts, as we queue them to the synthesizer.</p>
<p>Now, let’s take advantage of the delegate methods to do some calculations. At first, when the synthesizer starts to speak an utterance, we must increase the <em>currentUtterance</em> value by one. That way we will be always able to know what the number of the currently spoken text is (among all). Here it is:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, didStartSpeechUtterance utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; currentUtterance <span style="color: #002200;">=</span> currentUtterance <span style="color: #002200;">+</span> <span style="color: #2400d9;">1</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Next, we must take some actions when the speech of a text gets finished. Let me show you first what I mean exactly, and then it will be easier to discuss about it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, didFinishSpeechUtterance utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; spokenTextLengths <span style="color: #002200;">=</span> spokenTextLengths <span style="color: #002200;">+</span> utterance.speechString.utf16Count <span style="color: #002200;">+</span> <span style="color: #2400d9;">1</span><br>
<br>
&nbsp; &nbsp; let progress<span style="color: #002200;">:</span> Float <span style="color: #002200;">=</span> Float<span style="color: #002200;">(</span>spokenTextLengths <span style="color: #002200;">*</span> <span style="color: #2400d9;">100</span> <span style="color: #002200;">/</span> totalTextLength<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; pvSpeechProgress.progress <span style="color: #002200;">=</span> progress <span style="color: #002200;">/</span> <span style="color: #2400d9;">100</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> currentUtterance <span style="color: #002200;">==</span> totalUtterances <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; animateActionButtonAppearance<span style="color: #002200;">(</span><span style="color: #a61390;">false</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Initially, we calculate the total length of all the spoken texts up to now. Note that <strong>+1</strong> at the end of the line: If we won’t add it, the total progress calculation will be wrong, because the total length of the original text contains the line breaks characters, which are not processed during the speech progress.</p>
<p>Next, we calculate the progress after a piece of text (an utterance) has been spoken. This will make the whole progress calculation and representation smoother. Note that this is not the main spot where the progress is calculated; instead, it works as a complementary calculation. As you see, we assign that progress to the <em>pvSpeechProgress</em> progress view.</p>
<p>Lastly, and regardless the progress tracking functionality, we make sure to hide the Pause and Stop buttons once the utterance that was just spoken is the last one.</p>
<p>Now, the last delegate method where we’ll make use of the current range. This is the place where the most of the progress will be calculated, and here’s how it should be done:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let progress<span style="color: #002200;">:</span> Float <span style="color: #002200;">=</span> Float<span style="color: #002200;">(</span>spokenTextLengths <span style="color: #002200;">+</span> characterRange.location<span style="color: #002200;">)</span> <span style="color: #002200;">*</span> <span style="color: #2400d9;">100</span> <span style="color: #002200;">/</span> Float<span style="color: #002200;">(</span>totalTextLength<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; pvSpeechProgress.progress <span style="color: #002200;">=</span> progress <span style="color: #002200;">/</span> <span style="color: #2400d9;">100</span> &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Note that we add the total spoken text lengths to the current range location, and use that value against the total text length to find the progress percentage. Then we set it to the progress view (note that the progress view’s progress must be between 0.0 and 1.0, that’s why we divide by 100).</p>
<p>You may run the app now, but if you do so you won’t see the progress view. That’s because initially its alpha value is set to zero. To fix this, simply go to the custom method where we animated the alpha value changing of the buttons, and add the progress view in the animation block as shown next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func animateActionButtonAppearance<span style="color: #002200;">(</span>shouldHideSpeakButton<span style="color: #002200;">:</span> Bool<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; UIView.animateWithDuration<span style="color: #002200;">(</span><span style="color: #2400d9;">0.25</span>, animations<span style="color: #002200;">:</span> <span style="color: #002200;">{</span> <span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Void <span style="color: #a61390;">in</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; self.pvSpeechProgress.alpha <span style="color: #002200;">=</span> pauseStopButtonsAlphaValue<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Feel free now to run the app. Let it speak, and watch the progress view growing as the speech moves forward.</p>
<h2>Working in Settings View Controller</h2>
<p>The <em>SettingsViewController</em> is the place where all the important utterance-related values are going to be modified in a graphical way. The next screenshot displays the final outcome of our work in this view controller:</p>
<div class="figure"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/t29_2_view_controller2.png" alt="text to speech demo" class="aligncenter size-full wp-image-4843" style="width:NaN%;"></div>
<p>As you see in the above image, we are going to change the values of the speech rate, pitch and volume using a <em>slider</em> view. Any modification to them will be reflected to the speech after the Save button has been tapped. But that’s not only. There is going to be a <em>picker view</em> with all the available <em>speech voices</em> listed on it, so the current voice can be changed when picking another one.</p>
<p>We’ll implement all of the above and we’ll see the details as we move along. The first and quite important task we have to do, is to load the current rate, pitch and volume values from the user defaults, and set them to the proper controls in the Settings view controller. Open the <em>SettingsViewController.swift</em> file, and at the top of the class declare the following variables:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">let speechSettings <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
var rate<span style="color: #002200;">:</span> Float<span style="color: #002200;">!</span><br>
<br>
var pitch<span style="color: #002200;">:</span> Float<span style="color: #002200;">!</span><br>
<br>
var volume<span style="color: #002200;">:</span> Float<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>The <em>speechSettings</em> constant is declared and initialized at once. It’s a <em>NSDictionary</em> object containing all the existing values being in the user defaults dictionary. Also, we declare three float values for the rate, pitch and volume. The next step is to initialize them in the <em>viewDidLoad</em>:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; rate <span style="color: #002200;">=</span> speechSettings.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"rate"</span><span style="color: #002200;">)</span> as Float<br>
&nbsp; &nbsp; &nbsp; &nbsp; pitch <span style="color: #002200;">=</span> speechSettings.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"pitch"</span><span style="color: #002200;">)</span> as Float<br>
&nbsp; &nbsp; &nbsp; &nbsp; volume <span style="color: #002200;">=</span> speechSettings.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"volume"</span><span style="color: #002200;">)</span> as Float<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Note here that I omit to check if the values actually exist in the user defaults. I consider they’re there and nothing it’s nil. However in a real application you should really avoid what I do here and do all the proper checking.</p>
<p>If you examine the Settings View Controller scene in the storyboard file, you’ll notice that there are two prototype cells, but for now we’re only interested in the first one:</p>
<div class="figure"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/t29_4_first_prototype_cell.png" alt="text-to-speech prototype cell" class="aligncenter size-full wp-image-4845" style="width:NaN%;"></div>
<p>Notice that there are two labels there, right above the slider view: The left one will be used to display the name of the current setting (such as “Rate”), and the right one will be used to display the actual value. Also, the slider’s value will be properly set. These three subviews (two labels and the slider) have tag values so they can be recognized in code. These tag values are:</p>
<ol>
<li>Left label: Tag value = 10</li>
<li>Right label: Tag value = 20</li>
<li>Slider: Tag value = 30</li>
</ol>
<p>With the above fact in mind, let’s return to the <em>SettingsViewController.swift</em> file. In there you can find already defined the most important and necessary tableview methods, but for now there’s not logic implemented yet. So, let’s start adding some logic by specifying the total number of rows that will exist in the tableview:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, numberOfRowsInSection section<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Int <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">3</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Later we’ll change the above return value to 4, so we include the voices prototype cell. For now, we’re just good.</p>
<p>The rest of our work will take place in the <em>tableView(_:cellForRowAtIndexPath:)</em> method. The first step here is to make sure that the current cell regards a rate, pitch or volume cell, to dequeue the prototype cell, and “extract” the above controls from the cell. Let’s see what I mean up to this point:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell<span style="color: #002200;">:</span> UITableViewCell<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> indexPath.row &lt; <span style="color: #2400d9;">3</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; cell <span style="color: #002200;">=</span> tableView.dequeueReusableCellWithIdentifier<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"idCellSlider"</span>, forIndexPath<span style="color: #002200;">:</span> indexPath<span style="color: #002200;">)</span> as UITableViewCell<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; let keyLabel <span style="color: #002200;">=</span> cell.contentView.viewWithTag<span style="color: #002200;">(</span><span style="color: #2400d9;">10</span><span style="color: #002200;">)</span> as? UILabel<br>
&nbsp; &nbsp; &nbsp; &nbsp; let valueLabel <span style="color: #002200;">=</span> cell.contentView.viewWithTag<span style="color: #002200;">(</span><span style="color: #2400d9;">20</span><span style="color: #002200;">)</span> as? UILabel<br>
&nbsp; &nbsp; &nbsp; &nbsp; let slider <span style="color: #002200;">=</span> cell.contentView.viewWithTag<span style="color: #002200;">(</span><span style="color: #2400d9;">30</span><span style="color: #002200;">)</span> as UISlider &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>As you can find out in the snippet above, we check the current row number to make sure that the cell regards any of the three values of interest. Next, we dequeue the cell, and here I should make an important notice: We use the <em>dequeueReusableCellWithIdentifier(_:forIndexPath:)</em> tableview method (notice the index path parameter), instead of the <em>dequeueReusableCellWithIdentifier(_:)</em>, because in the second case the cell returns nil values for its subviews.</p>
<p>Lastly, we get the two labels and the slider using their tag values.</p>
<p>Next, depending on the current index path row we are going to display the rate, pitch and volume values to the labels:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell<span style="color: #002200;">:</span> UITableViewCell<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> indexPath.row &lt; <span style="color: #2400d9;">3</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; var value<span style="color: #002200;">:</span> Float <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">switch</span> indexPath.row <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value <span style="color: #002200;">=</span> rate<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyLabel?.text <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">"Rate"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valueLabel?.text <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a><span style="color: #002200;">(</span>format<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"%.2f"</span>, rate<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">1</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value <span style="color: #002200;">=</span> pitch<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyLabel?.text <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">"Pitch"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valueLabel?.text <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a><span style="color: #002200;">(</span>format<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"%.2f"</span>, pitch<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">default</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value <span style="color: #002200;">=</span> volume<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyLabel?.text <span style="color: #002200;">=</span> <span style="color: #bf1d1a;">"Volume"</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; valueLabel?.text <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/"><span style="color: #400080;">NSString</span></a><span style="color: #002200;">(</span>format<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"%.2f"</span>, volume<span style="color: #002200;">)</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Two points to note here: At first, there’s a float local variable declared right before the <em>switch</em> statement, named <em>value</em>. As you see in the code following the declaration, we store the actual value of each speech property to that variable, and if you’re wondering why we do that, then I just have to say that we’ll use it to set the sliders’ values. You’ll see pretty soon. The second point I’d like to highlight here is how we assign each value to the <em>valueLabel</em> label properly formatted using the <em>NSString</em> class. With the syntax above we let the three values to be displayed using two decimal points.</p>
<p>Now we must setup the sliders. In each case of the <em>switch</em> statement we’ll do two things at the same time: We’ll set the maximum and minimum values of each slider, and we’ll <em>connect them with an action method that will be called every time their value gets changed</em>. Here is that addition:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell<span style="color: #002200;">:</span> UITableViewCell<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> indexPath.row &lt; <span style="color: #2400d9;">3</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">switch</span> indexPath.row <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.minimumValue <span style="color: #002200;">=</span> AVSpeechUtteranceMinimumSpeechRate<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.maximumValue <span style="color: #002200;">=</span> AVSpeechUtteranceMaximumSpeechRate<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.addTarget<span style="color: #002200;">(</span>self, action<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"handleSliderValueChange:"</span>, forControlEvents<span style="color: #002200;">:</span> UIControlEvents.ValueChanged<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">1</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.minimumValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.5</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.maximumValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">2.0</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.addTarget<span style="color: #002200;">(</span>self, action<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"handleSliderValueChange:"</span>, forControlEvents<span style="color: #002200;">:</span> UIControlEvents.ValueChanged<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">default</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.minimumValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">0.0</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.maximumValue <span style="color: #002200;">=</span> <span style="color: #2400d9;">1.0</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.addTarget<span style="color: #002200;">(</span>self, action<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"handleSliderValueChange:"</span>, forControlEvents<span style="color: #002200;">:</span> UIControlEvents.ValueChanged<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Lastly, we must set the real values to the sliders. We won’t do that in each case above, as that’s something common for all of them. What we’ll only do is to go after the <em>switch</em> statement and add the next couple of lines:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell<span style="color: #002200;">:</span> UITableViewCell<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> indexPath.row &lt; <span style="color: #2400d9;">3</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> slider.value <span style="color: #002200;">!=</span> value <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.value <span style="color: #002200;">=</span> value<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The condition above is super-important, because if we omit it the sliders are never going to work as expected. In the next part we’re going to implement their behavior and change the respective values, and without that condition the sliders will never follow our finger towards the direction we order them to move.</p>
<h2>Changing Rate, Pitch and Volume Values</h2>
<p>In the previous part we specified the <em>handleSliderValueChanged(_:)</em> as the action method that should be called when the sliders change value. As you noticed, we didn’t implement this method, but here’s the place that we’ll do that. Here’s its definition:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func handleSliderValueChange<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> UISlider<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, depending on the slider that has changed value, we must update the proper property (rate, pitch, volume) appropriately. But, how can we determine and really say which slider is?</p>
<p>Well, there are two solutions to that. The first one is to get the slider’s superview, which is the cell containing it. Then, we can specify the index path of the cell using the tableview and finally decide which property the slider regards.</p>
<p>The second solution is quite different, and it relies on <em>subclassing</em> the <em>UISlider</em> class. To make that clear, we can subclass the <em>UISlider</em> class, and add a new property to that subclass. That property will be an identifier value, which we’ll use for distinguishing our three sliders. Of course, we’ll also have to change the class of each slider from <em>UISlider</em> to the new one. Generally, subclasses can be really powerful, as they allow you to add properties and methods not existing to parent classes. If you don’t use subclasses, maybe it would be a nice idea to start doing so when it’s needed.</p>
<p>Let’s create our new subclass. Hit the <em>Cmd + N</em> in Xcode, and create a new <strong>Cocoa Touch Class</strong> file. Make it subclass of the <strong>UISlider</strong> class, and name it <strong>CustomSlider</strong>. Once you create it, open it so we can edit it.</p>
<p>As I said before, we are going to declare just one property here, named <em>sliderIdentifier</em>. It’s going to be an Int value. Besides than simply declaring it, we must add a couple of init methods, as the consist of the minimum implementation that should be done when subclassing:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">class CustomSlider<span style="color: #002200;">:</span> UISlider <span style="color: #002200;">{</span><br>
<br>
&nbsp; &nbsp; var sliderIdentifier<span style="color: #002200;">:</span> Int<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; override init<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; super.init<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; sliderIdentifier <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
<br>
&nbsp; &nbsp; required init<span style="color: #002200;">(</span>coder aDecoder<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSCoder_Class/"><span style="color: #400080;">NSCoder</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; super.init<span style="color: #002200;">(</span>coder<span style="color: #002200;">:</span> aDecoder<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; sliderIdentifier <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The second init method is required and can’t be omitted. As you see, the extremely simple implementation above will give the solution to our problem.</p>
<p>Open now the <em>Main.storyboard</em> file and go straight ahead to the Settings View Controller scene. There, select the slider in the prototype cell and open the <strong>Identity Inspector</strong> in the Utilities pane. In the <strong>Custom Class</strong> section, set the <strong>CustomSlider</strong> value in the <strong>Class</strong> field.</p>
<div class="figure"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/t29_5_change_slider_class.png" alt="t29_5_change_slider_class" class="aligncenter size-full wp-image-4846" style="width:NaN%;"></div>
<p>Now, let’s return to the <em>SettingsViewController.swift</em> file. Go to the definition of the above action method, and change its parameter type as shown next:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func handleSliderValueChange<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> CustomSlider<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Before we implement it, let’s make an addition to the <em>tableView(_:cellForRowAtIndexPath:)</em> method. In here, we must set value to the <em>sliderIdentifer</em> property of each slider, but also set the proper class of the slider when downcasting:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell<span style="color: #002200;">:</span> UITableViewCell<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> indexPath.row &lt; <span style="color: #2400d9;">3</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Change the class when down casting next.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let slider <span style="color: #002200;">=</span> cell.contentView.viewWithTag<span style="color: #002200;">(</span><span style="color: #2400d9;">30</span><span style="color: #002200;">)</span> as CustomSlider<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">switch</span> indexPath.row <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">0</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.sliderIdentifier <span style="color: #002200;">=</span> <span style="color: #2400d9;">100</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">1</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.sliderIdentifier <span style="color: #002200;">=</span> <span style="color: #2400d9;">200</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">default</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slider.sliderIdentifier <span style="color: #002200;">=</span> <span style="color: #2400d9;">300</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now it’s easy to implement the action method; we’ll be based on the above identifier values:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func handleSliderValueChange<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> CustomSlider<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">switch</span> sender.sliderIdentifier <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">100</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; rate <span style="color: #002200;">=</span> sender.value<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">case</span> <span style="color: #2400d9;">200</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; pitch <span style="color: #002200;">=</span> sender.value<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">default</span><span style="color: #002200;">:</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; volume <span style="color: #002200;">=</span> sender.value<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; tbSettings.reloadData<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Notice that we must reload the tableview once we change a value.</p>
<p>If you run the application now and go to settings view controller, you’ll see the rate, pitch and volume values to get changed when you move the sliders.</p>
<h2>Applying Settings</h2>
<p>All the implementation we did in the Settings view controller will be totally meaningless if we don’t save the changed values, so they can be used in the <em>View Controller</em> class. So, here we’ll save everything by making two easy steps.</p>
<p>The first step is to save all properties managed in the Settings (modified and not) to the user defaults. This will take place in the <em>saveSettings(_:)</em> action method which can be found in the <em>SettingsViewController.swift</em> file. This action method is called when the save bar button item gets tapped. Let’s see that:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func saveSettings<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.setFloat<span style="color: #002200;">(</span>rate, forKey<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"rate"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.setFloat<span style="color: #002200;">(</span>pitch, forKey<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"pitch"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.setFloat<span style="color: #002200;">(</span>volume, forKey<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"volume"</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.synchronize<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>All it’s easy in the above implementation. Note that we call the <em>synchronize()</em> method to update the user defaults with the new values.</p>
<p>The second step we must make is to notify the <em>ViewController</em> class that the above values have been changed, so the speech synthesizer uses them the next time that will speak out some text. We’ll succeed this by using the <em>delegation pattern</em>.</p>
<p>In the <em>SettingsViewController.swift</em> file, go at the top of it right before the class definition. There, add the following <em>protocol</em>:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">protocol SettingsViewControllerDelegate <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; func didSaveSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Next, in the <em>SettingsViewController</em> class declare a delegate object:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var delegate<span style="color: #002200;">:</span> SettingsViewControllerDelegate<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>Back in the <em>saveSettings(_:)</em> action method now, let’s add a couple of missing rows. As you’ll see in the following segment, at first we make a call to the delegate method we just declared, and then we <em>pop</em> the settings view controller from the navigation stack so we return back to the first view controller:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func saveSettings<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; self.delegate.didSaveSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; navigationController?.popViewControllerAnimated<span style="color: #002200;">(</span><span style="color: #a61390;">true</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Okay, now the half job has been done. The above call to the delegate method will have no effect at all if we don’t make the <em>ViewController</em> class conform to the <em>SettingsViewControllerDelegate</em>, and then to implement that delegate method in there.</p>
<p>Switch now to the <em>ViewController.swift</em> file. First of all, adopt our custom protocol:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">class ViewController<span style="color: #002200;">:</span> UIViewController, AVSpeechSynthesizerDelegate, SettingsViewControllerDelegate</div></td></tr></tbody></table></div>
<p>Now, there’s an intermediate stage before we implement the delegate method. We must make this class the delegate of the <em>SettingsViewController</em>, for that reason implement the next one:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func prepareForSegue<span style="color: #002200;">(</span>segue<span style="color: #002200;">:</span> UIStoryboardSegue, sender<span style="color: #002200;">:</span> AnyObject?<span style="color: #002200;">)</span> <span style="color: #002200;">{</span> &nbsp; &nbsp;<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> segue.identifier <span style="color: #002200;">==</span> <span style="color: #bf1d1a;">"idSegueSettings"</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let settingsViewController <span style="color: #002200;">=</span> segue.destinationViewController as SettingsViewController<br>
&nbsp; &nbsp; &nbsp; &nbsp; settingsViewController.delegate <span style="color: #002200;">=</span> self<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>By overriding the <em>prepareForSegue(_:sender:)</em> method, we can access the view controller that is about to be loaded (in this case the <em>SettingsViewController</em>), and this can be done through the <em>destinationViewController</em> of the segue that will be performed. Note that the identifier value of the segue is “idSegueSettings”, and I set it in the Interface Builder. Remember that this identifier can be any value you want, as long as it’s unique and no other segue with the same identifier exists. Anyway, in the above condition we finally set our class as the delegate for the settings view controller.</p>
<p>Now, we’re able to implement the delegate method. In it, we’ll load the saved values from the user defaults and we’ll set them to the respective properties of our class (rate, pitch, volume). With that, the next time the synthesizer will speak, all utterances will use the new settings. Here’s the implementation:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func didSaveSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let settings <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span> as <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a><span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; rate <span style="color: #002200;">=</span> settings.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"rate"</span><span style="color: #002200;">)</span> as Float<br>
&nbsp; &nbsp; pitch <span style="color: #002200;">=</span> settings.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"pitch"</span><span style="color: #002200;">)</span> as Float<br>
&nbsp; &nbsp; volume <span style="color: #002200;">=</span> settings.valueForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"volume"</span><span style="color: #002200;">)</span> as Float<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>That’s all! Go now and run the app, change the various settings and let the synthesizer speak. Do many tests and see how each setting affects the produced speech.</p>
<h2>Selecting a Different Voice</h2>
<p>The default voice used to produce the speech in iOS matches to the current locale of the system (the language settings, etc). That means that if you currently have the US locale applied, the US voice will speak. If you have the French locale, the French voice will speak. However, it’s possible to change the default voice and have your text to be spoken with a different voice, and with a different accent.</p>
<p>Our goal in this part is to make the demo application capable of using another voice, and we’ll succeed this by providing such a setting in the settings view controller. Up to this point, Apple supports 37 different voices. Programmatically speaking now, we are going to use another class named <em>AVSpeechSynthesisVoice</em>, and through this we’ll access all voices for the supported locales.</p>
<p>There’s a class method called <em>speechVoices()</em> that returns all voices. You can see really easily what the supported locales are, if you simply add the following line to any <em>viewDidLoad</em> method you want:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">println<span style="color: #002200;">(</span>AVSpeechSynthesisVoice.speechVoices<span style="color: #002200;">(</span><span style="color: #002200;">)</span><span style="color: #002200;">)</span></div></td></tr></tbody></table></div>
<p>The first five results the above line returns are:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap"><span style="color: #002200;">[</span><span style="color: #002200;">[</span>AVSpeechSynthesisVoice 0x170007470<span style="color: #002200;">]</span> Language<span style="color: #002200;">:</span> ar<span style="color: #002200;">-</span>SA,<br>
&nbsp;<span style="color: #002200;">[</span>AVSpeechSynthesisVoice 0x1700075a0<span style="color: #002200;">]</span> Language<span style="color: #002200;">:</span> en<span style="color: #002200;">-</span>ZA,<br>
&nbsp;<span style="color: #002200;">[</span>AVSpeechSynthesisVoice 0x1700075b0<span style="color: #002200;">]</span> Language<span style="color: #002200;">:</span> nl<span style="color: #002200;">-</span>BE,<br>
&nbsp;<span style="color: #002200;">[</span>AVSpeechSynthesisVoice 0x170007590<span style="color: #002200;">]</span> Language<span style="color: #002200;">:</span> en<span style="color: #002200;">-</span>AU,<br>
&nbsp;<span style="color: #002200;">[</span>AVSpeechSynthesisVoice 0x1700075d0<span style="color: #002200;">]</span> Language<span style="color: #002200;">:</span> th<span style="color: #002200;">-</span>TH<br>
...<span style="color: #002200;">]</span></div></td></tr></tbody></table></div>
<p>As you guess, we are going to be based on that method to fetch all the supported locales, make it possible to select one, and eventually allow the synthesizer to speak using another voice. From the returned data (the one you see above) we are going to use the language code. With that code then we’ll specify the language name, and we’ll create a <em>dictionary</em> containing both the name and code for each language. Then, this dictionary will be added to an <em>array</em>, so we can access later all of those dictionaries and display all languages to the settings.</p>
<p>Let’s get started, as there are more than a few things to do here. Open the <em>SettingsViewController.swift</em> file, and declare the following array and integer variable at the top of the class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var arrVoiceLanguages<span style="color: #002200;">:</span> <span style="color: #002200;">[</span>Dictionary&lt;String, String<span style="color: #002200;">!</span>&gt;<span style="color: #002200;">]</span> <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">]</span><br>
<br>
var selectedVoiceLanguage <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span></div></td></tr></tbody></table></div>
<p>As I said, we’ll use the array to store all language names and codes matching to the supported voices. The integer value will be used as an index for the selected voice language.</p>
<p>Now, let’s create a custom method where we’ll do all what I described earlier. Let’s see it, and then we’ll talk about it:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func prepareVoiceList<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">for</span> voice <span style="color: #a61390;">in</span> AVSpeechSynthesisVoice.speechVoices<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let voiceLanguageCode <span style="color: #002200;">=</span> <span style="color: #002200;">(</span>voice as AVSpeechSynthesisVoice<span style="color: #002200;">)</span>.language<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; let languageName <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSLocale_Class/"><span style="color: #400080;">NSLocale</span></a>.currentLocale<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.displayNameForKey<span style="color: #002200;">(</span>NSLocaleIdentifier, value<span style="color: #002200;">:</span> voiceLanguageCode<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; let dictionary <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #bf1d1a;">"languageName"</span><span style="color: #002200;">:</span> languageName, <span style="color: #bf1d1a;">"languageCode"</span><span style="color: #002200;">:</span> voiceLanguageCode<span style="color: #002200;">]</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; arrVoiceLanguages.append<span style="color: #002200;">(</span>dictionary<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The code is pretty straightforward; the only thing I’d like to highlight is that we use the <em>NSLocale</em> class to get the language name using the code as shown above. Now that this method is implemented, we must call it, and we’ll do so in the <em>viewDidLoad</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; prepareVoiceList<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Our next step is to display the data we just prepared. In the Settings view controller scene in the storyboard file, there’s a second prototype cell with a picker view in it. We’ll use this cell to display all voice languages, and that means that we have to deal again with the tableview methods.</p>
<p>First of all, change the number of the returned rows from 3 to 4:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, numberOfRowsInSection section<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Int <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">4</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Next, in the <em>tableView(_:cellForRowAtIndexPath:)</em> method add the following <em>else</em>, right before you return the cell:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func tableView<span style="color: #002200;">(</span>tableView<span style="color: #002200;">:</span> UITableView, cellForRowAtIndexPath indexPath<span style="color: #002200;">:</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSIndexPath_Class/"><span style="color: #400080;">NSIndexPath</span></a><span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; UITableViewCell <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; var cell<span style="color: #002200;">:</span> UITableViewCell<span style="color: #002200;">!</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> indexPath.row &lt; <span style="color: #2400d9;">3</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">else</span><span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; cell <span style="color: #002200;">=</span> tableView.dequeueReusableCellWithIdentifier<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"idCellVoicePicker"</span>, forIndexPath<span style="color: #002200;">:</span> indexPath<span style="color: #002200;">)</span> as UITableViewCell<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; let pickerView <span style="color: #002200;">=</span> cell.contentView.viewWithTag<span style="color: #002200;">(</span><span style="color: #2400d9;">10</span><span style="color: #002200;">)</span> as UIPickerView<br>
&nbsp; &nbsp; &nbsp; &nbsp; pickerView.delegate <span style="color: #002200;">=</span> self<br>
&nbsp; &nbsp; &nbsp; &nbsp; pickerView.dataSource <span style="color: #002200;">=</span> self<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> cell<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>You see that we make the settings view controller class the delegate and datasource of the picker view, as through the methods of those protocols we’re able to provide data to it and also be aware of the user selection. Before we continue we must fix the errors Xcode is currently showing simply by adopting the following two protocols:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">class SettingsViewController<span style="color: #002200;">:</span> UIViewController, UITableViewDelegate, UITableViewDataSource, UIPickerViewDelegate, UIPickerViewDataSource</div></td></tr></tbody></table></div>
<p>Let’s implement now the required picker view delegate and datasource methods. At first, we must return the number of the components the picker view will have (obviously just one), and how many rows this component will contain:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func numberOfComponentsInPickerView<span style="color: #002200;">(</span>pickerView<span style="color: #002200;">:</span> UIPickerView<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Int <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> <span style="color: #2400d9;">1</span><br>
<span style="color: #002200;">}</span><br>
<br>
<br>
func pickerView<span style="color: #002200;">(</span>pickerView<span style="color: #002200;">:</span> UIPickerView, numberOfRowsInComponent component<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; Int <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> arrVoiceLanguages.count<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now, let’s display the voice languages to the picker view:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func pickerView<span style="color: #002200;">(</span>pickerView<span style="color: #002200;">:</span> UIPickerView, titleForRow row<span style="color: #002200;">:</span> Int, forComponent component<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">-</span>&gt; String<span style="color: #002200;">!</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let voiceLanguagesDictionary <span style="color: #002200;">=</span> arrVoiceLanguages<span style="color: #002200;">[</span>row<span style="color: #002200;">]</span> as Dictionary&lt;String, String<span style="color: #002200;">!</span>&gt;<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">return</span> voiceLanguagesDictionary<span style="color: #002200;">[</span><span style="color: #bf1d1a;">"languageName"</span><span style="color: #002200;">]</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>It’s really simple what we do here: We get the dictionary existing in the index of the array matching to the row specified by the parameter value, and from this dictionary we “extract” and return the language name. Just that.</p>
<p>There’s one last method missing, and in this one we must keep the selection of the user when taps on a row:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func pickerView<span style="color: #002200;">(</span>pickerView<span style="color: #002200;">:</span> UIPickerView, didSelectRow row<span style="color: #002200;">:</span> Int, inComponent component<span style="color: #002200;">:</span> Int<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; selectedVoiceLanguage <span style="color: #002200;">=</span> row<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>To sum up here, we have managed to get all the languages for the supported voices, display them to the picker view, and made it possible to select a row. But how are we going to let the synthesizer know about the selected voice?</p>
<p>The answer is to use once again the delegation pattern, and this time we have it already implemented. Actually, we must only add one line in the <em>saveSettings(_:)</em> method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func saveSettings<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
&nbsp; &nbsp; <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/"><span style="color: #400080;">NSUserDefaults</span></a>.standardUserDefaults<span style="color: #002200;">(</span><span style="color: #002200;">)</span>.setObject<span style="color: #002200;">(</span>arrVoiceLanguages<span style="color: #002200;">[</span>selectedVoiceLanguage<span style="color: #002200;">]</span><span style="color: #002200;">[</span><span style="color: #bf1d1a;">"languageCode"</span><span style="color: #002200;">]</span>, forKey<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"languageCode"</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; ...<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Note that this line should be added before the user defaults synchronization. With this single line, we manage to store in the user defaults the language code of the selected voice.</p>
<p>Now, let’s open the <em>ViewController.swift</em> file, where we need to make a couple of new additions. First of all, declare the following variable at the top of the class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var preferredVoiceLanguageCode<span style="color: #002200;">:</span> String<span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>You may assume from its name what is for. Next, head to the <em>didSaveSettings()</em> delegate method, and enrich it with the next line:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func didSaveSettings<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; preferredVoiceLanguageCode <span style="color: #002200;">=</span> settings.objectForKey<span style="color: #002200;">(</span><span style="color: #bf1d1a;">"languageCode"</span><span style="color: #002200;">)</span> as String<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>As you see, we store in the <em>preferredVoiceLanguageCode</em> variable the value of the selected voice language code.</p>
<p>Lastly, in the <em>speak(_:)</em> action method we must tell the synthesizer about the selected voice. Actually, we are not going to do something like that in the synthesizer object, but we’ll set the voice language code to each utterance object. In the <em>for</em> loop add the next snippet:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">@IBAction func speak<span style="color: #002200;">(</span>sender<span style="color: #002200;">:</span> AnyObject<span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> <span style="color: #002200;">!</span>speechSynthesizer.speaking <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">for</span> pieceOfText <span style="color: #a61390;">in</span> textParagraphs <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #a61390;">if</span> let voiceLanguageCode <span style="color: #002200;">=</span> preferredVoiceLanguageCode <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let voice <span style="color: #002200;">=</span> AVSpeechSynthesisVoice<span style="color: #002200;">(</span>language<span style="color: #002200;">:</span> voiceLanguageCode<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechUtterance.voice <span style="color: #002200;">=</span> voice<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speechSynthesizer.speakUtterance<span style="color: #002200;">(</span>speechUtterance<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
&nbsp; &nbsp; ...<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>We’re ready. Go and test the app once again. As you’ll see, now you can pick another voice for the produced speech in the settings view controller. I’m pretty sure that you’ll find the result really interesting.</p>
<h2>Bonus Material: Highlighting the Spoken Text</h2>
<p>Normally, at this point this tutorial comes to its end. So, if you want to give a final try to the demo application and stop reading, feel free to do it. On the other hand, if you want to see how to make the app more interesting and alive, then keep reading, as I considered to be really nice to make the spoken text to be highlighted during the speech process. There are cases where this feature is useful, and even it sounds easy, it requires some amount of work. Note though that this task has nothing to do with the text-to-speech process; instead we’ll use another framework to achieve this goal: The <em>UITextKit</em> framework.</p>
<p>If you’re comfortable working with Text Kit (which was first introduced in iOS 7), then you will be just fine with the rest content in this part. If you’re not familiar with Text Kit, then <a href="http://www.appcoda.com/intro-text-kit-ios-programming-guide/">here</a> is a link of an older tutorial of mine regarding it. I won’t provide much details about the Text Kit specifics; I’ll mostly describe the steps required to highlight the spoken text, so if there’s something that you don’t understand beyond any short explanation I give, go and search either on the above link or in the web for more information.</p>
<p>So, let’s get started. Trust me, this is a part that I find pretty interesting as I enjoy playing with Text Kit, and I hope that you will do so. The first step before performing any programming actions, is to convert the plain text of the textview to an <em>attributed</em> text. That’s important and necessary, as we’re going to apply changes to a textview property which is part of the Text Kit, named <em>TextStorage</em>. Actually, the text storage property of the textview is an object of the <em>NSTextStorage</em> class, and it’s responsible for storing the textview text along with its <em>attributes</em>. Such an attribute is the font name, including information whether the text is bold or italic (this information is called <em>font traits</em>). Another such an attribute is the text foreground color. Even custom attributes can be set regarding an attributed text. Anyway, I won’t go any further on that, but I have to tell you that we’re going to access the text attributes to change the text color (foreground color) of the currently spoken word, therefore we need to use the text storage property, and furthermore, we need to work on an attributed text.</p>
<p>With that, open the storyboard file in the Interface Builder. Go to the View Controller scene, and select the textview. Open the Utilities pane, and then the Attributes Inspector. There, click on the <strong>Text</strong> drop down control and select the <strong>Attributed</strong> value instead of the <strong>Plain</strong> and you’re done:</p>
<div class="figure"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/t29_6_attributed_text.png" alt="t29_6_attributed_text" class="aligncenter size-full wp-image-4847" style="width:NaN%;"></div>
<p>Now, the next step is to set the initial font to the textview text as an attribute. We’ll do that before performing any text highlighting, because we will need to revert the selected text back to its normal state, and of course, using its normal font. So, in the <em>ViewController.swift</em> file let’s write the next custom method:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func setInitialFontAttribute<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; let rangeOfWholeText <span style="color: #002200;">=</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, tvEditor.text.utf16Count<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; let attributedText <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableAttributedString_Class/"><span style="color: #400080;">NSMutableAttributedString</span></a><span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.text<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; attributedText.addAttribute<span style="color: #002200;">(</span>NSFontAttributeName, value<span style="color: #002200;">:</span> UIFont<span style="color: #002200;">(</span>name<span style="color: #002200;">:</span> <span style="color: #bf1d1a;">"Arial"</span>, size<span style="color: #002200;">:</span> <span style="color: #2400d9;">18.0</span><span style="color: #002200;">)</span><span style="color: #002200;">!</span>, range<span style="color: #002200;">:</span> rangeOfWholeText<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; tvEditor.textStorage.beginEditing<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; tvEditor.textStorage.replaceCharactersInRange<span style="color: #002200;">(</span>rangeOfWholeText, withAttributedString<span style="color: #002200;">:</span> attributedText<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; tvEditor.textStorage.endEditing<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Here’s what takes place above:</p>
<ul>
<li>At first, we specify the range of the whole text. In a previous part I had talked about the <em>NSRange</em> structure, but I think it’s good to remind here too that the first parameter is the start of the range, while the second one is its length.</li>
<li>Next, we assign the text of the area specified by the range (actually the whole text) to a mutable attributed string, so it’s possible to add attribute to it.</li>
<li>Using the <em>addAttribute(_:value:range:)</em> method of the attributed string object we set the font attribute (<em>NSFontAttributeName</em>), specifying the font name and size, and the range that this attribute will apply.</li>
<li>Lastly, we prepare the text storage for editing. We replace the current text with the attributed one, and we end by making any changes in the text storage valid.</li>
</ul>
<p>The above method must be called in the <em>viewDidLoad</em>:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">override func viewDidLoad<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; setInitialFontAttribute<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Now it is coming the interesting path, the highlighting of the words. Our target here is to change the foreground color of the currently spoken word, and make it <em>orange</em> when is spoken, while we’ll turn it back to black after it has been spoken. Our whole work will take place in the <em>speechSynthesizer(_:willSpeakRangeOfSpeechString:utterance:)</em> delegate method because, if you remember, it’s the only place where we can get the range of the currently spoken word. At this point is necessary to declare a new variable in the class:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">var previousSelectedRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span><span style="color: #002200;">!</span></div></td></tr></tbody></table></div>
<p>In this variable we are going to store the <em>range</em> of the previously selected word, so we can make it black again after it has been spoken.</p>
<p>Let’s go in the aforementioned method now to start adding some code. I’ll give it in pieces as it’s easier to understand it. There are also comments that will help you in that.</p>
<p>So, initially we want to specify the range of the current word, not in the context of the current text, but in the context of all texts (utterances) that are about to be spoken. Once that range has been determined, we will use it to select the appropriate area in the textview:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Determine the current range in the whole text (all utterances), not just the current one.</span><br>
&nbsp; &nbsp; let rangeInTotalText <span style="color: #002200;">=</span> NSMakeRange<span style="color: #002200;">(</span>spokenTextLengths <span style="color: #002200;">+</span> characterRange.location, characterRange.length<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Select the specified range in the textfield.</span><br>
&nbsp; &nbsp; tvEditor.selectedRange <span style="color: #002200;">=</span> rangeInTotalText &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Next, we must access the current attributes of the selected text, and keep a copy of the font attribute. We’ll need it later to make sure that the font won’t get changed. Besides finding the current attributes, we’ll also assign the selected text to a mutable attributed string, so we can add the foreground color attribute later:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Store temporarily the current font attribute of the selected text.</span><br>
&nbsp; &nbsp; let currentAttributes <span style="color: #002200;">=</span> tvEditor.attributedText.attributesAtIndex<span style="color: #002200;">(</span>rangeInTotalText.location, effectiveRange<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; let fontAttribute<span style="color: #002200;">:</span> AnyObject? <span style="color: #002200;">=</span> currentAttributes<span style="color: #002200;">[</span>NSFontAttributeName<span style="color: #002200;">]</span><br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Assign the selected text to a mutable attributed string.</span><br>
&nbsp; &nbsp; let attributedString <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableAttributedString_Class/"><span style="color: #400080;">NSMutableAttributedString</span></a><span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.attributedText.attributedSubstringFromRange<span style="color: #002200;">(</span>rangeInTotalText<span style="color: #002200;">)</span>.<span style="color: #a61390;">string</span><span style="color: #002200;">)</span><br>
<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Time to highlight the selected text, and of course to set the original font again. If we don’t do that, it will be replaced by the system font:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Make the text of the selected area orange by specifying a new attribute.</span><br>
&nbsp; &nbsp; attributedString.addAttribute<span style="color: #002200;">(</span>NSForegroundColorAttributeName, value<span style="color: #002200;">:</span> UIColor.orangeColor<span style="color: #002200;">(</span><span style="color: #002200;">)</span>, range<span style="color: #002200;">:</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, attributedString.length<span style="color: #002200;">)</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Make sure that the text will keep the original font by setting it as an attribute.</span><br>
&nbsp; &nbsp; attributedString.addAttribute<span style="color: #002200;">(</span>NSFontAttributeName, value<span style="color: #002200;">:</span> fontAttribute<span style="color: #002200;">!</span>, range<span style="color: #002200;">:</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, attributedString.<span style="color: #a61390;">string</span>.utf16Count<span style="color: #002200;">)</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>There’s a small detail we have to take care of here: If the selected word is out of the visible area of the screen, then it won’t be shown, therefore we should scroll the textview a bit:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// In case the selected word is not visible scroll a bit to fix this.</span><br>
&nbsp; &nbsp; tvEditor.scrollRangeToVisible<span style="color: #002200;">(</span>rangeInTotalText<span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>The last step in this method is to update the text storage property of the textview, so any changes we made to actually apply. During the editing session of the text storage property, we won’t just replace the selected word with the new attributed string we set above; we will also check if there was another highlighted word previously that has been spoken already, and we’ll change its foreground color back to normal (black). Note that we have already done once all that you see below:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;height:300px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Begin editing the text storage.</span><br>
&nbsp; &nbsp; tvEditor.textStorage.beginEditing<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Replace the selected text with the new one having the orange color attribute.</span><br>
&nbsp; &nbsp; tvEditor.textStorage.replaceCharactersInRange<span style="color: #002200;">(</span>rangeInTotalText, withAttributedString<span style="color: #002200;">:</span> attributedString<span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// If there was another highlighted word previously (orange text color), then do exactly the same things as above and change the foreground color to black.</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let previousRange <span style="color: #002200;">=</span> previousSelectedRange <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let previousAttributedText <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableAttributedString_Class/"><span style="color: #400080;">NSMutableAttributedString</span></a><span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.attributedText.attributedSubstringFromRange<span style="color: #002200;">(</span>previousRange<span style="color: #002200;">)</span>.<span style="color: #a61390;">string</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; previousAttributedText.addAttribute<span style="color: #002200;">(</span>NSForegroundColorAttributeName, value<span style="color: #002200;">:</span> UIColor.blackColor<span style="color: #002200;">(</span><span style="color: #002200;">)</span>, range<span style="color: #002200;">:</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, previousAttributedText.length<span style="color: #002200;">)</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; previousAttributedText.addAttribute<span style="color: #002200;">(</span>NSFontAttributeName, value<span style="color: #002200;">:</span> fontAttribute<span style="color: #002200;">!</span>, range<span style="color: #002200;">:</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, previousAttributedText.length<span style="color: #002200;">)</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; tvEditor.textStorage.replaceCharactersInRange<span style="color: #002200;">(</span>previousRange, withAttributedString<span style="color: #002200;">:</span> previousAttributedText<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// End editing the text storage.</span><br>
&nbsp; &nbsp; tvEditor.textStorage.endEditing<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>And one last, but important detail:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, willSpeakRangeOfSpeechString characterRange<span style="color: #002200;">:</span> <span style="color: #a61390;">NSRange</span>, utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span> &nbsp; &nbsp;<br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Keep the currently selected range so as to remove the orange text color next.</span><br>
&nbsp; &nbsp; previousSelectedRange <span style="color: #002200;">=</span> rangeInTotalText<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>At this point our work is pretty much done. There’s though one minor flaw that you’ll be able to see if only you run the application, but I’ll tell you what exactly is it in advance. The last highlighted word (last word in orange color) doesn’t get un-highlighted, and that’s something that must be fixed.</p>
<p>You probably already imagine the solution, which no other than doing something similar to all the above but not in that method. Right next I give you one more custom method where we fix the problem I mentioned, and the inner comments will help you understand each step:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func unselectLastWord<span style="color: #002200;">(</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> let selectedRange <span style="color: #002200;">=</span> previousSelectedRange <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Get the attributes of the last selected attributed word.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let currentAttributes <span style="color: #002200;">=</span> tvEditor.attributedText.attributesAtIndex<span style="color: #002200;">(</span>selectedRange.location, effectiveRange<span style="color: #002200;">:</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Keep the font attribute.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let fontAttribute<span style="color: #002200;">:</span> AnyObject? <span style="color: #002200;">=</span> currentAttributes<span style="color: #002200;">[</span>NSFontAttributeName<span style="color: #002200;">]</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Create a new mutable attributed string using the last selected word.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; let attributedWord <span style="color: #002200;">=</span> <a href="http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableAttributedString_Class/"><span style="color: #400080;">NSMutableAttributedString</span></a><span style="color: #002200;">(</span><span style="color: #a61390;">string</span><span style="color: #002200;">:</span> tvEditor.attributedText.attributedSubstringFromRange<span style="color: #002200;">(</span>selectedRange<span style="color: #002200;">)</span>.<span style="color: #a61390;">string</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Set the previous font attribute, and make the foreground color black.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; attributedWord.addAttribute<span style="color: #002200;">(</span>NSForegroundColorAttributeName, value<span style="color: #002200;">:</span> UIColor.blackColor<span style="color: #002200;">(</span><span style="color: #002200;">)</span>, range<span style="color: #002200;">:</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, attributedWord.length<span style="color: #002200;">)</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; attributedWord.addAttribute<span style="color: #002200;">(</span>NSFontAttributeName, value<span style="color: #002200;">:</span> fontAttribute<span style="color: #002200;">!</span>, range<span style="color: #002200;">:</span> NSMakeRange<span style="color: #002200;">(</span><span style="color: #2400d9;">0</span>, attributedWord.length<span style="color: #002200;">)</span><span style="color: #002200;">)</span><br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #11740a; font-style: italic;">// Update the text storage property and replace the last selected word with the new attributed string.</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; tvEditor.textStorage.beginEditing<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; tvEditor.textStorage.replaceCharactersInRange<span style="color: #002200;">(</span>selectedRange, withAttributedString<span style="color: #002200;">:</span> attributedWord<span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; tvEditor.textStorage.endEditing<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span><br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>Lastly, let’s perform a small update in the <em>speechSynthesizer(_:didFinishSpeechUtterance:)</em> delegate method, where we’ll call the above one:</p>
<div class="codecolorer-container objc geshi" style="overflow:auto;white-space:nowrap;width:750px;"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="line-numbers"><div>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></div></td><td><div class="objc codecolorer" style="white-space:nowrap">func speechSynthesizer<span style="color: #002200;">(</span>synthesizer<span style="color: #002200;">:</span> AVSpeechSynthesizer<span style="color: #002200;">!</span>, didFinishSpeechUtterance utterance<span style="color: #002200;">:</span> AVSpeechUtterance<span style="color: #002200;">!</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; <span style="color: #a61390;">if</span> currentUtterance <span style="color: #002200;">==</span> totalUtterances <span style="color: #002200;">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; ...<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; unselectLastWord<span style="color: #002200;">(</span><span style="color: #002200;">)</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; previousSelectedRange <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span><br>
&nbsp; &nbsp; <span style="color: #002200;">}</span> &nbsp; &nbsp;<br>
<span style="color: #002200;">}</span></div></td></tr></tbody></table></div>
<p>That’s all. Now, every time the synthesizer speaks, the spoken word will be highlighted with an orange color.</p>
<h2>Summary</h2>
<p>Now that we have reached the end of the tutorial, I hope you’ve enjoyed it as much as I did while I was writing it. If you’re thinking to develop an application that will feature the text to speech technology, you have no reason to hesitate anymore. As you witnessed, implementing and handling the TTS essentials is a really easy and straightforward process, and for the more tricky parts regarding the tracking of the progress and the spoken text highlighting you’ve been given with some useful guidelines that will help you stay in track. There are many ways that a text to speech app can be exploited, but focusing on the “funnier” side of it, it’s definitely amusing to hear your iPhone saying whatever you dictate it to. Having nothing more to say, I leave you play with the app, and I farewell you, hoping that you’ve obtained important benefits out of this tutorial.</p>
<p>For your reference, you can <a href="https://www.dropbox.com/s/kkow9st8ra3mlpj/SpeechDemo.zip?dl=0">download the final project here</a>. As always, leave me comment to share your thought on the tutorial.</p>

<!-- Quick Adsense WordPress Plugin: http://quicksense.net/ -->
<div style="float:none;margin:20px 0 20px 0;text-align:center;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8501671653071605";
/* Appcoda_336_280_Ad */
google_ad_slot = "4009415334";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/show_ads.js">
</script><ins id="aswift_2_expand" style="display:inline-table;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:336px;background-color:transparent"><ins id="aswift_2_anchor" style="display:block;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:336px;background-color:transparent"><iframe width="336" height="280" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;"></iframe></ins></ins>
</div>

<div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div><h3>You May Like These:</h3><div style="clear: both"></div><div style="border: 0pt none ; margin: 0pt; padding: 0pt;"><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/model-view-controller-delete-table-row-from-uitableview/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2012/06/Delete-Row-Featured-Image-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Delete a Row from UITableView and Model-View-Controller</div></div></a><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/ios-game-tutorial-maze-part-1/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2013/04/Simple-Maze-Game-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Creating a Simple Maze Game for iPhone - Part 1</div></div></a><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/understanding-key-value-observing-coding/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2014/08/kvo-featured-150x150.png) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Understanding Key-Value Observing and Coding</div></div></a><a onmouseout="this.style.backgroundColor=&#39;#FFFFFF&#39;" onmouseover="this.style.backgroundColor=&#39;#EEEEEF&#39;" style="background-color: #FFFFFF; border-right: 1px solid #DDDDDD; border-bottom: medium none; margin: 0pt; padding: 6px; display: block; float: left; text-decoration: none; text-align: left; cursor: pointer;" href="http://www.appcoda.com/local-notifications-ios8/"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; width: 150px; height: 225px;"><div style="border: 0pt none ; margin: 0pt; padding: 0pt; background: transparent url(http://www.appcoda.com/wp-content/uploads/2014/12/ios8-local-notification-150x150.jpg) no-repeat scroll 0% 0%; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous; width: 150px; height: 150px;"></div><div style="border: 0pt none; margin: 3px 0pt 0pt; padding: 0pt; font-family: ; font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; line-height: normal; font-size-adjust: none; font-stretch: normal; -x-system-font: none; color: #333333;">Creating Interactive Local Notifications in iOS 8</div></div></a></div><div style="clear: both"></div><span class="et_social_bottom_trigger"></span><!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="http://www.appcoda.com/text-to-speech-ios-tutorial/"
    dc:identifier="http://www.appcoda.com/text-to-speech-ios-tutorial/"
    dc:title="Building a Text to Speech App Using AVSpeechSynthesizer"
    trackback:ping="http://www.appcoda.com/text-to-speech-ios-tutorial/trackback/" />
</rdf:RDF>-->
</div><div class="post-meta"><span class="categories">Filed Under: <a href="http://www.appcoda.com/course/" rel="category tag">Course</a>, <a href="http://www.appcoda.com/course/intermediate/" rel="category tag">Intermediate</a>, <a href="http://www.appcoda.com/swift-2/" rel="category tag">Swift</a>, <a href="http://www.appcoda.com/tutorials/" rel="category tag">Tutorials</a></span> <span class="tags">Tagged With: <a href="http://www.appcoda.com/tag/avspeechsynthesizer/" rel="tag">AVSpeechSynthesizer</a>, <a href="http://www.appcoda.com/tag/ios-8/" rel="tag">iOS 8</a>, <a href="http://www.appcoda.com/tag/ios-programming/" rel="tag">iOS Programming</a>, <a href="http://www.appcoda.com/tag/swift/" rel="tag">swift</a>, <a href="http://www.appcoda.com/tag/text-to-speech/" rel="tag">text-to-speech</a></span></div><div class="after-post widget-area"><div id="text-8" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Free Chapters of Our Swift Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignright size-medium wp-image-4153" style="width:26.31578947368421%;"></a>If you want to create an app but don't know where to begin, this book covers the whole aspect of Swift programming and iOS 8 development and shows you every step from an idea to a real app on App Store. This book features a lot of hands-on exercises and projects. You will first create a simple app, then prototype an app idea, and later add some features to it in each chapter, until a real app is built. Want to learn more? <a href="http://www.appcoda.com/swift/">Check it out here and get three free chapters.</a>
<p></p>
<br></div>
		</div></div>
<div id="featured-page-2" class="widget featured-content featuredpage"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for our Free Tutorials</h4>
<div class="post-38 page type-page status-publish has-post-thumbnail hentry entry"><ul>
<li>Learn iOS Programming From Scratch</li>
<li>Step by Step Guide to Build Your First iPhone App</li>
<li>Complete Source Code for Your Reference</li>
<li>More Programming Tips and Tutorials to Come</li>
</ul>
<div class="enews">
<h4 class="widgettitle">Whatcha waiting for?</h4>
<form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" placeholder="Enter your email address" required=""><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button"><br>
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw"><br>
</form>
</div>
</div></div></div>
</div></div><div class="author-box"><div><img alt="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/582c964c3dafd700a4df627225d859fe" srcset="http://2.gravatar.com/avatar/582c964c3dafd700a4df627225d859fe?s=140&amp;d=mm&amp;r=g 2x" class="avatar avatar-70 photo" height="70" width="70"> <strong>About Gabriel Theodoropoulos</strong><br><p>Gabriel has been a software developer for about two decades. He has long experience in developing software solutions for various platforms in many programming languages. Since middle-2010 he has been developing almost exclusively for iOS. Tutorials consist of the best way to share knowledge with people all over the world. Follow Gabriel at <a href="http://plus.google.com/+gabrieltheodoropoulos">Google+</a> and <a href="https://twitter.com/gabtheodor">Twitter</a>.</p>
</div></div>
<div id="disqus_thread"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="about:blank" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 0px !important;"></iframe></div>

<script type="text/javascript">
var disqus_url = 'http://www.appcoda.com/text-to-speech-ios-tutorial/';
var disqus_identifier = '4837 http://www.appcoda.com/?p=4837';
var disqus_container_id = 'disqus_thread';
var disqus_shortname = 'appcoda';
var disqus_title = "Building a Text to Speech App Using AVSpeechSynthesizer";
var disqus_config_custom = window.disqus_config;
var disqus_config = function () {
    /*
    All currently supported events:
    onReady: fires when everything is ready,
    onNewComment: fires when a new comment is posted,
    onIdentify: fires when user is authenticated
    */
    
    
    this.language = '';
        this.callbacks.onReady.push(function () {

        // sync comments in the background so we don't block the page
        var script = document.createElement('script');
        script.async = true;
        script.src = '?cf_action=sync_comments&post_id=4837';

        var firstScript = document.getElementsByTagName('script')[0];
        firstScript.parentNode.insertBefore(script, firstScript);
    });
    
    if (disqus_config_custom) {
        disqus_config_custom.call(this);
    }
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

</div><div id="sidebar" class="sidebar widget-area"><div id="search-4" class="widget widget_search"><div class="widget-wrap"><form role="search" method="get" id="searchform" class="searchform" action="http://www.appcoda.com/">
                    <div><label class="screen-reader-text" for="s">Search for:</label>
                    <input type="text" value="" name="s" id="s">
                    <input type="submit" id="searchsubmit" value="Search">
                    </div>
                    </form></div></div>
<div id="text-2" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Sign Up for Our Free Tutorials</h4>
			<div class="textwidget"><div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" placeholder="Enter your email address" required=""><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw">
</form>
</div></div>
		</div></div>
<div id="text-6" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><!-- BuySellAds Zone Code -->
<div id="bsap_1283996" class="bsap_1283996 bsap"></div>
<!-- End BuySellAds Zone Code --></div>
		</div></div>
<div id="text-4" class="widget widget_text"><div class="widget-wrap">			<div class="textwidget"><div class="fb-like-box" data-href="http://www.facebook.com/appcodamobile" data-width="300" data-height="260" data-show-faces="true" data-border-color="#F1F1F1" data-stream="false" data-header="false"></div></div>
		</div></div>
		<div id="recent-posts-3" class="widget widget_recent_entries"><div class="widget-wrap">		<h4 class="widget-title widgettitle">Recent Posts</h4>
		<ul>
					<li>
				<a href="http://www.appcoda.com/qr-code-generator-tutorial/">Building a QR Code Generator with Core Image Filters</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/react-native-introduction/">Introduction to React Native: Building iOS Apps with JavaScript</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/cloudkit-introduction-tutorial/">Working with CloudKit in iOS 8</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/instagram-app-parse-swift/">Building an Instagram-Like App with Parse and Swift</a>
						</li>
					<li>
				<a href="http://www.appcoda.com/google-maps-api-tutorial/">A Swift Tutorial for Google Maps SDK</a>
						</li>
				</ul>
		</div></div>
<div id="wp_insert_ad_widget-3" class="widget widget_wp_insert_ad_widget"><div class="widget-wrap"><div class="wpInsert wpInsertAdWidget" style="margin: 5px; padding: 0px;"><script async="" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/adsbygoogle.js"></script>
<!-- Premium Large Skyscraper -->
<ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-8501671653071605" data-ad-slot="6120307730" data-adsbygoogle-status="done"><ins id="aswift_3_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_3_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div></div></div>
<div id="nav_menu-3" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar" class="menu"><li id="menu-item-57" class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li id="menu-item-58" class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li id="menu-item-59" class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li id="menu-item-68" class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
</div></div></div></div><div id="footer-widgets" class="footer-widgets"><div class="wrap"><div class="footer-widgets-1 widget-area"><div id="nav_menu-4" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">About AppCoda</h4>
<div class="menu-default-container"><ul id="menu-default-1" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="http://www.appcoda.com/about/">About</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-28"><a href="http://www.appcoda.com/tutorials/">Tutorials</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-530"><a href="http://www.appcoda.com/ios-programming-course/">Course</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3045"><a title="Swift Programming Book for iOS 8" href="http://www.appcoda.com/swift">Book</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2140"><a href="http://www.appcoda.com/ios-app-kit/ios-game-kit.html">Game Kit</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-710"><a href="http://www.appcoda.com/marketplace/">Marketplace</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-34"><a href="http://www.appcoda.com/contact/">Contact</a></li>
</ul></div></div></div>
</div><div class="footer-widgets-2 widget-area"><div id="text-9" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Get Our New Book</h4>
			<div class="textwidget"><a href="http://www.appcoda.com/swift/"><img src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/swift-book-cover-227x300.png" alt="Beginning iOS 8 Programming with Swift" class="alignleft size-medium wp-image-4153"></a></div>
		</div></div>
</div><div class="footer-widgets-3 widget-area"><div id="nav_menu-5" class="widget widget_nav_menu"><div class="widget-wrap"><h4 class="widget-title widgettitle">Connect With Us</h4>
<div class="menu-sidebar-container"><ul id="menu-sidebar-1" class="menu"><li class="social-twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="http://twitter.com/appcodamobile">Twitter</a></li>
<li class="social-facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="http://facebook.com/appcodamobile">Facebook</a></li>
<li class="social-rss menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="http://feeds.feedburner.com/appcoda">RSS</a></li>
<li class="social-plus menu-item menu-item-type-custom menu-item-object-custom menu-item-68"><a href="https://plus.google.com/b/118438564257465271998/">Google Plus</a></li>
</ul></div></div></div>
<div id="text-3" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Email Newsletter</h4>
			<div class="textwidget"><p>Sign up to receive free tutorial and
to hear what's going on with AppCoda!</p>
<div class="enews"><form action="http://sendy.appcoda.com/sendy/subscribe" method="post" id="subscribe" name="mc-embedded-subscribe-form" class="validate" target="_blank" accept-charset="utf-8">
	<input type="email" id="subbox" value="" name="email" class="email" placeholder="Enter your email address" required=""><input type="submit" value="Subscribe" name="subscribe" id="subbutton" class="button">
	<input type="hidden" name="list" value="KEdC8BeT8EC8znOnfjSQAw">
</form>
</div></div>
		</div></div>
</div></div></div><div id="footer" class="footer"><div class="wrap">    <p>© Copyright 2015 <a href="http://appcoda.com/">AppCoda</a> · All Rights Reserved · Powered by <a href="http://wordpress.org/">WordPress · </a><a href="http://www.appcoda.com/privacy-policy">Privacy Policy</a> · <a href="http://www.appcoda.com/terms-of-service/">Terms of Service</a></p>
    </div></div></div><!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
<script src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/prism.js"></script>        <script type="text/javascript">
        // <![CDATA[
        var disqus_shortname = 'appcoda';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script'); 
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        // ]]>
        </script>
                    <!-- Version: 0.3.3 -->
            <script type="text/javascript">
                var EjSocialSlideoutJsApi_Settings =
                {
                    SliderImage: "<img width=\"150\" height=\"150\" src=\"http:\/\/www.appcoda.com\/wp-content\/uploads\/2015\/04\/appcoda-300-150x150.png\" class=\"attachment-thumbnail\" alt=\"appcoda-300\" \/>",
                    SocialProfiles: {"Facebook":{"Name":"Facebook","NetworkId":"Facebook","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Facebook","Description":"And get free tutorial updates"},"Twitter":{"Name":"Twitter","NetworkId":"Twitter","IsActive":true,"Id":"appcodamobile","Title":"Follow Us on Twitter","Description":"And get free tutorial updates"}},
                    Preview: false
                                    };

                if (typeof (EjSocialSlideoutJsApi) !== "undefined")
                    EjSocialSlideoutJsApi.SettingsLoaded(EjSocialSlideoutJsApi_Settings);
            </script>
            <div id="ej-ss-slideout-dom-templates" style="display:none"><div id="ej-ss-slideout-dom-template-facebook"><div class="fb-follow" data-href="https://www.facebook.com/appcodamobile" data-width="210" data-colorscheme="light" data-layout="standard" data-show-faces="true"></div></div><div id="ej-ss-slideout-dom-template-twitter"><a href="https://twitter.com/appcodamobile" class="twitter-follow-button" data-show-count="true" data-size="medium">Follow @appcodamobile</a></div></div><div class="et_social_sidebar_networks et_social_visible_sidebar et_social_slideright et_social_animated et_social_rectangle et_social_sidebar_flip et_social_sidebar_withcounts et_social_withtotalcount et_social_mobile_off" style="top: 197.5px;">
					<div class="et_social_totalcount et_social_dark">
							<span class="et_social_totalcount_count et_social_total_share" data-post_id="4837"><span class="et_social_placeholder"></span></span>
							<span class="et_social_totalcount_label">Shares</span>
						</div>
					<ul class="et_social_icons_container"><li class="et_social_facebook">
									<a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&t=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="4837" data-social_type="share">
										<i class="et_social_icon et_social_icon_facebook"></i>
										
										<div class="et_social_count"><span>57</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_twitter">
									<a href="http://twitter.com/share?text=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer&url=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="4837" data-social_type="share">
										<i class="et_social_icon et_social_icon_twitter"></i>
										
										<div class="et_social_count"><span>23</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_googleplus">
									<a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&t=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="4837" data-social_type="share">
										<i class="et_social_icon et_social_icon_googleplus"></i>
										
										<div class="et_social_count"><span>2</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li><li class="et_social_linkedin">
									<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&title=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="4837" data-social_type="share">
										<i class="et_social_icon et_social_icon_linkedin"></i>
										
										<div class="et_social_count"><span>1</span></div>
										<span class="et_social_overlay"></span>
									</a>
								</li></ul>
					<span class="et_social_hide_sidebar et_social_icon"></span>
				</div><div class="et_social_flyin et_social_resize et_social_flyin_bottom_right et_social_slideup et_social_trigger_bottom et_social_mobile_on">
					<a href="http://www.appcoda.com/text-to-speech-ios-tutorial/#" class="et_social_icon et_social_icon_cancel"></a>
					<div class="et_social_header">
						<h3>Share This</h3>
						<p>Share this post with your friends!</p>
					</div>
					<div class="et_social_networks et_social_2col et_social_slide et_social_rectangle et_social_left et_social_withnetworknames">
						
						<ul class="et_social_icons_container"><li class="et_social_facebook"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&t=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer" class="et_social_share" rel="nofollow" data-social_name="facebook" data-post_id="4837" data-social_type="share"><i class="et_social_icon et_social_icon_facebook"></i><div class="et_social_network_label"><div class="et_social_networkname">Facebook</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_twitter"><a href="http://twitter.com/share?text=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer&url=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&via=appcodamobile" class="et_social_share" rel="nofollow" data-social_name="twitter" data-post_id="4837" data-social_type="share"><i class="et_social_icon et_social_icon_twitter"></i><div class="et_social_network_label"><div class="et_social_networkname">Twitter</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_googleplus"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&t=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer" class="et_social_share" rel="nofollow" data-social_name="googleplus" data-post_id="4837" data-social_type="share"><i class="et_social_icon et_social_icon_googleplus"></i><div class="et_social_network_label"><div class="et_social_networkname">Google+</div></div><span class="et_social_overlay"></span></a></li><li class="et_social_linkedin"><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fwww.appcoda.com%2Ftext-to-speech-ios-tutorial%2F&title=Building%20a%20Text%20to%20Speech%20App%20Using%20AVSpeechSynthesizer" class="et_social_share" rel="nofollow" data-social_name="linkedin" data-post_id="4837" data-social_type="share"><i class="et_social_icon et_social_icon_linkedin"></i><div class="et_social_network_label"><div class="et_social_networkname">LinkedIn</div></div><span class="et_social_overlay"></span></a></li></ul>
					</div>
				</div><span></span><style type="text/css" class="fluid-images">img{max-width:100%;height:auto;}</style><div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_http" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="http://static.ak.facebook.com/connect/xd_arbiter/KTWTb9MY5lw.js?version=41#channel=f38512270&origin=http%3A%2F%2Fwww.appcoda.com" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="https://s-static.ak.facebook.com/connect/xd_arbiter/KTWTb9MY5lw.js?version=41#channel=f38512270&origin=http%3A%2F%2Fwww.appcoda.com" style="border: none;"></iframe></div></div></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><script type="text/javascript">
/* <![CDATA[ */
var mejsL10n = {"language":"en-US","strings":{"Close":"Close","Fullscreen":"Fullscreen","Download File":"Download File","Download Video":"Download Video","Play\/Pause":"Play\/Pause","Mute Toggle":"Mute Toggle","None":"None","Turn off Fullscreen":"Turn off Fullscreen","Go Fullscreen":"Go Fullscreen","Unmute":"Unmute","Mute":"Mute","Captions\/Subtitles":"Captions\/Subtitles"}};
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/"};
/* ]]> */
</script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/mediaelement-and-player.min.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/wp-mediaelement.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/jquery.form.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/www.appcoda.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ...","cached":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/scripts.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/idle-timer.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var monarchSettings = {"ajaxurl":"http:\/\/www.appcoda.com\/wp-admin\/admin-ajax.php","pageurl":"http:\/\/www.appcoda.com\/text-to-speech-ios-tutorial\/","stats_nonce":"8c81aa481c","share_counts":"467408ffd2","follow_counts":"001478b52c","total_counts":"29892eac0e","media_single":"8dcef85eb3","media_total":"957c5aa407","generate_all_window_nonce":"f853c5d5ce","no_img_message":"No images available for sharing on this page"};
/* ]]> */
</script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/custom.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/comment-reply.min.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/superfish.min.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/superfish.args.min.js"></script>
<script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/superfish.compat.min.js"></script>
<!-- This site converts visitors into subscribers and customers with the OptinMonster WordPress plugin v2.1.6.6 - http://optinmonster.com/ -->
<div id="om-d7egu9k5k9-lightbox" class="optin-monster-overlay" style="display:none;"><script type="text/javascript" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/webfont.js"></script><style type="text/css" class="om-theme-case-study-styles">.optin-monster-success-message {font-size: 21px;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;color: #282828;font-weight: 300;text-align: center;margin: 0 auto;}.optin-monster-success-overlay .om-success-close {font-size: 32px !important;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif !important;color: #282828 !important;font-weight: 300 !important;position: absolute !important;top: 0px !important;right: 10px !important;background: none !important;text-decoration: none !important;width: auto !important;height: auto !important;display: block !important;line-height: 32px !important;padding: 0 !important;}.om-helper-field {display: none !important;visibility: hidden !important;opacity: 0 !important;height: 0 !important;line-height: 0 !important;}html div#om-d7egu9k5k9-lightbox * {box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;}html div#om-d7egu9k5k9-lightbox {background:none;border:0;border-radius:0;-webkit-border-radius:0;-moz-border-radius:0;float:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing: grayscale;height:auto;letter-spacing:normal;outline:none;position:static;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;margin:0;padding:0;line-height:1;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-shadow:none;-moz-box-shadow:none;-ms-box-shadow:none;-o-box-shadow:none;box-shadow:none;-webkit-appearance:none;}html div#om-d7egu9k5k9-lightbox {background: rgb(0, 0, 0);background: rgba(0, 0, 0, .7);font-family: helvetica,arial,sans-serif;-moz-osx-font-smoothing: grayscale;-webkit-font-smoothing: antialiased;line-height: 1;width: 100%;height: 100%;}html div#om-d7egu9k5k9-lightbox .om-clearfix {clear: both;}html div#om-d7egu9k5k9-lightbox .om-clearfix:after {clear: both;content: ".";display: block;height: 0;line-height: 0;overflow: auto;visibility: hidden;zoom: 1;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin {background: #fff;display: none;position: absolute;top: 50%;left: 50%;min-height: 175px;max-width: 700px;width: 100%;z-index: 734626274;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-wrap {position: relative;height: 100%;}html div#om-d7egu9k5k9-lightbox .om-close {position: absolute;top: -12px;right: -12px;text-decoration: none !important;display: block;width: 35px;height: 35px;background: url("http://www.appcoda.com/wp-content/plugins/optin-monster/assets/css/images/close.png") no-repeat scroll 0 0;z-index: 1500;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-bar {margin-bottom: 20px;clear: both;}html div#om-d7egu9k5k9-lightbox .om-bar {float: left;width: 25%;height: 11px;display: block;}html div#om-d7egu9k5k9-lightbox .om-red-bar {background-color: #ef3e36;}html div#om-d7egu9k5k9-lightbox .om-green-bar {background-color: #abb92e;}html div#om-d7egu9k5k9-lightbox .om-orange-bar {background-color: #f57826;}html div#om-d7egu9k5k9-lightbox .om-blue-bar {background-color: #17b4e9;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-header {min-height: 30px;padding: 15px;width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-title {font-size: 24px;color: #484848;width: 100%;margin-bottom: 15px;text-shadow: 0 1px #fff;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-tagline {font-size: 16px;line-height: 1.25;color: #484848;width: 100%;margin-bottom: 30px;text-shadow: 0 1px #fff;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-content {padding: 15px;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left {float: left;max-width: 280px;width: 100%;position: relative;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-image-container {position: relative;max-width: 280px;max-height: 245px;margin: 0 auto;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-image-container img {display: block;margin: 0 auto;text-align: center;height: auto;max-width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-right {float: right;max-width: 370px;width: 100%;background-color: #dadada;margin-right: -15px;padding: 20px;position: relative;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-arrow {position: absolute;width: 49px;height: 56px;left: -40px;top: -40px;}html div#om-d7egu9k5k9-lightbox label {color: #333;}html div#om-d7egu9k5k9-lightbox input,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email {background-color: #fff;width: 100%;border: 1px solid #ccc;font-size: 16px;line-height: 24px;padding: 10px 6px;overflow: hidden;outline: none;margin: 0 0 15px;vertical-align: middle;height: 46px;}html div#om-d7egu9k5k9-lightbox input[type=submit],html div#om-d7egu9k5k9-lightbox button,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-submit {background: #484848;border: 1px solid #484848;width: 100%;color: #fff;font-size: 20px;padding: 12px 6px;line-height: 28px;text-align: center;vertical-align: middle;cursor: pointer;margin: 0;height: 54px;}html div#om-d7egu9k5k9-lightbox input[type=checkbox],html div#om-d7egu9k5k9-lightbox input[type=radio] {-webkit-appearance: checkbox;width: auto;outline: invert none medium;padding: 0;margin: 0;}@media (max-width: 700px) {html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin[style] {width: 100%;position: relative;}html div#om-d7egu9k5k9-lightbox .om-close {right: 9px;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-right,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-submit,html div#om-d7egu9k5k9-lightbox .om-has-email #om-lightbox-case-study-optin-email {float: none;width: 100%;max-width: 100%;}html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-left,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-name,html div#om-d7egu9k5k9-lightbox #om-lightbox-case-study-optin-email {margin-bottom: 15px;}}@media only screen and (-webkit-min-device-pixel-ratio: 2),only screen and (min--moz-device-pixel-ratio: 2),only screen and (-o-min-device-pixel-ratio: 2/1),only screen and (min-device-pixel-ratio: 2),only screen and (min-resolution: 192dpi),only screen and (min-resolution: 2dppx) {html div#om-d7egu9k5k9-lightbox .om-close {background-image: url("http://www.appcoda.com/wp-content/plugins/optin-monster/assets/css/images/<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="5437383b273114662c7a243a33">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>");background-size: 35px 35px;}}</style><div id="om-lightbox-case-study-optin" class="om-lightbox-case-study om-clearfix om-theme-case-study om-custom-html-form"><div id="om-lightbox-case-study-optin-wrap" class="om-clearfix"><a href="http://www.appcoda.com/text-to-speech-ios-tutorial/#" class="om-close" title="Close"></a><div id="om-lightbox-case-study-optin-bar" class="om-clearfix"><span class="om-bar om-red-bar"></span><span class="om-bar om-green-bar"></span><span class="om-bar om-orange-bar"></span><span class="om-bar om-blue-bar"></span></div><div id="om-lightbox-case-study-header" class="om-clearfix"><div id="om-lightbox-case-study-optin-title" data-om-action="editable" data-om-field="title" style="color:#484848;font-family:Bree Serif;font-size:32px;text-align:center;"><span style="font-family:montserrat;">FREE Swift Programming Course</span></div><div id="om-lightbox-case-study-optin-tagline" data-om-action="editable" data-om-field="tagline" style="color:#484848;font-family:Open Sans;font-size:24px;text-align:center;"><span style="font-family:montserrat;">Sign up today and get a 7 day email course with free tips and ebook chapters for starting app development.</span></div></div><div id="om-lightbox-case-study-content" class="om-clearfix"><div id="om-lightbox-case-study-left"><div id="om-lightbox-case-study-optin-image-container" class="om-image-container om-clearfix"><img class="optin-monster-image optin-monster-image-lightbox-case-study" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/swift-free-course-280x245.jpg" alt="" title="swift-free-course"></div></div><div id="om-lightbox-case-study-right"><img id="om-lightbox-case-study-arrow" src="./Building a Text to Speech App Using AVSpeechSynthesizer_files/arrow.png" alt="Arrow"><form action="http://sendy.appcoda.com/sendy/subscribe" method="POST" accept-charset="utf-8">
<input id="om-lightbox-case-study-optin-name" type="text" name="name" value="" data-om-action="selectable" data-om-target="#optin-monster-field-name_field" placeholder="Enter your name here..." style="color:#484848;font-family:Montserrat;">
<input id="om-lightbox-case-study-optin-email" type="email" name="email" value="" data-om-action="selectable" data-om-target="#optin-monster-field-email_field" placeholder="Enter your email address here..." style="color:#484848;font-family:Montserrat;">
<input id="om-lightbox-case-study-optin-submit" type="submit" data-om-action="selectable" data-om-target="#optin-monster-field-submit_field" value="Send me the course" style="color:#ffffff;background-color:#484848;border-color:#484848;font-family:Montserrat;">
<input type="hidden" name="list" value="neAW97jagVmb3C3O892VnnLA">
</form></div></div></div><input type="email" name="email" value="" class="om-helper-field"><input type="text" name="website" value="" class="om-helper-field"></div><script type="text/javascript">jQuery(document).ready(function($){WebFont.load({google: {families: ['Montserrat%7CBree+Serif%7COpen+Sans']}});});</script></div>
<script type="text/javascript">var d7egu9k5k9_lightbox, omo = {"id":4744,"optin":"d7egu9k5k9-lightbox","campaign":"Free Swift Programming Course","clones":[""],"hash":"d7egu9k5k9-lightbox","optin_js":"d7egu9k5k9_lightbox","type":"lightbox","theme":"case-study","cookie":30,"delay":5000,"second":0,"exit":1,"redirect":"","redirect_pass":false,"custom":true,"test":false,"global_cookie":23320,"preview":false,"ajax":"http:\/\/www.appcoda.com\/?optin-monster-ajax-route=1","mobile":false,"post_id":4837,"preloader":"http:\/\/www.appcoda.com\/wp-content\/plugins\/optin-monster\/assets\/css\/images\/preloader.gif","error":"There was an error with your submission. Please try again.","ajax_error":"There was an error with the AJAX request: ","name_error":"Please enter a valid name.","email_error":"Please enter a valid email address.","bot_error":"Honeypot fields have been activated. Your submission is being flagged as potential spam.","success":"Thanks for subscribing! Please check your email for further instructions.","exit_sensitivity":20}; d7egu9k5k9_lightbox = new OptinMonster(); d7egu9k5k9_lightbox.init(omo);</script>
<!--[if lte IE 9]><script type="text/javascript">var om_ie_browser = true;</script><![endif]--><!-- / OptinMonster WordPress plugin. -->



<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced

 Served from: www.appcoda.com @ 2015-05-05 17:00:32 by W3 Total Cache --></body></html>